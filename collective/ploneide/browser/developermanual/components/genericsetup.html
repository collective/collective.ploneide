<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Add-on installation and export framework: GenericSetup &mdash; Plone Community Managed Developer Manual v1.0 documentation</title>
    <link rel="stylesheet" href="../_static/plone.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '1.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="top" title="Plone Community Managed Developer Manual v1.0 documentation" href="../index.html" />
    <link rel="up" title="Component architecture" href="index.html" />
    <link rel="next" title="Customizing Plone" href="customizing_plone.html" />
    <link rel="prev" title="Grok framework" href="grok.html" />
<script language="javascript">
//<![CDATA[

Documentation.addTranslations({"locale": "fr", "plural_expr": "(n > 1)", "messages": {"See the definition": "Voir la d\u00e9finition"}});

// See http://disqus.disqus.com/general_integration_help/
var disqus_developer = 1;
if (document.location.protocol == 'http:') {
    disqus_developer = 0;
}

// Some HTML/CSS transforms we can't do in pure CSS (waiting for CSS3 support)
$(document).ready(function () {

    // Style of .. verisonmodified:: , .. versionadded:: ...
    $('p:has(span.versionmodified)').addClass('p-versionmodified');

    // Style of the TOC tree
    $('ul:has(li.toctree-l1)').addClass('toctree');

    // Decorate links to other sites
    $('a[class~=external]').attr('target', '_blank');

    // Glossary terms
    $('em.xref').attr('title', _('See the definition'));

    // We need to have all <pre> in a <div class="highlight"> to mimic pygments
    // to work around a pygments (?) bug
    var suffixes = {cfg: null, python:null};
    for (var suffix in suffixes) {
        var pattern = 'div.highlight-' + suffix + ' > pre';
        $(pattern).wrap('<div class="highlight" />');
    }
    return true;
});
//]]>
</script>

  </head>
  <body>
<!--[if lte IE 6]>
<style type="text/css">
#ie6msg{border:3px solid #090; margin:8px 0; background:#cfc; color:#000;}
#ie6msg h4{margin:8px; padding:0;}
#ie6msg p{margin:8px; padding:0;}
#ie6msg p a.getie8{font-weight:bold; color:#006;}
#ie6msg p a.ie6expl{font-weight:normal; color:#006;}
</style>
<div id="ie6msg">
<h4>Did you know that your browser is out of date?</h4>
<p>If the layout of this site seems ugly, that's because you're actually using
an outdated browser. And we wont put any effort to provide a nice layout to IE6
users.</p>
<p>To get the best possible experience using our website we recommend that you
upgrade your browser to a newer version. The current version
is <a class="getie8"
href="http://upgradeie.s3.amazonaws.com/eng/index.html">Internet Explorer
8</a>. The upgrade is free. If you're using a PC at work you should contact your
IT administrator.</p>
<p>If you want to you may also try some other popular Internet browsers
like <a class="ie6expl"
href="http://getfirefox.com">Firefox</a>, <a class="ie6expl"
href="http://www.google.com/chrome">Chrome</a>, <a class="ie6expl"
href="http://www.opera.com">Opera</a>, or <a class="ie6expl"
href="http://www.apple.com/safari/download/">Safari</a></p>
</div>
<![endif]-->

    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="customizing_plone.html" title="Customizing Plone"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="grok.html" title="Grok framework"
             accesskey="P">previous</a> |</li>
        <li><a href="../index.html">Plone Community Managed Developer Manual v1.0 documentation</a> &raquo;</li>
          <li><a href="index.html" accesskey="U">Component architecture</a> &raquo;</li> 
      </ul>
    </div>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="sphinx-content">
    <div class="section" id="add-on-installation-and-export-framework-genericsetup">
<h1>Add-on installation and export framework: GenericSetup<a class="headerlink" href="#add-on-installation-and-export-framework-genericsetup" title="Permalink to this headline">¶</a></h1>
<div class="admonition-description admonition ">
<p class="first admonition-title">Description</p>
<p class="last">GenericSetup is a framework to modify the Plone site during add-on
product installation and uninstallation. It provides XML-based rules
to change the site settings easily.</p>
</div>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><a class="reference internal" href="#introduction" id="id1">Introduction</a></li>
<li><a class="reference internal" href="#creating-a-profile" id="id2">Creating a profile</a></li>
<li><a class="reference internal" href="#add-on-specific-issues" id="id3">Add-on-specific issues</a></li>
<li><a class="reference internal" href="#listing-available-profiles" id="id4">Listing available profiles</a></li>
<li><a class="reference internal" href="#installing-a-profile" id="id5">Installing a profile</a><ul>
<li><a class="reference internal" href="#plonetestcase-setupplonesite" id="id6">PloneTestCase.setupPloneSite</a></li>
<li><a class="reference internal" href="#manually" id="id7">Manually</a></li>
</ul>
</li>
<li><a class="reference internal" href="#uninstall-profile" id="id8">Uninstall profile</a></li>
<li><a class="reference internal" href="#dependencies" id="id9">Dependencies</a></li>
<li><a class="reference internal" href="#custom-installer-code-setuphandlers-py" id="id10">Custom installer code (setuphandlers.py)</a></li>
<li><a class="reference internal" href="#overriding-import-step-order" id="id11">Overriding import step order</a><ul>
<li><a class="reference internal" href="#controlling-the-import-step-execution-order" id="id12">Controlling the import step execution order</a></li>
</ul>
</li>
<li><a class="reference internal" href="#upgrade-steps" id="id13">Upgrade steps</a></li>
<li><a class="reference internal" href="#add-on-product-appears-twice-in-the-installer-list" id="id14">Add-on product appears twice in the installer list</a></li>
<li><a class="reference internal" href="#preventing-uninstall" id="id15">Preventing uninstall</a></li>
<li><a class="reference internal" href="#plone-genericsetup-reference" id="id16">Plone GenericSetup Reference</a><ul>
<li><a class="reference internal" href="#module-plone.app.portlets.exportimport.portlets" id="id17">portlets.xml</a></li>
<li><a class="reference internal" href="#module-plone.app.viewletmanager.exportimport.storage" id="id18">viewlets.xml</a></li>
<li><a class="reference internal" href="#cssregistry-xml" id="id19">cssregistry.xml</a></li>
<li><a class="reference internal" href="#jsregistry-xml" id="id20">jsregistry.xml</a></li>
<li><a class="reference internal" href="#kssregistry-xml" id="id21">kssregistry.xml</a></li>
<li><a class="reference internal" href="#module-Products.ResourceRegistries.exportimport.resourceregistry" id="id22">Resource Registries</a></li>
<li><a class="reference internal" href="#module-Products.GenericSetup.content" id="id23">Content Generation</a></li>
</ul>
</li>
<li><a class="reference internal" href="#module-plone.app.workflow.exportimport" id="id24">sharing.xml</a><ul>
<li><a class="reference internal" href="#tinymce-xml" id="id25">tinymce.xml</a></li>
<li><a class="reference internal" href="#propertiestool-xml" id="id26">propertiestool.xml</a></li>
<li><a class="reference internal" href="#metadata-xml" id="id27">metadata.xml</a></li>
<li><a class="reference internal" href="#actions-xml" id="id28">actions.xml</a></li>
<li><a class="reference internal" href="#skins-xml" id="id29">skins.xml</a></li>
<li><a class="reference internal" href="#module-Products.DCWorkflow.exportimport" id="id30">workflows.xml</a></li>
<li><a class="reference internal" href="#repositorytool-xml" id="id31">repositorytool.xml</a></li>
<li><a class="reference internal" href="#module-plone.app.contentrules.exportimport" id="id32">contentrules.xml</a></li>
<li><a class="reference internal" href="#best-practices" id="id33">Best Practices</a></li>
</ul>
</li>
</ul>
</div>
<div class="section" id="introduction">
<h2><a class="toc-backref" href="#id1">Introduction</a><a class="headerlink" href="#introduction" title="Permalink to this headline">¶</a></h2>
<p>GenericSetup is an XML-based way to import and export Plone site configurations.</p>
<p>It is mainly used to prepare the Plone site for add-on products, by:</p>
<ul class="simple">
<li>registering CSS files,</li>
<li>registering Javascript files,</li>
<li>setting various properties,</li>
<li>registering portlets,</li>
<li>registering portal_catalog search query indexes,</li>
<li>...and so on...</li>
</ul>
<p>GenericSetup is mostly used to apply add-on-specific changes to the site
configuration, and to enable add-on-specific behavior when the add-on
installer is run.</p>
<p>GenericSetup XML files are usually in a <tt class="docutils literal"><span class="pre">profiles/default</span></tt> folder inside
the add-on product.</p>
<p>All run-time configurable items, like viewlets order through
<tt class="docutils literal"><span class="pre">/&#64;&#64;manage-viewlets</span></tt> page, are made repeatable using GenericSetup profile
files.</p>
<p>You do not need to hand-edit GenericSetup profile files.
You can always change the configuration options through Plone
or using the Zope Management Interface. Then you can export the resulting
profile as an XML file, using the <em>Export</em> tab in the <tt class="docutils literal"><span class="pre">portal_setup</span></tt> ZMI
tool.</p>
<p>Directly
editing XML profile files does not change anything on the site, even after
Zope restart. This is because run-time configurable items are stored in the
database. If you edit profile files, you need reimport edited files using
the <tt class="docutils literal"><span class="pre">portal_setup</span></tt> tool or rerun the add-on product installer in Plone
control panel. This import will read XML files and change Plone database
accordingly.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>Difference between ZCML and GenericSetup</p>
<p>ZCML changes affect loaded Python code in
<strong>all</strong> sites inside Zope whereas
GenericSetup XML files affect only one Plone site and its database.
GenericSetup XML files are always database changes.</p>
<p class="last">Relationship between ZCML and site-specific behavior is usually done
using <a class="reference internal" href="../views/layers.html"><em>layers</em></a>. ZCML
directives, like viewlets and views, are registered
to be active on a certain layer only using <cite>layer</cite>
attribute. When GenericSetup XML is imported
through <tt class="docutils literal"><span class="pre">portal_setup</span></tt>, or the product add-on installer is
run for a Plone site, the layer is activated for the
particular site only, enabling all views registered
for this layer.</p>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The <tt class="docutils literal"><span class="pre">metadata.xml</span></tt> file (add-on dependency and version
information) is read during Plone start-up.
If this file has problems your add-on might not appear in the installer control panel.</p>
</div>
<ul class="simple">
<li><a class="reference external" href="http://plone.org/documentation/tutorial/genericsetup">GenericSetup tutorial</a></li>
<li><a class="reference external" href="http://pypi.python.org/pypi/Products.GenericSetup/1.4.5">GenericSetup product page</a>.</li>
<li><a class="reference external" href="http://svn.zope.org/Products.GenericSetup/trunk/Products/GenericSetup/README.txt?rev=87436&amp;view=auto">Source code</a>.</li>
</ul>
</div>
<div class="section" id="creating-a-profile">
<h2><a class="toc-backref" href="#id2">Creating a profile</a><a class="headerlink" href="#creating-a-profile" title="Permalink to this headline">¶</a></h2>
<p>You use <tt class="docutils literal"><span class="pre">&lt;genericsetup&gt;</span></tt> directive in your add-on product's <tt class="docutils literal"><span class="pre">configure.zcml</span></tt>.
The name for the default profile executed by the Plone add-on installer
is &quot;default&quot;. If you need different profiles for e.g. unit testing
you can declare them here.</p>
<p>Profile XML files go in the <tt class="docutils literal"><span class="pre">profiles/default</span></tt> folder inside your add-on
product.</p>
<div class="highlight-xml"><div class="highlight"><pre><span class="nt">&lt;configure</span>
    <span class="na">xmlns=</span><span class="s">&quot;http://namespaces.zope.org/zope&quot;</span>
    <span class="na">xmlns:genericsetup=</span><span class="s">&quot;http://namespaces.zope.org/genericsetup&quot;</span>
    <span class="na">i18n_domain=</span><span class="s">&quot;gomobile.mobile&quot;</span><span class="nt">&gt;</span>

    <span class="nt">&lt;genericsetup:registerProfile</span>
      <span class="na">name=</span><span class="s">&quot;default&quot;</span>
      <span class="na">title=</span><span class="s">&quot;Plone Go Mobile&quot;</span>
      <span class="na">directory=</span><span class="s">&quot;profiles/default&quot;</span>
      <span class="na">description=</span><span class="s">&#39;Mobile CMS add-on&#39;</span>
      <span class="na">provides=</span><span class="s">&quot;Products.GenericSetup.interfaces.EXTENSION&quot;</span>
      <span class="nt">/&gt;</span>

<span class="nt">&lt;/configure&gt;</span>
</pre></div>
</div>
</div>
<div class="section" id="add-on-specific-issues">
<h2><a class="toc-backref" href="#id3">Add-on-specific issues</a><a class="headerlink" href="#add-on-specific-issues" title="Permalink to this headline">¶</a></h2>
<p>Add-on products may contain:</p>
<ul class="simple">
<li>A default GenericSetup XML profile which is automatically run when the
product is installed using the quick-installer. The profile name is
&quot;default&quot;.</li>
<li>Other profiles which the user may install using the <tt class="docutils literal"><span class="pre">portal_setup</span></tt> <em>Import</em> tab, or which can be manually enabled for unit tests.</li>
<li>An &quot;Import various&quot; step, which runs Python code every time the GenericSetup XML profile is installed.</li>
</ul>
<p>For more information about custom import steps, see:</p>
<ul class="simple">
<li><a class="reference external" href="http://n2.nabble.com/indexing-of-content-created-by-Generic-Setup-tp4454703p4454703.html">http://n2.nabble.com/indexing-of-content-created-by-Generic-Setup-tp4454703p4454703.html</a></li>
</ul>
</div>
<div class="section" id="listing-available-profiles">
<h2><a class="toc-backref" href="#id4">Listing available profiles</a><a class="headerlink" href="#listing-available-profiles" title="Permalink to this headline">¶</a></h2>
<p>Example:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c"># Run the default quick installer profile</span>
<span class="n">setup_tool</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">portal</span><span class="o">.</span><span class="n">portal_setup</span>

<span class="n">profiles</span> <span class="o">=</span> <span class="n">setup_tool</span><span class="o">.</span><span class="n">listProfileInfo</span><span class="p">()</span>
<span class="k">for</span> <span class="n">profile</span> <span class="ow">in</span> <span class="n">profiles</span><span class="p">:</span>
    <span class="k">print</span>  <span class="nb">str</span><span class="p">(</span><span class="n">profile</span><span class="p">)</span>
</pre></div>
</div>
<p>Results:</p>
<div class="highlight-python"><pre>{'product': 'PluggableAuthService', 'description': 'Content for an empty PAS (plugins registry only).', 'for': &lt;InterfaceClass Products.PluggableAuthService.interfaces.authservice.IPluggableAuthService&gt;, 'title': 'Empty PAS Content Profile', 'version': 'PluggableAuthService-1.5.3', 'path': 'profiles/empty', 'type': 1, 'id': 'PluggableAuthService:empty'}
{'product': 'Products.CMFDefault', 'description': u'Profile for a default CMFSite.', 'for': &lt;InterfaceClass Products.CMFCore.interfaces._content.ISiteRoot&gt;, 'title': u'CMFDefault Site', 'version': 'CMF-2.1.1', 'path': u'profiles/default', 'type': 1, 'id': u'Products.CMFDefault:default'}
{'product': 'Products.CMFPlone', 'description': u'Profile for a default Plone.', 'for': &lt;InterfaceClass Products.CMFPlone.interfaces.siteroot.IPloneSiteRoot&gt;, 'title': u'Plone Site', 'version': u'3.1.7', 'path': u'/home/moo/sits/parts/plone/CMFPlone/profiles/default', 'type': 1, 'id': u'Products.CMFPlone:plone'}
{'product': 'Products.Archetypes', 'description': u'Extension profile for default Archetypes setup.', 'for': None, 'title': u'Archetypes', 'version': u'1.5.7', 'path': u'/home/moo/sits/parts/plone/Archetypes/profiles/default', 'type': 2, 'id': u'Products.Archetypes:Archetypes'}
...</pre>
</div>
</div>
<div class="section" id="installing-a-profile">
<h2><a class="toc-backref" href="#id5">Installing a profile</a><a class="headerlink" href="#installing-a-profile" title="Permalink to this headline">¶</a></h2>
<p>This is usually unit test specific question how to enable certain add-ons for unit testing.</p>
<div class="section" id="plonetestcase-setupplonesite">
<h3><a class="toc-backref" href="#id6">PloneTestCase.setupPloneSite</a><a class="headerlink" href="#plonetestcase-setupplonesite" title="Permalink to this headline">¶</a></h3>
<p>See <em>Running add-on installers and extensions profiles for unit tests</em>.</p>
</div>
<div class="section" id="manually">
<h3><a class="toc-backref" href="#id7">Manually</a><a class="headerlink" href="#manually" title="Permalink to this headline">¶</a></h3>
<p>You might want to install profiles manually if they need to be enabled only for certain tests.</p>
<p>The profile name is in the format <tt class="docutils literal"><span class="pre">profile-${product</span> <span class="pre">name}:${profile</span> <span class="pre">id}</span></tt></p>
<p>Unit testing example:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c"># Run the extended profile which will create email_catalog</span>
<span class="n">setup_tool</span><span class="o">.</span><span class="n">runAllImportStepsFromProfile</span><span class="p">(</span><span class="s">&#39;profile-betahaus.emaillogin:exdended&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="uninstall-profile">
<h2><a class="toc-backref" href="#id8">Uninstall profile</a><a class="headerlink" href="#uninstall-profile" title="Permalink to this headline">¶</a></h2>
<p>For the theory, see:
<a class="reference external" href="http://plone.org/documentation/kb/genericsetup/creating-an-uninstall-profile">http://plone.org/documentation/kb/genericsetup/creating-an-uninstall-profile</a></p>
<p>For an example, see the <a class="reference external" href="http://svn.plone.org/svn/collective/collective.pdfpeek/trunk/collective/pdfpeek/profiles/">collective.pdfpeek source code</a>.</p>
</div>
<div class="section" id="dependencies">
<h2><a class="toc-backref" href="#id9">Dependencies</a><a class="headerlink" href="#dependencies" title="Permalink to this headline">¶</a></h2>
<p>GenericSetup profile can contain dependencies to other add-on product installers and profiles.</p>
<ul class="simple">
<li><a class="reference external" href="http://plone.org/products/plone/roadmap/195/">More information about GenericSetup dependencies</a>.</li>
</ul>
<p>For example, if you want to declare dependency to <em>collective.basket</em> add-on product, so that it
is automatically installed when your add-on installed you can use the declaration below.
This way, you can be sure that all layers, portlets, etc. features which require database changes
are usable from <em>collective.basket</em> add-on products when your add-on product is run.</p>
<p><tt class="docutils literal"><span class="pre">metadata.xml</span></tt>:</p>
<div class="highlight-xml"><div class="highlight"><pre><span class="cp">&lt;?xml version=&quot;1.0&quot;?&gt;</span>
<span class="nt">&lt;metadata&gt;</span>
  <span class="c">&lt;!-- We do not declare &lt;version&gt; here because Plone 3.3+ picks the version from setup.py file --&gt;</span>
  <span class="nt">&lt;dependencies&gt;</span>
    <span class="nt">&lt;dependency&gt;</span>profile-collective.basket:default<span class="nt">&lt;/dependency&gt;</span>
  <span class="nt">&lt;/dependencies&gt;</span>
<span class="nt">&lt;/metadata&gt;</span>
</pre></div>
</div>
<p><em>collective.basket</em> declares the profile in its configure.zcml:</p>
<div class="highlight-xml"><div class="highlight"><pre><span class="nt">&lt;genericsetup:registerProfile</span>
          <span class="na">name=</span><span class="s">&quot;default&quot;</span>
          <span class="na">title=</span><span class="s">&quot;collective.basket&quot;</span>
          <span class="na">directory=</span><span class="s">&quot;profiles/default&quot;</span>
          <span class="na">description=</span><span class="s">&#39;Collector portlet framework&#39;</span>
          <span class="na">provides=</span><span class="s">&quot;Products.GenericSetup.interfaces.EXTENSION&quot;</span>
          <span class="nt">/&gt;</span>
</pre></div>
</div>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">Unlike other GenericSetup XML files, metadata.xml is read on the start-up and this read is cached.
Always restart Plone after editing metadata.xml. If your metadata.xml contains syntax errors
or dependencies to a missing product (typo in name) your add-on will disapper from the
Installation control panel.</p>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Products.* Python namespace need to declare generic setup dependencies specially.
You actually do not mention Products.xxx space.</p>
</div>
<p>To declare dependency to <tt class="docutils literal"><span class="pre">Products.Carousel</span></tt>:</p>
<div class="highlight-xml"><div class="highlight"><pre><span class="cp">&lt;?xml version=&quot;1.0&quot;?&gt;</span>
<span class="nt">&lt;metadata&gt;</span>
  <span class="c">&lt;!-- Install Products.Carousel on the site when this add-on is installed --&gt;</span>
  <span class="nt">&lt;dependencies&gt;</span>
    <span class="nt">&lt;dependency&gt;</span>profile-Carousel:default<span class="nt">&lt;/dependency&gt;</span>
  <span class="nt">&lt;/dependencies&gt;</span>
<span class="nt">&lt;/metadata&gt;</span>
</pre></div>
</div>
</div>
<div class="section" id="custom-installer-code-setuphandlers-py">
<h2><a class="toc-backref" href="#id10">Custom installer code (setuphandlers.py)</a><a class="headerlink" href="#custom-installer-code-setuphandlers-py" title="Permalink to this headline">¶</a></h2>
<p>Besides out-of-the-box XML steps which easily provide both install and uninstall,
GenericSetup provides a way to run a custom Python code when your
add-on product is installed and uninstalled.
This is not very straightforward process, though.</p>
<p>The best practice is to create a <tt class="docutils literal"><span class="pre">setuphandlers.py</span></tt> file
which contains function <tt class="docutils literal"><span class="pre">setupVarious()</span></tt> which runs required
Python code to make changes to Plone site object.
This function is registerd as a custom <tt class="docutils literal"><span class="pre">genericsetup:importStep</span></tt>
in XML.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">When you do custom importSteps remember to write uninstallation
code as well.</p>
</div>
<p>However, the trick is that all GenericSetup import steps, including
your custom step, are run for <em>every</em> add-on product
when they are installed. Thus, if your need to run
code which is specific <strong>during your add-on install only</strong>
you need to use a marker text file which is checked by GenericSetup
context.</p>
<p>Also you need to register this custom import step in <tt class="docutils literal"><span class="pre">configure.zcml</span></tt></p>
<div class="highlight-xml"><div class="highlight"><pre><span class="nt">&lt;configure</span>
  <span class="na">xmlns=</span><span class="s">&quot;http://namespaces.zope.org/zope&quot;</span>
  <span class="na">xmlns:genericsetup=</span><span class="s">&quot;http://namespaces.zope.org/genericsetup&quot;</span><span class="nt">&gt;</span>

        <span class="c">&lt;!-- Register the import step --&gt;</span>
        <span class="nt">&lt;genericsetup:importStep</span>
            <span class="na">name=</span><span class="s">&quot;your.package&quot;</span>
            <span class="na">title=</span><span class="s">&quot;your.package special import handlers&quot;</span>
            <span class="na">description=</span><span class="s">&quot;&quot;</span>
            <span class="na">handler=</span><span class="s">&quot;your.package.setuphandlers.setupVarious&quot;</span> <span class="nt">/&gt;</span>
            /&gt;

<span class="nt">&lt;/configure&gt;</span>
</pre></div>
</div>
<p><tt class="docutils literal"><span class="pre">setuphandlers.py</span></tt> example</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">__docformat__</span> <span class="o">=</span> <span class="s">&quot;epytext&quot;</span>

<span class="k">def</span> <span class="nf">runCustomCode</span><span class="p">(</span><span class="n">site</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Run custom add-on product installation code to modify Plone site object and others</span>

<span class="sd">    @param site: Plone site</span>
<span class="sd">    &quot;&quot;&quot;</span>

<span class="k">def</span> <span class="nf">setupVarious</span><span class="p">(</span><span class="n">context</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    @param context: Products.GenericSetup.context.DirectoryImportContext instance</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c"># We check from our GenericSetup context whether we are running</span>
    <span class="c"># add-on installation for your product or any other proudct</span>
    <span class="k">if</span> <span class="n">context</span><span class="o">.</span><span class="n">readDataFile</span><span class="p">(</span><span class="s">&#39;your.package.marker.txt&#39;</span><span class="p">)</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="c"># Not your add-on</span>
        <span class="k">return</span>

    <span class="n">portal</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="n">getSite</span><span class="p">()</span>

    <span class="n">runCustomCode</span><span class="p">(</span><span class="n">portal</span><span class="p">)</span>
</pre></div>
</div>
<p>And add a dummy text file <tt class="docutils literal"><span class="pre">your.package/your/package/profiles/default/your.package.marker.txt</span></tt>:</p>
<div class="highlight-python"><pre>This text file can contain any content - it just needs to be present</pre>
</div>
<p>More information</p>
<ul class="simple">
<li><a class="reference external" href="http://keeshink.blogspot.com/2009/02/creating-portal-content-in.html">http://keeshink.blogspot.com/2009/02/creating-portal-content-in.html</a></li>
<li><a class="reference external" href="http://maurits.vanrees.org/weblog/archive/2009/12/catalog">http://maurits.vanrees.org/weblog/archive/2009/12/catalog</a> (unrelated, but contains pointers)</li>
</ul>
</div>
<div class="section" id="overriding-import-step-order">
<h2><a class="toc-backref" href="#id11">Overriding import step order</a><a class="headerlink" href="#overriding-import-step-order" title="Permalink to this headline">¶</a></h2>
<p>You need <tt class="docutils literal"><span class="pre">import_steps.xml</span></tt>.</p>
<p>More information</p>
<ul class="simple">
<li><a class="reference external" href="http://plone.293351.n2.nabble.com/Overriding-import-step-order-td2189638.html">http://plone.293351.n2.nabble.com/Overriding-import-step-order-td2189638.html</a></li>
<li><a class="reference external" href="http://dev.communesplone.org/trac/browser/communesplone/urban/trunk/profiles/default/import_steps.xml?rev=5652">http://dev.communesplone.org/trac/browser/communesplone/urban/trunk/profiles/default/import_steps.xml?rev=5652</a></li>
</ul>
<div class="section" id="controlling-the-import-step-execution-order">
<h3><a class="toc-backref" href="#id12">Controlling the import step execution order</a><a class="headerlink" href="#controlling-the-import-step-execution-order" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><a class="reference external" href="http://plone.293351.n2.nabble.com/indexing-of-content-created-by-Generic-Setup-td4454703.html">http://plone.293351.n2.nabble.com/indexing-of-content-created-by-Generic-Setup-td4454703.html</a></li>
</ul>
</div>
</div>
<div class="section" id="upgrade-steps">
<h2><a class="toc-backref" href="#id13">Upgrade steps</a><a class="headerlink" href="#upgrade-steps" title="Permalink to this headline">¶</a></h2>
<p>You can define upgrade steps to run code only when someone upgrades your
product from version <em>x</em> to <em>y</em>.</p>
<p>As an example, let's say that the new version 1.2 of YOUR.PRODUCT defines a
<em>price</em> field on a content type <em>MyType</em> to be a string, but previously
(version 1.1.  and earlier) it was a float. Code that uses this field and
assumes it to be a float will break after the upgrade, so you'd like to
automatically convert existing values for the field to string.</p>
<p>(Obviously, you could do this very quickly in a simple script, but having a
GenericSetup upgrade step means non-technical people can do it as well. As it
turns out, once you have the script, it's easy to put its code in an upgrade
step.)</p>
<p>We add the upgrade step to the profile:</p>
<div class="highlight-python"><pre>.. code-block:: xml</pre>
</div>
<blockquote>
<dl class="docutils">
<dt>&lt;genericsetup:upgradeStep</dt>
<dd>title=&quot;Convert Price to strings&quot;
description=&quot;Price was previously a float field, it should be converted to string&quot;
source=&quot;*&quot;
destination=&quot;1.2&quot;
handler=&quot;YOUR.PRODUCT.setuphandlers.convert_price_to_string&quot;
sortkey=&quot;1&quot;
profile=&quot;YOUR.PRODUCT:default&quot;
/&gt;</dd>
</dl>
</blockquote>
<ul class="simple">
<li>You can use a wildcard character for <em>source</em> to indicate an upgrade for any
previous version. To run the upgrade step only when upgrading from a specific
version, use that version's number.</li>
<li>The <em>sortkey</em> can be used to indicate the order in which upgrade steps are
run.</li>
</ul>
<p>The code for the upgrade method itself is best placed in <em>setuphandlers.py</em>:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">logging</span>
<span class="n">PROFILE_ID</span><span class="o">=</span><span class="s">&#39;profile-YOUR.PRODUCT:default&#39;</span>

<span class="k">def</span> <span class="nf">convert_price_to_string</span><span class="p">(</span><span class="n">context</span><span class="p">,</span> <span class="n">logger</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Method to convert float Price fields to string.</span>

<span class="sd">    When called from the import_various method, &#39;context&#39; is</span>
<span class="sd">    the plone site and &#39;logger&#39; is the portal_setup logger.</span>

<span class="sd">    But this method will be used as upgrade step, in which case &#39;context&#39;</span>
<span class="sd">    will be portal_setup and &#39;logger&#39; will be None.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">logger</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="c"># Called as upgrade step: define our own logger.</span>
        <span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s">&#39;YOUR.PRODUCT&#39;</span><span class="p">)</span>

    <span class="c"># Run the catalog.xml step as that may have defined new metadata</span>
    <span class="c"># columns.  We could instead add &lt;depends name=&quot;catalog&quot;/&gt; to</span>
    <span class="c"># the registration of our import step in zcml, but doing it in</span>
    <span class="c"># code makes this method usable as upgrade step as well.</span>
    <span class="c"># Remove these lines when you have no catalog.xml file.</span>
    <span class="n">setup</span> <span class="o">=</span> <span class="n">getToolByName</span><span class="p">(</span><span class="n">context</span><span class="p">,</span> <span class="s">&#39;portal_setup&#39;</span><span class="p">)</span>
    <span class="n">setup</span><span class="o">.</span><span class="n">runImportStepFromProfile</span><span class="p">(</span><span class="n">PROFILE_ID</span><span class="p">,</span> <span class="s">&#39;catalog&#39;</span><span class="p">)</span>

    <span class="n">catalog</span> <span class="o">=</span> <span class="n">getToolByName</span><span class="p">(</span><span class="n">context</span><span class="p">,</span> <span class="s">&#39;portal_catalog&#39;</span><span class="p">)</span>
    <span class="n">brains</span> <span class="o">=</span> <span class="n">catalog</span><span class="p">(</span><span class="n">portal_type</span><span class="o">=</span><span class="s">&#39;MyType&#39;</span><span class="p">)</span>
    <span class="n">count</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">brain</span> <span class="ow">in</span> <span class="n">brains</span><span class="p">:</span>
        <span class="n">current_price</span> <span class="o">=</span> <span class="n">brain</span><span class="o">.</span><span class="n">getPrice</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">current_price</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">type</span><span class="p">(</span><span class="s">&#39;a string&#39;</span><span class="p">):</span>
            <span class="n">voorstelling</span> <span class="o">=</span> <span class="n">brain</span><span class="o">.</span><span class="n">getObject</span><span class="p">()</span>
            <span class="n">voorstelling</span><span class="o">.</span><span class="n">setPrice</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">current_price</span><span class="p">))</span>
            <span class="n">voorstelling</span><span class="o">.</span><span class="n">reindexObject</span><span class="p">()</span>
            <span class="n">count</span> <span class="o">=</span> <span class="n">count</span> <span class="o">+</span> <span class="mi">1</span>

    <span class="n">setup</span><span class="o">.</span><span class="n">runImportStepFromProfile</span><span class="p">(</span><span class="n">PROFILE_ID</span><span class="p">,</span> <span class="s">&#39;catalog&#39;</span><span class="p">)</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s">&quot;</span><span class="si">%s</span><span class="s"> fields converted.&quot;</span> <span class="o">%</span> <span class="n">count</span><span class="p">)</span>
</pre></div>
</div>
<p>Other examples of using generic setup to run import steps are below</p>
<p>If you want to call types.xml use typeinfo:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">setup</span><span class="o">.</span><span class="n">runImportStepFromProfile</span><span class="p">(</span><span class="n">PROFILE_ID</span><span class="p">,</span> <span class="s">&#39;typeinfo&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>If you want to call workflow.xml use workflow:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">setup</span><span class="o">.</span><span class="n">runImportStepFromProfile</span><span class="p">(</span><span class="n">PROFILE_ID</span><span class="p">,</span> <span class="s">&#39;workflow&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>The ids of the various default import steps are defined in the import_steps.xml of CMFDefault.
visit it at <a class="reference external" href="http://svn.zope.org/CMF/branches/2.1/CMFDefault/profiles/default/import_steps.xml?logsort=date&amp;rev=78624&amp;view=markup">http://svn.zope.org/CMF/branches/2.1/CMFDefault/profiles/default/import_steps.xml?logsort=date&amp;rev=78624&amp;view=markup</a></p>
<p>XXX Fix the link above</p>
<p>After restarting Zope, your upgrade step should be visible in the ZMI: The
<em>portal_setup</em> tool has a tab <em>Upgrades</em>. Select your product profile to see
which upgrade steps Zope knows about for your product.</p>
</div>
<div class="section" id="add-on-product-appears-twice-in-the-installer-list">
<h2><a class="toc-backref" href="#id14">Add-on product appears twice in the installer list</a><a class="headerlink" href="#add-on-product-appears-twice-in-the-installer-list" title="Permalink to this headline">¶</a></h2>
<p>This happens if you are developing your own add-on and keep changing things.
You have an error in your add-on product ZCML code which causes
portal_quickinstaller to have two entries.</p>
<p>More information</p>
<ul class="simple">
<li><a class="reference external" href="http://plone.293351.n2.nabble.com/Product-twice-in-quickinstaller-td5345492.html#a5345492">http://plone.293351.n2.nabble.com/Product-twice-in-quickinstaller-td5345492.html#a5345492</a></li>
</ul>
</div>
<div class="section" id="preventing-uninstall">
<h2><a class="toc-backref" href="#id15">Preventing uninstall</a><a class="headerlink" href="#preventing-uninstall" title="Permalink to this headline">¶</a></h2>
<p>You might want to prevent your add-on product uninstall for some reason.</p>
<p>Example:</p>
<div class="highlight-python"><pre>.. code-block:: python</pre>
</div>
<blockquote>
<p>from zExceptions import BadRequest</p>
<dl class="docutils">
<dt>def uninstall(self, reinstall):</dt>
<dd><dl class="first last docutils">
<dt>if reinstall==False:</dt>
<dd>raise BadRequest(&quot;This product cannot be uninstalled!&quot;)</dd>
</dl>
</dd>
</dl>
</blockquote>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">This example if for Extensions/install.py, old Plone 2 way of writing installers</p>
</div>
</div>
<div class="section" id="plone-genericsetup-reference">
<h2><a class="toc-backref" href="#id16">Plone GenericSetup Reference</a><a class="headerlink" href="#plone-genericsetup-reference" title="Permalink to this headline">¶</a></h2>
<div class="section" id="module-plone.app.portlets.exportimport.portlets">
<span id="portlets-xml"></span><h3><a class="toc-backref" href="#id17">portlets.xml</a><a class="headerlink" href="#module-plone.app.portlets.exportimport.portlets" title="Permalink to this headline">¶</a></h3>
<p>When creating custom portlet managers, you will need to extend
existing portlets to be addable to that manager:</p>
<div class="highlight-python"><pre>&lt;portlet extend="True" addview="portlets.Calendar"&gt;
  &lt;for interface="my.package.interfaces.ICustomPortletManager"/&gt;
&lt;/portlet&gt;</pre>
</div>
<p>You can also change the title and description of the portlet with the
extend attribute:</p>
<div class="highlight-python"><pre>&lt;portlet
  extend="True"
  title="Dates of inquisition"
  description="Nobody expects the SpanishInquisition!"
  addview="portlets.Calendar"/&gt;</pre>
</div>
<p>Remove a portlet definition using the 'remove' attribute so that it can
no longer be added via &#64;&#64;manage-portlets. This does not remove
any assignments:</p>
<div class="highlight-python"><pre>&lt;portlet remove="True" addview="portlets.Calendar"/&gt;</pre>
</div>
</div>
<div class="section" id="module-plone.app.viewletmanager.exportimport.storage">
<span id="viewlets-xml"></span><h3><a class="toc-backref" href="#id18">viewlets.xml</a><a class="headerlink" href="#module-plone.app.viewletmanager.exportimport.storage" title="Permalink to this headline">¶</a></h3>
<p>The following examples would all be added into the viewlets.xml file.</p>
<dl class="docutils">
<dt>Re-order viewlets: ::</dt>
<dd><p class="first">&lt;order manager=&quot;plone.portaltop&quot; skinname=&quot;Plone 
Default&quot;&gt;</p>
<blockquote>
&lt;viewlet name=&quot;plone.header&quot;/&gt;
&lt;viewlet name=&quot;plone.personal_bar&quot;/&gt;</blockquote>
<p class="last">&lt;/order&gt;</p>
</dd>
</dl>
<p>Move a viewlet using insert-before and insert-after (this will only affect 
the skinname that is specified, in this case 'My Custom Theme') ::</p>
<div class="highlight-python"><pre>&lt;order manager="plone.portalheader" skinname="My 
Custom Theme" based-on="Plone Default"&gt;
  &lt;viewlet name="plone.global_sections" insertbefore="*"/&gt;
  &lt;viewlet name="plone.site_actions" insertafter="plone.searchbox"/&gt;
&lt;/order&gt;</pre>
</div>
<p>Hide a viewlet (here we hide the colophon for 'My Custom Theme'):</p>
<div class="highlight-python"><pre>&lt;hidden manager="plone.portalfooter" skinname="My
Custom Theme"&gt;
  &lt;viewlet name="plone.colophon"/&gt;
&lt;/hidden&gt;</pre>
</div>
<p>Unhide a specific viewlet using the remove attribute:</p>
<div class="highlight-python"><pre>&lt;hidden manager="plone.portalfooter" skinname="My
Custom Theme"&gt;
  &lt;viewlet name="plone.colophon" remove="True"/&gt;
&lt;/hidden&gt;</pre>
</div>
<p>Unhide all viewlets for a given manager using the purge attribute:</p>
<div class="highlight-python"><pre>&lt;hidden manager="plone.portalfooter" skinname="My
Custom Theme" purge="True"/&gt;</pre>
</div>
<p>Hide a viewlet for all skins:</p>
<div class="highlight-python"><pre>&lt;hidden manager="plone.portalfooter" skinname="*"&gt;
  &lt;viewlet name="plone.colophon"/&gt;
&lt;/hidden&gt;</pre>
</div>
<p>Pro Tip: Using skinname=&quot;*&quot; currently only works if the manager has
already been registered in each skin (see Plone Trac ticket #7166)</p>
</div>
<div class="section" id="cssregistry-xml">
<h3><a class="toc-backref" href="#id19">cssregistry.xml</a><a class="headerlink" href="#cssregistry-xml" title="Permalink to this headline">¶</a></h3>
<p>see <a class="reference internal" href="#resourceregistries"><em>Resource Registries</em></a></p>
</div>
<div class="section" id="jsregistry-xml">
<h3><a class="toc-backref" href="#id20">jsregistry.xml</a><a class="headerlink" href="#jsregistry-xml" title="Permalink to this headline">¶</a></h3>
<p>see <a class="reference internal" href="#resourceregistries"><em>Resource Registries</em></a></p>
</div>
<div class="section" id="kssregistry-xml">
<h3><a class="toc-backref" href="#id21">kssregistry.xml</a><a class="headerlink" href="#kssregistry-xml" title="Permalink to this headline">¶</a></h3>
<p>see <a class="reference internal" href="#resourceregistries"><em>Resource Registries</em></a></p>
</div>
<div class="section" id="module-Products.ResourceRegistries.exportimport.resourceregistry">
<span id="resource-registries"></span><span id="resourceregistries"></span><h3><a class="toc-backref" href="#id22">Resource Registries</a><a class="headerlink" href="#module-Products.ResourceRegistries.exportimport.resourceregistry" title="Permalink to this headline">¶</a></h3>
</div>
<div class="section" id="module-Products.GenericSetup.content">
<span id="content-generation"></span><h3><a class="toc-backref" href="#id23">Content Generation</a><a class="headerlink" href="#module-Products.GenericSetup.content" title="Permalink to this headline">¶</a></h3>
<p>Filesystem exporter / importer adapters.</p>
<p>$Id: content.py 110425 2010-04-01 17:19:14Z tseaver $</p>
<dl class="class">
<dt id="Products.GenericSetup.content.FolderishExporterImporter">
<em class="property">class </em><tt class="descclassname">Products.GenericSetup.content.</tt><tt class="descname">FolderishExporterImporter</tt><big>(</big><em>context</em><big>)</big><a class="headerlink" href="#Products.GenericSetup.content.FolderishExporterImporter" title="Permalink to this definition">¶</a></dt>
<dd><p>Tree-walking exporter / importer for &quot;folderish&quot; types.</p>
<p>Folderish instances are mapped to directories within the 'structure'
portion of the profile, where the folder's relative path within the site
corresponds to the path of its directory under 'structure'.</p>
<p>The subobjects of a folderish instance are enumerated in the '.objects'
file in the corresponding directory.  This file is a CSV file, with one
row per subobject, with the following wtructure:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="s">&quot;&lt;subobject id&gt;&quot;</span><span class="p">,</span><span class="s">&quot;&lt;subobject portal_type&gt;&quot;</span>
</pre></div>
</div>
<p>Subobjects themselves are represented as individual files or
subdirectories within the parent's directory.</p>
<dl class="method">
<dt id="Products.GenericSetup.content.FolderishExporterImporter.export">
<tt class="descname">export</tt><big>(</big><em>export_context</em>, <em>subdir</em>, <em>root=False</em><big>)</big><a class="headerlink" href="#Products.GenericSetup.content.FolderishExporterImporter.export" title="Permalink to this definition">¶</a></dt>
<dd><p>See IFilesystemExporter.</p>
</dd></dl>

<dl class="method">
<dt id="Products.GenericSetup.content.FolderishExporterImporter.import_">
<tt class="descname">import_</tt><big>(</big><em>import_context</em>, <em>subdir</em>, <em>root=False</em><big>)</big><a class="headerlink" href="#Products.GenericSetup.content.FolderishExporterImporter.import_" title="Permalink to this definition">¶</a></dt>
<dd><p>See IFilesystemImporter.</p>
</dd></dl>

<dl class="method">
<dt id="Products.GenericSetup.content.FolderishExporterImporter.listExportableItems">
<tt class="descname">listExportableItems</tt><big>(</big><big>)</big><a class="headerlink" href="#Products.GenericSetup.content.FolderishExporterImporter.listExportableItems" title="Permalink to this definition">¶</a></dt>
<dd><p>See IFilesystemExporter.</p>
</dd></dl>

</dd></dl>

</div>
</div>
<div class="section" id="module-plone.app.workflow.exportimport">
<span id="sharing-xml"></span><h2><a class="toc-backref" href="#id24">sharing.xml</a><a class="headerlink" href="#module-plone.app.workflow.exportimport" title="Permalink to this headline">¶</a></h2>
<div class="section" id="tinymce-xml">
<h3><a class="toc-backref" href="#id25">tinymce.xml</a><a class="headerlink" href="#tinymce-xml" title="Permalink to this headline">¶</a></h3>
</div>
<div class="section" id="propertiestool-xml">
<h3><a class="toc-backref" href="#id26">propertiestool.xml</a><a class="headerlink" href="#propertiestool-xml" title="Permalink to this headline">¶</a></h3>
</div>
<div class="section" id="metadata-xml">
<h3><a class="toc-backref" href="#id27">metadata.xml</a><a class="headerlink" href="#metadata-xml" title="Permalink to this headline">¶</a></h3>
</div>
<div class="section" id="actions-xml">
<h3><a class="toc-backref" href="#id28">actions.xml</a><a class="headerlink" href="#actions-xml" title="Permalink to this headline">¶</a></h3>
</div>
<div class="section" id="skins-xml">
<h3><a class="toc-backref" href="#id29">skins.xml</a><a class="headerlink" href="#skins-xml" title="Permalink to this headline">¶</a></h3>
</div>
<div class="section" id="module-Products.DCWorkflow.exportimport">
<span id="workflows-xml"></span><h3><a class="toc-backref" href="#id30">workflows.xml</a><a class="headerlink" href="#module-Products.DCWorkflow.exportimport" title="Permalink to this headline">¶</a></h3>
<p>DCWorkflow export / import support.</p>
<p>$Id: exportimport.py 121521 2011-05-03 13:13:36Z erico_andrei $</p>
</div>
<div class="section" id="repositorytool-xml">
<h3><a class="toc-backref" href="#id31">repositorytool.xml</a><a class="headerlink" href="#repositorytool-xml" title="Permalink to this headline">¶</a></h3>
<dl class="class">
<dt id="Products.CMFEditions.exportimport.repository.RepositoryToolXMLAdapter">
<em class="property">class </em><tt class="descclassname">Products.CMFEditions.exportimport.repository.</tt><tt class="descname">RepositoryToolXMLAdapter</tt><big>(</big><em>context</em>, <em>environ</em><big>)</big><a class="headerlink" href="#Products.CMFEditions.exportimport.repository.RepositoryToolXMLAdapter" title="Permalink to this definition">¶</a></dt>
<dd><p>Mode in- and exporter for RepositoryTool.</p>
</dd></dl>

</div>
<div class="section" id="module-plone.app.contentrules.exportimport">
<span id="contentrules-xml"></span><h3><a class="toc-backref" href="#id32">contentrules.xml</a><a class="headerlink" href="#module-plone.app.contentrules.exportimport" title="Permalink to this headline">¶</a></h3>
</div>
<div class="section" id="best-practices">
<h3><a class="toc-backref" href="#id33">Best Practices</a><a class="headerlink" href="#best-practices" title="Permalink to this headline">¶</a></h3>
<p>When importing items such as property sheets, make sure not to
override other profile settings by setting the purge attribute to False.
This will add the items listed to the property instead of resetting the
property. Example:</p>
<div class="highlight-xml"><div class="highlight"><pre><span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;metaTypesNotToList&quot;</span> <span class="na">type=</span><span class="s">&quot;lines&quot;</span> <span class="na">purge=</span><span class="s">&quot;False&quot;</span><span class="nt">&gt;</span>
 <span class="nt">&lt;element</span> <span class="na">value=</span><span class="s">&quot;File&quot;</span><span class="nt">/&gt;</span>
 <span class="nt">&lt;element</span> <span class="na">value=</span><span class="s">&quot;Image&quot;</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/property&gt;</span>
</pre></div>
</div>
<p>Only use the configuration that you need. When you export your site's
configuration, it will include things that you don't need. For example,
if you needed to change only the 'Allow anonymous to view about'
property, this is what your propertiestool.xml would look like:</p>
<div class="highlight-xml"><pre>&lt;?xml version="1.0"?&gt;
&lt;object name="portal_properties" meta_type="Plone Properties Tool"&gt;
 &lt;object name="site_properties" meta_type="Plone Property Sheet"&gt;
  &lt;property name="allowAnonymousViewAbout"
    type="boolean"&gt;True&lt;/property&gt;
 &lt;/object&gt;
&lt;/object</pre>
</div>
</div>
</div>
</div>

  </div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
<p class="logo"><a href="../index.html"><img src="../_static/plone-icon-64.png" />
</a></p>

  <h3><a href="../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Add-on installation and export framework: GenericSetup</a><ul>
<li><a class="reference internal" href="#introduction">Introduction</a></li>
<li><a class="reference internal" href="#creating-a-profile">Creating a profile</a></li>
<li><a class="reference internal" href="#add-on-specific-issues">Add-on-specific issues</a></li>
<li><a class="reference internal" href="#listing-available-profiles">Listing available profiles</a></li>
<li><a class="reference internal" href="#installing-a-profile">Installing a profile</a><ul>
<li><a class="reference internal" href="#plonetestcase-setupplonesite">PloneTestCase.setupPloneSite</a></li>
<li><a class="reference internal" href="#manually">Manually</a></li>
</ul>
</li>
<li><a class="reference internal" href="#uninstall-profile">Uninstall profile</a></li>
<li><a class="reference internal" href="#dependencies">Dependencies</a></li>
<li><a class="reference internal" href="#custom-installer-code-setuphandlers-py">Custom installer code (setuphandlers.py)</a></li>
<li><a class="reference internal" href="#overriding-import-step-order">Overriding import step order</a><ul>
<li><a class="reference internal" href="#controlling-the-import-step-execution-order">Controlling the import step execution order</a></li>
</ul>
</li>
<li><a class="reference internal" href="#upgrade-steps">Upgrade steps</a></li>
<li><a class="reference internal" href="#add-on-product-appears-twice-in-the-installer-list">Add-on product appears twice in the installer list</a></li>
<li><a class="reference internal" href="#preventing-uninstall">Preventing uninstall</a></li>
<li><a class="reference internal" href="#plone-genericsetup-reference">Plone GenericSetup Reference</a><ul>
<li><a class="reference internal" href="#module-plone.app.portlets.exportimport.portlets">portlets.xml</a></li>
<li><a class="reference internal" href="#module-plone.app.viewletmanager.exportimport.storage">viewlets.xml</a></li>
<li><a class="reference internal" href="#cssregistry-xml">cssregistry.xml</a></li>
<li><a class="reference internal" href="#jsregistry-xml">jsregistry.xml</a></li>
<li><a class="reference internal" href="#kssregistry-xml">kssregistry.xml</a></li>
<li><a class="reference internal" href="#module-Products.ResourceRegistries.exportimport.resourceregistry">Resource Registries</a></li>
<li><a class="reference internal" href="#module-Products.GenericSetup.content">Content Generation</a></li>
</ul>
</li>
<li><a class="reference internal" href="#module-plone.app.workflow.exportimport">sharing.xml</a><ul>
<li><a class="reference internal" href="#tinymce-xml">tinymce.xml</a></li>
<li><a class="reference internal" href="#propertiestool-xml">propertiestool.xml</a></li>
<li><a class="reference internal" href="#metadata-xml">metadata.xml</a></li>
<li><a class="reference internal" href="#actions-xml">actions.xml</a></li>
<li><a class="reference internal" href="#skins-xml">skins.xml</a></li>
<li><a class="reference internal" href="#module-Products.DCWorkflow.exportimport">workflows.xml</a></li>
<li><a class="reference internal" href="#repositorytool-xml">repositorytool.xml</a></li>
<li><a class="reference internal" href="#module-plone.app.contentrules.exportimport">contentrules.xml</a></li>
<li><a class="reference internal" href="#best-practices">Best Practices</a></li>
</ul>
</li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="grok.html"
                        title="previous chapter">Grok framework</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="customizing_plone.html"
                        title="next chapter">Customizing Plone</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="../_sources/components/genericsetup.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" size="18" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="customizing_plone.html" title="Customizing Plone"
             >next</a> |</li>
        <li class="right" >
          <a href="grok.html" title="Grok framework"
             >previous</a> |</li>
        <li><a href="../index.html">Plone Community Managed Developer Manual v1.0 documentation</a> &raquo;</li>
          <li><a href="index.html" >Component architecture</a> &raquo;</li> 
      </ul>
    </div>

    <div class="footer">
        &copy; Copyright 2010 mFabrik Research Oy and Plone community contributors.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.0.4.
    </div>


  </body>
</html>