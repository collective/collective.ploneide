<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Listing objects &mdash; Plone Community Managed Developer Manual v1.0 documentation</title>
    <link rel="stylesheet" href="../_static/plone.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '1.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="top" title="Plone Community Managed Developer Manual v1.0 documentation" href="../index.html" />
    <link rel="up" title="Content management" href="index.html" />
    <link rel="next" title="Manipulating objects" href="manipulating.html" />
    <link rel="prev" title="Creating objects" href="creating.html" />
<script language="javascript">
//<![CDATA[

Documentation.addTranslations({"locale": "fr", "plural_expr": "(n > 1)", "messages": {"See the definition": "Voir la d\u00e9finition"}});

// See http://disqus.disqus.com/general_integration_help/
var disqus_developer = 1;
if (document.location.protocol == 'http:') {
    disqus_developer = 0;
}

// Some HTML/CSS transforms we can't do in pure CSS (waiting for CSS3 support)
$(document).ready(function () {

    // Style of .. verisonmodified:: , .. versionadded:: ...
    $('p:has(span.versionmodified)').addClass('p-versionmodified');

    // Style of the TOC tree
    $('ul:has(li.toctree-l1)').addClass('toctree');

    // Decorate links to other sites
    $('a[class~=external]').attr('target', '_blank');

    // Glossary terms
    $('em.xref').attr('title', _('See the definition'));

    // We need to have all <pre> in a <div class="highlight"> to mimic pygments
    // to work around a pygments (?) bug
    var suffixes = {cfg: null, python:null};
    for (var suffix in suffixes) {
        var pattern = 'div.highlight-' + suffix + ' > pre';
        $(pattern).wrap('<div class="highlight" />');
    }
    return true;
});
//]]>
</script>

  </head>
  <body>
<!--[if lte IE 6]>
<style type="text/css">
#ie6msg{border:3px solid #090; margin:8px 0; background:#cfc; color:#000;}
#ie6msg h4{margin:8px; padding:0;}
#ie6msg p{margin:8px; padding:0;}
#ie6msg p a.getie8{font-weight:bold; color:#006;}
#ie6msg p a.ie6expl{font-weight:normal; color:#006;}
</style>
<div id="ie6msg">
<h4>Did you know that your browser is out of date?</h4>
<p>If the layout of this site seems ugly, that's because you're actually using
an outdated browser. And we wont put any effort to provide a nice layout to IE6
users.</p>
<p>To get the best possible experience using our website we recommend that you
upgrade your browser to a newer version. The current version
is <a class="getie8"
href="http://upgradeie.s3.amazonaws.com/eng/index.html">Internet Explorer
8</a>. The upgrade is free. If you're using a PC at work you should contact your
IT administrator.</p>
<p>If you want to you may also try some other popular Internet browsers
like <a class="ie6expl"
href="http://getfirefox.com">Firefox</a>, <a class="ie6expl"
href="http://www.google.com/chrome">Chrome</a>, <a class="ie6expl"
href="http://www.opera.com">Opera</a>, or <a class="ie6expl"
href="http://www.apple.com/safari/download/">Safari</a></p>
</div>
<![endif]-->

    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="manipulating.html" title="Manipulating objects"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="creating.html" title="Creating objects"
             accesskey="P">previous</a> |</li>
        <li><a href="../index.html">Plone Community Managed Developer Manual v1.0 documentation</a> &raquo;</li>
          <li><a href="index.html" accesskey="U">Content management</a> &raquo;</li> 
      </ul>
    </div>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="sphinx-content">
    <div class="section" id="listing-objects">
<h1>Listing objects<a class="headerlink" href="#listing-objects" title="Permalink to this headline">¶</a></h1>
<div class="admonition-description admonition ">
<p class="first admonition-title">Description</p>
<p class="last">How to programmatically generate folder listings in Plone.</p>
</div>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><a class="reference internal" href="#introduction" id="id1">Introduction</a></li>
<li><a class="reference internal" href="#ensuring-content-item-is-a-folder" id="id2">Ensuring content item is a folder</a></li>
<li><a class="reference internal" href="#getting-all-content-objects-inside-a-folder" id="id3">Getting all content objects inside a folder</a></li>
<li><a class="reference internal" href="#querying-folder-through-catalog" id="id4">Querying folder through catalog</a><ul>
<li><a class="reference internal" href="#getting-indexed-objects" id="id5">Getting indexed objects</a></li>
<li><a class="reference internal" href="#getting-full-objects" id="id6">Getting full objects</a></li>
</ul>
</li>
<li><a class="reference internal" href="#getting-folder-objects-filtered" id="id7">Getting folder objects filtered</a><ul>
<li><a class="reference internal" href="#rules-for-filtering-items" id="id8">Rules for filtering items</a></li>
</ul>
</li>
<li><a class="reference internal" href="#getting-object-ids" id="id9">Getting object ids</a></li>
<li><a class="reference internal" href="#getting-non-contentish-zope-objects" id="id10">Getting non-contentish Zope objects</a></li>
<li><a class="reference internal" href="#checking-for-the-existence-of-a-particular-object-id" id="id11">Checking for the existence of a particular object id</a></li>
<li><a class="reference internal" href="#listing-the-folder-items-using-portal-catalog" id="id12">Listing the folder items using portal_catalog</a></li>
<li><a class="reference internal" href="#count-of-content-items" id="id13">Count of content items</a><ul>
<li><a class="reference internal" href="#counting-items-using-getfoldercontents" id="id14">Counting items using getFolderContents</a></li>
<li><a class="reference internal" href="#counting-items-using-contentitems" id="id15">Counting items using contentItems</a></li>
</ul>
</li>
<li><a class="reference internal" href="#custom-folder-listing" id="id16">Custom folder listing</a><ul>
<li><a class="reference internal" href="#making-view-to-be-available-in-display-menu" id="id17">Making view to be available in Display... menu</a></li>
</ul>
</li>
<li><a class="reference internal" href="#complex-folder-listings-and-filtering" id="id18">Complex folder listings and filtering</a></li>
</ul>
</div>
<div class="section" id="introduction">
<h2><a class="toc-backref" href="#id1">Introduction</a><a class="headerlink" href="#introduction" title="Permalink to this headline">¶</a></h2>
<p>Plone has several methods of getting the list of folder items depending on whether</p>
<ul class="simple">
<li>You want to get all items or items visible for the currently logged in user</li>
<li>You want to get hold of the item objects themselves or just indexed search information is enough
(the latter is faster)</li>
<li>You want to get Plone's contentish items only (contentItems) or Zope 2 management objects too (objectIds),
the latter covers various site utilities found in the portal root and otherwise hidden magical items</li>
</ul>
<p>Special attentation must be paid also on object ids. Zope looks all objects by traversing site graph
using ids. The id mapping is usually the property of a parent object, not child. Thus most of the listing
methods tend to return (id, object) tuples instead of plain objects.</p>
</div>
<div class="section" id="ensuring-content-item-is-a-folder">
<h2><a class="toc-backref" href="#id2">Ensuring content item is a folder</a><a class="headerlink" href="#ensuring-content-item-is-a-folder" title="Permalink to this headline">¶</a></h2>
<p>All Plone folderish content types provide <tt class="docutils literal"><span class="pre">IFolderish</span></tt> interface.
Check that this is present to make sure a content item is a
folder and you can call <tt class="docutils literal"><span class="pre">contentItems()</span></tt> and other methods:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">Products.CMFCore.interfaces</span> <span class="kn">import</span> <span class="n">IFolderish</span>

<span class="k">def</span> <span class="nf">recurse_all_content</span><span class="p">(</span><span class="n">portal</span><span class="p">):</span>

    <span class="n">output</span> <span class="o">=</span> <span class="n">StringIO</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">recurse</span><span class="p">(</span><span class="n">context</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Recurse through all content on Plone site &quot;&quot;&quot;</span>

        <span class="k">print</span>  <span class="o">&gt;&gt;</span> <span class="n">output</span><span class="p">,</span> <span class="s">&quot;Recusring to item:&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">context</span><span class="p">)</span>

        <span class="c"># Make sure that we recurse to real folders only,</span>
        <span class="c"># otherwise contentItems() might be acquired from higher level</span>
        <span class="k">if</span> <span class="n">IFolderish</span><span class="o">.</span><span class="n">providedBy</span><span class="p">(</span><span class="n">context</span><span class="p">):</span>
            <span class="k">for</span> <span class="nb">id</span><span class="p">,</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">context</span><span class="o">.</span><span class="n">contentItems</span><span class="p">():</span>
                <span class="n">recurse</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>

    <span class="n">recurse</span><span class="p">(</span><span class="n">portal</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">output</span>
</pre></div>
</div>
</div>
<div class="section" id="getting-all-content-objects-inside-a-folder">
<h2><a class="toc-backref" href="#id3">Getting all content objects inside a folder</a><a class="headerlink" href="#getting-all-content-objects-inside-a-folder" title="Permalink to this headline">¶</a></h2>
<p>The method contentItems is defined in CMFCore/PortalFolder.py. From
Plone 4 onwards, you can also use folder.items() instead (this applies
to the whole section below).
See source code for details, e.g. filtering and other forms of listing</p>
</div>
<div class="section" id="querying-folder-through-catalog">
<h2><a class="toc-backref" href="#id4">Querying folder through catalog</a><a class="headerlink" href="#querying-folder-through-catalog" title="Permalink to this headline">¶</a></h2>
<p>These methods apply for real folders, and not for collections.</p>
<div class="section" id="getting-indexed-objects">
<h3><a class="toc-backref" href="#id5">Getting indexed objects</a><a class="headerlink" href="#getting-indexed-objects" title="Permalink to this headline">¶</a></h3>
<p>This is a faster method. You must have portal_catalog up-to-date for the folder.
This will return <a class="reference internal" href="../searching_and_indexing/query.html"><em>brain objects</em></a>.</p>
<blockquote>
brains = folder.getFolderContents()</blockquote>
</div>
<div class="section" id="getting-full-objects">
<h3><a class="toc-backref" href="#id6">Getting full objects</a><a class="headerlink" href="#getting-full-objects" title="Permalink to this headline">¶</a></h3>
<blockquote>
items = folder.contentItems() # return Python list of children object tuples (id, object)</blockquote>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">contentItems() call may be costly, since it will return the actual content objects,
not their indexed metadata from portal_catalog. You should avoid this method
if possible.</p>
</div>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">folder.contentItems() returns all items regardless of the user security context.</p>
</div>
</div>
</div>
<div class="section" id="getting-folder-objects-filtered">
<h2><a class="toc-backref" href="#id7">Getting folder objects filtered</a><a class="headerlink" href="#getting-folder-objects-filtered" title="Permalink to this headline">¶</a></h2>
<p>listFolderContents() method retrieves the full objects in the folder. It takes <em>contentFilter</em> as an argument which can be used to filter the results.  contentFilter uses the same syntax as portal_catalog queries but does not support all the same parameters e.g. &quot;object_provides&quot; is not supported. See the <a class="reference external" href="http://svn.zope.org/Products.CMFCore/trunk/Products/CMFCore/PortalFolder.py?view=markup">ContentFilter class</a> for details.</p>
<p>Example:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c"># List all types in this folder whose portal_type is &quot;CourseModulePage&quot;</span>

<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">listFolderContents</span><span class="p">(</span><span class="n">contentFilter</span><span class="o">=</span><span class="p">{</span><span class="s">&quot;portal_type&quot;</span> <span class="p">:</span> <span class="s">&quot;CourseModulePage&quot;</span><span class="p">})</span>
</pre></div>
</div>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">Security warning: listFolderContens() honors the currently logged in user roles.</p>
</div>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">Performance warning: Slow for big folders. Preferably use portal_catalog and path based query
to query items in a big folder.</p>
</div>
<div class="section" id="rules-for-filtering-items">
<h3><a class="toc-backref" href="#id8">Rules for filtering items</a><a class="headerlink" href="#rules-for-filtering-items" title="Permalink to this headline">¶</a></h3>
<p>Plone applies some default rules for listFolderContents()</p>
<ul class="simple">
<li>portal_properties.nav_tree_properties.metaTypesNotToQuery: folders (large folders) don't generate listing</li>
<li><a class="reference internal" href="dynamic_views.html"><em>default_page</em></a> is not listed</li>
<li>portal_properties.nav_tree_properties.: meta types marked here do not appear in the listing</li>
</ul>
</div>
</div>
<div class="section" id="getting-object-ids">
<h2><a class="toc-backref" href="#id9">Getting object ids</a><a class="headerlink" href="#getting-object-ids" title="Permalink to this headline">¶</a></h2>
<p>If you need to get ids only, use objectIds() method, or keys() in
Plone 4. This is a fast method:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c"># Return a list of object ids in the folder</span>
<span class="n">ids</span> <span class="o">=</span> <span class="n">folder</span><span class="o">.</span><span class="n">objectIds</span><span class="p">()</span>  <span class="c"># Plone 3 or older</span>
<span class="n">ids</span> <span class="o">=</span> <span class="n">folder</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>       <span class="c"># Plone 4 or newer</span>
</pre></div>
</div>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">objectIds() and keys() will return ids for raw Zope 2 objects too, not just Plone content.
If you run objectIds() in portal root, you will get objects like acl_users,
portal_workflow and so on...</p>
</div>
</div>
<div class="section" id="getting-non-contentish-zope-objects">
<h2><a class="toc-backref" href="#id10">Getting non-contentish Zope objects</a><a class="headerlink" href="#getting-non-contentish-zope-objects" title="Permalink to this headline">¶</a></h2>
<p>Manipulating non-contentish Zope objects
are needed in some special cases.</p>
<p>This listing method applies to all <a class="reference external" href="http://svn.zope.org/Zope/trunk/src/OFS/interfaces.py?rev=96262&amp;view=auto">OFS.Folder.Folder objects</a>,
not just Plone content objects.</p>
<p>Example:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">for</span> <span class="nb">id</span><span class="p">,</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">folder</span><span class="o">.</span><span class="n">objectItems</span><span class="p">():</span>
    <span class="c"># id is 8-bit string of object id in the folder</span>
    <span class="c"># item is the object itself</span>
    <span class="k">pass</span>
</pre></div>
</div>
</div>
<div class="section" id="checking-for-the-existence-of-a-particular-object-id">
<h2><a class="toc-backref" href="#id11">Checking for the existence of a particular object id</a><a class="headerlink" href="#checking-for-the-existence-of-a-particular-object-id" title="Permalink to this headline">¶</a></h2>
<p>If you want to know whether the folder has a certain item or not, you can use the following snippet.</p>
<p>There is a special case for Large Plone Folders (BTree based).
The following is optimal code, but you can simplify it if you don't need to check if the folder is BTreeFolder:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c"># Use the BTreeFolder API if possible</span>
<span class="n">myid</span> <span class="o">=</span> <span class="s">&quot;index_html&quot;</span>

<span class="k">if</span> <span class="n">base_hasattr</span><span class="p">(</span><span class="n">context</span><span class="p">,</span> <span class="s">&#39;has_key&#39;</span><span class="p">):</span>
    <span class="c"># BTreeFolder&#39;s has_key returns numeric values</span>
    <span class="k">return</span> <span class="n">context</span><span class="o">.</span><span class="n">has_key</span><span class="p">(</span><span class="n">myid</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">True</span> <span class="ow">or</span> <span class="bp">False</span>
<span class="k">elif</span> <span class="n">myid</span> <span class="ow">in</span> <span class="n">context</span><span class="o">.</span><span class="n">objectIds</span><span class="p">():</span>
<span class="c"># &quot;elif myid in context:&quot; in Plone 4 or newer</span>
    <span class="k">return</span> <span class="bp">True</span>
<span class="k">else</span><span class="p">:</span>
    <span class="k">return</span> <span class="bp">False</span>
</pre></div>
</div>
</div>
<div class="section" id="listing-the-folder-items-using-portal-catalog">
<h2><a class="toc-backref" href="#id12">Listing the folder items using portal_catalog</a><a class="headerlink" href="#listing-the-folder-items-using-portal-catalog" title="Permalink to this headline">¶</a></h2>
<p>This should be your preferred method for querying folder items. portal_catalog searches are fast,
because they return catalog brain objects of real content objects (less database look ups).</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">Returned catalog brain data, like Title, will be UTF-8 encoded.
You need to call brain[&quot;title&quot;].decode(&quot;utf-8&quot;) or similar
to all strings you want to extract from the data.</p>
</div>
<p>Simple example how to get all items in a folder:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c"># Get the physical path (includes Plone site name)</span>
<span class="c"># to the folder</span>
<span class="n">path</span> <span class="o">=</span> <span class="n">folder</span><span class="o">.</span><span class="n">getPhysicalPath</span><span class="p">()</span>

<span class="c"># Convert getPhysicalPath() tuples result to</span>
<span class="c"># slash separated string, which is used by ExtendedPathIndex</span>
<span class="n">path</span> <span class="o">=</span> <span class="s">&quot;/&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>

<span class="c"># This will fetch catalog brains.</span>
<span class="c"># Includes also unreleased items, not caring about workflow state.</span>
<span class="c"># depth = 1 means that subfolder items are not included</span>

<span class="n">brains</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="n">portal_catalog</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="p">{</span><span class="s">&quot;query&quot;</span> <span class="p">:</span> <span class="n">path</span><span class="p">,</span> <span class="s">&quot;depth&quot;</span> <span class="p">:</span> <span class="mi">1</span><span class="p">})</span>
</pre></div>
</div>
<p>Complex example how to perform various filtering and honour some default
Plone filtering rules. This example is taken from Products.CMFPlone/skins/plone_scripts/getFolderContents:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">mtool</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="n">portal_membership</span>
<span class="n">cur_path</span> <span class="o">=</span> <span class="s">&#39;/&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">context</span><span class="o">.</span><span class="n">getPhysicalPath</span><span class="p">())</span>
<span class="n">path</span> <span class="o">=</span> <span class="p">{}</span>

<span class="k">if</span> <span class="ow">not</span> <span class="n">contentFilter</span><span class="p">:</span>
    <span class="c"># The form and other are what really matters</span>
    <span class="n">contentFilter</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="n">context</span><span class="o">.</span><span class="n">REQUEST</span><span class="p">,</span> <span class="s">&#39;form&#39;</span><span class="p">,{}))</span>
    <span class="n">contentFilter</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="n">context</span><span class="o">.</span><span class="n">REQUEST</span><span class="p">,</span> <span class="s">&#39;other&#39;</span><span class="p">,{})))</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">contentFilter</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">contentFilter</span><span class="p">)</span>

<span class="k">if</span> <span class="ow">not</span> <span class="n">contentFilter</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;sort_on&#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">):</span>
    <span class="n">contentFilter</span><span class="p">[</span><span class="s">&#39;sort_on&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;getObjPositionInParent&#39;</span>

<span class="k">if</span> <span class="n">contentFilter</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;path&#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
    <span class="n">path</span><span class="p">[</span><span class="s">&#39;query&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">cur_path</span>
    <span class="n">path</span><span class="p">[</span><span class="s">&#39;depth&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">contentFilter</span><span class="p">[</span><span class="s">&#39;path&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">path</span>

<span class="n">show_inactive</span> <span class="o">=</span> <span class="n">mtool</span><span class="o">.</span><span class="n">checkPermission</span><span class="p">(</span><span class="s">&#39;Access inactive portal content&#39;</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span>

<span class="c"># Evaluate in catalog context because some containers override queryCatalog</span>
<span class="c"># with their own unrelated method (Topics)</span>
<span class="n">contents</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="n">portal_catalog</span><span class="o">.</span><span class="n">queryCatalog</span><span class="p">(</span><span class="n">contentFilter</span><span class="p">,</span> <span class="n">show_all</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                                                  <span class="n">show_inactive</span><span class="o">=</span><span class="n">show_inactive</span><span class="p">)</span>

<span class="k">if</span> <span class="n">full_objects</span><span class="p">:</span>
    <span class="n">contents</span> <span class="o">=</span> <span class="p">[</span><span class="n">b</span><span class="o">.</span><span class="n">getObject</span><span class="p">()</span> <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">contents</span><span class="p">]</span>

<span class="k">if</span> <span class="n">batch</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">Products.CMFPlone</span> <span class="kn">import</span> <span class="n">Batch</span>
    <span class="n">b_start</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="n">REQUEST</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;b_start&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
    <span class="n">batch</span> <span class="o">=</span> <span class="n">Batch</span><span class="p">(</span><span class="n">contents</span><span class="p">,</span> <span class="n">b_size</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">b_start</span><span class="p">),</span> <span class="n">orphan</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">batch</span>

<span class="k">return</span> <span class="n">contents</span>
</pre></div>
</div>
</div>
<div class="section" id="count-of-content-items">
<h2><a class="toc-backref" href="#id13">Count of content items</a><a class="headerlink" href="#count-of-content-items" title="Permalink to this headline">¶</a></h2>
<div class="section" id="counting-items-using-getfoldercontents">
<h3><a class="toc-backref" href="#id14">Counting items using getFolderContents</a><a class="headerlink" href="#counting-items-using-getfoldercontents" title="Permalink to this headline">¶</a></h3>
<p>The least expensive call for this for tens of items is to call len() for getFolderContents() which is portal_catalog based query:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">items</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getFolderContents</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="section" id="counting-items-using-contentitems">
<h3><a class="toc-backref" href="#id15">Counting items using contentItems</a><a class="headerlink" href="#counting-items-using-contentitems" title="Permalink to this headline">¶</a></h3>
<p>Alternative, if you know there are not many objects in in the folder,
you can call contentItems() (or simply items() in Plone 4 or newer) as this
will potentially wake less items than complex catalog query.</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">Security: This method does not consider access rights.</p>
</div>
<p>Example (AT content class method):</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">getMainImage</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="n">items</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">contentItems</span><span class="p">()</span> <span class="c"># id, object tuples</span>
    <span class="c"># &quot;items = self.items()&quot; in Plone 4 or newer</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">items</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">items</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="custom-folder-listing">
<h2><a class="toc-backref" href="#id16">Custom folder listing</a><a class="headerlink" href="#custom-folder-listing" title="Permalink to this headline">¶</a></h2>
<p>Here is an example how to create a view which will render custom listing for a folder or a collection (ATTopic).</p>
<p>The view is called ProductSummaryView and it is registered with name <em>productsummary</em>. This example
is not suitable for your add-on product as is, but you need to tailor it for your specific needs.</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">If you are going to call item/getObject for a catalog brain it might cause
excessive database load as it causes a new database query per object.
Try use information available in the catalog
or add more catalog indexes. To know more about the
issue read about waking up database objects.</p>
</div>
<ul>
<li><p class="first">First let's register our view</p>
<blockquote>
<p>We could limit content types for which view is enabled by putting <em>Products.ATContentTypes.interface.IATFolder</em>
or <em>Products.ATContentTypes.interface.IATTopic</em> into for attribute. The <em>configure.zcml</em> snippet below.</p>
</blockquote>
</li>
</ul>
<div class="highlight-xml"><div class="highlight"><pre><span class="nt">&lt;browser:page</span>
    <span class="na">for=</span><span class="s">&quot;*&quot;</span>
    <span class="na">name=</span><span class="s">&quot;productcardsummary&quot;</span>
    <span class="na">class=</span><span class="s">&quot;.productcardsummaryview.ProductCardSummaryView&quot;</span>
    <span class="na">template=</span><span class="s">&quot;productcardsummaryview.pt&quot;</span>
    <span class="na">allowed_interface=</span><span class="s">&quot;.productcardsummaryview.IProductCardSummaryView&quot;</span>
    <span class="na">permission=</span><span class="s">&quot;zope2.View&quot;</span>
    <span class="nt">/&gt;</span>
</pre></div>
</div>
<ul class="simple">
<li>Below is the example view code, named as <em>productcardsummaryview.py</em>.</li>
</ul>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">zope.interface</span> <span class="kn">import</span> <span class="n">implements</span><span class="p">,</span> <span class="n">Interface</span>

<span class="kn">from</span> <span class="nn">zope</span> <span class="kn">import</span> <span class="n">schema</span>

<span class="kn">from</span> <span class="nn">Products.Five</span> <span class="kn">import</span> <span class="n">BrowserView</span>
<span class="kn">from</span> <span class="nn">Products.CMFCore.utils</span> <span class="kn">import</span> <span class="n">getToolByName</span>

<span class="kn">from</span> <span class="nn">Products.ATContentTypes.interface</span> <span class="kn">import</span> <span class="n">IATTopic</span>

<span class="c"># zope.18n message translator for your add-on product</span>
<span class="kn">from</span> <span class="nn">yourproduct.namespace</span> <span class="kn">import</span> <span class="n">appMessageFactory</span> <span class="k">as</span> <span class="n">_</span>

<span class="k">class</span> <span class="nc">IProductCardSummaryView</span><span class="p">(</span><span class="n">Interface</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Allowed template variables exposed from the view.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c"># Item list as iterable Products.CMFPlone.PloneBatch.Batch object</span>
    <span class="n">contents</span> <span class="o">=</span> <span class="n">schema</span><span class="o">.</span><span class="n">Object</span><span class="p">(</span><span class="n">Interface</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">ProductCardSummaryView</span><span class="p">(</span><span class="n">BrowserView</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    List summary information for all product cards in the folder.</span>

<span class="sd">    Batch results.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">implements</span><span class="p">(</span><span class="n">IProductCardSummaryView</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">query</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">limit</span><span class="p">,</span> <span class="n">contentFilter</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Make catalog query for the folder listing.</span>

<span class="sd">        @param start: First index to query</span>

<span class="sd">        @param limit: maximum number of items in the batch</span>

<span class="sd">        @param contentFilter: portal_catalog filtering dictionary with index -&gt; value pairs.</span>

<span class="sd">        @return: Products.CMFPlone.PloneBatch.Batch object</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c"># Batch size</span>
        <span class="n">b_size</span> <span class="o">=</span> <span class="n">limit</span>

        <span class="c"># Batch start index, zero based</span>
        <span class="n">b_start</span> <span class="o">=</span> <span class="n">start</span>

        <span class="c"># We use different query method, depending on</span>
        <span class="c"># whether we do listing for topic or folder</span>
        <span class="k">if</span> <span class="n">IATTopic</span><span class="o">.</span><span class="n">providedBy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="p">):</span>
            <span class="c"># ATTopic like content</span>
            <span class="c"># Call Products.ATContentTypes.content.topic.ATTopic.queryCatalog() method</span>
            <span class="c"># This method handles b_start internally and</span>
            <span class="c"># grabs it from HTTPRequest object</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">queryCatalog</span><span class="p">(</span><span class="n">contentFilter</span><span class="p">,</span> <span class="n">batch</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">b_size</span><span class="o">=</span><span class="n">b_size</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c"># Folder or Large Folder like content</span>
            <span class="c"># Call CMFPlone(/skins/plone_scripts/getFolderContents Python script</span>
            <span class="c"># This method handles b_start parametr internally and grabs it from the request object</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">getFolderContents</span><span class="p">(</span><span class="n">contentFilter</span><span class="p">,</span> <span class="n">batch</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">b_size</span><span class="o">=</span><span class="n">b_size</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Render the content item listing.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c"># How many items is one one page</span>
        <span class="n">limit</span> <span class="o">=</span> <span class="mi">3</span>

        <span class="c"># What kind of query we perform?</span>
        <span class="c"># Here we limit results to ProductCard content type</span>
        <span class="nb">filter</span> <span class="o">=</span> <span class="p">{</span> <span class="s">&quot;portal_type&quot;</span> <span class="p">:</span> <span class="s">&quot;ProductCard&quot;</span> <span class="p">}</span>

        <span class="c"># Read the first index of the selected batch parameter as HTTP GET request query parameter</span>
        <span class="n">start</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;b_start&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

        <span class="c"># Perform portal_catalog query</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">contents</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">limit</span><span class="p">,</span> <span class="nb">filter</span><span class="p">)</span>

        <span class="c"># Return the rendered template (productcardsummaryview.pt), with content listing information filled in</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="p">()</span>
</pre></div>
</div>
<ul class="simple">
<li>Below is the corresponding page template skeleton productcardsummaryview.pt</li>
</ul>
<div class="highlight-html"><pre>&lt;html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"
      lang="en"
      metal:use-macro="here/main_template/macros/master"
      i18n:domain="yourproduct.namespace"&gt;
&lt;body&gt;
    &lt;div metal:fill-slot="main"&gt;
        &lt;tal:main-macro metal:define-macro="main"
           tal:define="kssClassesView context/@@kss_field_decorator_view;
                       getKssClasses nocall:kssClassesView/getKssClassesInlineEditable;
                       "&gt;


            &lt;div tal:replace="structure provider:plone.abovecontenttitle" /&gt;

            &lt;h1 metal:use-macro="here/kss_generic_macros/macros/generic_title_view"&gt;
                Title or id
            &lt;/h1&gt;

            &lt;div tal:replace="structure provider:plone.belowcontenttitle" /&gt;

            &lt;p metal:use-macro="here/kss_generic_macros/macros/generic_description_view"&gt;
                Description
            &lt;/p&gt;

            &lt;div tal:replace="structure provider:plone.abovecontentbody" /&gt;

            &lt;tal:listing define="batch view/contents"&gt;

                &lt;tal:block tal:repeat="item batch"&gt;
                    &lt;div class="tileItem visualIEFloatFix vevent"
                         tal:define="item_url item/getURL|item/absolute_url;
                                           item_id item/getId|item/id;
                                           item_title_or_id item/pretty_title_or_id;
                                           item_description item/Description;
                                           item_type item/portal_type;
                                           item_type_title item/Type;
                                           item_type_class python: 'contenttype-' + normalizeString(item_type);
                                           item_modified item/ModificationDate;
                                           item_created item/CreationDate;
                                           item_wf_state        item/review_state|python: wtool.getInfoFor(item, 'review_state', '');
                                           item_wf_state_class python:'state-' + normalizeString(item_wf_state);
                                           item_creator item/Creator;
                                           item_start item/start/ISO|item/StartDate|nothing;
                                           item_end item/end/ISO|item/EndDate|nothing;
                                       "
                         tal:attributes="class string:tileItem visualIEFloatFix vevent ${item_type_class}"&gt;

                        &lt;a href="#"
                           tal:attributes="href item_url"&gt;
                            &lt;img src="" alt=""
                                 witdh="64"
                                 height="64"
                                 tal:condition="item_object/main_image|python:False"
                                 tal:attributes="src item_object/main_image" /&gt;
                        &lt;/a&gt;


                        &lt;h2 class="tileHeadline"
                            metal:define-macro="listitem"&gt;

                            &lt;a href="#"
                               class="summary url"
                               tal:attributes="href item_url"
                               tal:content="item_title_or_id"&gt;
                                Item Title
                            &lt;/a&gt;

                        &lt;/h2&gt;

                        &lt;p class="tileBody"&gt;
                            &lt;span tal:omit-tag="" tal:condition="not:item_description"&gt;
                                &amp;nbsp;
                            &lt;/span&gt;
                            &lt;span class="description" tal:content="item_description"&gt;
                                description
                            &lt;/span&gt;
                        &lt;/p&gt;

                        &lt;p class="tileFooter"&gt;
                            &lt;a href=""
                               tal:attributes="href item_url"
                               i18n:translate="read_more"&gt;
                            Read More&amp;hellip;
                            &lt;/a&gt;
                        &lt;/p&gt;

                        &lt;div class="visualClear"&gt;&lt;!-- --&gt;&lt;/div&gt;

                    &lt;/div&gt;
                &lt;/tal:block&gt;

                &lt;!-- Navigation --&gt;
                &lt;div metal:use-macro="here/batch_macros/macros/navigation" /&gt;

            &lt;/tal:listing&gt;

            &lt;div tal:replace="structure provider:plone.belowcontentbody" /&gt;

        &lt;/tal:main-macro&gt;
    &lt;/div&gt;
&lt;/body&gt;
&lt;/html&gt;</pre>
</div>
<ul class="simple">
<li>Go to view page by adding /&#64;&#64;productsummary to your folder URL.</li>
</ul>
<div class="section" id="making-view-to-be-available-in-display-menu">
<h3><a class="toc-backref" href="#id17">Making view to be available in Display... menu</a><a class="headerlink" href="#making-view-to-be-available-in-display-menu" title="Permalink to this headline">¶</a></h3>
<p>You need to add browser:menuItem entry to make your view appear in the Display... menu
where folders and topics can choose the style of the display.</p>
<p>See <a class="reference internal" href="dynamic_views.html"><em>dynamic views</em></a>.</p>
<p>You need to add</p>
<ul class="simple">
<li>&lt;browser:menuItem&gt; configuration directive with view id (e.g. &#64;&#64;productsummary)</li>
<li>New properties to Folder.xml or Topic.xml so that view becomes available</li>
</ul>
</div>
</div>
<div class="section" id="complex-folder-listings-and-filtering">
<h2><a class="toc-backref" href="#id18">Complex folder listings and filtering</a><a class="headerlink" href="#complex-folder-listings-and-filtering" title="Permalink to this headline">¶</a></h2>
<p>The following example is for a very complex folder listing view.
You can call view methods to returns the listed items themselves and render
the HTML in another view - this allows you to recycle this listing code easily.</p>
<p>The view does the various sanity checks what normal Plone item listings have</p>
<ul class="simple">
<li>No meta items</li>
<li>No large folders</li>
<li>No default views</li>
<li>Filter by active language</li>
<li>Do not list items where you do not have View permission</li>
<li>The view also performs the listing on the parent container if the context itself
is not folderish</li>
</ul>
<p>Example code</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">FolderListingView</span><span class="p">(</span><span class="n">BrowserView</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Mobile folder listing helper view</span>

<span class="sd">    Use getItems() to get list of mobile folder listable items for automatically generated</span>
<span class="sd">    mobile folder listings (touch button list).</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">getListingContainer</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Get the item for which we perform the listing</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">context</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">aq_inner</span>
        <span class="k">if</span> <span class="n">IFolderish</span><span class="o">.</span><span class="n">providedBy</span><span class="p">(</span><span class="n">context</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">context</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">context</span><span class="o">.</span><span class="n">aq_parent</span>

    <span class="k">def</span> <span class="nf">getActiveTemplate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">state</span> <span class="o">=</span> <span class="n">getMultiAdapter</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="p">),</span> <span class="n">name</span><span class="o">=</span><span class="s">u&#39;plone_context_state&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">state</span><span class="o">.</span><span class="n">view_template_id</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">getTemplateIdsNoListing</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        @return: List of mobile-specific ids found from portal_properties where not to show folder listing</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="kn">from</span> <span class="nn">gomobile.mobile.utilities</span> <span class="kn">import</span> <span class="n">getCachedMobileProperties</span>
            <span class="n">context</span> <span class="o">=</span> <span class="n">aq_inner</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="p">)</span>
            <span class="n">mobile_properties</span> <span class="o">=</span> <span class="n">getCachedMobileProperties</span><span class="p">(</span><span class="n">context</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="n">mobile_properties</span> <span class="o">=</span> <span class="bp">None</span>

        <span class="k">return</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">mobile_properties</span><span class="p">,</span> <span class="s">&quot;no_folder_listing_view_ids&quot;</span><span class="p">,</span> <span class="p">[])</span>


    <span class="k">def</span> <span class="nf">filterItems</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">container</span><span class="p">,</span> <span class="n">items</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Apply mobile specific filtering rules</span>

<span class="sd">        @param items: List of context brains</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c"># Filter out default content</span>
        <span class="n">default_page_helper</span> <span class="o">=</span> <span class="n">getMultiAdapter</span><span class="p">((</span><span class="n">container</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="p">),</span> <span class="n">name</span><span class="o">=</span><span class="s">&#39;default_page&#39;</span><span class="p">)</span>

        <span class="n">portal_state</span> <span class="o">=</span> <span class="n">getMultiAdapter</span><span class="p">((</span><span class="n">container</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="p">),</span> <span class="n">name</span><span class="o">=</span><span class="s">&#39;plone_portal_state&#39;</span><span class="p">)</span>

        <span class="c"># Active language</span>
        <span class="n">language</span> <span class="o">=</span> <span class="n">portal_state</span><span class="o">.</span><span class="n">language</span><span class="p">()</span>

        <span class="c"># Return  the default page id or None if not set</span>
        <span class="n">default_page</span> <span class="o">=</span> <span class="n">default_page_helper</span><span class="o">.</span><span class="n">getDefaultPage</span><span class="p">(</span><span class="n">container</span><span class="p">)</span>

        <span class="n">security_manager</span> <span class="o">=</span> <span class="n">getSecurityManager</span><span class="p">()</span>

        <span class="n">meta_types_not_to_list</span> <span class="o">=</span> <span class="n">container</span><span class="o">.</span><span class="n">portal_properties</span><span class="o">.</span><span class="n">navtree_properties</span><span class="o">.</span><span class="n">metaTypesNotToList</span>


        <span class="k">def</span> <span class="nf">show</span><span class="p">(</span><span class="n">item</span><span class="p">):</span>
            <span class="sd">&quot;&quot;&quot; Filter whether the user can view a mobile item.</span>

<span class="sd">            @param item: Real content object (not brain)</span>

<span class="sd">            @return: True if item should be visible in the listing</span>
<span class="sd">            &quot;&quot;&quot;</span>


            <span class="c"># Check from mobile behavior should we do the listing</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">behavior</span> <span class="o">=</span> <span class="n">IMobileBehavior</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
                <span class="n">appearInFolderListing</span> <span class="o">=</span> <span class="n">behavior</span><span class="o">.</span><span class="n">appearInFolderListing</span>
            <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
                <span class="c"># Site root or some weird object, give up</span>
                <span class="n">appearInFolderListing</span> <span class="o">=</span> <span class="bp">True</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">appearInFolderListing</span><span class="p">:</span>
                <span class="c"># Default to appearing</span>
                <span class="k">return</span> <span class="bp">False</span>

            <span class="c"># Default page should not appear in the quick listing</span>
            <span class="k">if</span> <span class="n">item</span><span class="o">.</span><span class="n">getId</span><span class="p">()</span> <span class="o">==</span> <span class="n">default_page</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">False</span>

            <span class="k">if</span> <span class="n">item</span><span class="o">.</span><span class="n">meta_type</span> <span class="ow">in</span> <span class="n">meta_types_not_to_list</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">False</span>

            <span class="c"># Two letter language code</span>
            <span class="n">item_lang</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">Language</span><span class="p">()</span>

            <span class="c"># Empty string makes language netral content</span>
            <span class="k">if</span> <span class="n">item_lang</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&quot;&quot;</span><span class="p">,</span> <span class="bp">None</span><span class="p">]:</span>
                <span class="k">if</span> <span class="n">item_lang</span> <span class="o">!=</span> <span class="n">language</span><span class="p">:</span>
                    <span class="k">return</span> <span class="bp">False</span>

            <span class="c"># Note: getExcludeFromNav not necessarily exist on all content types</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="s">&quot;getExcludeFromNav&quot;</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">item</span><span class="o">.</span><span class="n">getExcludeFromNav</span><span class="p">():</span>
                    <span class="k">return</span> <span class="bp">False</span>

            <span class="c"># Does the user have a permission to view this object</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">security_manager</span><span class="o">.</span><span class="n">checkPermission</span><span class="p">(</span><span class="n">permissions</span><span class="o">.</span><span class="n">View</span><span class="p">,</span> <span class="n">item</span><span class="p">):</span>
                <span class="k">return</span> <span class="bp">False</span>

            <span class="k">return</span> <span class="bp">True</span>

        <span class="k">return</span> <span class="p">[</span> <span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">items</span> <span class="k">if</span> <span class="n">show</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">==</span> <span class="bp">True</span> <span class="p">]</span>


    <span class="k">def</span> <span class="nf">constructListing</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="c"># Iterable of content items for the item listing</span>
        <span class="n">items</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c"># Check from mobile behavior should we do the listing</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">behavior</span> <span class="o">=</span> <span class="n">IMobileBehavior</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="p">)</span>
            <span class="n">do_listing</span> <span class="o">=</span> <span class="n">behavior</span><span class="o">.</span><span class="n">mobileFolderListing</span>
        <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
            <span class="c"># Site root or some weird object, give up</span>
            <span class="n">do_listing</span> <span class="o">=</span> <span class="bp">False</span>

        <span class="c"># Do listing by default, must be explictly disabledc</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">do_listing</span><span class="p">:</span>
            <span class="c"># No mobile behavior -&gt; no mobile listing</span>
            <span class="k">return</span> <span class="bp">None</span>

        <span class="n">container</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getListingContainer</span><span class="p">()</span>

        <span class="c"># Do not list if already doing folder listing</span>
        <span class="n">template</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getActiveTemplate</span><span class="p">()</span>
        <span class="k">print</span> <span class="s">&quot;Active template id:&quot;</span> <span class="o">+</span> <span class="n">template</span>
        <span class="k">if</span> <span class="n">template</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">getTemplateIdsNoListing</span><span class="p">():</span>
            <span class="c"># Listing forbidden by mobile rules</span>
            <span class="k">return</span> <span class="bp">None</span>


        <span class="n">portal_properties</span> <span class="o">=</span> <span class="n">getToolByName</span><span class="p">(</span><span class="n">container</span><span class="p">,</span> <span class="s">&quot;portal_properties&quot;</span><span class="p">)</span>
        <span class="n">navtree_properties</span> <span class="o">=</span> <span class="n">portal_properties</span><span class="o">.</span><span class="n">navtree_properties</span>
        <span class="k">if</span> <span class="n">container</span><span class="o">.</span><span class="n">meta_type</span> <span class="ow">in</span> <span class="n">navtree_properties</span><span class="o">.</span><span class="n">parentMetaTypesNotToQuery</span><span class="p">:</span>
            <span class="c"># Big folder... listing forbidden</span>
            <span class="k">return</span> <span class="bp">None</span>

        <span class="n">state</span> <span class="o">=</span> <span class="n">container</span><span class="o">.</span><span class="n">restrictedTraverse</span><span class="p">(</span><span class="s">&#39;@@plone_portal_state&#39;</span><span class="p">)</span>

        <span class="n">items</span> <span class="o">=</span> <span class="n">container</span><span class="o">.</span><span class="n">listFolderContents</span><span class="p">()</span>

        <span class="n">items</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">filterItems</span><span class="p">(</span><span class="n">container</span><span class="p">,</span> <span class="n">items</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">items</span>

    <span class="k">def</span> <span class="nf">getItems</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        @return: Iterable of content objects. Never return None.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">items</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">constructListing</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">items</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[]</span>
        <span class="k">return</span> <span class="n">items</span>
</pre></div>
</div>
</div>
</div>

  </div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
<p class="logo"><a href="../index.html"><img src="../_static/plone-icon-64.png" />
</a></p>

  <h3><a href="../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Listing objects</a><ul>
<li><a class="reference internal" href="#introduction">Introduction</a></li>
<li><a class="reference internal" href="#ensuring-content-item-is-a-folder">Ensuring content item is a folder</a></li>
<li><a class="reference internal" href="#getting-all-content-objects-inside-a-folder">Getting all content objects inside a folder</a></li>
<li><a class="reference internal" href="#querying-folder-through-catalog">Querying folder through catalog</a><ul>
<li><a class="reference internal" href="#getting-indexed-objects">Getting indexed objects</a></li>
<li><a class="reference internal" href="#getting-full-objects">Getting full objects</a></li>
</ul>
</li>
<li><a class="reference internal" href="#getting-folder-objects-filtered">Getting folder objects filtered</a><ul>
<li><a class="reference internal" href="#rules-for-filtering-items">Rules for filtering items</a></li>
</ul>
</li>
<li><a class="reference internal" href="#getting-object-ids">Getting object ids</a></li>
<li><a class="reference internal" href="#getting-non-contentish-zope-objects">Getting non-contentish Zope objects</a></li>
<li><a class="reference internal" href="#checking-for-the-existence-of-a-particular-object-id">Checking for the existence of a particular object id</a></li>
<li><a class="reference internal" href="#listing-the-folder-items-using-portal-catalog">Listing the folder items using portal_catalog</a></li>
<li><a class="reference internal" href="#count-of-content-items">Count of content items</a><ul>
<li><a class="reference internal" href="#counting-items-using-getfoldercontents">Counting items using getFolderContents</a></li>
<li><a class="reference internal" href="#counting-items-using-contentitems">Counting items using contentItems</a></li>
</ul>
</li>
<li><a class="reference internal" href="#custom-folder-listing">Custom folder listing</a><ul>
<li><a class="reference internal" href="#making-view-to-be-available-in-display-menu">Making view to be available in Display... menu</a></li>
</ul>
</li>
<li><a class="reference internal" href="#complex-folder-listings-and-filtering">Complex folder listings and filtering</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="creating.html"
                        title="previous chapter">Creating objects</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="manipulating.html"
                        title="next chapter">Manipulating objects</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="../_sources/content/listing.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" size="18" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="manipulating.html" title="Manipulating objects"
             >next</a> |</li>
        <li class="right" >
          <a href="creating.html" title="Creating objects"
             >previous</a> |</li>
        <li><a href="../index.html">Plone Community Managed Developer Manual v1.0 documentation</a> &raquo;</li>
          <li><a href="index.html" >Content management</a> &raquo;</li> 
      </ul>
    </div>

    <div class="footer">
        &copy; Copyright 2010 mFabrik Research Oy and Plone community contributors.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.0.4.
    </div>


  </body>
</html>