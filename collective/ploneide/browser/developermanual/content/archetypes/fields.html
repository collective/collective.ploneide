<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Fields and widgets &mdash; Plone Community Managed Developer Manual v1.0 documentation</title>
    <link rel="stylesheet" href="../../_static/plone.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '1.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <link rel="top" title="Plone Community Managed Developer Manual v1.0 documentation" href="../../index.html" />
    <link rel="up" title="Archetypes" href="index.html" />
    <link rel="next" title="Field storages" href="storages.html" />
    <link rel="prev" title="Archetypes" href="index.html" />
<script language="javascript">
//<![CDATA[

Documentation.addTranslations({"locale": "fr", "plural_expr": "(n > 1)", "messages": {"See the definition": "Voir la d\u00e9finition"}});

// See http://disqus.disqus.com/general_integration_help/
var disqus_developer = 1;
if (document.location.protocol == 'http:') {
    disqus_developer = 0;
}

// Some HTML/CSS transforms we can't do in pure CSS (waiting for CSS3 support)
$(document).ready(function () {

    // Style of .. verisonmodified:: , .. versionadded:: ...
    $('p:has(span.versionmodified)').addClass('p-versionmodified');

    // Style of the TOC tree
    $('ul:has(li.toctree-l1)').addClass('toctree');

    // Decorate links to other sites
    $('a[class~=external]').attr('target', '_blank');

    // Glossary terms
    $('em.xref').attr('title', _('See the definition'));

    // We need to have all <pre> in a <div class="highlight"> to mimic pygments
    // to work around a pygments (?) bug
    var suffixes = {cfg: null, python:null};
    for (var suffix in suffixes) {
        var pattern = 'div.highlight-' + suffix + ' > pre';
        $(pattern).wrap('<div class="highlight" />');
    }
    return true;
});
//]]>
</script>

  </head>
  <body>
<!--[if lte IE 6]>
<style type="text/css">
#ie6msg{border:3px solid #090; margin:8px 0; background:#cfc; color:#000;}
#ie6msg h4{margin:8px; padding:0;}
#ie6msg p{margin:8px; padding:0;}
#ie6msg p a.getie8{font-weight:bold; color:#006;}
#ie6msg p a.ie6expl{font-weight:normal; color:#006;}
</style>
<div id="ie6msg">
<h4>Did you know that your browser is out of date?</h4>
<p>If the layout of this site seems ugly, that's because you're actually using
an outdated browser. And we wont put any effort to provide a nice layout to IE6
users.</p>
<p>To get the best possible experience using our website we recommend that you
upgrade your browser to a newer version. The current version
is <a class="getie8"
href="http://upgradeie.s3.amazonaws.com/eng/index.html">Internet Explorer
8</a>. The upgrade is free. If you're using a PC at work you should contact your
IT administrator.</p>
<p>If you want to you may also try some other popular Internet browsers
like <a class="ie6expl"
href="http://getfirefox.com">Firefox</a>, <a class="ie6expl"
href="http://www.google.com/chrome">Chrome</a>, <a class="ie6expl"
href="http://www.opera.com">Opera</a>, or <a class="ie6expl"
href="http://www.apple.com/safari/download/">Safari</a></p>
</div>
<![endif]-->

    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="storages.html" title="Field storages"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="index.html" title="Archetypes"
             accesskey="P">previous</a> |</li>
        <li><a href="../../index.html">Plone Community Managed Developer Manual v1.0 documentation</a> &raquo;</li>
          <li><a href="../index.html" >Content management</a> &raquo;</li>
          <li><a href="index.html" accesskey="U">Archetypes</a> &raquo;</li> 
      </ul>
    </div>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="sphinx-content">
    <div class="section" id="fields-and-widgets">
<h1>Fields and widgets<a class="headerlink" href="#fields-and-widgets" title="Permalink to this headline">¶</a></h1>
<div class="admonition-description admonition ">
<p class="first admonition-title">Description</p>
<p class="last">How to read, add, remove and create fields and widgets available for Archetypes content types.</p>
</div>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><a class="reference internal" href="#introduction" id="id1">Introduction</a></li>
<li><a class="reference internal" href="#getting-hold-of-schema-objects" id="id2">Getting hold of schema objects</a><ul>
<li><a class="reference internal" href="#during-application-start-up" id="id3">During application start-up</a></li>
<li><a class="reference internal" href="#during-http-request-processing" id="id4">During HTTP request processing</a></li>
</ul>
</li>
<li><a class="reference internal" href="#schema-introspection" id="id5">Schema introspection</a><ul>
<li><a class="reference internal" href="#out-of-box-schema-source-code" id="id6">Out of box schema source code</a></li>
<li><a class="reference internal" href="#run-time-introspection" id="id7">Run-time introspection</a></li>
</ul>
</li>
<li><a class="reference internal" href="#field-name" id="id8">Field name</a></li>
<li><a class="reference internal" href="#accessing-archetypes-field-value" id="id9">Accessing Archetypes field value</a><ul>
<li><a class="reference internal" href="#accessor-method" id="id10">Accessor method</a></li>
<li><a class="reference internal" href="#raw-access" id="id11">Raw access</a></li>
<li><a class="reference internal" href="#indirect-access" id="id12">Indirect access</a></li>
</ul>
</li>
<li><a class="reference internal" href="#validating-objects" id="id13">Validating objects</a></li>
<li><a class="reference internal" href="#checking-permissions" id="id14">Checking permissions</a></li>
<li><a class="reference internal" href="#modifying-all-fields-in-schema" id="id15">Modifying all fields in schema</a></li>
<li><a class="reference internal" href="#reordering-fields" id="id16">Reordering fields</a></li>
<li><a class="reference internal" href="#hiding-widgets" id="id17">Hiding widgets</a></li>
<li><a class="reference internal" href="#rendering-widget" id="id18">Rendering widget</a></li>
<li><a class="reference internal" href="#creating-your-own-field" id="id19">Creating your own Field</a></li>
<li><a class="reference internal" href="#automatically-generating-description-based-on-body-text" id="id20">Automatically generating description based on body text</a></li>
<li><a class="reference internal" href="#vocabularies" id="id21">Vocabularies</a><ul>
<li><a class="reference internal" href="#dynamic-vocabularies" id="id22">Dynamic vocabularies</a></li>
</ul>
</li>
<li><a class="reference internal" href="#rendering-single-field" id="id23">Rendering single field</a></li>
<li><a class="reference internal" href="#hiding-widgets-conditionally" id="id24">Hiding widgets conditionally</a></li>
<li><a class="reference internal" href="#dynamic-field-definitions" id="id25">Dynamic field definitions</a></li>
</ul>
</div>
<div class="section" id="introduction">
<h2><a class="toc-backref" href="#id1">Introduction</a><a class="headerlink" href="#introduction" title="Permalink to this headline">¶</a></h2>
<p>This document contains instructions how to manipulate Archetypes schema
(data model for content items) and fields and widgets it consists of.</p>
<p><em>Schema</em> is list of fields associated with a content type.
Each field can belong to one <em>schemata</em> which corresponds to one Edit tab
sub-tab in Plone user interface.</p>
<p>Field schemata is chosen by setting field's <tt class="docutils literal"><span class="pre">schemata</span></tt> attribute.</p>
</div>
<div class="section" id="getting-hold-of-schema-objects">
<h2><a class="toc-backref" href="#id2">Getting hold of schema objects</a><a class="headerlink" href="#getting-hold-of-schema-objects" title="Permalink to this headline">¶</a></h2>
<p>Archetypes based data model is defined as Schema object, which is a list of fields.</p>
<div class="section" id="during-application-start-up">
<h3><a class="toc-backref" href="#id3">During application start-up</a><a class="headerlink" href="#during-application-start-up" title="Permalink to this headline">¶</a></h3>
<p>When your class is being constructed you can refer the schema simply in Python:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c"># Assume you have YourContentSchema object</span>
<span class="k">print</span> <span class="n">YourContentSchema</span><span class="o">.</span><span class="n">fields</span><span class="p">()</span>

<span class="k">class</span> <span class="nc">SitsCountry</span><span class="p">(</span><span class="n">ATBTreeFolder</span><span class="p">):</span>
        <span class="n">schema</span> <span class="o">=</span><span class="n">YourContentSchema</span>

<span class="k">print</span> <span class="n">SitsCountry</span><span class="o">.</span><span class="n">schema</span><span class="o">.</span><span class="n">fields</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="section" id="during-http-request-processing">
<h3><a class="toc-backref" href="#id4">During HTTP request processing</a><a class="headerlink" href="#during-http-request-processing" title="Permalink to this headline">¶</a></h3>
<p>You can access context schema object by using Schema() accessor.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Run-time schema patching is possible, so Schema() output might
differ what you put in to your content type during the construction.</p>
</div>
<p>Example:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">schema</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="n">Schema</span><span class="p">()</span>
<span class="k">print</span> <span class="n">schema</span><span class="o">.</span><span class="n">fields</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="schema-introspection">
<h2><a class="toc-backref" href="#id5">Schema introspection</a><a class="headerlink" href="#schema-introspection" title="Permalink to this headline">¶</a></h2>
<p>How to know what fields are available on content items.</p>
<div class="section" id="out-of-box-schema-source-code">
<h3><a class="toc-backref" href="#id6">Out of box schema source code</a><a class="headerlink" href="#out-of-box-schema-source-code" title="Permalink to this headline">¶</a></h3>
<p>The default Plone schemas are defined</p>
<p>Id and title fields:</p>
<ul class="simple">
<li><a class="reference external" href="http://svn.plone.org/svn/archetypes/Products.Archetypes/trunk/Products/Archetypes/BaseObject.py">http://svn.plone.org/svn/archetypes/Products.Archetypes/trunk/Products/Archetypes/BaseObject.py</a></li>
</ul>
<p>Category and owners schemata: Dublin core metadata</p>
<ul class="simple">
<li><a class="reference external" href="http://svn.plone.org/svn/archetypes/Products.Archetypes/trunk/Products/Archetypes/ExtensibleMetadata.py">http://svn.plone.org/svn/archetypes/Products.Archetypes/trunk/Products/Archetypes/ExtensibleMetadata.py</a></li>
</ul>
<p>Settings schemata: Exclude from navigation, related items and next/previous navigation</p>
<ul class="simple">
<li><a class="reference external" href="http://svn.plone.org/svn/collective/Products.ATContentTypes/trunk/Products/ATContentTypes/content/schemata.py">http://svn.plone.org/svn/collective/Products.ATContentTypes/trunk/Products/ATContentTypes/content/schemata.py</a></li>
</ul>
<p>Document content</p>
<ul class="simple">
<li><a class="reference external" href="http://svn.plone.org/svn/collective/Products.ATContentTypes/trunk/Products/ATContentTypes/content/document.py">http://svn.plone.org/svn/collective/Products.ATContentTypes/trunk/Products/ATContentTypes/content/document.py</a></li>
</ul>
<p>Image content</p>
<ul class="simple">
<li><a class="reference external" href="http://svn.plone.org/svn/collective/Products.ATContentTypes/trunk/Products/ATContentTypes/content/image.py">http://svn.plone.org/svn/collective/Products.ATContentTypes/trunk/Products/ATContentTypes/content/image.py</a></li>
</ul>
<p>News content</p>
<ul class="simple">
<li><a class="reference external" href="http://svn.plone.org/svn/collective/Products.ATContentTypes/trunk/Products/ATContentTypes/content/newsitem.py">http://svn.plone.org/svn/collective/Products.ATContentTypes/trunk/Products/ATContentTypes/content/newsitem.py</a></li>
</ul>
</div>
<div class="section" id="run-time-introspection">
<h3><a class="toc-backref" href="#id7">Run-time introspection</a><a class="headerlink" href="#run-time-introspection" title="Permalink to this headline">¶</a></h3>
<p>You can get hold of content item schema and its fields as in the example below.</p>
<p>You can do this either in</p>
<ul class="simple">
<li><a class="reference internal" href="../../views/browserviews.html"><em>Your own BrowserView Python code</em></a></li>
<li><a class="reference internal" href="../../testing_and_debugging/pdb.html"><em>pdb breakpoint</em></a></li>
<li><a class="reference internal" href="../../misc/commandline.html"><em>Command line Zope debug console</em></a></li>
</ul>
<p>Example:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="n">context</span><span class="o">.</span><span class="n">Schema</span><span class="p">()</span><span class="o">.</span><span class="n">fields</span><span class="p">():</span>
        <span class="k">print</span> <span class="s">&quot;Field:&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">field</span><span class="p">)</span> <span class="o">+</span> <span class="s">&quot; value:&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">field</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">context</span><span class="p">))</span>
</pre></div>
</div>
<p>Field can be also accessed by name:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">field</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="n">Schema</span><span class="p">()[</span><span class="s">&quot;yourfieldname&quot;</span><span class="p">]</span>
</pre></div>
</div>
<p>See</p>
<ul class="simple">
<li><a class="reference external" href="http://svn.plone.org/svn/archetypes/Products.Archetypes/trunk/Products/Archetypes/Schema/__init__.py">http://svn.plone.org/svn/archetypes/Products.Archetypes/trunk/Products/Archetypes/Schema/__init__.py</a></li>
</ul>
</div>
</div>
<div class="section" id="field-name">
<h2><a class="toc-backref" href="#id8">Field name</a><a class="headerlink" href="#field-name" title="Permalink to this headline">¶</a></h2>
<p>Field exposes its name through getName() attribute:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">field</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="n">Schema</span><span class="p">()[</span><span class="s">&quot;yourfieldname&quot;</span><span class="p">]</span>
<span class="k">assert</span> <span class="n">field</span><span class="o">.</span><span class="n">getName</span><span class="p">()</span> <span class="o">==</span> <span class="s">&quot;yourfieldname&quot;</span>
</pre></div>
</div>
</div>
<div class="section" id="accessing-archetypes-field-value">
<h2><a class="toc-backref" href="#id9">Accessing Archetypes field value</a><a class="headerlink" href="#accessing-archetypes-field-value" title="Permalink to this headline">¶</a></h2>
<div class="section" id="accessor-method">
<h3><a class="toc-backref" href="#id10">Accessor method</a><a class="headerlink" href="#accessor-method" title="Permalink to this headline">¶</a></h3>
<p>Each field has accessor method. Accessor method is</p>
<blockquote>
<ul class="simple">
<li>In your content type class</li>
<li>Automatically generated if you don't give it manually</li>
<li>Has name get + schema field name with first letter uppercase. E.g. yourfield has accessor method context.getYourfield()</li>
</ul>
</blockquote>
</div>
<div class="section" id="raw-access">
<h3><a class="toc-backref" href="#id11">Raw access</a><a class="headerlink" href="#raw-access" title="Permalink to this headline">¶</a></h3>
<p>Archetypes has to kind of access methods</p>
<ul class="simple">
<li>Normal, getSomething(), which filters output</li>
<li>Raw, so calle edit accessor, getSomethingRaw() which does not filter output</li>
</ul>
<p>When you access directly by obj.something you can have a <a class="reference external" href="http://svn.plone.org/svn/archetypes/Products.Archetypes/trunk/Products/Archetypes/BaseUnit.py">BaseUnit</a> object.
BaseUnit is an encapsulation of raw data for long text or file.
It contains information about mimetype, filename, encoding.
To get the raw value of a BaseUnit object you can use getRaw method or more simpler str(baseunit)</p>
</div>
<div class="section" id="indirect-access">
<h3><a class="toc-backref" href="#id12">Indirect access</a><a class="headerlink" href="#indirect-access" title="Permalink to this headline">¶</a></h3>
<p>You can use field.get(context) to read values of fields indirectly, without knowing the accessor method.</p>
<p>This example shows how to read and duplicate all values of lc object to nc:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">Products.Archetypes</span> <span class="kn">import</span> <span class="n">public</span> <span class="k">as</span> <span class="n">atapi</span>


<span class="n">nc</span> <span class="o">=</span> <span class="n">createObjectSomehow</span><span class="p">()</span>

<span class="c"># List of field names which we cannot copy</span>
<span class="n">do_not_copy</span> <span class="o">=</span> <span class="p">[</span><span class="s">&quot;id&quot;</span><span class="p">]</span>

<span class="c"># Duplicate field data from one object to another</span>
<span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="n">lc</span><span class="o">.</span><span class="n">Schema</span><span class="p">()</span><span class="o">.</span><span class="n">fields</span><span class="p">():</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">field</span><span class="o">.</span><span class="n">getName</span><span class="p">()</span>

    <span class="c"># ComputedFields are handled specially,</span>
    <span class="c"># and UID also</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">field</span><span class="p">,</span> <span class="n">atapi</span><span class="o">.</span><span class="n">ComputedField</span><span class="p">)</span> <span class="ow">and</span> <span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">do_not_copy</span><span class="p">:</span>
        <span class="n">value</span> <span class="o">=</span> <span class="n">field</span><span class="o">.</span><span class="n">getRaw</span><span class="p">(</span><span class="n">lc</span><span class="p">)</span>
        <span class="n">newfield</span> <span class="o">=</span> <span class="n">nc</span><span class="o">.</span><span class="n">Schema</span><span class="p">()[</span><span class="n">name</span><span class="p">]</span>
        <span class="n">newfield</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">nc</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>

<span class="c"># Mark creation flag to be set</span>
<span class="n">nc</span><span class="o">.</span><span class="n">processForm</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="validating-objects">
<h2><a class="toc-backref" href="#id13">Validating objects</a><a class="headerlink" href="#validating-objects" title="Permalink to this headline">¶</a></h2>
<p>Example for <em>nc</em> AT object:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">errors</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">nc</span><span class="o">.</span><span class="n">Schema</span><span class="p">()</span><span class="o">.</span><span class="n">validate</span><span class="p">(</span><span class="n">nc</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="n">errors</span><span class="p">,</span> <span class="bp">True</span><span class="p">,</span> <span class="bp">True</span><span class="p">)</span>
<span class="k">if</span> <span class="n">errors</span><span class="p">:</span>
    <span class="k">assert</span> <span class="ow">not</span> <span class="n">errors</span><span class="p">,</span> <span class="s">&quot;Got errors:&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">errors</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="checking-permissions">
<h2><a class="toc-backref" href="#id14">Checking permissions</a><a class="headerlink" href="#checking-permissions" title="Permalink to this headline">¶</a></h2>
<p>field.writeable() provides a short-cut whether the currently
logged in user can change the field value.</p>
<p>Example:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">field</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="n">Schema</span><span class="p">()[</span><span class="s">&quot;phone_number&quot;</span><span class="p">]</span>
<span class="k">assert</span> <span class="n">field</span><span class="o">.</span><span class="n">writeable</span><span class="p">(),</span> <span class="s">&quot;Cannot set phone number&quot;</span>
</pre></div>
</div>
<p>There is also a verbose debugging version which will print the reason
to log if the writeable condition is not effective:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">field</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="n">Schema</span><span class="p">()[</span><span class="s">&quot;phone_number&quot;</span><span class="p">]</span>
<span class="k">assert</span> <span class="n">field</span><span class="o">.</span><span class="n">writeable</span><span class="p">(</span><span class="n">debug</span><span class="o">=</span><span class="bp">True</span><span class="p">),</span> <span class="s">&quot;Cannot set phone number&quot;</span>
</pre></div>
</div>
</div>
<div class="section" id="modifying-all-fields-in-schema">
<h2><a class="toc-backref" href="#id15">Modifying all fields in schema</a><a class="headerlink" href="#modifying-all-fields-in-schema" title="Permalink to this headline">¶</a></h2>
<p>You might want to modify all schema fields based on some criteria.</p>
<p>Example how to hide all metadata fields:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">ExperienceEducatorSchema</span><span class="o">.</span><span class="n">filterFields</span><span class="p">(</span><span class="n">isMetadata</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span> <span class="n">f</span><span class="o">.</span><span class="n">widget</span><span class="o">.</span><span class="n">visible</span> <span class="o">=</span> <span class="p">{</span> <span class="s">&quot;edit&quot;</span> <span class="p">:</span> <span class="s">&quot;invisible&quot;</span> <span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="reordering-fields">
<h2><a class="toc-backref" href="#id16">Reordering fields</a><a class="headerlink" href="#reordering-fields" title="Permalink to this headline">¶</a></h2>
<p>See moveField() in <a class="reference external" href="http://svn.plone.org/svn/archetypes/Products.Archetypes/trunk/Products/Archetypes/Schema/__init__.py">Schema/__init__.py</a>.</p>
<p>Example</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">ProductCardFolderSchema</span> <span class="o">=</span> <span class="n">MountPointSchema</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span> <span class="o">+</span> <span class="n">atapi</span><span class="o">.</span><span class="n">Schema</span><span class="p">((</span>

    <span class="c"># -*- Your Archetypes field definitions here ... -*-</span>
    <span class="n">atapi</span><span class="o">.</span><span class="n">StringField</span><span class="p">(</span>
        <span class="s">&#39;pageTitle&#39;</span><span class="p">,</span>
        <span class="n">stxxxge</span><span class="o">=</span><span class="n">atapi</span><span class="o">.</span><span class="n">AnnotationStxxxge</span><span class="p">(),</span>
        <span class="n">widget</span><span class="o">=</span><span class="n">atapi</span><span class="o">.</span><span class="n">StringWidget</span><span class="p">(</span>
            <span class="n">label</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s">u&quot;Page title&quot;</span><span class="p">),</span>
            <span class="n">description</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s">u&quot;Title shown on the page text if differs from the navigation title&quot;</span><span class="p">),</span>
        <span class="p">),</span>
        <span class="n">default</span><span class="o">=</span><span class="s">&quot;&quot;</span>
    <span class="p">),</span>

   <span class="o">...</span>


<span class="p">))</span>


<span class="n">schemata</span><span class="o">.</span><span class="n">finalizeATCTSchema</span><span class="p">(</span>
    <span class="n">ProductCardFolderSchema</span><span class="p">,</span>
    <span class="n">folderish</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
    <span class="n">moveDiscussion</span><span class="o">=</span><span class="bp">False</span>
<span class="p">)</span>

<span class="c"># Reorder schema fields to the final order,</span>
<span class="c"># show special pageTitle field after actual Title field</span>
<span class="n">ProductCardFolderSchema</span><span class="o">.</span><span class="n">moveField</span><span class="p">(</span><span class="s">&quot;pageTitle&quot;</span><span class="p">,</span> <span class="n">after</span><span class="o">=</span><span class="s">&quot;title&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="hiding-widgets">
<h2><a class="toc-backref" href="#id17">Hiding widgets</a><a class="headerlink" href="#hiding-widgets" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li>You should not remove core Plone fields (Title, Description) as they
are used by Plone internally e.g. in the navigation tree</li>
<li>But you can override their accessor functions <tt class="docutils literal"><span class="pre">Title()</span></tt> and
<tt class="docutils literal"><span class="pre">Description()</span></tt></li>
<li>You can also hide the widgets</li>
</ul>
<p>The recommended approach is to hide the widgets,
then update the field contents when the relevant data is update.
E.g. you can generate title value from fields firstname and lastname.</p>
<p>Below is an example which uses custom JSON field as input,
and then sets title and description based on it:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="sd">&quot;&quot;&quot;Definition of the XXX Researcher content type</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">logging</span>
<span class="kn">import</span> <span class="nn">json</span> <span class="c"># py2.6</span>

<span class="kn">from</span> <span class="nn">zope.interface</span> <span class="kn">import</span> <span class="n">implements</span><span class="p">,</span> <span class="n">directlyProvides</span><span class="p">,</span> <span class="n">alsoProvides</span>

<span class="kn">from</span> <span class="nn">five</span> <span class="kn">import</span> <span class="n">grok</span>

<span class="kn">from</span> <span class="nn">Products.Archetypes.interfaces</span> <span class="kn">import</span> <span class="n">IObjectEditedEvent</span>
<span class="kn">from</span> <span class="nn">Products.Archetypes</span> <span class="kn">import</span> <span class="n">atapi</span>
<span class="kn">from</span> <span class="nn">Products.ATContentTypes.content</span> <span class="kn">import</span> <span class="n">folder</span>
<span class="kn">from</span> <span class="nn">Products.ATContentTypes.content</span> <span class="kn">import</span> <span class="n">schemata</span>

<span class="kn">from</span> <span class="nn">xxx.objects</span> <span class="kn">import</span> <span class="n">objectsMessageFactory</span> <span class="k">as</span> <span class="n">_</span>
<span class="kn">from</span> <span class="nn">xxx.objects.interfaces</span> <span class="kn">import</span> <span class="n">IXXXResearcher</span>
<span class="kn">from</span> <span class="nn">xxx.objects.config</span> <span class="kn">import</span> <span class="n">PROJECTNAME</span>

<span class="n">XXXResearcherSchema</span> <span class="o">=</span> <span class="n">folder</span><span class="o">.</span><span class="n">ATFolderSchema</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span> <span class="o">+</span> <span class="n">atapi</span><span class="o">.</span><span class="n">Schema</span><span class="p">((</span>

    <span class="c"># -*- Your Archetypes field definitions here ... -*-</span>

    <span class="c"># Stores XXX entry as JSON string</span>
    <span class="n">atapi</span><span class="o">.</span><span class="n">TextField</span><span class="p">(</span><span class="s">&quot;XXXData&quot;</span><span class="p">,</span>
                    <span class="n">required</span> <span class="o">=</span>  <span class="bp">True</span><span class="p">,</span>
                    <span class="n">widget</span><span class="o">=</span><span class="n">atapi</span><span class="o">.</span><span class="n">StringWidget</span><span class="p">(</span>
                                <span class="n">label</span><span class="o">=</span><span class="s">&quot;XXX source entry&quot;</span><span class="p">,</span>
                                <span class="n">description</span><span class="o">=</span><span class="s">&quot;Start typing person&#39;s name&quot;</span>
                                <span class="p">)),</span>

<span class="p">))</span>

<span class="n">XXXResearcherSchema</span><span class="p">[</span><span class="s">&quot;title&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">widget</span><span class="o">.</span><span class="n">visible</span> <span class="o">=</span> <span class="p">{</span><span class="s">&quot;edit&quot;</span><span class="p">:</span> <span class="s">&quot;invisible&quot;</span> <span class="p">}</span>
<span class="n">XXXResearcherSchema</span><span class="p">[</span><span class="s">&quot;description&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">widget</span><span class="o">.</span><span class="n">visible</span> <span class="o">=</span> <span class="p">{</span><span class="s">&quot;edit&quot;</span><span class="p">:</span> <span class="s">&quot;invisible&quot;</span> <span class="p">}</span>

<span class="c"># Set stxxxge on fields copied from ATFolderSchema, making sure</span>
<span class="c"># they work well with the python bridge properties.</span>

<span class="n">schemata</span><span class="o">.</span><span class="n">finalizeATCTSchema</span><span class="p">(</span>
    <span class="n">XXXResearcherSchema</span><span class="p">,</span>
    <span class="n">folderish</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
    <span class="n">moveDiscussion</span><span class="o">=</span><span class="bp">False</span>
<span class="p">)</span>

<span class="k">class</span> <span class="nc">XXXResearcher</span><span class="p">(</span><span class="n">folder</span><span class="o">.</span><span class="n">ATFolder</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;A Researcher synchronized from XXX.</span>

<span class="sd">    This content will have all</span>



<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">implements</span><span class="p">(</span><span class="n">IXXXResearcher</span><span class="p">)</span>

    <span class="n">meta_type</span> <span class="o">=</span> <span class="s">&quot;XXXResearcher&quot;</span>
    <span class="n">schema</span> <span class="o">=</span> <span class="n">XXXResearcherSchema</span>

    <span class="c"># -*- Your ATSchema to Python Property Bridges Here ... -*-</span>

    <span class="k">def</span> <span class="nf">refreshXXXData</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Performs collective.mountpoint synchronization for one object.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c">#synchronize_item(self, logging.WARNING)</span>

    <span class="k">def</span> <span class="nf">updateXXX</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">json</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        @param json: JSON payload as a string</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parseXXXData</span><span class="p">(</span><span class="n">json</span><span class="p">)</span>

        <span class="c"># Set this core Plone fields to actual values,</span>
        <span class="c"># so that we surely co-operate with old legacy code</span>

        <span class="n">title</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getTitleFromData</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="n">desc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getDescriptionFromData</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">setTitle</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setDescription</span><span class="p">(</span><span class="n">desc</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">parseXXXData</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">jsonData</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        @return Python dict</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">jsonData</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">getParsedXXXData</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return XXX JSON data parsed to Python object.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getXXXData</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">data</span> <span class="o">==</span> <span class="s">&quot;&quot;</span> <span class="ow">or</span> <span class="n">data</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">None</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">parseXXXData</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">getTitleFromData</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Use lastname + surname from FOAF data as the connt title.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">title</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">u&quot;foaf_name&quot;</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">title</span> <span class="o">==</span> <span class="s">&quot;&quot;</span> <span class="ow">or</span> <span class="n">title</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="c"># Title must have something so that the users</span>
            <span class="c"># can click this item in list...</span>
            <span class="n">title</span> <span class="o">=</span> <span class="s">&quot;(unnamed)&quot;</span>

        <span class="c"># foaf_name is actually list of values, so we need to merge them</span>
        <span class="n">title</span> <span class="o">=</span> <span class="s">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">title</span>

    <span class="k">def</span> <span class="nf">getDescriptionFromData</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Extract content item description from data blob &quot;&quot;&quot;</span>

        <span class="n">desc</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">u&quot;dc_description&quot;</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">desc</span> <span class="ow">is</span> <span class="bp">None</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">desc</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="c"># Decription is not required, we get omit it</span>
            <span class="k">return</span> <span class="bp">None</span>

        <span class="c"># dc_description is actually a list of description</span>
        <span class="c"># let&#39;s merge them to string here</span>
        <span class="n">desc</span> <span class="o">=</span> <span class="s">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">desc</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">desc</span>


<span class="n">atapi</span><span class="o">.</span><span class="n">registerType</span><span class="p">(</span><span class="n">XXXResearcher</span><span class="p">,</span> <span class="n">PROJECTNAME</span><span class="p">)</span>

<span class="nd">@grok.subscribe</span><span class="p">(</span><span class="n">XXXResearcher</span><span class="p">,</span> <span class="n">IObjectEditedEvent</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">object_edited</span><span class="p">(</span><span class="n">context</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Event handler which will update title + description</span>
<span class="sd">    values every time the object has been edited.</span>

<span class="sd">    @param context: Object for which the event was fired</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c"># Read JSON data entry which user entered on the form</span>
    <span class="n">json</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="n">getXXXData</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">json</span> <span class="o">!=</span> <span class="bp">None</span><span class="p">:</span>

        <span class="c"># Update the core fields to reflect changes</span>
        <span class="c"># in JSON data</span>
        <span class="n">context</span><span class="o">.</span><span class="n">updateXXX</span><span class="p">(</span><span class="n">json</span><span class="p">)</span>

        <span class="c"># Reflect object changes back to the portal catalog</span>
        <span class="c"># Note that we are running reindexObject()</span>
        <span class="c"># here again... edit itself runs it and</span>
        <span class="c"># we could do some optimization here</span>
        <span class="n">context</span><span class="o">.</span><span class="n">reindexObject</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="section" id="rendering-widget">
<h2><a class="toc-backref" href="#id18">Rendering widget</a><a class="headerlink" href="#rendering-widget" title="Permalink to this headline">¶</a></h2>
<p>Archetypes is hardwired to render widgets from viewless TAL page templates.</p>
<p>Example how to render widget for field 'maintext':</p>
<div class="highlight-python"><pre>&lt;tal:fields tal:define="field_macro here/widgets/field/macros/view;
                        field python:here.Schema()['maintext']"&gt;

  &lt;tal:if_visible define="mode string:view;
                          visState python:field.widget.isVisible(here, mode);
                          visCondition python:field.widget.testCondition(context.aq_inner.aq_parent, portal, context);"
                  condition="python:visState == 'visible' and visCondition"&gt;
    &lt;metal:use_field use-macro="field_macro" /&gt;
  &lt;/tal:if_visible&gt;
&lt;/tal:fields&gt;</pre>
</div>
</div>
<div class="section" id="creating-your-own-field">
<h2><a class="toc-backref" href="#id19">Creating your own Field</a><a class="headerlink" href="#creating-your-own-field" title="Permalink to this headline">¶</a></h2>
<p>Here is an example how to create a custom field based on TextField.</p>
<p>Example (mfabrik/rstpage/archetypes/fields.py):</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">Products.Archetypes</span> <span class="kn">import</span> <span class="n">public</span> <span class="k">as</span> <span class="n">atapi</span>
<span class="kn">from</span> <span class="nn">Products.Archetypes.Field</span> <span class="kn">import</span> <span class="n">TextField</span><span class="p">,</span> <span class="n">ObjectField</span><span class="p">,</span> <span class="n">encode</span><span class="p">,</span> <span class="n">decode</span><span class="p">,</span> <span class="n">registerField</span>

<span class="kn">from</span> <span class="nn">mfabrik.rstpage.transform</span> <span class="kn">import</span> <span class="n">transform_rst_to_html</span>

<span class="k">class</span> <span class="nc">RSTField</span><span class="p">(</span><span class="n">atapi</span><span class="o">.</span><span class="n">TextField</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">_getCooked</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">instance</span><span class="p">,</span> <span class="n">text</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Perform reST to HTML transformation for the field cotent.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">html</span><span class="p">,</span> <span class="n">errors</span> <span class="o">=</span> <span class="n">transform_rst_to_html</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">html</span>

    <span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">instance</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Field accessor.</span>

<span class="sd">        Define view mode accessor for the widget.</span>

<span class="sd">        @param instance: Archetypes content item instance</span>

<span class="sd">        @param kwargs: Arbitary parameters passed to the field getter</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c"># Read the stored field value from the instance</span>
        <span class="n">text</span> <span class="o">=</span> <span class="n">ObjectField</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">instance</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="c"># raw = edit mode, get reST source in that case</span>
        <span class="n">raw</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;raw&quot;</span><span class="p">,</span> <span class="bp">False</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">raw</span><span class="p">:</span>
            <span class="c"># Return reST source</span>
            <span class="k">return</span> <span class="n">text</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c"># Return HTML for viewing</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_getCooked</span><span class="p">(</span><span class="n">instance</span><span class="p">,</span> <span class="n">text</span><span class="p">)</span>


<span class="n">registerField</span><span class="p">(</span><span class="n">RSTField</span><span class="p">,</span>
              <span class="n">title</span><span class="o">=</span><span class="s">&#39;Restructured Text field&#39;</span><span class="p">,</span>
              <span class="n">description</span><span class="o">=</span><span class="p">(</span><span class="s">&#39;Edit HTML as reST source&#39;</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="section" id="automatically-generating-description-based-on-body-text">
<h2><a class="toc-backref" href="#id20">Automatically generating description based on body text</a><a class="headerlink" href="#automatically-generating-description-based-on-body-text" title="Permalink to this headline">¶</a></h2>
<p>Below is a sample through-the-web Python Script which
you can drop to any Plone through Zope Management Interface.</p>
<p>Use case: People are lazy to write descriptions
(as in Dublin Core metadata). You can generate some kind
of description by taking the few first sentences of the text.
This is not perfect, but this is way better than empty description.</p>
<p>This script will provide one-time operation to automatically
generate content item descriptions based on their body text
by taking the first three sentences.</p>
<p>The script will provide logging output to standard Plone log
(var/log and stdout if Plone is run in the debug mode).</p>
<p>Example code:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">create_automatic_description</span><span class="p">(</span><span class="n">content</span><span class="p">,</span> <span class="n">text_field_name</span><span class="o">=</span><span class="s">&quot;text&quot;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Creates an automatic description from HTML body by taking three first sentences.</span>

<span class="sd">    Takes the body text</span>

<span class="sd">    @param content: Any Plone contentish item (they all have description)</span>

<span class="sd">    @param text_field_name: Which schema field is used to supply the body text (may very depending on the content type)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c"># Body is Archetype &quot;text&quot; field in schema by default.</span>
    <span class="c"># Accessor can take the desired format as a mimetype parameter.</span>
    <span class="c"># The line below should trigger conversion from text/html -&gt; text/plain automatically using portal_transforms</span>
    <span class="n">field</span> <span class="o">=</span> <span class="n">content</span><span class="o">.</span><span class="n">Schema</span><span class="p">()[</span><span class="n">text_field_name</span><span class="p">]</span>

    <span class="c"># Returns a Python method which you can call to get field&#39;s</span>
    <span class="c"># for a certain content type. This is also security aware</span>
    <span class="c"># and does not breach field-level security provded by Archetypes</span>
    <span class="n">accessor</span> <span class="o">=</span> <span class="n">field</span><span class="o">.</span><span class="n">getAccessor</span><span class="p">(</span><span class="n">content</span><span class="p">)</span>

    <span class="c"># body is UTF-8</span>
    <span class="n">body</span> <span class="o">=</span> <span class="n">accessor</span><span class="p">(</span><span class="n">mimetype</span><span class="o">=</span><span class="s">&quot;text/plain&quot;</span><span class="p">)</span>

    <span class="c"># Now let&#39;s take three first sentences or the whole content of body</span>
    <span class="n">sentences</span> <span class="o">=</span> <span class="n">body</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&quot;.&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">sentences</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">3</span><span class="p">:</span>
       <span class="n">intro</span> <span class="o">=</span> <span class="s">&quot;.&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">sentences</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">3</span><span class="p">])</span>
       <span class="n">intro</span> <span class="o">+=</span> <span class="s">&quot;.&quot;</span> <span class="c"># Don&#39;t forget closing the last sentence</span>
    <span class="k">else</span><span class="p">:</span>
       <span class="c"># Body text is shorter than 3 sentences</span>
       <span class="n">intro</span> <span class="o">=</span> <span class="n">body</span>

    <span class="n">content</span><span class="o">.</span><span class="n">setDescription</span><span class="p">(</span><span class="n">intro</span><span class="p">)</span>


<span class="c"># context is the reference of the folder where this script is run</span>
<span class="k">for</span> <span class="nb">id</span><span class="p">,</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">context</span><span class="o">.</span><span class="n">contentItems</span><span class="p">():</span>
     <span class="c"># Iterate through all content items (this ignores Zope objects like this script itself)</span>

     <span class="c"># Use RestrictedPython safe logging.</span>
     <span class="c"># plone_log() method is permission aware and available on any contentish object</span>
     <span class="c"># so we can safely use it from through-the-web scripts</span>
     <span class="n">context</span><span class="o">.</span><span class="n">plone_log</span><span class="p">(</span><span class="s">&quot;Fixing:&quot;</span> <span class="o">+</span> <span class="nb">id</span><span class="p">)</span>

     <span class="c"># Check that the description has never been saved (None)</span>
     <span class="c"># or it is empty, so we do not override a description someone has</span>
     <span class="c"># set before automatically or manually</span>
     <span class="n">desc</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="n">Description</span><span class="p">()</span> <span class="c"># All Archetypes accessor method, returns UTF-8 encoded string</span>

     <span class="k">if</span> <span class="n">desc</span> <span class="ow">is</span> <span class="bp">None</span> <span class="ow">or</span> <span class="n">desc</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="o">==</span> <span class="s">&quot;&quot;</span><span class="p">:</span>
          <span class="c"># We use the HTML of field called &quot;text&quot; to generate the description</span>
          <span class="n">create_automatic_description</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="s">&quot;text&quot;</span><span class="p">)</span>

<span class="c"># This will be printed in the browser when the script completes succesfully</span>
<span class="k">return</span> <span class="s">&quot;OK&quot;</span>
</pre></div>
</div>
<p>See also</p>
<ul class="simple">
<li><a class="reference external" href="http://blog.mfabrik.com/2010/06/04/automatically-generating-description-based-on-body-text/">http://blog.mfabrik.com/2010/06/04/automatically-generating-description-based-on-body-text/</a></li>
</ul>
</div>
<div class="section" id="vocabularies">
<h2><a class="toc-backref" href="#id21">Vocabularies</a><a class="headerlink" href="#vocabularies" title="Permalink to this headline">¶</a></h2>
<p>Archetypes has its own vocabulary infrastructure which is not compatible with <a class="reference internal" href="../../models/vocabularies.html"><em>zope.schema vocabularies</em></a>.</p>
<div class="section" id="dynamic-vocabularies">
<h3><a class="toc-backref" href="#id22">Dynamic vocabularies</a><a class="headerlink" href="#dynamic-vocabularies" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><a class="reference external" href="http://www.universalwebservices.net/web-programming-resources/zope-plone/dynamic-vocabularies-in-plone-archetypes">http://www.universalwebservices.net/web-programming-resources/zope-plone/dynamic-vocabularies-in-plone-archetypes</a></li>
</ul>
</div>
</div>
<div class="section" id="rendering-single-field">
<h2><a class="toc-backref" href="#id23">Rendering single field</a><a class="headerlink" href="#rendering-single-field" title="Permalink to this headline">¶</a></h2>
<p>Example:</p>
<div class="highlight-python"><pre>&lt;metal:fieldMacro use-macro="python:context.widget(field.getName(), mode='edit')" /&gt;</pre>
</div>
</div>
<div class="section" id="hiding-widgets-conditionally">
<h2><a class="toc-backref" href="#id24">Hiding widgets conditionally</a><a class="headerlink" href="#hiding-widgets-conditionally" title="Permalink to this headline">¶</a></h2>
<p>AT widgets have <tt class="docutils literal"><span class="pre">condition</span></tt> <a class="reference internal" href="../../functionality/expressions.html"><em>expression</em></a>.</p>
<p>Example how to set a condition for multiple widgets to call a BrowserView to ask whether the widget should be visible or not:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="n">ResearcherSchema</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
    <span class="c"># setCondition() is in Products.Archetypes.Widget</span>
    <span class="c"># possible expression variables are_ object, portal, folder.</span>
    <span class="n">field</span><span class="o">.</span><span class="n">widget</span><span class="o">.</span><span class="n">setCondition</span><span class="p">(</span><span class="s">&quot;python:object.restrictedTraverse(&#39;@@msd_widget_condition&#39;)(&#39;&quot;</span> <span class="o">+</span> <span class="n">field</span><span class="o">.</span><span class="n">getName</span><span class="p">()</span> <span class="o">+</span> <span class="s">&quot;&#39;)&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>The related view with some sample code:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">WidgetCondition</span><span class="p">(</span><span class="n">BrowserView</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This is referred in msd.researcher schema conditions field.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fieldName</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">settings</span> <span class="o">=</span> <span class="n">getResearcherSettings</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="p">)</span>
        <span class="n">customization</span> <span class="o">=</span> <span class="n">settings</span><span class="o">.</span><span class="n">getFieldCustomization</span><span class="p">(</span><span class="n">fieldName</span><span class="p">,</span> <span class="s">&quot;visible&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">customization</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">customization</span>

        <span class="c"># Default is visible</span>
        <span class="k">return</span> <span class="bp">True</span>
</pre></div>
</div>
</div>
<div class="section" id="dynamic-field-definitions">
<h2><a class="toc-backref" href="#id25">Dynamic field definitions</a><a class="headerlink" href="#dynamic-field-definitions" title="Permalink to this headline">¶</a></h2>
<p>You can override <tt class="docutils literal"><span class="pre">Schema()</span></tt> and <tt class="docutils literal"><span class="pre">Schemata()</span></tt> methods in your content type class
to poke the schema per HTTP request access basis.</p>
<p>Example:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">Schema</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Overrides field definitions in fly.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c"># XXX: Cache this method?</span>
    <span class="kn">from</span> <span class="nn">Acquisition</span> <span class="kn">import</span> <span class="n">ImplicitAcquisitionWrapper</span>
    <span class="kn">from</span> <span class="nn">Products.Archetypes.interfaces</span> <span class="kn">import</span> <span class="n">ISchema</span>

    <span class="c"># Create modifiable copy of schema</span>
    <span class="c"># See Products.Archetypes.BaseObject</span>
    <span class="n">schema</span> <span class="o">=</span> <span class="n">ISchema</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
    <span class="n">schema</span> <span class="o">=</span> <span class="n">schema</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">schema</span> <span class="o">=</span> <span class="n">ImplicitAcquisitionWrapper</span><span class="p">(</span><span class="n">schema</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>

    <span class="n">settings</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getResearchSettings</span><span class="p">()</span>

    <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">settings</span><span class="o">.</span><span class="n">getFieldCustomizations</span><span class="p">():</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">row</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;fieldName&quot;</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
        <span class="n">vocab</span> <span class="o">=</span> <span class="n">row</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;vocabToUse&quot;</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>

        <span class="n">field</span> <span class="o">=</span> <span class="n">schema</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">field</span> <span class="ow">and</span> <span class="n">vocab</span> <span class="ow">and</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">field</span><span class="p">,</span> <span class="s">&quot;vocabulary&quot;</span><span class="p">):</span>
            <span class="c"># Modify field copy ion</span>

            <span class="n">displayList</span> <span class="o">=</span> <span class="n">settings</span><span class="o">.</span><span class="n">getVocabulary</span><span class="p">(</span><span class="n">vocab</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">displayList</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">field</span><span class="o">.</span><span class="n">vocabulary</span> <span class="o">=</span> <span class="n">displayList</span>

    <span class="k">return</span> <span class="n">schema</span>
</pre></div>
</div>
</div>
</div>

  </div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
<p class="logo"><a href="../../index.html"><img src="../../_static/plone-icon-64.png" />
</a></p>

  <h3><a href="../../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Fields and widgets</a><ul>
<li><a class="reference internal" href="#introduction">Introduction</a></li>
<li><a class="reference internal" href="#getting-hold-of-schema-objects">Getting hold of schema objects</a><ul>
<li><a class="reference internal" href="#during-application-start-up">During application start-up</a></li>
<li><a class="reference internal" href="#during-http-request-processing">During HTTP request processing</a></li>
</ul>
</li>
<li><a class="reference internal" href="#schema-introspection">Schema introspection</a><ul>
<li><a class="reference internal" href="#out-of-box-schema-source-code">Out of box schema source code</a></li>
<li><a class="reference internal" href="#run-time-introspection">Run-time introspection</a></li>
</ul>
</li>
<li><a class="reference internal" href="#field-name">Field name</a></li>
<li><a class="reference internal" href="#accessing-archetypes-field-value">Accessing Archetypes field value</a><ul>
<li><a class="reference internal" href="#accessor-method">Accessor method</a></li>
<li><a class="reference internal" href="#raw-access">Raw access</a></li>
<li><a class="reference internal" href="#indirect-access">Indirect access</a></li>
</ul>
</li>
<li><a class="reference internal" href="#validating-objects">Validating objects</a></li>
<li><a class="reference internal" href="#checking-permissions">Checking permissions</a></li>
<li><a class="reference internal" href="#modifying-all-fields-in-schema">Modifying all fields in schema</a></li>
<li><a class="reference internal" href="#reordering-fields">Reordering fields</a></li>
<li><a class="reference internal" href="#hiding-widgets">Hiding widgets</a></li>
<li><a class="reference internal" href="#rendering-widget">Rendering widget</a></li>
<li><a class="reference internal" href="#creating-your-own-field">Creating your own Field</a></li>
<li><a class="reference internal" href="#automatically-generating-description-based-on-body-text">Automatically generating description based on body text</a></li>
<li><a class="reference internal" href="#vocabularies">Vocabularies</a><ul>
<li><a class="reference internal" href="#dynamic-vocabularies">Dynamic vocabularies</a></li>
</ul>
</li>
<li><a class="reference internal" href="#rendering-single-field">Rendering single field</a></li>
<li><a class="reference internal" href="#hiding-widgets-conditionally">Hiding widgets conditionally</a></li>
<li><a class="reference internal" href="#dynamic-field-definitions">Dynamic field definitions</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="index.html"
                        title="previous chapter">Archetypes</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="storages.html"
                        title="next chapter">Field storages</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="../../_sources/content/archetypes/fields.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" size="18" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="storages.html" title="Field storages"
             >next</a> |</li>
        <li class="right" >
          <a href="index.html" title="Archetypes"
             >previous</a> |</li>
        <li><a href="../../index.html">Plone Community Managed Developer Manual v1.0 documentation</a> &raquo;</li>
          <li><a href="../index.html" >Content management</a> &raquo;</li>
          <li><a href="index.html" >Archetypes</a> &raquo;</li> 
      </ul>
    </div>

    <div class="footer">
        &copy; Copyright 2010 mFabrik Research Oy and Plone community contributors.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.0.4.
    </div>


  </body>
</html>