<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Zope DateTime &mdash; Plone Community Managed Developer Manual v1.0 documentation</title>
    <link rel="stylesheet" href="../_static/plone.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '1.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="top" title="Plone Community Managed Developer Manual v1.0 documentation" href="../index.html" />
    <link rel="up" title="Miscellaneous information" href="index.html" />
    <link rel="next" title="Sending email" href="email.html" />
    <link rel="prev" title="Context helpers" href="context.html" />
<script language="javascript">
//<![CDATA[

Documentation.addTranslations({"locale": "fr", "plural_expr": "(n > 1)", "messages": {"See the definition": "Voir la d\u00e9finition"}});

// See http://disqus.disqus.com/general_integration_help/
var disqus_developer = 1;
if (document.location.protocol == 'http:') {
    disqus_developer = 0;
}

// Some HTML/CSS transforms we can't do in pure CSS (waiting for CSS3 support)
$(document).ready(function () {

    // Style of .. verisonmodified:: , .. versionadded:: ...
    $('p:has(span.versionmodified)').addClass('p-versionmodified');

    // Style of the TOC tree
    $('ul:has(li.toctree-l1)').addClass('toctree');

    // Decorate links to other sites
    $('a[class~=external]').attr('target', '_blank');

    // Glossary terms
    $('em.xref').attr('title', _('See the definition'));

    // We need to have all <pre> in a <div class="highlight"> to mimic pygments
    // to work around a pygments (?) bug
    var suffixes = {cfg: null, python:null};
    for (var suffix in suffixes) {
        var pattern = 'div.highlight-' + suffix + ' > pre';
        $(pattern).wrap('<div class="highlight" />');
    }
    return true;
});
//]]>
</script>

  </head>
  <body>
<!--[if lte IE 6]>
<style type="text/css">
#ie6msg{border:3px solid #090; margin:8px 0; background:#cfc; color:#000;}
#ie6msg h4{margin:8px; padding:0;}
#ie6msg p{margin:8px; padding:0;}
#ie6msg p a.getie8{font-weight:bold; color:#006;}
#ie6msg p a.ie6expl{font-weight:normal; color:#006;}
</style>
<div id="ie6msg">
<h4>Did you know that your browser is out of date?</h4>
<p>If the layout of this site seems ugly, that's because you're actually using
an outdated browser. And we wont put any effort to provide a nice layout to IE6
users.</p>
<p>To get the best possible experience using our website we recommend that you
upgrade your browser to a newer version. The current version
is <a class="getie8"
href="http://upgradeie.s3.amazonaws.com/eng/index.html">Internet Explorer
8</a>. The upgrade is free. If you're using a PC at work you should contact your
IT administrator.</p>
<p>If you want to you may also try some other popular Internet browsers
like <a class="ie6expl"
href="http://getfirefox.com">Firefox</a>, <a class="ie6expl"
href="http://www.google.com/chrome">Chrome</a>, <a class="ie6expl"
href="http://www.opera.com">Opera</a>, or <a class="ie6expl"
href="http://www.apple.com/safari/download/">Safari</a></p>
</div>
<![endif]-->

    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="email.html" title="Sending email"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="context.html" title="Context helpers"
             accesskey="P">previous</a> |</li>
        <li><a href="../index.html">Plone Community Managed Developer Manual v1.0 documentation</a> &raquo;</li>
          <li><a href="index.html" accesskey="U">Miscellaneous information</a> &raquo;</li> 
      </ul>
    </div>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="sphinx-content">
    <div class="section" id="zope-datetime">
<h1>Zope DateTime<a class="headerlink" href="#zope-datetime" title="Permalink to this headline">¶</a></h1>
<div class="admonition-description admonition ">
<p class="first admonition-title">Description</p>
<p class="last">Using Zope DateTime class in Plone programming</p>
</div>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><a class="reference internal" href="#introduction" id="id2">Introduction</a></li>
<li><a class="reference internal" href="#datetime-api" id="id3">DateTime API</a></li>
<li><a class="reference internal" href="#converting-between-datetime-and-datetime" id="id4">Converting between DateTime and datetime</a></li>
<li><a class="reference internal" href="#datetime-problems-and-pitfalls" id="id5">DateTime problems and pitfalls</a></li>
<li><a class="reference internal" href="#parsing-both-us-and-european-dates" id="id6">Parsing both US and European dates</a></li>
<li><a class="reference internal" href="#friendly-date-time-formatting" id="id7">Friendly date/time formatting</a></li>
</ul>
</div>
<div class="section" id="introduction">
<h2><a class="toc-backref" href="#id2">Introduction</a><a class="headerlink" href="#introduction" title="Permalink to this headline">¶</a></h2>
<p>Some Plone dates are stored as Zope DateTime objects.
This is different from standard Python datetime (notice the letter casing).
Zope DateTime predates Python datetime which was added in Python 2.4.
Zope DateTime is old code, so do rites necessary
for your religion before programming with it.</p>
<ul class="simple">
<li><a class="reference external" href="http://pypi.python.org/pypi/DateTime/">Zope DateTime HTML API documentation</a></li>
<li><a class="reference external" href="http://docs.python.org/library/datetime.html">Python datetime documentation</a></li>
</ul>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Using Python datetime is recommended if possible.
Zope DateTime should be dealt in legacy systems only
as Python datetime is much more documented and widely used.</p>
</div>
</div>
<div class="section" id="datetime-api">
<h2><a class="toc-backref" href="#id3">DateTime API</a><a class="headerlink" href="#datetime-api" title="Permalink to this headline">¶</a></h2>
<p><a class="reference external" href="http://pypi.python.org/pypi/DateTime/">Zope DateTime HTML API documentation</a></p>
<p>You may find the following links useful</p>
<ul class="simple">
<li><a class="reference external" href="http://svn.zope.org/DateTime/trunk/src/DateTime/DateTime.txt?rev=96241&amp;view=auto">README</a></li>
<li><a class="reference external" href="http://svn.zope.org/DateTime/trunk/src/DateTime/interfaces.py?rev=96241&amp;view=auto">Interface description</a></li>
</ul>
</div>
<div class="section" id="converting-between-datetime-and-datetime">
<h2><a class="toc-backref" href="#id4">Converting between DateTime and datetime</a><a class="headerlink" href="#converting-between-datetime-and-datetime" title="Permalink to this headline">¶</a></h2>
<p>Since two different datetime object types are used, you need to often convert between them.</p>
<p>Please see</p>
<ul class="simple">
<li><a class="reference external" href="http://api.plone.org/Plone/2.1.4/public/frames/ATContentTypes/ATContentTypes.utils-module.html">http://api.plone.org/Plone/2.1.4/public/frames/ATContentTypes/ATContentTypes.utils-module.html</a></li>
</ul>
<p>DateTime to datetime:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">Products.ATContentTypes.utils</span> <span class="kn">import</span> <span class="n">DT2dt</span>

<span class="n">python_dt</span> <span class="o">=</span> <span class="n">DT2dt</span><span class="p">(</span><span class="n">zope_dt</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="datetime-problems-and-pitfalls">
<h2><a class="toc-backref" href="#id5">DateTime problems and pitfalls</a><a class="headerlink" href="#datetime-problems-and-pitfalls" title="Permalink to this headline">¶</a></h2>
<p>This <strong>will fail</strong> silenty and you get a wrong date:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">dt</span> <span class="o">=</span> <span class="n">DateTime</span><span class="p">(</span><span class="s">&quot;02.07.2010&quot;</span><span class="p">)</span> <span class="c"># Parses like US date 02/07/2010</span>
</pre></div>
</div>
<p>Please see</p>
<ul class="simple">
<li><a class="reference external" href="http://pyyou.wordpress.com/2010/01/11/datetime-against-mx-datetime/">http://pyyou.wordpress.com/2010/01/11/datetime-against-mx-datetime/</a></li>
</ul>
</div>
<div class="section" id="parsing-both-us-and-european-dates">
<h2><a class="toc-backref" href="#id6">Parsing both US and European dates</a><a class="headerlink" href="#parsing-both-us-and-european-dates" title="Permalink to this headline">¶</a></h2>
<p>Example:</p>
<div class="highlight-python"><pre># Lazy ass way to parse both formats
# 2010/31/12
# 31.12.2010
try:
    if "." in rendDate:
        # European
        end = DateTime(rendDate, datefmt='international')
    else:
        # US
        end = DateTime(rendDate)</pre>
</div>
</div>
<div class="section" id="friendly-date-time-formatting">
<h2><a class="toc-backref" href="#id7">Friendly date/time formatting</a><a class="headerlink" href="#friendly-date-time-formatting" title="Permalink to this headline">¶</a></h2>
<p>Format datetime relative to the current time,
human-readable:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">format_datetime_friendly_ago</span><span class="p">(</span><span class="n">date</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Format date &amp; time using site specific settings.</span>

<span class="sd">    @param date: datetime object</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="n">date</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="s">&quot;&quot;</span>

    <span class="n">date</span> <span class="o">=</span> <span class="n">DT2dt</span><span class="p">(</span><span class="n">date</span><span class="p">)</span> <span class="c"># zope DateTime -&gt; python datetime</span>

    <span class="c"># How long ago the timestamp is</span>
    <span class="c"># See timedelta doc http://docs.python.org/lib/datetime-timedelta.html</span>
    <span class="c">#since = datetime.datetime.utcnow() - date</span>

    <span class="n">now</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">utcnow</span><span class="p">()</span>
    <span class="n">now</span> <span class="o">=</span> <span class="n">now</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">tzinfo</span><span class="o">=</span><span class="n">pytz</span><span class="o">.</span><span class="n">utc</span><span class="p">)</span>

    <span class="n">since</span> <span class="o">=</span> <span class="n">now</span> <span class="o">-</span> <span class="n">date</span>

    <span class="n">seconds</span> <span class="o">=</span> <span class="n">since</span><span class="o">.</span><span class="n">seconds</span> <span class="o">+</span> <span class="n">since</span><span class="o">.</span><span class="n">microseconds</span> <span class="o">/</span> <span class="mf">1E6</span> <span class="o">+</span> <span class="n">since</span><span class="o">.</span><span class="n">days</span> <span class="o">*</span> <span class="mi">86400</span>

    <span class="n">days</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">seconds</span> <span class="o">/</span> <span class="p">(</span><span class="mi">3600</span><span class="o">*</span><span class="mi">24</span><span class="p">))</span>

    <span class="k">if</span> <span class="n">days</span> <span class="o">&lt;=</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">seconds</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="c"># Timezone confusion, is in future</span>
        <span class="k">return</span> <span class="s">&quot;moment ago&quot;</span>

    <span class="k">if</span> <span class="n">days</span> <span class="o">&gt;</span> <span class="mi">7</span><span class="p">:</span>
        <span class="c"># Full date</span>
        <span class="k">return</span> <span class="n">date</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s">&quot;</span><span class="si">%d</span><span class="s">.%m.%Y %H:%M&quot;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">days</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">:</span>
        <span class="c"># Week day format</span>
        <span class="k">return</span> <span class="n">date</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s">&quot;%A %H:%M&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">hours</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">seconds</span><span class="o">/</span><span class="mf">3600.0</span><span class="p">)</span>
        <span class="n">minutes</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">floor</span><span class="p">((</span><span class="n">seconds</span> <span class="o">%</span> <span class="mi">3600</span><span class="p">)</span> <span class="o">/</span><span class="mi">60</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">hours</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="s">&quot;</span><span class="si">%d</span><span class="s"> hours </span><span class="si">%d</span><span class="s"> minutes ago&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">hours</span><span class="p">,</span> <span class="n">minutes</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">minutes</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">return</span> <span class="s">&quot;</span><span class="si">%d</span><span class="s"> minutes ago&quot;</span> <span class="o">%</span> <span class="n">minutes</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="s">&quot;few seconds ago&quot;</span>
</pre></div>
</div>
</div>
</div>

  </div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
<p class="logo"><a href="../index.html"><img src="../_static/plone-icon-64.png" />
</a></p>

  <h3><a href="../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Zope DateTime</a><ul>
<li><a class="reference internal" href="#introduction">Introduction</a></li>
<li><a class="reference internal" href="#datetime-api">DateTime API</a></li>
<li><a class="reference internal" href="#converting-between-datetime-and-datetime">Converting between DateTime and datetime</a></li>
<li><a class="reference internal" href="#datetime-problems-and-pitfalls">DateTime problems and pitfalls</a></li>
<li><a class="reference internal" href="#parsing-both-us-and-european-dates">Parsing both US and European dates</a></li>
<li><a class="reference internal" href="#friendly-date-time-formatting">Friendly date/time formatting</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="context.html"
                        title="previous chapter">Context helpers</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="email.html"
                        title="next chapter">Sending email</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="../_sources/misc/datetime.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" size="18" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="email.html" title="Sending email"
             >next</a> |</li>
        <li class="right" >
          <a href="context.html" title="Context helpers"
             >previous</a> |</li>
        <li><a href="../index.html">Plone Community Managed Developer Manual v1.0 documentation</a> &raquo;</li>
          <li><a href="index.html" >Miscellaneous information</a> &raquo;</li> 
      </ul>
    </div>

    <div class="footer">
        &copy; Copyright 2010 mFabrik Research Oy and Plone community contributors.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.0.4.
    </div>


  </body>
</html>