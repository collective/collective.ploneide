<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>HTTP request and response &mdash; Plone Community Managed Developer Manual v1.0 documentation</title>
    <link rel="stylesheet" href="../_static/plone.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '1.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="top" title="Plone Community Managed Developer Manual v1.0 documentation" href="../index.html" />
    <link rel="up" title="Serving HTTP and other protocols" href="index.html" />
    <link rel="next" title="Traversing" href="traversing.html" />
    <link rel="prev" title="Serving HTTP and other protocols" href="index.html" />
<script language="javascript">
//<![CDATA[

Documentation.addTranslations({"locale": "fr", "plural_expr": "(n > 1)", "messages": {"See the definition": "Voir la d\u00e9finition"}});

// See http://disqus.disqus.com/general_integration_help/
var disqus_developer = 1;
if (document.location.protocol == 'http:') {
    disqus_developer = 0;
}

// Some HTML/CSS transforms we can't do in pure CSS (waiting for CSS3 support)
$(document).ready(function () {

    // Style of .. verisonmodified:: , .. versionadded:: ...
    $('p:has(span.versionmodified)').addClass('p-versionmodified');

    // Style of the TOC tree
    $('ul:has(li.toctree-l1)').addClass('toctree');

    // Decorate links to other sites
    $('a[class~=external]').attr('target', '_blank');

    // Glossary terms
    $('em.xref').attr('title', _('See the definition'));

    // We need to have all <pre> in a <div class="highlight"> to mimic pygments
    // to work around a pygments (?) bug
    var suffixes = {cfg: null, python:null};
    for (var suffix in suffixes) {
        var pattern = 'div.highlight-' + suffix + ' > pre';
        $(pattern).wrap('<div class="highlight" />');
    }
    return true;
});
//]]>
</script>

  </head>
  <body>
<!--[if lte IE 6]>
<style type="text/css">
#ie6msg{border:3px solid #090; margin:8px 0; background:#cfc; color:#000;}
#ie6msg h4{margin:8px; padding:0;}
#ie6msg p{margin:8px; padding:0;}
#ie6msg p a.getie8{font-weight:bold; color:#006;}
#ie6msg p a.ie6expl{font-weight:normal; color:#006;}
</style>
<div id="ie6msg">
<h4>Did you know that your browser is out of date?</h4>
<p>If the layout of this site seems ugly, that's because you're actually using
an outdated browser. And we wont put any effort to provide a nice layout to IE6
users.</p>
<p>To get the best possible experience using our website we recommend that you
upgrade your browser to a newer version. The current version
is <a class="getie8"
href="http://upgradeie.s3.amazonaws.com/eng/index.html">Internet Explorer
8</a>. The upgrade is free. If you're using a PC at work you should contact your
IT administrator.</p>
<p>If you want to you may also try some other popular Internet browsers
like <a class="ie6expl"
href="http://getfirefox.com">Firefox</a>, <a class="ie6expl"
href="http://www.google.com/chrome">Chrome</a>, <a class="ie6expl"
href="http://www.opera.com">Opera</a>, or <a class="ie6expl"
href="http://www.apple.com/safari/download/">Safari</a></p>
</div>
<![endif]-->

    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="traversing.html" title="Traversing"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="index.html" title="Serving HTTP and other protocols"
             accesskey="P">previous</a> |</li>
        <li><a href="../index.html">Plone Community Managed Developer Manual v1.0 documentation</a> &raquo;</li>
          <li><a href="index.html" accesskey="U">Serving HTTP and other protocols</a> &raquo;</li> 
      </ul>
    </div>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="sphinx-content">
    <div class="section" id="http-request-and-response">
<h1>HTTP request and response<a class="headerlink" href="#http-request-and-response" title="Permalink to this headline">¶</a></h1>
<div class="admonition-description admonition ">
<p class="first admonition-title">Description</p>
<p class="last">Accessing and manipulating Zope's HTTP request and response objects programmatically.</p>
</div>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><a class="reference internal" href="#introduction" id="id2">Introduction</a></li>
<li><a class="reference internal" href="#lifecycle" id="id3">Lifecycle</a></li>
<li><a class="reference internal" href="#webservers" id="id4">Webservers</a></li>
<li><a class="reference internal" href="#http-request" id="id5">HTTP Request</a><ul>
<li><a class="reference internal" href="#request-method" id="id6">Request method</a></li>
<li><a class="reference internal" href="#request-url" id="id7">Request URL</a></li>
<li><a class="reference internal" href="#query-string" id="id8">Query string</a></li>
<li><a class="reference internal" href="#request-path" id="id9">Request path</a></li>
<li><a class="reference internal" href="#request-uri" id="id10"><tt class="docutils literal"><span class="pre">REQUEST_URI</span></tt></a></li>
<li><a class="reference internal" href="#request-client-ip" id="id11">Request client IP</a></li>
<li><a class="reference internal" href="#get-variables" id="id12"><tt class="docutils literal"><span class="pre">GET</span></tt> variables</a></li>
<li><a class="reference internal" href="#post-variables" id="id13"><tt class="docutils literal"><span class="pre">POST</span></tt> variables</a></li>
<li><a class="reference internal" href="#http-headers" id="id14">HTTP headers</a></li>
<li><a class="reference internal" href="#id1" id="id15">Query string</a></li>
<li><a class="reference internal" href="#web-environment" id="id16">Web environment</a></li>
<li><a class="reference internal" href="#hostname" id="id17">Hostname</a></li>
<li><a class="reference internal" href="#request-port" id="id18">Request port</a></li>
<li><a class="reference internal" href="#flat-access" id="id19">Flat access</a></li>
<li><a class="reference internal" href="#request-mutability" id="id20">Request mutability</a></li>
</ul>
</li>
<li><a class="reference internal" href="#accessing-http-request-outside-context" id="id21">Accessing HTTP request outside context</a><ul>
<li><a class="reference internal" href="#zope-globalrequest-getrequest" id="id22">zope.globalrequest.getRequest</a></li>
</ul>
</li>
<li><a class="reference internal" href="#http-response" id="id23">HTTP response</a><ul>
<li><a class="reference internal" href="#accessing-response" id="id24">Accessing response</a></li>
<li><a class="reference internal" href="#response-headers" id="id25">Response headers</a></li>
<li><a class="reference internal" href="#content-disposition" id="id26">Content disposition</a></li>
<li><a class="reference internal" href="#return-code" id="id27">Return code</a></li>
<li><a class="reference internal" href="#response-body" id="id28">Response body</a></li>
<li><a class="reference internal" href="#redirects" id="id29">Redirects</a></li>
</ul>
</li>
<li><a class="reference internal" href="#middleware-like-hooks" id="id30">Middleware-like hooks</a></li>
<li><a class="reference internal" href="#post-publication-hook" id="id31">Post-publication hook</a><ul>
<li><a class="reference internal" href="#extracting-useful-information-in-the-post-publication-hook" id="id32">Extracting useful information in the post-publication hook</a></li>
</ul>
</li>
</ul>
</div>
<div class="section" id="introduction">
<h2><a class="toc-backref" href="#id2">Introduction</a><a class="headerlink" href="#introduction" title="Permalink to this headline">¶</a></h2>
<p>This chapter explains the basics of Zope HTTP requests and responses:</p>
<ul class="simple">
<li>request and response objects lifecycle;</li>
<li>data which can be extracted from the request;</li>
<li>data which can be placed on the response.</li>
</ul>
</div>
<div class="section" id="lifecycle">
<h2><a class="toc-backref" href="#id3">Lifecycle</a><a class="headerlink" href="#lifecycle" title="Permalink to this headline">¶</a></h2>
<p>Unlike some other web frameworks, in Plone you do not explictly create or
return HTTP response objects.  A HTTP request object always has a HTTP response
object associated with it, and the response object is created as soon as the
request hits the webserver.</p>
<p>The response is available for the whole lifetime of request processing.  This
effectively allows you to set and modify response headers at any point in the
code.</p>
</div>
<div class="section" id="webservers">
<h2><a class="toc-backref" href="#id4">Webservers</a><a class="headerlink" href="#webservers" title="Permalink to this headline">¶</a></h2>
<p>Usually Plone runs on Zope's <a class="reference external" href="http://svn.zope.org/Zope/trunk/src/ZServer/README.txt?rev=96262&amp;view=markup">ZServer</a> (based on Sam Rushing's <a class="reference external" href="http://www.amk.ca/python/code/medusa.html">Medusa</a>). Other
alternatives are <a class="reference external" href="http://ivory.idyll.org/articles/wsgi-intro/what-is-wsgi.html">WSGI</a> compatible web servers like <a class="reference external" href="http://repoze.org/">Repoze</a>.</p>
<p>The web server will affect how your HTTP objects are constructed.</p>
</div>
<div class="section" id="http-request">
<h2><a class="toc-backref" href="#id5">HTTP Request</a><a class="headerlink" href="#http-request" title="Permalink to this headline">¶</a></h2>
<p>All incoming HTTP requests are wrapped in Zope's <a class="reference external" href="http://www.python.org/">ZPublisher</a> <a class="reference external" href="http://svn.zope.org/Zope/trunk/src/ZPublisher/HTTPRequest.py?rev=99866&amp;view=markup">HTTPRequest</a>
objects. This is a multi-mapping: it contains mappings for environment
variables, other variables, form data, and cookies, but the keys of all these
mappings can also be looked up directly on the request object (i.e.
<tt class="docutils literal"><span class="pre">request['some_form_id']</span></tt> and <tt class="docutils literal"><span class="pre">request.form['some_form_id']</span></tt> are
equivalent).</p>
<p>Usually your view function or instance will receive an HTTP request object,
along with a traversed context, as its construction parameter.</p>
<p>You can access the request in your view:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">Products.Five.browser</span> <span class="kn">import</span> <span class="n">BrowserView</span>

<span class="k">class</span> <span class="nc">SampleView</span><span class="p">(</span><span class="n">BrowserView</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">context</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
        <span class="c"># Each view instance receives context and request as construction parameters</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">context</span> <span class="o">=</span> <span class="n">context</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">request</span> <span class="o">=</span> <span class="n">request</span>

    <span class="k">def</span> <span class="nf">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Entry point of request processing</span>
        <span class="c"># Dump out incoming request variables</span>
        <span class="k">print</span> <span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
</pre></div>
</div>
<div class="section" id="request-method">
<h3><a class="toc-backref" href="#id6">Request method</a><a class="headerlink" href="#request-method" title="Permalink to this headline">¶</a></h3>
<p>The request method (GET or POST) can be read:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">request</span><span class="p">[</span><span class="s">&quot;REQUEST_METHOD&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s">&quot;POST&quot;</span> <span class="c"># or &quot;GET&quot;</span>
</pre></div>
</div>
</div>
<div class="section" id="request-url">
<h3><a class="toc-backref" href="#id7">Request URL</a><a class="headerlink" href="#request-url" title="Permalink to this headline">¶</a></h3>
<p>To get the requested URL:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">request</span><span class="p">[</span><span class="s">&quot;ACTUAL_URL&quot;</span><span class="p">]</span>
<span class="go">&#39;http://localhost:8080/site&#39;</span>
</pre></div>
</div>
<p>To get the URL of the served object use the following (this might be different
from the requested URL, since Plone does all kinds of default page and default
view magic):</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">request</span><span class="p">[</span><span class="s">&quot;URL&quot;</span><span class="p">]</span>
<span class="go">&#39;http://m.localhost:8080/site/matkailijallefolder/@@frontpage&#39;</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">URLs, as accessed above, do not contain query string.</p>
</div>
</div>
<div class="section" id="query-string">
<h3><a class="toc-backref" href="#id8">Query string</a><a class="headerlink" href="#query-string" title="Permalink to this headline">¶</a></h3>
<p>The unparsed query string can be accessed.</p>
<p>E.g. if you go to <tt class="docutils literal"><span class="pre">http://localhost:8080/site?something=foobar</span></tt>:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="p">[</span><span class="s">&quot;QUERY_STRING&quot;</span><span class="p">]</span>
<span class="go">&#39;something=foobar&#39;</span>
</pre></div>
</div>
<p>If the query string is not present in the HTTP request, it is an empty string.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">You can also use the <tt class="docutils literal"><span class="pre">request.form</span></tt> dictionary to access parsed query
string content.</p>
</div>
</div>
<div class="section" id="request-path">
<h3><a class="toc-backref" href="#id9">Request path</a><a class="headerlink" href="#request-path" title="Permalink to this headline">¶</a></h3>
<p>The request URI path can be read from <tt class="docutils literal"><span class="pre">request.path</span></tt>, which returns a list of
path components.  <tt class="docutils literal"><span class="pre">request.path</span></tt> is a virtual path, and has the site id
component removed from it.</p>
<p>Example:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">reconstructed_path</span> <span class="o">=</span> <span class="s">&quot;/&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">path</span><span class="p">)</span>
</pre></div>
</div>
<p>Other possible headers:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="p">(</span><span class="s">&#39;PATH_INFO&#39;</span><span class="p">,</span> <span class="s">&#39;/plonecommunity/Members&#39;</span><span class="p">)</span>
<span class="p">(</span><span class="s">&#39;PATH_TRANSLATED&#39;</span><span class="p">,</span> <span class="s">&#39;/plonecommunity/Members&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="request-uri">
<h3><a class="toc-backref" href="#id10"><tt class="docutils literal"><span class="pre">REQUEST_URI</span></tt></a><a class="headerlink" href="#request-uri" title="Permalink to this headline">¶</a></h3>
<p>To get the variable which corresponds to <tt class="docutils literal"><span class="pre">REQUEST_URI</span></tt> in e.g. PHP the
following helps:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c"># Concatenate the user-visible URL and query parameters</span>
<span class="n">full_url</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">ACTUAL_URL</span> <span class="o">+</span> <span class="s">&quot;?&quot;</span> <span class="o">+</span> <span class="n">request</span><span class="o">.</span><span class="n">QUERY_STRING</span>
<span class="n">parsed</span> <span class="o">=</span> <span class="n">urlparse</span><span class="o">.</span><span class="n">urlsplit</span><span class="p">(</span><span class="n">full_url</span><span class="p">)</span>

<span class="c"># Extract path part and add the query if it existed</span>
<span class="n">uri</span> <span class="o">=</span> <span class="n">parsed</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
<span class="k">if</span> <span class="n">parsed</span><span class="p">[</span><span class="mi">3</span><span class="p">]:</span>
    <span class="n">uri</span> <span class="o">+=</span> <span class="s">&quot;?&quot;</span> <span class="o">+</span> <span class="n">parsed</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
</pre></div>
</div>
<p>For more information, see:</p>
<ul class="simple">
<li><a class="reference external" href="http://www.teamrubber.com/blog/_serverrequest_uri-in-zope/">http://www.teamrubber.com/blog/_serverrequest_uri-in-zope/</a></li>
<li><a class="reference external" href="http://www.doughellmann.com/PyMOTW/urlparse/index.html">http://www.doughellmann.com/PyMOTW/urlparse/index.html</a></li>
</ul>
</div>
<div class="section" id="request-client-ip">
<h3><a class="toc-backref" href="#id11">Request client IP</a><a class="headerlink" href="#request-client-ip" title="Permalink to this headline">¶</a></h3>
<p>Example:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">get_ip</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Extract the client IP address from the HTTP request in a proxy-compatible way.</span>

<span class="sd">    @return: IP address as a string or None if not available</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="s">&quot;HTTP_X_FORWARDED_FOR&quot;</span> <span class="ow">in</span> <span class="n">request</span><span class="o">.</span><span class="n">environ</span><span class="p">:</span>
        <span class="c"># Virtual host</span>
        <span class="n">ip</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s">&quot;HTTP_X_FORWARDED_FOR&quot;</span><span class="p">]</span>
    <span class="k">elif</span> <span class="s">&quot;HTTP_HOST&quot;</span> <span class="ow">in</span> <span class="n">request</span><span class="o">.</span><span class="n">environ</span><span class="p">:</span>
        <span class="c"># Non-virtualhost</span>
        <span class="n">ip</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s">&quot;REMOTE_ADDR&quot;</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c"># Unit test code?</span>
        <span class="n">ip</span> <span class="o">=</span> <span class="bp">None</span>

    <span class="k">return</span> <span class="n">ip</span>
</pre></div>
</div>
<p>For more information, see:</p>
<ul class="simple">
<li><a class="reference external" href="http://wiki.zope.org/zope2/ZopeAndApache#setting-remote-addr-to-the-client-ip">http://wiki.zope.org/zope2/ZopeAndApache#setting-remote-addr-to-the-client-ip</a></li>
</ul>
</div>
<div class="section" id="get-variables">
<h3><a class="toc-backref" href="#id12"><tt class="docutils literal"><span class="pre">GET</span></tt> variables</a><a class="headerlink" href="#get-variables" title="Permalink to this headline">¶</a></h3>
<p>HTTP <tt class="docutils literal"><span class="pre">GET</span></tt> variables are available in <tt class="docutils literal"><span class="pre">request.form</span></tt> if the <tt class="docutils literal"><span class="pre">REQUEST_METHOD</span></tt> was <tt class="docutils literal"><span class="pre">GET</span></tt>.</p>
<p>Example:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c"># http://yoursite.com/@@testview/?my_param_id=something</span>
<span class="k">print</span> <span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">form</span><span class="p">[</span><span class="s">&quot;my_param_id&quot;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="section" id="post-variables">
<h3><a class="toc-backref" href="#id13"><tt class="docutils literal"><span class="pre">POST</span></tt> variables</a><a class="headerlink" href="#post-variables" title="Permalink to this headline">¶</a></h3>
<p>HTTP <tt class="docutils literal"><span class="pre">POST</span></tt> varibles are available in <tt class="docutils literal"><span class="pre">request.form</span></tt>:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">print</span> <span class="n">request</span><span class="o">.</span><span class="n">form</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="c"># Everything POST brought to us</span>
</pre></div>
</div>
<p>There is no difference in accessing <tt class="docutils literal"><span class="pre">GET</span></tt> and <tt class="docutils literal"><span class="pre">POST</span></tt> variables.</p>
</div>
<div class="section" id="http-headers">
<h3><a class="toc-backref" href="#id14">HTTP headers</a><a class="headerlink" href="#http-headers" title="Permalink to this headline">¶</a></h3>
<p>HTTP headers are available through <tt class="docutils literal"><span class="pre">request.get_header()</span></tt> and the
<tt class="docutils literal"><span class="pre">request.environ</span></tt> dictionary.</p>
<p>Example:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">referer</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">get_header</span><span class="p">(</span><span class="s">&quot;referer&quot;</span><span class="p">)</span> <span class="c"># Page referer (the page from user came from)</span>

<span class="k">if</span> <span class="n">referer</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span> <span class="c"># referer will be none if it was missing</span>
    <span class="k">pass</span>
</pre></div>
</div>
<p>Dumping all headers:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">request</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="k">print</span> <span class="s">&quot;</span><span class="si">%s</span><span class="s">: </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="id1">
<h3><a class="toc-backref" href="#id15">Query string</a><a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h3>
<p>To access the raw HTTP <tt class="docutils literal"><span class="pre">GET</span></tt> query string:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">query_string</span> <span class="o">=</span> <span class="n">request</span><span class="p">[</span><span class="s">&quot;QUERY_STRING&quot;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="section" id="web-environment">
<h3><a class="toc-backref" href="#id16">Web environment</a><a class="headerlink" href="#web-environment" title="Permalink to this headline">¶</a></h3>
<p>The web server exposes its own environment variables in <tt class="docutils literal"><span class="pre">request.other</span></tt>
(<a class="reference external" href="http://svn.zope.org/Zope/trunk/src/ZServer/README.txt?rev=96262&amp;view=markup">ZServer</a>) or <tt class="docutils literal"><span class="pre">request.environ</span></tt> (<a class="reference external" href="http://repoze.org/">Repoze</a> and other <a class="reference external" href="http://ivory.idyll.org/articles/wsgi-intro/what-is-wsgi.html">WSGI</a>-based web servers):</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">print</span> <span class="n">request</span><span class="o">.</span><span class="n">other</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>

<span class="n">user_agent</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">other</span><span class="p">[</span><span class="s">&quot;HTTP_USER_AGENT&quot;</span><span class="p">]</span>

<span class="n">user_agent</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s">&quot;HTTP_USER_AGENT&quot;</span><span class="p">]</span> <span class="c"># WSGI or Repoze server</span>
</pre></div>
</div>
</div>
<div class="section" id="hostname">
<h3><a class="toc-backref" href="#id17">Hostname</a><a class="headerlink" href="#hostname" title="Permalink to this headline">¶</a></h3>
<p>Below is an example to get the HTTP server name in a safe manner, taking
virtual hosting into account:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">get_hostname</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Extract hostname in virtual-host-safe manner</span>

<span class="sd">    @param request: HTTPRequest object, assumed contains environ dictionary</span>

<span class="sd">    @return: Host DNS name, as requested by client. Lowercased, no port part.</span>
<span class="sd">             Return None if host name is not present in HTTP request headers</span>
<span class="sd">             (e.g. unit testing).</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="s">&quot;HTTP_X_FORWARDED_HOST&quot;</span> <span class="ow">in</span> <span class="n">request</span><span class="o">.</span><span class="n">environ</span><span class="p">:</span>
        <span class="c"># Virtual host</span>
        <span class="n">host</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s">&quot;HTTP_X_FORWARDED_HOST&quot;</span><span class="p">]</span>
    <span class="k">elif</span> <span class="s">&quot;HTTP_HOST&quot;</span> <span class="ow">in</span> <span class="n">request</span><span class="o">.</span><span class="n">environ</span><span class="p">:</span>
        <span class="c"># Direct client request</span>
        <span class="n">host</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s">&quot;HTTP_HOST&quot;</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">None</span>

    <span class="c"># separate to domain name and port sections</span>
    <span class="n">host</span><span class="o">=</span><span class="n">host</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&quot;:&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">host</span>
</pre></div>
</div>
</div>
<div class="section" id="request-port">
<h3><a class="toc-backref" href="#id18">Request port</a><a class="headerlink" href="#request-port" title="Permalink to this headline">¶</a></h3>
<p>It is possible to extract the Zope instance port from the request.  This is
useful e.g. for debugging purposes if you have multiple ZEO front ends running,
and you want to identify them easily:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">port</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;SERVER_PORT&quot;</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The <tt class="docutils literal"><span class="pre">SERVER_PORT</span></tt> variable returns the port number as a string, not an integer.</p>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">This port number is not the one visible to the external traffic (port 80, HTTP)</p>
</div>
</div>
<div class="section" id="flat-access">
<h3><a class="toc-backref" href="#id19">Flat access</a><a class="headerlink" href="#flat-access" title="Permalink to this headline">¶</a></h3>
<p><tt class="docutils literal"><span class="pre">GET</span></tt>, <tt class="docutils literal"><span class="pre">POST</span></tt> and web environment variables are flat mapped
to the request object as a dictionary look up:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c"># Comes from POST</span>
<span class="n">request</span><span class="p">[</span><span class="s">&quot;input_username&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">request</span><span class="o">.</span><span class="n">form</span><span class="p">[</span><span class="s">&quot;input_username&quot;</span><span class="p">]</span>

<span class="c"># Comes from environ</span>
<span class="n">request</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;HTTP_USER_AGENT&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="n">request</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s">&quot;HTTP_USER_AGENT&quot;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="section" id="request-mutability">
<h3><a class="toc-backref" href="#id20">Request mutability</a><a class="headerlink" href="#request-mutability" title="Permalink to this headline">¶</a></h3>
<p>Even if you can write and add your own attributes to HTTP request objects, this
behavior is discouraged. If you need to create cache variables for request
lifecycle use <a class="reference external" href="http://pypi.python.org/pypi/zope.annotation/3.4.1">annotations</a>.</p>
</div>
</div>
<div class="section" id="accessing-http-request-outside-context">
<h2><a class="toc-backref" href="#id21">Accessing HTTP request outside context</a><a class="headerlink" href="#accessing-http-request-outside-context" title="Permalink to this headline">¶</a></h2>
<p>There are often cases where you would like to get hold of the HTTP request
object, but the underlying framework does not pass it to you.  In these cases
you have two ways to access the request object:</p>
<ul class="simple">
<li>Use <em>acquisition</em> to get the request object from the site root. When Plone
site traversal starts, the HTTP request is assigned to current site object
as the <tt class="docutils literal"><span class="pre">site.REQUEST</span></tt> attribute.</li>
<li>Use <a class="reference external" href="http://pypi.python.org/pypi/five.globalrequest">http://pypi.python.org/pypi/five.globalrequest</a>.</li>
</ul>
<p>Example of getting the request using acquisition:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c"># context is any traversed Plone content item</span>
<span class="n">request</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">context</span><span class="p">,</span> <span class="s">&quot;REQUEST&quot;</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
<span class="k">if</span> <span class="n">request</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
    <span class="c"># Do the normal flow</span>
    <span class="o">...</span>
<span class="k">else</span><span class="p">:</span>
    <span class="c"># This code path was not initiated by an incoming web server request</span>
    <span class="c"># Handle cases like</span>
    <span class="c"># - command line scripts</span>
    <span class="c"># - add-on installer</span>
    <span class="c"># - code called during Zope start up</span>
    <span class="c"># -etc.</span>
    <span class="o">...</span>
</pre></div>
</div>
<div class="section" id="zope-globalrequest-getrequest">
<h3><a class="toc-backref" href="#id22">zope.globalrequest.getRequest</a><a class="headerlink" href="#zope-globalrequest-getrequest" title="Permalink to this headline">¶</a></h3>
<p>See</p>
<ul class="simple">
<li><a class="reference external" href="http://pypi.python.org/pypi/five.globalrequest">http://pypi.python.org/pypi/five.globalrequest</a></li>
</ul>
</div>
</div>
<div class="section" id="http-response">
<h2><a class="toc-backref" href="#id23">HTTP response</a><a class="headerlink" href="#http-response" title="Permalink to this headline">¶</a></h2>
<p>Usually you do not return HTTP responses directly from your views. Instead, you
modify the existing HTTP response object (associated with the request) and
return the object which will be HTTP response payload.</p>
<p>The returned payload object can be:</p>
<ul class="simple">
<li>a string (str) 8-bit raw data; or</li>
<li>an iterable: the response is streamed, instead of memory-buffered.</li>
</ul>
<div class="section" id="accessing-response">
<h3><a class="toc-backref" href="#id24">Accessing response</a><a class="headerlink" href="#accessing-response" title="Permalink to this headline">¶</a></h3>
<p>You can access the HTTP response if you know the request:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">Products.Five.browser</span> <span class="kn">import</span> <span class="n">BrowserView</span>

<span class="k">class</span> <span class="nc">SampleView</span><span class="p">(</span><span class="n">BrowserView</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="n">context</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
        <span class="c"># Each view instance receives context and request as construction parameters</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">context</span> <span class="o">=</span> <span class="n">context</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">request</span> <span class="o">=</span> <span class="n">request</span>

    <span class="k">def</span> <span class="nf">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">response</span>
        <span class="k">return</span> <span class="s">&quot;&lt;html&gt;&lt;body&gt;Hello world!&lt;/body&gt;&lt;/html&gt;&quot;</span>
</pre></div>
</div>
</div>
<div class="section" id="response-headers">
<h3><a class="toc-backref" href="#id25">Response headers</a><a class="headerlink" href="#response-headers" title="Permalink to this headline">¶</a></h3>
<p>Use <a class="reference external" href="http://svn.zope.org/Zope/trunk/src/ZPublisher/HTTPResponse.py?rev=99866&amp;view=markup">HTTPResponse</a> <tt class="docutils literal"><span class="pre">setHeader()</span></tt> to set headers:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c"># The response is a dynamically generated image</span>
<span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">response</span><span class="o">.</span><span class="n">setHeader</span><span class="p">(</span><span class="s">&quot;Content-type&quot;</span><span class="p">,</span> <span class="s">&quot;image/jpeg&quot;</span><span class="p">)</span>
<span class="k">return</span> <span class="n">image_data</span>
</pre></div>
</div>
</div>
<div class="section" id="content-disposition">
<h3><a class="toc-backref" href="#id26">Content disposition</a><a class="headerlink" href="#content-disposition" title="Permalink to this headline">¶</a></h3>
<p>The <tt class="docutils literal"><span class="pre">Content-Disposition</span></tt> header is used to set the filename of a download.
It is also used by Flash 10 to check whether Flash download is valid.</p>
<p>Example of setting the download and downloadable filename:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">response</span>
<span class="n">response</span><span class="o">.</span><span class="n">setHeader</span><span class="p">(</span><span class="s">&quot;Content-type&quot;</span><span class="p">,</span> <span class="s">&quot;text/x-vCard; charset=utf-8&quot;</span><span class="p">)</span>
<span class="n">response</span><span class="o">.</span><span class="n">setHeader</span><span class="p">(</span><span class="s">&quot;Content-Transfer-Encoding&quot;</span><span class="p">,</span> <span class="s">&quot;8bit&quot;</span><span class="p">)</span>

<span class="n">cd</span> <span class="o">=</span> <span class="s">&#39;attachment; filename=</span><span class="si">%s</span><span class="s">.vcf&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">context</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
<span class="n">response</span><span class="o">.</span><span class="n">setHeader</span><span class="p">(</span><span class="s">&#39;Content-Disposition&#39;</span><span class="p">,</span> <span class="n">cd</span><span class="p">)</span>
</pre></div>
</div>
<p>For more information, see:</p>
<ul class="simple">
<li><a class="reference external" href="http://www.littled.net/new/2008/10/17/plone-and-flash-player-10/">http://www.littled.net/new/2008/10/17/plone-and-flash-player-10/</a></li>
<li><a class="reference external" href="http://support.microsoft.com/kb/260519">http://support.microsoft.com/kb/260519</a></li>
</ul>
</div>
<div class="section" id="return-code">
<h3><a class="toc-backref" href="#id27">Return code</a><a class="headerlink" href="#return-code" title="Permalink to this headline">¶</a></h3>
<p>Use <tt class="docutils literal"><span class="pre">HTTPResponse.setStatus(self,</span> <span class="pre">status,</span> <span class="pre">reason=None,</span> <span class="pre">lock=None)</span></tt>
to set HTTP return status (&quot;404 Not Found&quot;, &quot;500 Internal Error&quot;, etc.).</p>
<p>If <tt class="docutils literal"><span class="pre">lock=True</span></tt>, no further modification of the HTTPResponse are allowed,
and will fail silently.</p>
</div>
<div class="section" id="response-body">
<h3><a class="toc-backref" href="#id28">Response body</a><a class="headerlink" href="#response-body" title="Permalink to this headline">¶</a></h3>
<p>You might want to read or manipulate the response body in the post-publication
hook.</p>
<p>The response body is not always a string or basestring: it can be a generator
or iterable for blob data.</p>
<p>The body is avaialble as the <tt class="docutils literal"><span class="pre">response.body</span></tt> attribute.</p>
</div>
<div class="section" id="redirects">
<h3><a class="toc-backref" href="#id29">Redirects</a><a class="headerlink" href="#redirects" title="Permalink to this headline">¶</a></h3>
<p>Use the <tt class="docutils literal"><span class="pre">response.redirect()</span></tt> method:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c"># This will send a &quot;302 Temporary Redirect&quot; notification to the browser</span>
<span class="n">response</span><span class="o">.</span><span class="n">redirect</span><span class="p">(</span><span class="n">new_url</span><span class="p">)</span>

<span class="c"># This will send a &quot;301 Permantent Redirect&quot; notification to the browser</span>
<span class="n">response</span><span class="o">.</span><span class="n">redirect</span><span class="p">(</span><span class="n">new_url</span><span class="p">,</span> <span class="n">status</span><span class="o">=</span><span class="mi">301</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="middleware-like-hooks">
<h2><a class="toc-backref" href="#id30">Middleware-like hooks</a><a class="headerlink" href="#middleware-like-hooks" title="Permalink to this headline">¶</a></h2>
<p>Plone does not have a middleware concept, as everything happens through traversal.
Middleware behavior can be emulated with the <em>before traverse</em> hook.
This hook can be installed on any persistent object in the traversing graph.
The hook is persistent, so it is a database change and must be installed using
custom GenericSetup Python code.</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">Before traverse hooks cannot create new HTTP responses, or return
alternative HTTP responses.  Only exception-like HTTP response modification
is supported, e.g. HTTP redirects. If you need to rewrite the whole
response, the post-publication hook must be used.</p>
</div>
<p>For more information, see:</p>
<ul class="simple">
<li><a class="reference external" href="http://blog.fourdigits.nl/changing-your-plone-theme-skin-based-on-the-objects-portal_type">http://blog.fourdigits.nl/changing-your-plone-theme-skin-based-on-the-objects-portal_type</a></li>
<li><a class="reference external" href="http://zebert.blogspot.com/2008_01_01_archive.html">http://zebert.blogspot.com/2008_01_01_archive.html</a></li>
<li><a class="reference external" href="http://svn.repoze.org/thirdparty/zopelib/branches/2.9.8/ZPublisher/tests/testBeforeTraverse.py">http://svn.repoze.org/thirdparty/zopelib/branches/2.9.8/ZPublisher/tests/testBeforeTraverse.py</a></li>
</ul>
<p>Examples:</p>
<ul class="simple">
<li>Redirector: <a class="reference external" href="https://plonegomobile.googlecode.com/svn/trunk/gomobile/gomobile.mobile/gomobile/mobile/postpublication.py">https://plonegomobile.googlecode.com/svn/trunk/gomobile/gomobile.mobile/gomobile/mobile/postpublication.py</a></li>
</ul>
</div>
<div class="section" id="post-publication-hook">
<h2><a class="toc-backref" href="#id31">Post-publication hook</a><a class="headerlink" href="#post-publication-hook" title="Permalink to this headline">¶</a></h2>
<p>The post-publication hook is run when:</p>
<ul class="simple">
<li>the context object has been traversed;</li>
<li>after the view has been called and the view has rendered the response;</li>
<li>before the response is sent to the browser;</li>
<li>before the transaction is committed.</li>
</ul>
<p>This is practical for caching purposes: it is the ideal place to determine and
insert caching headers into the response.</p>
<p>Read more at the <a class="reference external" href="http://pypi.python.org/pypi/plone.postpublicationhook/">plone.postpublicationhook package page</a>.</p>
<div class="section" id="extracting-useful-information-in-the-post-publication-hook">
<h3><a class="toc-backref" href="#id32">Extracting useful information in the post-publication hook</a><a class="headerlink" href="#extracting-useful-information-in-the-post-publication-hook" title="Permalink to this headline">¶</a></h3>
<p>Example:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">zope.component</span> <span class="kn">import</span> <span class="n">adapter</span><span class="p">,</span> <span class="n">getUtility</span><span class="p">,</span> <span class="n">getMultiAdapter</span>
<span class="kn">from</span> <span class="nn">plone.postpublicationhook.interfaces</span> <span class="kn">import</span> <span class="n">IAfterPublicationEvent</span>
<span class="kn">from</span> <span class="nn">Products.CMFCore.interfaces</span> <span class="kn">import</span> <span class="n">IContentish</span>

<span class="k">def</span> <span class="nf">get_contentish</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Traverse acquisition upwards until we get contentish object used for the HTTP response.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">contentish</span> <span class="o">=</span> <span class="nb">object</span>
    <span class="k">while</span> <span class="ow">not</span> <span class="n">IContentish</span><span class="o">.</span><span class="n">providedBy</span><span class="p">(</span><span class="n">contentish</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">contentish</span><span class="p">,</span> <span class="s">&quot;aq_parent&quot;</span><span class="p">):</span>
            <span class="n">contentish</span> <span class="o">=</span> <span class="n">contentish</span><span class="o">.</span><span class="n">aq_parent</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">break</span>

    <span class="k">return</span> <span class="n">contentish</span>


<span class="c"># This must be refered in configure.zcml</span>
<span class="nd">@adapter</span><span class="p">(</span><span class="n">Interface</span><span class="p">,</span> <span class="n">IAfterPublicationEvent</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">language_fixer</span><span class="p">(</span><span class="nb">object</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Redirect mobile users to mobile site using gomobile.mobile.interfaces.IRedirector.</span>

<span class="sd">    Note: Plone does not provide a good hook doing this before traversing, so we must</span>
<span class="sd">    do it in post-publication. This adds extra latency, but is doable.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">request</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">request</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">response</span>

    <span class="c"># object can be a page template, view, whichever happens to be at the very end of traversed acquisition chain</span>
    <span class="n">context</span> <span class="o">=</span> <span class="n">get_contentish</span><span class="p">(</span><span class="nb">object</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>

  </div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
<p class="logo"><a href="../index.html"><img src="../_static/plone-icon-64.png" />
</a></p>

  <h3><a href="../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">HTTP request and response</a><ul>
<li><a class="reference internal" href="#introduction">Introduction</a></li>
<li><a class="reference internal" href="#lifecycle">Lifecycle</a></li>
<li><a class="reference internal" href="#webservers">Webservers</a></li>
<li><a class="reference internal" href="#http-request">HTTP Request</a><ul>
<li><a class="reference internal" href="#request-method">Request method</a></li>
<li><a class="reference internal" href="#request-url">Request URL</a></li>
<li><a class="reference internal" href="#query-string">Query string</a></li>
<li><a class="reference internal" href="#request-path">Request path</a></li>
<li><a class="reference internal" href="#request-uri"><tt class="docutils literal"><span class="pre">REQUEST_URI</span></tt></a></li>
<li><a class="reference internal" href="#request-client-ip">Request client IP</a></li>
<li><a class="reference internal" href="#get-variables"><tt class="docutils literal"><span class="pre">GET</span></tt> variables</a></li>
<li><a class="reference internal" href="#post-variables"><tt class="docutils literal"><span class="pre">POST</span></tt> variables</a></li>
<li><a class="reference internal" href="#http-headers">HTTP headers</a></li>
<li><a class="reference internal" href="#id1">Query string</a></li>
<li><a class="reference internal" href="#web-environment">Web environment</a></li>
<li><a class="reference internal" href="#hostname">Hostname</a></li>
<li><a class="reference internal" href="#request-port">Request port</a></li>
<li><a class="reference internal" href="#flat-access">Flat access</a></li>
<li><a class="reference internal" href="#request-mutability">Request mutability</a></li>
</ul>
</li>
<li><a class="reference internal" href="#accessing-http-request-outside-context">Accessing HTTP request outside context</a><ul>
<li><a class="reference internal" href="#zope-globalrequest-getrequest">zope.globalrequest.getRequest</a></li>
</ul>
</li>
<li><a class="reference internal" href="#http-response">HTTP response</a><ul>
<li><a class="reference internal" href="#accessing-response">Accessing response</a></li>
<li><a class="reference internal" href="#response-headers">Response headers</a></li>
<li><a class="reference internal" href="#content-disposition">Content disposition</a></li>
<li><a class="reference internal" href="#return-code">Return code</a></li>
<li><a class="reference internal" href="#response-body">Response body</a></li>
<li><a class="reference internal" href="#redirects">Redirects</a></li>
</ul>
</li>
<li><a class="reference internal" href="#middleware-like-hooks">Middleware-like hooks</a></li>
<li><a class="reference internal" href="#post-publication-hook">Post-publication hook</a><ul>
<li><a class="reference internal" href="#extracting-useful-information-in-the-post-publication-hook">Extracting useful information in the post-publication hook</a></li>
</ul>
</li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="index.html"
                        title="previous chapter">Serving HTTP and other protocols</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="traversing.html"
                        title="next chapter">Traversing</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="../_sources/serving/http_request_and_response.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" size="18" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="traversing.html" title="Traversing"
             >next</a> |</li>
        <li class="right" >
          <a href="index.html" title="Serving HTTP and other protocols"
             >previous</a> |</li>
        <li><a href="../index.html">Plone Community Managed Developer Manual v1.0 documentation</a> &raquo;</li>
          <li><a href="index.html" >Serving HTTP and other protocols</a> &raquo;</li> 
      </ul>
    </div>

    <div class="footer">
        &copy; Copyright 2010 mFabrik Research Oy and Plone community contributors.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.0.4.
    </div>


  </body>
</html>