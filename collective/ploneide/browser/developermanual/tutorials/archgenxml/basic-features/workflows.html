<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Workflows &mdash; Plone Community Managed Developer Manual v1.0 documentation</title>
    <link rel="stylesheet" href="../../../_static/plone.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../../',
        VERSION:     '1.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../_static/doctools.js"></script>
    <link rel="top" title="Plone Community Managed Developer Manual v1.0 documentation" href="../../../index.html" />
    <link rel="up" title="Basic Features" href="index.html" />
    <link rel="next" title="Tests" href="tests.html" />
    <link rel="prev" title="Relationships between classes and objects" href="relationships-between-classes-and-objects.html" />
<script language="javascript">
//<![CDATA[

Documentation.addTranslations({"locale": "fr", "plural_expr": "(n > 1)", "messages": {"See the definition": "Voir la d\u00e9finition"}});

// See http://disqus.disqus.com/general_integration_help/
var disqus_developer = 1;
if (document.location.protocol == 'http:') {
    disqus_developer = 0;
}

// Some HTML/CSS transforms we can't do in pure CSS (waiting for CSS3 support)
$(document).ready(function () {

    // Style of .. verisonmodified:: , .. versionadded:: ...
    $('p:has(span.versionmodified)').addClass('p-versionmodified');

    // Style of the TOC tree
    $('ul:has(li.toctree-l1)').addClass('toctree');

    // Decorate links to other sites
    $('a[class~=external]').attr('target', '_blank');

    // Glossary terms
    $('em.xref').attr('title', _('See the definition'));

    // We need to have all <pre> in a <div class="highlight"> to mimic pygments
    // to work around a pygments (?) bug
    var suffixes = {cfg: null, python:null};
    for (var suffix in suffixes) {
        var pattern = 'div.highlight-' + suffix + ' > pre';
        $(pattern).wrap('<div class="highlight" />');
    }
    return true;
});
//]]>
</script>

  </head>
  <body>
<!--[if lte IE 6]>
<style type="text/css">
#ie6msg{border:3px solid #090; margin:8px 0; background:#cfc; color:#000;}
#ie6msg h4{margin:8px; padding:0;}
#ie6msg p{margin:8px; padding:0;}
#ie6msg p a.getie8{font-weight:bold; color:#006;}
#ie6msg p a.ie6expl{font-weight:normal; color:#006;}
</style>
<div id="ie6msg">
<h4>Did you know that your browser is out of date?</h4>
<p>If the layout of this site seems ugly, that's because you're actually using
an outdated browser. And we wont put any effort to provide a nice layout to IE6
users.</p>
<p>To get the best possible experience using our website we recommend that you
upgrade your browser to a newer version. The current version
is <a class="getie8"
href="http://upgradeie.s3.amazonaws.com/eng/index.html">Internet Explorer
8</a>. The upgrade is free. If you're using a PC at work you should contact your
IT administrator.</p>
<p>If you want to you may also try some other popular Internet browsers
like <a class="ie6expl"
href="http://getfirefox.com">Firefox</a>, <a class="ie6expl"
href="http://www.google.com/chrome">Chrome</a>, <a class="ie6expl"
href="http://www.opera.com">Opera</a>, or <a class="ie6expl"
href="http://www.apple.com/safari/download/">Safari</a></p>
</div>
<![endif]-->

    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="tests.html" title="Tests"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="relationships-between-classes-and-objects.html" title="Relationships between classes and objects"
             accesskey="P">previous</a> |</li>
        <li><a href="../../../index.html">Plone Community Managed Developer Manual v1.0 documentation</a> &raquo;</li>
          <li><a href="../../index.html" >Tutorials</a> &raquo;</li>
          <li><a href="../index.html" >Using ArchGenXML</a> &raquo;</li>
          <li><a href="index.html" accesskey="U">Basic Features</a> &raquo;</li> 
      </ul>
    </div>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="sphinx-content">
    <div class="section" id="workflows">
<h1>Workflows<a class="headerlink" href="#workflows" title="Permalink to this headline">¶</a></h1>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><a class="reference internal" href="#problems-with-uml-software" id="id1">Problems with UML-Software</a></li>
<li><a class="reference internal" href="#creating-a-workflow" id="id2">Creating a workflow</a></li>
<li><a class="reference internal" href="#states" id="id3">States</a></li>
<li><a class="reference internal" href="#transitions" id="id4">Transitions</a><ul>
<li><a class="reference internal" href="#transition-guards" id="id5">Transition guards</a></li>
<li><a class="reference internal" href="#permissions" id="id6">Permissions</a></li>
</ul>
</li>
<li><a class="reference internal" href="#workflow-actions" id="id7">Workflow actions</a></li>
<li><a class="reference internal" href="#attach-workflow-to-more-than-one-class" id="id8">Attach workflow to more than one class</a></li>
<li><a class="reference internal" href="#worklist-support" id="id9">Worklist support</a></li>
</ul>
</div>
<div class="admonition-description admonition ">
<p class="first admonition-title">Description</p>
<p class="last">Usage of state diagrams to create custom workflows.</p>
</div>
<p>ArchGenXML can use state diagrams to generate workflows for a portal type. Workflows are used to set the various states an object can be in, and the transitions between them.</p>
<p>Importantly, workflows control permissions of objects. By convention, and for convenience and consistency, most content types will use the permissions found in the <tt class="docutils literal"><span class="pre">CMFCorePermissions</span></tt> class in the CMFCore product to control access to their methods. The methods generated by and inherited from the CMF and Archetypes frameworks adhere to this principle. Although many different content types use the same basic permissions to control access, workflows are the means by which you can control permissions for an object in detail. For instance, you may wish to specify that in the <tt class="docutils literal"><span class="pre">testing</span></tt> state, Manager and Reviewer has <tt class="docutils literal"><span class="pre">Modify</span> <span class="pre">portal</span> <span class="pre">content</span></tt> permissions, and Owner, Manager and Reviewer has <tt class="docutils literal"><span class="pre">View</span></tt> permissions. For the <tt class="docutils literal"><span class="pre">completed</span></tt> state, you could have a different set of permissions. See the DCWorkflow documentation for more details about how to use workflows.</p>
<div class="section" id="problems-with-uml-software">
<h2><a class="toc-backref" href="#id1">Problems with UML-Software</a><a class="headerlink" href="#problems-with-uml-software" title="Permalink to this headline">¶</a></h2>
<p>The workflow implementation of ArchGenXML has to date only been tested with ArgoUML and Poseidon (tested Version is 3.1 and 3.2 CE).</p>
<p>ObjectDomain is known not to work at this time, because it does not appear to correctly export the XMI for state diagrams. If you have different experiences, please add a comment to this document or contact us.</p>
</div>
<div class="section" id="creating-a-workflow">
<h2><a class="toc-backref" href="#id2">Creating a workflow</a><a class="headerlink" href="#creating-a-workflow" title="Permalink to this headline">¶</a></h2>
<p>In your UML modeller, add a state diagram for the class you wish to create a custom workflow for. If you don't want to assign the workflow to a class use an class with stereotype <tt class="docutils literal"><span class="pre">stub</span></tt>. In Poseidon, this is done by right-clicking on the object in the tree on the left hand side, and selecting to add a new state diagram. The name of the state diagram becomes the name of the workflow.</p>
</div>
<div class="section" id="states">
<h2><a class="toc-backref" href="#id3">States</a><a class="headerlink" href="#states" title="Permalink to this headline">¶</a></h2>
<p>On the state diagram, add a state item (a rounded-corner box) for each state. You must have an initial state of your workflow for it to work correctly. Use a &quot;initial state&quot; symbol (filled cirlce) for the state your object defaults to after creation. Optional you can use a normal state item and set a tagged value <tt class="docutils literal"><span class="pre">initial_state</span></tt> with value 1 to it.</p>
<p>At present, ArchGenXML does not support the &quot;final state&quot; UML symbols to represent final states, so you should stick to the standard state symbols.</p>
<p>The names of your states in UML become the names of the states in your workflow. The user-visible label can be set with the <tt class="docutils literal"><span class="pre">label</span></tt> tagged value; it defaults to the state name.</p>
<img alt="Workflow in UML" src="../../../_images/workflow.jpg" />
</div>
<div class="section" id="transitions">
<h2><a class="toc-backref" href="#id4">Transitions</a><a class="headerlink" href="#transitions" title="Permalink to this headline">¶</a></h2>
<p>For each possible transition between states, add a transition arrow to your UML model. The name of the transition becomes the name of the workflow action. You can set the <tt class="docutils literal"><span class="pre">label</span></tt> tagged value on the transition to set a custom label to display to the user.</p>
<p>If a transition with the same name/target is used more than one time, you can use the stereotype <tt class="docutils literal"><span class="pre">&lt;&lt;primary&gt;&gt;</span></tt> to define its settings once and use it by name on all similar transitions.</p>
<div class="section" id="transition-guards">
<h3><a class="toc-backref" href="#id5">Transition guards</a><a class="headerlink" href="#transition-guards" title="Permalink to this headline">¶</a></h3>
<p>You can add a guard to a transition to restrict to whom and when it is made available. Set the <tt class="docutils literal"><span class="pre">expression</span></tt> field of a transition to a |-separated list of the following pairs:</p>
<dl class="docutils">
<dt><strong>guard_roles</strong></dt>
<dd>Set <tt class="docutils literal"><span class="pre">guard_roles:Owner;</span> <span class="pre">Manager</span></tt> to restrict the transition to users posessing the Owner or Manager role in the current context.</dd>
<dt><strong>guard_permissions</strong></dt>
<dd>Set <tt class="docutils literal"><span class="pre">guard_permissions:My</span> <span class="pre">custom</span> <span class="pre">permission;View</span></tt> to ensure that only those users with <tt class="docutils literal"><span class="pre">My</span> <span class="pre">custom</span> <span class="pre">permission</span></tt> or <tt class="docutils literal"><span class="pre">View</span></tt> permissions in the current context are allowed to access the transition.</dd>
<dt><strong>guard_expr</strong></dt>
<dd>Set <tt class="docutils literal"><span class="pre">guard_expr:expression</span></tt>, where <tt class="docutils literal"><span class="pre">expression</span></tt> is a TALES expression, to have the expression be evaluated in order to determine whether the transition should be made available.</dd>
</dl>
<p>Thus, to restrict access to roles Reviewer and Manager, and only those users with permission <tt class="docutils literal"><span class="pre">My</span> <span class="pre">custom</span> <span class="pre">permission</span></tt> and <tt class="docutils literal"><span class="pre">View</span></tt> in the current context, you can set the expression of the transition to <tt class="docutils literal"><span class="pre">guard_roles:Reviewer;Manager|guard_permissions:My</span> <span class="pre">custom</span> <span class="pre">permission,</span> <span class="pre">View</span></tt>.</p>
<p>If you are using Poseidon, transition guards are located in the property of the transition arrow with the name <tt class="docutils literal"><span class="pre">[A]</span> <span class="pre">Guard</span></tt>. You can add an expression like the one outlined above to this field.</p>
</div>
<div class="section" id="permissions">
<h3><a class="toc-backref" href="#id6">Permissions</a><a class="headerlink" href="#permissions" title="Permalink to this headline">¶</a></h3>
<p>ArchGenXML uses tagged values on states in a somewhat unconventional, though convenient, way to control permissions. With the exception of the special-case <tt class="docutils literal"><span class="pre">initial_state</span></tt> and <tt class="docutils literal"><span class="pre">label</span></tt> tagged values, you give the name of the permission as the tagged value key, and a comma-separated list of roles the permission should be enabled for as the value.</p>
<p>There are three shorthand permission names available:</p>
<dl class="docutils">
<dt><strong>access</strong></dt>
<dd>referes to the <tt class="docutils literal"><span class="pre">Access</span> <span class="pre">contents</span> <span class="pre">information</span></tt> permission,</dd>
<dt><strong>view</strong></dt>
<dd>refers to the <tt class="docutils literal"><span class="pre">View</span></tt> permission,</dd>
<dt><strong>modify</strong></dt>
<dd>refers to the <tt class="docutils literal"><span class="pre">Modify</span> <span class="pre">portal</span> <span class="pre">content</span></tt> permission,</dd>
<dt><strong>list</strong></dt>
<dd>refers to the <tt class="docutils literal"><span class="pre">List</span> <span class="pre">folder</span> <span class="pre">contents</span></tt> permission.</dd>
<dt><strong>delete</strong></dt>
<dd>refers to the <tt class="docutils literal"><span class="pre">Delete</span> <span class="pre">objects</span></tt> permission.</dd>
</dl>
<p>Hence, if you want your state to permit anonymous users and members to view your content, only permit managers to modify, and permit both the owner and managers to add new objects controlled by the <tt class="docutils literal"><span class="pre">Add</span> <span class="pre">MySubTypes</span></tt> permission, you can add tagged values to the workflow state:</p>
<div class="highlight-python"><pre>view           ==&gt; Anonymous, Member
modify         ==&gt; Manager
Add MySubTypes ==&gt; Owner, Manager</pre>
</div>
<p>If you want to aquire the permissions and add new ones you can use the value 'aquire':</p>
<div class="highlight-python"><pre>view           ==&gt; acquire, Anonymous, Member</pre>
</div>
<p>(One special case: if you leave the value empty, no one gets that permission (which is logical), but it also explicitly unsets acquisition of the permission).</p>
</div>
</div>
<div class="section" id="workflow-actions">
<h2><a class="toc-backref" href="#id7">Workflow actions</a><a class="headerlink" href="#workflow-actions" title="Permalink to this headline">¶</a></h2>
<p>The <tt class="docutils literal"><span class="pre">portal_workflow</span></tt> tool allows a script to be executed before and/or after a transition is completed. This is no longer supported. Instead subscribers to the Workflow events are used. Event-subsribers are more flexible.</p>
<p>Actions are set using the <tt class="docutils literal"><span class="pre">effect</span></tt> field of a transition. The value given here gives the name of the subscriber to execute (and thus must be valid python method name). ArchGenXML will create or modify a subscriber for each workflow-action in a file <tt class="docutils literal"><span class="pre">wfsubsribers.py</span></tt> in your product. You must fill in the method bodies for the actions in this file. Method bodies will be preserved upon re-generation of your product from the UML model. In Plone 2.5 compatible mode DCWorkflow needs a patch with a backport. This patch is generated, if <tt class="docutils literal"><span class="pre">2.5</span></tt> is selected as <tt class="docutils literal"><span class="pre">plone_target_version</span></tt> (tagged value on model).</p>
<p>By default, actions specified in this way are post-transition actions, meaning that they are executed after the transition has taken place. If you wish to specify a pre-transition action, executed before the transition takes place, separate action names by semicolons: <tt class="docutils literal"><span class="pre">preActionName;postActionName</span></tt>. If you want only a pre-transition action, use <tt class="docutils literal"><span class="pre">preActionName;</span></tt> to specify that there is an empty post-transition action.</p>
</div>
<div class="section" id="attach-workflow-to-more-than-one-class">
<h2><a class="toc-backref" href="#id8">Attach workflow to more than one class</a><a class="headerlink" href="#attach-workflow-to-more-than-one-class" title="Permalink to this headline">¶</a></h2>
<p>In UML there is no semantic to use a workflow for more than one class. We introduced the tagged value <tt class="docutils literal"><span class="pre">use_workflow</span></tt> for classes. Value is the workflow name.</p>
</div>
<div class="section" id="worklist-support">
<h2><a class="toc-backref" href="#id9">Worklist support</a><a class="headerlink" href="#worklist-support" title="Permalink to this headline">¶</a></h2>
<p>You can attach objects in a certain state to a worklist. A worklist is something like the &quot;documents to review&quot; list you get when you're a reviewer in a Plone site. This is done by adding a tag <tt class="docutils literal"><span class="pre">worklist</span></tt> to the state with the name of the worklist as value (like <tt class="docutils literal"><span class="pre">review_list</span></tt>).</p>
<p>You can add more than one state to a <tt class="docutils literal"><span class="pre">worklist</span></tt>, just by specifying the same name for the worklist tagged value. Likewise, you can have more than one worklist (just not on the same state). The tagged value <tt class="docutils literal"><span class="pre">worklist:guard_permissions</span></tt> allows you to specify the permission you need to have to view the worklist. The default value is <tt class="docutils literal"><span class="pre">Review</span> <span class="pre">portal</span> <span class="pre">content</span></tt>.</p>
</div>
</div>

  </div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
<p class="logo"><a href="../../../index.html"><img src="../../../_static/plone-icon-64.png" />
</a></p>

  <h3><a href="../../../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Workflows</a><ul>
<li><a class="reference internal" href="#problems-with-uml-software">Problems with UML-Software</a></li>
<li><a class="reference internal" href="#creating-a-workflow">Creating a workflow</a></li>
<li><a class="reference internal" href="#states">States</a></li>
<li><a class="reference internal" href="#transitions">Transitions</a><ul>
<li><a class="reference internal" href="#transition-guards">Transition guards</a></li>
<li><a class="reference internal" href="#permissions">Permissions</a></li>
</ul>
</li>
<li><a class="reference internal" href="#workflow-actions">Workflow actions</a></li>
<li><a class="reference internal" href="#attach-workflow-to-more-than-one-class">Attach workflow to more than one class</a></li>
<li><a class="reference internal" href="#worklist-support">Worklist support</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="relationships-between-classes-and-objects.html"
                        title="previous chapter">Relationships between classes and objects</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="tests.html"
                        title="next chapter">Tests</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="../../../_sources/tutorials/archgenxml/basic-features/workflows.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" size="18" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="tests.html" title="Tests"
             >next</a> |</li>
        <li class="right" >
          <a href="relationships-between-classes-and-objects.html" title="Relationships between classes and objects"
             >previous</a> |</li>
        <li><a href="../../../index.html">Plone Community Managed Developer Manual v1.0 documentation</a> &raquo;</li>
          <li><a href="../../index.html" >Tutorials</a> &raquo;</li>
          <li><a href="../index.html" >Using ArchGenXML</a> &raquo;</li>
          <li><a href="index.html" >Basic Features</a> &raquo;</li> 
      </ul>
    </div>

    <div class="footer">
        &copy; Copyright 2010 mFabrik Research Oy and Plone community contributors.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.0.4.
    </div>


  </body>
</html>