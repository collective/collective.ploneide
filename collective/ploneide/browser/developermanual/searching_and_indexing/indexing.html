<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Indexes and metadata &mdash; Plone Community Managed Developer Manual v1.0 documentation</title>
    <link rel="stylesheet" href="../_static/plone.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '1.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="top" title="Plone Community Managed Developer Manual v1.0 documentation" href="../index.html" />
    <link rel="up" title="Searching and indexing" href="index.html" />
    <link rel="next" title="Querying" href="query.html" />
    <link rel="prev" title="Catalogs" href="catalog.html" />
<script language="javascript">
//<![CDATA[

Documentation.addTranslations({"locale": "fr", "plural_expr": "(n > 1)", "messages": {"See the definition": "Voir la d\u00e9finition"}});

// See http://disqus.disqus.com/general_integration_help/
var disqus_developer = 1;
if (document.location.protocol == 'http:') {
    disqus_developer = 0;
}

// Some HTML/CSS transforms we can't do in pure CSS (waiting for CSS3 support)
$(document).ready(function () {

    // Style of .. verisonmodified:: , .. versionadded:: ...
    $('p:has(span.versionmodified)').addClass('p-versionmodified');

    // Style of the TOC tree
    $('ul:has(li.toctree-l1)').addClass('toctree');

    // Decorate links to other sites
    $('a[class~=external]').attr('target', '_blank');

    // Glossary terms
    $('em.xref').attr('title', _('See the definition'));

    // We need to have all <pre> in a <div class="highlight"> to mimic pygments
    // to work around a pygments (?) bug
    var suffixes = {cfg: null, python:null};
    for (var suffix in suffixes) {
        var pattern = 'div.highlight-' + suffix + ' > pre';
        $(pattern).wrap('<div class="highlight" />');
    }
    return true;
});
//]]>
</script>

  </head>
  <body>
<!--[if lte IE 6]>
<style type="text/css">
#ie6msg{border:3px solid #090; margin:8px 0; background:#cfc; color:#000;}
#ie6msg h4{margin:8px; padding:0;}
#ie6msg p{margin:8px; padding:0;}
#ie6msg p a.getie8{font-weight:bold; color:#006;}
#ie6msg p a.ie6expl{font-weight:normal; color:#006;}
</style>
<div id="ie6msg">
<h4>Did you know that your browser is out of date?</h4>
<p>If the layout of this site seems ugly, that's because you're actually using
an outdated browser. And we wont put any effort to provide a nice layout to IE6
users.</p>
<p>To get the best possible experience using our website we recommend that you
upgrade your browser to a newer version. The current version
is <a class="getie8"
href="http://upgradeie.s3.amazonaws.com/eng/index.html">Internet Explorer
8</a>. The upgrade is free. If you're using a PC at work you should contact your
IT administrator.</p>
<p>If you want to you may also try some other popular Internet browsers
like <a class="ie6expl"
href="http://getfirefox.com">Firefox</a>, <a class="ie6expl"
href="http://www.google.com/chrome">Chrome</a>, <a class="ie6expl"
href="http://www.opera.com">Opera</a>, or <a class="ie6expl"
href="http://www.apple.com/safari/download/">Safari</a></p>
</div>
<![endif]-->

    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="query.html" title="Querying"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="catalog.html" title="Catalogs"
             accesskey="P">previous</a> |</li>
        <li><a href="../index.html">Plone Community Managed Developer Manual v1.0 documentation</a> &raquo;</li>
          <li><a href="index.html" accesskey="U">Searching and indexing</a> &raquo;</li> 
      </ul>
    </div>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="sphinx-content">
    <div class="section" id="indexes-and-metadata">
<h1>Indexes and metadata<a class="headerlink" href="#indexes-and-metadata" title="Permalink to this headline">¶</a></h1>
<div class="admonition-description admonition ">
<p class="first admonition-title">Description</p>
<p class="last">How to program your custom fields and data queriable
through portal_catalog.</p>
</div>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><a class="reference internal" href="#what-does-indexing-mean" id="id3">What does indexing mean?</a></li>
<li><a class="reference internal" href="#viewing-indexes-and-indexed-data" id="id4">Viewing indexes and indexed data</a><ul>
<li><a class="reference internal" href="#indexed-data" id="id5">Indexed data</a></li>
<li><a class="reference internal" href="#indexes-and-metadata-columns" id="id6">Indexes and metadata columns</a></li>
</ul>
</li>
<li><a class="reference internal" href="#creating-an-index" id="id7">Creating an index</a><ul>
<li><a class="reference internal" href="#creating-an-index-through-the-web" id="id8">Creating an index through the web</a></li>
<li><a class="reference internal" href="#adding-index-using-add-on-product-installer" id="id9">Adding index using add-on product installer</a></li>
<li><a class="reference internal" href="#custom-index-methods" id="id10">Custom index methods</a></li>
</ul>
</li>
<li><a class="reference internal" href="#when-indexing-happens-and-how-to-reindex-manually" id="id11">When indexing happens and how to reindex manually</a></li>
<li><a class="reference internal" href="#index-types" id="id12">Index types</a></li>
<li><a class="reference internal" href="#default-plone-indexes-and-metadata-columns" id="id13">Default Plone indexes and metadata columns</a><ul>
<li><a class="reference internal" href="#custom-sorting-by-title" id="id14">Custom sorting by title</a></li>
</ul>
</li>
<li><a class="reference internal" href="#textindexng3" id="id15">TextIndexNG3</a></li>
<li><a class="reference internal" href="#other" id="id16">Other</a></li>
</ul>
</div>
<div class="section" id="what-does-indexing-mean">
<h2><a class="toc-backref" href="#id3">What does indexing mean?</a><a class="headerlink" href="#what-does-indexing-mean" title="Permalink to this headline">¶</a></h2>
<p>Indexing is the action to make object data searchable.
Plone stores available indexes in the database.
You can create them through-the-web and inspect existing indexes
in portal_catalog on Index tab.</p>
<p>The Catalog Tool can be configured through the ZMI or
programatically in Python but current best practice in the CMF
world is to use GenericSetup to configure it using the declarative
<em>catalog.xml</em> file. The GenericSetup profile for Plone, for
example, uses the <em>CMFPlone/profiles/default/catalog.xml</em> XML data
file to configure the Catalog Tool when a Plone site is created. It
is fairly readable so taking a quick look through it can be very
informative.</p>
<p>When using a GenericSetup extension profile to customize the
Catalog Tool** in your portal, you only need to include XML for the
pieces of the catalog you are changing. To add an index for the
Archetypes location field, as in the example above, a policy
package could include the following
<em>profiles/default/catalog.xml</em>:</p>
<div class="highlight-python"><pre>&lt;?xml version="1.0"?&gt;
&lt;object name="portal_catalog" meta_type="Plone Catalog Tool"&gt;
 &lt;index name="location" meta_type="FieldIndex"&gt;
  &lt;indexed_attr value="location"/&gt;
 &lt;/index&gt;
&lt;/object&gt;</pre>
</div>
<p>The GenericSetup import handler for the Catalog Tool also supports
removing indexes from the catalog if present using the &quot;remove&quot;
attribute of the <em>&lt;index&gt;</em> element. To remove the &quot;start&quot; and &quot;end&quot;
indexes used for events, for example, a policy package could
include the following <em>profiles/default/catalog.xml</em>:</p>
<div class="highlight-python"><pre>&lt;?xml version="1.0"?&gt;
&lt;object name="portal_catalog" meta_type="Plone Catalog Tool"&gt;
 &lt;index name="start" remove="True" /&gt;
 &lt;index name="end" remove="True" /&gt;
&lt;/object&gt;</pre>
</div>
<div class="admonition-warning admonition ">
<p class="first admonition-title">Warning</p>
<p class="last">Care must be taken when setting up indexes with GenericSetup - if
the import step for a <em>catalog.xml</em> is run a second time (for example
when you reinstall the product), the indexes specified will be
destroyed, losing all currently indexed entries, and then re-created
fresh (and empty!). If you want to workaround this behaviour, you can
either update the catalog afterwards or add the indexes yourself in
Python code using a custom import handler.</p>
</div>
</div>
<div class="section" id="viewing-indexes-and-indexed-data">
<h2><a class="toc-backref" href="#id4">Viewing indexes and indexed data</a><a class="headerlink" href="#viewing-indexes-and-indexed-data" title="Permalink to this headline">¶</a></h2>
<div class="section" id="indexed-data">
<h3><a class="toc-backref" href="#id5">Indexed data</a><a class="headerlink" href="#indexed-data" title="Permalink to this headline">¶</a></h3>
<p>You can do this through portal_catalog tool in ZMI.</p>
<ul class="simple">
<li>Click portal_catalog in the portal root</li>
<li>Click <em>Catalog</em> tab</li>
<li>Click any object</li>
</ul>
</div>
<div class="section" id="indexes-and-metadata-columns">
<h3><a class="toc-backref" href="#id6">Indexes and metadata columns</a><a class="headerlink" href="#indexes-and-metadata-columns" title="Permalink to this headline">¶</a></h3>
<p>Available indexes are stored in the database, not in Python code.
To see what indexes your site has</p>
<ul class="simple">
<li>Click portal_catalog in the portal root</li>
<li>Click <em>Indexes</em> and <em>Metadata</em> tabs</li>
</ul>
</div>
</div>
<div class="section" id="creating-an-index">
<h2><a class="toc-backref" href="#id7">Creating an index</a><a class="headerlink" href="#creating-an-index" title="Permalink to this headline">¶</a></h2>
<p>To perform queries on custom data, you need to add corresponding index to portal_catalog first.</p>
<p>E.g. If your <a class="reference internal" href="../content/types.html"><em>Archetypes</em></a> content type has a field:</p>
<div class="highlight-python"><pre>        schema = [

           DateField("revisitDate",
                widget = atapi.DateWidget(
                    label="Revisit date"),
                    description="When you are alarmed this content should be revisited (one month beforehand this date)",
                    schemata="revisit"
                    ),
        ]

class MyContent(...):

        # This is automatically run-time generated function accessor method,
        # but could be any hand-written method as well
        # def getMyCustomValue(self):
        #        pass</pre>
</div>
<p>You can add a new index which will <em>index</em> the value of this field, so you can
make queries based on it later.</p>
<p>See more information about <a class="reference internal" href="../content/archetypes/fields.html"><em>accessor methods</em></a>.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">If you want to create an index for content type you do not
control yourself or if you want to do some custom logic in your indexer,
please see <em>Custom index method</em> below.</p>
</div>
<div class="section" id="creating-an-index-through-the-web">
<h3><a class="toc-backref" href="#id8">Creating an index through the web</a><a class="headerlink" href="#creating-an-index-through-the-web" title="Permalink to this headline">¶</a></h3>
<p>This method is suitable during development time - you can create an index
to your Plone database locally.</p>
<ul>
<li><p class="first">Go ZMI</p>
</li>
<li><p class="first">Click portal_catalog</p>
</li>
<li><p class="first">Click Indexes tab</p>
</li>
<li><p class="first">On top right corner, you have a drop down menu to add new indexes. Choose the index type you need to add.</p>
<blockquote>
<ul class="simple">
<li>Type: FieldIndex</li>
<li>Id: getMyCustomValue</li>
<li>Indexed attributes: getMyCustomValue</li>
</ul>
</blockquote>
</li>
</ul>
<p>You can use Archetypes accessors methods directly as an indexed attribute.
In example we use <tt class="docutils literal"><span class="pre">getMyCustomValue</span></tt> for AT field <tt class="docutils literal"><span class="pre">customValue</span></tt>.</p>
<p>The type of index you need depends on what kind queries you need to do on the data. E.g.
direct value matching, ranged date queries, free text search, etc. need different kind of indexes.</p>
<ul>
<li><p class="first">After this you can query portal_catalog:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">my_brains</span> <span class="o">=</span> <span class="n">contex</span><span class="o">.</span><span class="n">portal_catalog</span><span class="p">(</span><span class="n">getMyCustomValue</span><span class="o">=</span><span class="mi">111</span><span class="p">)</span>
<span class="k">for</span> <span class="n">brain</span> <span class="ow">in</span> <span class="n">my_brains</span><span class="p">:</span>
        <span class="k">print</span> <span class="n">brain</span><span class="p">[</span><span class="s">&quot;getMyCustomValue&quot;</span><span class="p">]</span>
</pre></div>
</div>
</li>
</ul>
</div>
<div class="section" id="adding-index-using-add-on-product-installer">
<h3><a class="toc-backref" href="#id9">Adding index using add-on product installer</a><a class="headerlink" href="#adding-index-using-add-on-product-installer" title="Permalink to this headline">¶</a></h3>
<p>You need to have your own add-on product which
registers new indexes when the add-on installer is run.
This is the recommended method for repeated installations.</p>
<p>You can create an index</p>
<ul class="simple">
<li>Using catalog.xml where XML is written by hand</li>
<li>Create the index through the web and export catalog data from a development site
using <em>portal_setup</em> tool <em>Export</em> functionality. The index is created
through-the-web as above, XML is generated for you and you can fine tune the resulting XML
before dropping it in to your add-on product.</li>
<li>Create indexes in Python code of add-on custom import step.</li>
<li>As a prerequisitement, your add-on product must have
<a class="reference internal" href="../components/genericsetup.html"><em>GenericSetup profile support</em></a>.</li>
</ul>
<p>This way is repeatable: index gets created every time an add-on product is installed.
It is more cumbersome, however.</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">There is a known issue of indexed data getting pruned
when an add-on product is reinstalled. If you want to avoid
this then you need to create new indexes in add-on
installer custom setup step (Python code).</p>
</div>
<p>The example below is not safe for data prune on reinstall.
This file is <tt class="docutils literal"><span class="pre">profiles/default/catalog.xml</span></tt>
It installs a new index called <tt class="docutils literal"><span class="pre">revisit_date</span></tt>
of DateIndex type.</p>
<div class="highlight-xml"><div class="highlight"><pre><span class="cp">&lt;?xml version=&quot;1.0&quot;?&gt;</span>
<span class="nt">&lt;object</span> <span class="na">name=</span><span class="s">&quot;portal_catalog&quot;</span> <span class="na">meta_type=</span><span class="s">&quot;Plone Catalog Tool&quot;</span><span class="nt">&gt;</span>
         <span class="nt">&lt;index</span> <span class="na">name=</span><span class="s">&quot;revisit_date&quot;</span> <span class="na">meta_type=</span><span class="s">&quot;DateIndex&quot;</span><span class="nt">&gt;</span>
                <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;index_naive_time_as_local&quot;</span><span class="nt">&gt;</span>True<span class="nt">&lt;/property&gt;</span>
        <span class="nt">&lt;/index&gt;</span>
<span class="nt">&lt;/object&gt;</span>
</pre></div>
</div>
<p>For more information see</p>
<ul class="simple">
<li><a class="reference external" href="http://maurits.vanrees.org/weblog/archive/2009/12/catalog">http://maurits.vanrees.org/weblog/archive/2009/12/catalog</a></li>
</ul>
</div>
<div class="section" id="custom-index-methods">
<h3><a class="toc-backref" href="#id10">Custom index methods</a><a class="headerlink" href="#custom-index-methods" title="Permalink to this headline">¶</a></h3>
<p>The <a class="reference external" href="http://pypi.python.org/pypi/plone.indexer">plone.indexer</a> package provides method to create custom indexing functions.</p>
<p>Sometimes you want to index &quot;virtual&quot; attributes of an object
computed from existing ones, or just want to customize the way
certain attributes are indexed, for example, saving only the 10
first characters of a field instead of its whole content.</p>
<p>To do so in an elegant and flexible way, Plone&gt;=3.3 includes a new
package, <a class="reference external" href="http://pypi.python.org/pypi/plone.indexer">plone.indexer</a>,
which provides a series of primitives to delegate indexing operations
to adapters.</p>
<p>Let's say you have a content-type providing the interface
<tt class="docutils literal"><span class="pre">IMyType</span></tt>. To define an indexer for your type which takes the
first 10 characters from the body text, just type (assuming the
attribute's name is 'text'):</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">plone.indexer.decorator</span> <span class="kn">import</span> <span class="n">indexer</span>

<span class="nd">@indexer</span><span class="p">(</span><span class="n">IMyType</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">mytype_description</span><span class="p">(</span><span class="nb">object</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">):</span>
     <span class="k">return</span> <span class="nb">object</span><span class="o">.</span><span class="n">text</span><span class="p">[:</span><span class="mi">10</span><span class="p">]</span>
</pre></div>
</div>
<p>Finally, register this factory function as a named adapter using
ZCML. Assuming you've put the code above into a file named
<tt class="docutils literal"><span class="pre">indexers.py</span></tt>:</p>
<div class="highlight-python"><pre>&lt;adapter name="description" factory=".indexers.mytype_description" /&gt;</pre>
</div>
<p>And that's all! Easy, wasn't it?</p>
<p>Note you can omit the <tt class="docutils literal"><span class="pre">for</span></tt> attribute because you passed this to
the <tt class="docutils literal"><span class="pre">&#64;indexer</span></tt> decorator, and you can omit the <tt class="docutils literal"><span class="pre">provides</span></tt>
attribute because the thing returned by the decorator is actually a
class providing the required <tt class="docutils literal"><span class="pre">IIndexer</span></tt> interface.</p>
<p>To learn more about the <em>plone.indexer</em> package, read
<a class="reference external" href="http://dev.plone.org/plone/browser/plone.indexer/trunk/plone/indexer/README.txt">its doctest</a>.</p>
<p>For more info about how to create content-types, refer to the
<a class="reference external" href="http://plone.org/documentation/manual/developer-manual/archetypes">Archetypes Developer Manual</a>.</p>
<p><strong>Important note:</strong> If you want to adapt a out-of-the-box
Archetypes content-type like Event or News Item, take into account
you will have to feed the <tt class="docutils literal"><span class="pre">indexer</span></tt> decorator with the Zope 3
interfaces defined in <tt class="docutils literal"><span class="pre">Products.ATContentTypes.interface.*</span></tt>
files, not with the deprecated Zope 2 ones into the
<tt class="docutils literal"><span class="pre">Products.ATContentTypes.interfaces</span></tt> file.</p>
</div>
</div>
<div class="section" id="when-indexing-happens-and-how-to-reindex-manually">
<h2><a class="toc-backref" href="#id11">When indexing happens and how to reindex manually</a><a class="headerlink" href="#when-indexing-happens-and-how-to-reindex-manually" title="Permalink to this headline">¶</a></h2>
<p>Content item reindexing is run when</p>
<p>Plone calls reindexObject() if</p>
<ul class="simple">
<li>The object is modified by the user using the standard edit forms</li>
<li>portal_catalog rebuild is run (from <em>Advanced</em> tab)</li>
<li>If you add a new
index you need to run <a class="reference internal" href="catalog.html"><em>Rebuild catalog</em></a>
to get the existing values from content objects to new index.</li>
<li>You might also want to call <a class="reference internal" href="catalog.html"><em>reindexObject()</em></a> method  manually in some
cases. This method is defined in the <a class="reference external" href="http://svn.zope.org/Products.CMFCore/trunk/Products/CMFCore/interfaces/_content.py?rev=91414&amp;view=auto">ICatalogAware</a> interface.</li>
</ul>
<p>You must call reindexObject() if you</p>
<ul class="simple">
<li>Directly call object field mutators</li>
<li>Otherwise directly change object data</li>
</ul>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last"><strong>Unit test warning:</strong> Usually Plone reindexes modified objects at the end of each request (each transaction).
If you modify the object yourself you are responsible to notify related catalogs about the new object data.</p>
</div>
<p>reindexObject() method takes the optional argument <em>idxs</em> which will list the changed indexes.
If idxs is not given, all related indexes are updated even though they were not changed.</p>
<p>Example:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="nb">object</span><span class="o">.</span><span class="n">setTitle</span><span class="p">(</span><span class="s">&quot;Foobar&quot;</span><span class="p">)</span>

<span class="c"># Object.reindexObject() method is called to reflect the changed data in portal_catalog.</span>
<span class="c"># In our example, we change the title. The new title is not updated in the navigation,</span>
<span class="c"># since the navigation tree and folder listing pulls object title from the catalog.</span>

<span class="nb">object</span><span class="o">.</span><span class="n">reindexObject</span><span class="p">(</span><span class="n">idxs</span><span class="o">=</span><span class="p">[</span><span class="s">&quot;Title&quot;</span><span class="p">])</span>
</pre></div>
</div>
<p>Also, if you modify security related parameters (permissions), you need to call reindexObjectSecurity().</p>
</div>
<div class="section" id="index-types">
<h2><a class="toc-backref" href="#id12">Index types</a><a class="headerlink" href="#index-types" title="Permalink to this headline">¶</a></h2>
<p>Zope 2 product PluginIndexes defines various portal_catalog index types used by Plone.</p>
<ul class="simple">
<li>FieldIndex stores values as is</li>
<li>DateIndex and DateRangeIndex store dates (Zope 2 DateTime objects) in searhable format. The latter
provides ranged searches.</li>
<li>KeywordIndex allows keyword-style look-ups (query term is matched against the all values of a stored list)</li>
<li>ZCTextIndex is used for full text indexing</li>
<li><a class="reference external" href="https://svn.plone.org/svn/plone/Products.ExtendedPathIndex/trunk/README.txt">ExtendedPathIndex</a> is used for indexing content object locations.</li>
</ul>
</div>
<div class="section" id="default-plone-indexes-and-metadata-columns">
<h2><a class="toc-backref" href="#id13">Default Plone indexes and metadata columns</a><a class="headerlink" href="#default-plone-indexes-and-metadata-columns" title="Permalink to this headline">¶</a></h2>
<p>Some interesting indexes</p>
<ul class="simple">
<li>start and end: Calendar event timestamps, used to make up calendar portlet</li>
<li>sortable_title: Title provided for sorting</li>
<li>portal_type: Content type as it appears in portal_types</li>
<li>Type: Translated, human readable, type of the content</li>
<li>path: Where the object is (getPhysicalPath accessor method).</li>
<li>object_provides: What interfaces and marker interfaces object has. KeywordIndex of
interface full names.</li>
<li>is_default_page: is_default_page is method in CMFPlone/CatalogTool.py handled by plone.indexer, so there is nothing
like object.is_default_page and this method calls ptool.isDefaultPage(obj)</li>
</ul>
<p>Some interesting columns</p>
<ul class="simple">
<li>getRemoteURL: Where to go when the object is clicked</li>
<li>getIcon: Which content type icon is used for this object in the navigation</li>
<li>exclude_from_nav: If True the object won't appear in sitemap, navigation tree</li>
</ul>
<div class="section" id="custom-sorting-by-title">
<h3><a class="toc-backref" href="#id14">Custom sorting by title</a><a class="headerlink" href="#custom-sorting-by-title" title="Permalink to this headline">¶</a></h3>
<p><tt class="docutils literal"><span class="pre">sortable_title</span> <span class="pre">is</span> <span class="pre">type</span> <span class="pre">of</span> <span class="pre">FieldIndex</span> <span class="pre">(raw</span> <span class="pre">value)</span> <span class="pre">and</span> <span class="pre">normal</span> <span class="pre">``Title</span></tt> index is type of searhable text.</p>
<p><tt class="docutils literal"><span class="pre">sortable_title</span></tt> is generated from <tt class="docutils literal"><span class="pre">Title</span></tt> in <tt class="docutils literal"><span class="pre">Products/CMFPlone/CatalogTool.py</span></tt>.</p>
<p>You can override <tt class="docutils literal"><span class="pre">sortable_title</span></tt> by providing an indexer adapter with a specific interface of your content type.</p>
<p>Example indexes.py:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">plone.indexer</span> <span class="kn">import</span> <span class="n">indexer</span>

<span class="kn">from</span> <span class="nn">xxx.researcher.interfaces</span> <span class="kn">import</span> <span class="n">IResearcher</span>

<span class="nd">@indexer</span><span class="p">(</span><span class="n">IResearcher</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">sortable_title</span><span class="p">(</span><span class="n">obj</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Provide custom sorting title.</span>

<span class="sd">    This is used by various folder functions of Plone.</span>
<span class="sd">    This can differ from actual Title.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c"># Remember to handle None value if the object has not been edited yet</span>
    <span class="n">first_name</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">getFirst_name</span><span class="p">()</span> <span class="ow">or</span> <span class="s">&quot;&quot;</span>
    <span class="n">last_name</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">getLast_name</span><span class="p">()</span> <span class="ow">or</span> <span class="s">&quot;&quot;</span>

    <span class="k">return</span> <span class="n">last_name</span> <span class="o">+</span> <span class="s">&quot; &quot;</span> <span class="o">+</span> <span class="n">first_name</span>
</pre></div>
</div>
<p>Related <tt class="docutils literal"><span class="pre">configure.zcml</span></tt></p>
<div class="highlight-xml"><div class="highlight"><pre><span class="nt">&lt;adapter</span> <span class="na">factory=</span><span class="s">&quot;.indexes.sortable_title&quot;</span> <span class="na">name=</span><span class="s">&quot;sortable_title&quot;</span> <span class="nt">/&gt;</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="textindexng3">
<h2><a class="toc-backref" href="#id15">TextIndexNG3</a><a class="headerlink" href="#textindexng3" title="Permalink to this headline">¶</a></h2>
<p><a class="reference external" href="http://www.zopyx.com/projects/TextIndexNG3">TextIndexNG3</a> is advanced text indexing solution for Zope.</p>
<p>Please read TextIndexNG3 README.txt regarding how to add support for custom fields.
Besides installing TextIndexNG3 in GenericSetup XML you need to provide a custom
indexing adapter.</p>
<p># Add TextIndexNG3 in catalog.xml. Example:</p>
<div class="highlight-python"><pre>&lt;index name="getYourFieldName" meta_type="TextIndexNG3"&gt;

  &lt;field value="getYourFieldName"/&gt;

  &lt;autoexpand value="off"/&gt;
  &lt;autoexpand_limit value="4"/&gt;
  &lt;dedicated_storage value="False"/&gt;
  &lt;default_encoding value="utf-8"/&gt;
  &lt;index_unknown_languages value="True"/&gt;
  &lt;language value="en"/&gt;
  &lt;lexicon value="txng.lexicons.default"/&gt;
  &lt;query_parser value="txng.parsers.en"/&gt;
  &lt;ranking value="True"/&gt;
  &lt;splitter value="txng.splitters.simple"/&gt;
  &lt;splitter_additional_chars value="_-"/&gt;
  &lt;splitter_casefolding value="True"/&gt;
  &lt;storage value="txng.storages.term_frequencies"/&gt;
  &lt;use_normalizer value="False"/&gt;
  &lt;use_stemmer value="False"/&gt;
  &lt;use_stopwords value="False"/&gt;
&lt;/index&gt;</pre>
</div>
<p># Create adapter which will add TextIndexNG3 indexing support for your custom fields. Example:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">logging</span>

<span class="kn">from</span> <span class="nn">Products.TextIndexNG3.adapters.cmf_adapters</span> <span class="kn">import</span> <span class="n">CMFContentAdapter</span>
<span class="kn">from</span> <span class="nn">zope.component</span> <span class="kn">import</span> <span class="n">adapts</span>

<span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s">&quot;Plone&quot;</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">TextIndexNG3SearchAdapter</span><span class="p">(</span><span class="n">CMFContentAdapter</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Adapter which provides custom field specific index information for TextIndexNG3</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c"># Your content marker interface here</span>
    <span class="n">adapts</span><span class="p">(</span><span class="n">IDescriptionBase</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">indexableContent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fields</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Produce TextIndexNG3 indexing information for the object</span>

<span class="sd">        Traceback::</span>

<span class="sd">              ZCatalog.py(536)catalog_object()</span>
<span class="sd">            -&gt; update_metadata=update_metadata)</span>
<span class="sd">              Catalog.py(360)catalogObject()</span>
<span class="sd">            -&gt; blah = x.index_object(index, object, threshold)</span>
<span class="sd">              Products/TextIndexNG3/TextIndexNG3.py(91)index_object()</span>
<span class="sd">            -&gt; result = self.index.index_object(obj, docid)</span>
<span class="sd">              Products/TextIndexNG3/src/textindexng/index.py(114)index_object()</span>
<span class="sd">            -&gt; default_language=self.languages[0])</span>
<span class="sd">              Products/TextIndexNG3/src/textindexng/content.py(99)extract_content()</span>
<span class="sd">            -&gt; icc = adapter.indexableContent(fields)</span>
<span class="sd">            &gt; indexableContent()</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s">&quot;Indexing&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="p">))</span>

        <span class="c"># Use superclass to construct generic field adapters (id, title, description, SearchableText)</span>
        <span class="n">icc</span> <span class="o">=</span> <span class="n">CMFContentAdapter</span><span class="o">.</span><span class="n">indexableContent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fields</span><span class="p">)</span>

        <span class="c"># These fields have their own TextIndexNG3 indexes which</span>
        <span class="c"># are queried separately from SearchableText</span>
        <span class="n">accessors</span> <span class="o">=</span> <span class="p">[</span> <span class="s">&quot;getClassifications&quot;</span><span class="p">,</span> <span class="s">&quot;getOtherNames&quot;</span> <span class="p">]</span>

        <span class="k">for</span> <span class="n">accessor</span> <span class="ow">in</span> <span class="n">accessors</span><span class="p">:</span>

            <span class="k">try</span><span class="p">:</span>
                <span class="n">method</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="p">,</span> <span class="n">accessor</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s">&quot;Declared indexing for unsuppoted accessor:&quot;</span> <span class="o">+</span> <span class="n">accesor</span><span class="p">)</span>
                <span class="k">continue</span>

            <span class="n">value</span> <span class="o">=</span> <span class="n">method</span><span class="p">()</span>

            <span class="c"># We might have a value which is not a real string,</span>
            <span class="c"># but must be first stringified</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">value</span> <span class="o">=</span> <span class="nb">unicode</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">UnicodeDecodeError</span><span class="p">,</span> <span class="n">e</span><span class="p">:</span>
                <span class="c"># Bad things happen here?</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s">&quot;Failed to index field:&quot;</span> <span class="o">+</span> <span class="n">accessor</span><span class="p">)</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
                <span class="k">continue</span>

            <span class="c"># Convert value to text format (utf-8) expected</span>
            <span class="c"># by the indexer</span>
            <span class="n">text</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_c</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>

            <span class="n">icc</span><span class="o">.</span><span class="n">addContent</span><span class="p">(</span><span class="n">accessor</span><span class="p">,</span> <span class="n">text</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">language</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">icc</span>
</pre></div>
</div>
<p># Add adapter in your ZCML:</p>
<div class="highlight-python"><pre>&lt;adapter factory=".customcontent.TextIndexNG3SearchAdapter"/&gt;</pre>
</div>
</div>
<div class="section" id="other">
<h2><a class="toc-backref" href="#id16">Other</a><a class="headerlink" href="#other" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><a class="reference external" href="http://toutpt.wordpress.com/2008/12/14/archetype_tool-queuecatalog-becareful-with-indexing-with-plones-portal_catalog/">http://toutpt.wordpress.com/2008/12/14/archetype_tool-queuecatalog-becareful-with-indexing-with-plones-portal_catalog/</a></li>
</ul>
</div>
</div>

  </div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
<p class="logo"><a href="../index.html"><img src="../_static/plone-icon-64.png" />
</a></p>

  <h3><a href="../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Indexes and metadata</a><ul>
<li><a class="reference internal" href="#what-does-indexing-mean">What does indexing mean?</a></li>
<li><a class="reference internal" href="#viewing-indexes-and-indexed-data">Viewing indexes and indexed data</a><ul>
<li><a class="reference internal" href="#indexed-data">Indexed data</a></li>
<li><a class="reference internal" href="#indexes-and-metadata-columns">Indexes and metadata columns</a></li>
</ul>
</li>
<li><a class="reference internal" href="#creating-an-index">Creating an index</a><ul>
<li><a class="reference internal" href="#creating-an-index-through-the-web">Creating an index through the web</a></li>
<li><a class="reference internal" href="#adding-index-using-add-on-product-installer">Adding index using add-on product installer</a></li>
<li><a class="reference internal" href="#custom-index-methods">Custom index methods</a></li>
</ul>
</li>
<li><a class="reference internal" href="#when-indexing-happens-and-how-to-reindex-manually">When indexing happens and how to reindex manually</a></li>
<li><a class="reference internal" href="#index-types">Index types</a></li>
<li><a class="reference internal" href="#default-plone-indexes-and-metadata-columns">Default Plone indexes and metadata columns</a><ul>
<li><a class="reference internal" href="#custom-sorting-by-title">Custom sorting by title</a></li>
</ul>
</li>
<li><a class="reference internal" href="#textindexng3">TextIndexNG3</a></li>
<li><a class="reference internal" href="#other">Other</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="catalog.html"
                        title="previous chapter">Catalogs</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="query.html"
                        title="next chapter">Querying</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="../_sources/searching_and_indexing/indexing.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" size="18" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="query.html" title="Querying"
             >next</a> |</li>
        <li class="right" >
          <a href="catalog.html" title="Catalogs"
             >previous</a> |</li>
        <li><a href="../index.html">Plone Community Managed Developer Manual v1.0 documentation</a> &raquo;</li>
          <li><a href="index.html" >Searching and indexing</a> &raquo;</li> 
      </ul>
    </div>

    <div class="footer">
        &copy; Copyright 2010 mFabrik Research Oy and Plone community contributors.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.0.4.
    </div>


  </body>
</html>