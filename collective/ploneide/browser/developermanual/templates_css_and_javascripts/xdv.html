<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Diazo / XDV theming &mdash; Plone Community Managed Developer Manual v1.0 documentation</title>
    <link rel="stylesheet" href="../_static/plone.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '1.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="top" title="Plone Community Managed Developer Manual v1.0 documentation" href="../index.html" />
    <link rel="up" title="Templates, CSS and Javascript" href="index.html" />
    <link rel="next" title="DTML" href="dtml.html" />
    <link rel="prev" title="Skin layers" href="skin_layers.html" />
<script language="javascript">
//<![CDATA[

Documentation.addTranslations({"locale": "fr", "plural_expr": "(n > 1)", "messages": {"See the definition": "Voir la d\u00e9finition"}});

// See http://disqus.disqus.com/general_integration_help/
var disqus_developer = 1;
if (document.location.protocol == 'http:') {
    disqus_developer = 0;
}

// Some HTML/CSS transforms we can't do in pure CSS (waiting for CSS3 support)
$(document).ready(function () {

    // Style of .. verisonmodified:: , .. versionadded:: ...
    $('p:has(span.versionmodified)').addClass('p-versionmodified');

    // Style of the TOC tree
    $('ul:has(li.toctree-l1)').addClass('toctree');

    // Decorate links to other sites
    $('a[class~=external]').attr('target', '_blank');

    // Glossary terms
    $('em.xref').attr('title', _('See the definition'));

    // We need to have all <pre> in a <div class="highlight"> to mimic pygments
    // to work around a pygments (?) bug
    var suffixes = {cfg: null, python:null};
    for (var suffix in suffixes) {
        var pattern = 'div.highlight-' + suffix + ' > pre';
        $(pattern).wrap('<div class="highlight" />');
    }
    return true;
});
//]]>
</script>

  </head>
  <body>
<!--[if lte IE 6]>
<style type="text/css">
#ie6msg{border:3px solid #090; margin:8px 0; background:#cfc; color:#000;}
#ie6msg h4{margin:8px; padding:0;}
#ie6msg p{margin:8px; padding:0;}
#ie6msg p a.getie8{font-weight:bold; color:#006;}
#ie6msg p a.ie6expl{font-weight:normal; color:#006;}
</style>
<div id="ie6msg">
<h4>Did you know that your browser is out of date?</h4>
<p>If the layout of this site seems ugly, that's because you're actually using
an outdated browser. And we wont put any effort to provide a nice layout to IE6
users.</p>
<p>To get the best possible experience using our website we recommend that you
upgrade your browser to a newer version. The current version
is <a class="getie8"
href="http://upgradeie.s3.amazonaws.com/eng/index.html">Internet Explorer
8</a>. The upgrade is free. If you're using a PC at work you should contact your
IT administrator.</p>
<p>If you want to you may also try some other popular Internet browsers
like <a class="ie6expl"
href="http://getfirefox.com">Firefox</a>, <a class="ie6expl"
href="http://www.google.com/chrome">Chrome</a>, <a class="ie6expl"
href="http://www.opera.com">Opera</a>, or <a class="ie6expl"
href="http://www.apple.com/safari/download/">Safari</a></p>
</div>
<![endif]-->

    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="dtml.html" title="DTML"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="skin_layers.html" title="Skin layers"
             accesskey="P">previous</a> |</li>
        <li><a href="../index.html">Plone Community Managed Developer Manual v1.0 documentation</a> &raquo;</li>
          <li><a href="index.html" accesskey="U">Templates, CSS and Javascript</a> &raquo;</li> 
      </ul>
    </div>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="sphinx-content">
    <div class="section" id="diazo-xdv-theming">
<h1>Diazo / XDV theming<a class="headerlink" href="#diazo-xdv-theming" title="Permalink to this headline">¶</a></h1>
<div class="admonition-description admonition ">
<p class="first admonition-title">Description</p>
<p class="last">Theming Plone and integrating external sites under one theme service
using Diazo / XDV solution.</p>
</div>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><a class="reference internal" href="#introduction" id="id1">Introduction</a><ul>
<li><a class="reference internal" href="#theming-editing-interface-backend" id="id2">Theming editing interface (backend)</a></li>
</ul>
</li>
<li><a class="reference internal" href="#tutorials" id="id3">Tutorials</a></li>
<li><a class="reference internal" href="#creating-your-first-xdv-project" id="id4">Creating your first XDV project</a></li>
<li><a class="reference internal" href="#setting-up-xdv-development-tools" id="id5">Setting up XDV development tools</a></li>
<li><a class="reference internal" href="#xdv-rules" id="id6">XDV Rules</a></li>
<li><a class="reference internal" href="#dropping-specific-css-files-with-xdv" id="id7">Dropping specific CSS files with XDV</a></li>
<li><a class="reference internal" href="#handling-relative-urls" id="id8">Handling .. relative URLs</a></li>
<li><a class="reference internal" href="#using-xdv-to-theme-and-integrate-a-wordpress-site" id="id9">Using XDV to theme and integrate a Wordpress site</a><ul>
<li><a class="reference internal" href="#theme-elements" id="id10">Theme elements</a><ul>
<li><a class="reference internal" href="#cms-page-template" id="id11">CMS page template</a></li>
<li><a class="reference internal" href="#theming-rules" id="id12">Theming rules</a></li>
<li><a class="reference internal" href="#wordpress-specific-css" id="id13">Wordpress specific CSS</a></li>
<li><a class="reference internal" href="#helper-script" id="id14">Helper script</a></li>
</ul>
</li>
<li><a class="reference internal" href="#compiling-the-theme" id="id15">Compiling the theme</a></li>
<li><a class="reference internal" href="#testing-the-theme" id="id16">Testing the theme</a></li>
<li><a class="reference internal" href="#applying-the-theme-in-apache-production-environment" id="id17">Applying the theme in Apache production environment</a><ul>
<li><a class="reference internal" href="#installing-dependencies" id="id18">Installing dependencies</a></li>
<li><a class="reference internal" href="#virtual-host-configuration" id="id19">Virtual host configuration</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#standard-configuration" id="id20">Standard Configuration</a></li>
<li><a class="reference internal" href="#integrating-with-wordpress" id="id21">Integrating with Wordpress</a><ul>
<li><a class="reference internal" href="#running-it" id="id22">Running it</a><ul>
<li><a class="reference internal" href="#automatically-reflecting-cms-changes-back-to-xdv-theme" id="id23">Automatically reflecting CMS changes back to XDV theme</a></li>
</ul>
</li>
<li><a class="reference internal" href="#updating-wordpress-settings" id="id24">Updating Wordpress settings</a><ul>
<li><a class="reference internal" href="#site-url" id="id25">Site URL</a></li>
</ul>
</li>
<li><a class="reference internal" href="#http-404-not-found-special-case" id="id26">HTTP 404 Not Found special case</a></li>
<li><a class="reference internal" href="#roll-out-checklist" id="id27">Roll-out checklist</a></li>
</ul>
</li>
<li><a class="reference internal" href="#using-xdv-to-theme-and-integrate-a-phpbb-forum" id="id28">Using XDV to theme and integrate a phpBB forum</a></li>
</ul>
</div>
<div class="section" id="introduction">
<h2><a class="toc-backref" href="#id1">Introduction</a><a class="headerlink" href="#introduction" title="Permalink to this headline">¶</a></h2>
<p>XDV is an external HTML theming engine, a.k.a. theming proxy, which allows
you to mix and match HTML and CSS from internal and external sites
by using simple XML rules. It separates the theme development from the site development,
so that people with little HTML and CSS knowledge can create themes
without need to know underlying Python, PHP or whatever. It also enables
integration of different services and sites to one, unified, user experience.
For example, XDV is used by <cite>plone.org &lt;http://plone.org&gt;</cite> to integrate
Plone CMS and Trac issue tracker.</p>
<p>XDV compiles theming rules to XSL templates, which has been a standard
XML based templates language since 1999. XSL has good support
in every programming language and web server out there.</p>
<p>Example backends to perform XDV transformation include</p>
<ul class="simple">
<li>collective.xdv (as a normal Plone add-on, a post-process hook)</li>
<li>Apache's mod_transform</li>
<li>Nginx web server transform module</li>
</ul>
<p>XDV theming can be used together with Plone where enhanced support is provided
by <a class="reference external" href="http://pypi.python.org/pypi/collective.xdv">collective.xdv package</a> package.
Technically, collective.xdv adds Plone settings panel and does XSL transformation in Zope's
post-publication hook using lxml library.</p>
<p>XDV can be used standalone with <a class="reference external" href="http://pypi.python.org/pypi/xdv/0.3a2">XDV package</a> to theme any web site,
let it be Wordpress, Joomla, Drupal or custom in-house PHP solution from year 2000.</p>
<p>XDV is based on <a class="reference external" href="http://deliverance.openplans.org/">Deliverance specification</a>
The difference between XDV and Deliverance reference implementation
is that XDV internally compiles themes to XSL templates, when Deliverance relies
on processing HTML in Python. Currently XDV approach seems to be
working better, as we had many problems trying to apply Deliverance
for Wordpress site (redirects didn't work, HTTP posts didn't work, etc.).</p>
<div class="section" id="theming-editing-interface-backend">
<h3><a class="toc-backref" href="#id2">Theming editing interface (backend)</a><a class="headerlink" href="#theming-editing-interface-backend" title="Permalink to this headline">¶</a></h3>
<p>Editing interface, backend, or admin site, however you wish to call it,
can be themed with collective.xdv. However, it does not need to be
and edit interface can fallback to the default Plone theme.</p>
<p>There are several reasons for this</p>
<ul class="simple">
<li>Plone editing interface is powerful and has very high
usability, which means that it is internally quite complex
(makes complex things to pose itself as a simple to the end user)</li>
<li>The public theme you are building would not fit to the
editing interface very well. E.g. no space for portlets.
This is especially problematic if an external
artist has created the visuals without properly
fitting them for Plone.</li>
</ul>
<p>With XDV you can easily have separate admin.yoursite.com
where Plone editing interface is ontouched.</p>
</div>
</div>
<div class="section" id="tutorials">
<h2><a class="toc-backref" href="#id3">Tutorials</a><a class="headerlink" href="#tutorials" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><a class="reference external" href="http://reinout.vanrees.org/weblog/2010/12/29/xdv-setup.html">http://reinout.vanrees.org/weblog/2010/12/29/xdv-setup.html</a></li>
<li><a class="reference external" href="http://plone.org/products/collective.xdv/documentation/reference-manual/theming">http://plone.org/products/collective.xdv/documentation/reference-manual/theming</a></li>
<li><a class="reference external" href="http://pypi.python.org/pypi/collective.xdv">http://pypi.python.org/pypi/collective.xdv</a></li>
<li><a class="reference external" href="http://pypi.python.org/pypi/xdv">http://pypi.python.org/pypi/xdv</a></li>
<li><a class="reference external" href="http://pypi.python.org/pypi/dv.xdvserver">http://pypi.python.org/pypi/dv.xdvserver</a> (with WSGI)</li>
</ul>
</div>
<div class="section" id="creating-your-first-xdv-project">
<h2><a class="toc-backref" href="#id4">Creating your first XDV project</a><a class="headerlink" href="#creating-your-first-xdv-project" title="Permalink to this headline">¶</a></h2>
<p><a class="reference internal" href="../tutorials/paste.html"><em>ZopeSkel package</em></a> includes XDV theme skeleton
since version 2.20.</p>
<p>Example how to boostrap your theme.</p>
</div>
<div class="section" id="setting-up-xdv-development-tools">
<h2><a class="toc-backref" href="#id5">Setting up XDV development tools</a><a class="headerlink" href="#setting-up-xdv-development-tools" title="Permalink to this headline">¶</a></h2>
<p>XDV tools are deployed as Python eggs.
You can use tools like <cite>buildout &lt;http://www.buildout.org/&gt;</cite>
configuration and assembly tool or easy_install
to get XDV on your development computer and the server.</p>
<p>If you are working with Plone you can integrate XDV to your
site existing buildout. If you are not working with Plone,
<a class="reference external" href="http://pypi.python.org/pypi/xdv#installation">XDV home page</a> has instructions how to deploy
XDV command standalone.</p>
</div>
<div class="section" id="xdv-rules">
<h2><a class="toc-backref" href="#id6">XDV Rules</a><a class="headerlink" href="#xdv-rules" title="Permalink to this headline">¶</a></h2>
<p>Rules (rules.xml) will tell how to fit content from external source to
your theme HTML.</p>
<p>It provides straightforward XML based syntax to manipulate HTML easily</p>
<ul class="simple">
<li>Append, replace and drop HTML pieces</li>
<li>Insert HTML snippets</li>
<li>CSS or XPath selectors can be used to identify HTML parts</li>
<li>It is possible to mix and match content from more than two sites</li>
<li>etc.</li>
</ul>
<p>Rules XML syntax is documented at <a class="reference external" href="http://pypi.python.org/pypi/xdv">XDV homepage</a>.</p>
<p>Rules will be compiled to XSL template (theme.xsl) by <em>xdvcompiler</em> command.
The actual theming is done by one of the XSL backends listed above,
by taking HTML as input and applying XSL transformations on it.</p>
<p>Note that currently rules without matching selectors are silently ignored
and there is no bullet-proof way to debug what happens inside
XSL transformation, except by looking into compiled theme.xsl.</p>
</div>
<div class="section" id="dropping-specific-css-files-with-xdv">
<h2><a class="toc-backref" href="#id7">Dropping specific CSS files with XDV</a><a class="headerlink" href="#dropping-specific-css-files-with-xdv" title="Permalink to this headline">¶</a></h2>
<p>For example if you wish to get rid of the base-cachekey????.css file that comes from
a Plone site, but still want to keep the authoring CSS and any special CSS
files that come from add-ons</p>
<p>Example:</p>
<div class="highlight-python"><pre>&lt;drop content="/html/head[style *=
'portal_css/Plone%20Default/base-cachekey']/style" /&gt;</pre>
</div>
<p>More info</p>
<ul class="simple">
<li><a class="reference external" href="http://www.coactivate.org/projects/deliverance/lists/deliverance-discussion/archive/2010/09/1284795659190">http://www.coactivate.org/projects/deliverance/lists/deliverance-discussion/archive/2010/09/1284795659190</a></li>
</ul>
</div>
<div class="section" id="handling-relative-urls">
<h2><a class="toc-backref" href="#id8">Handling .. relative URLs</a><a class="headerlink" href="#handling-relative-urls" title="Permalink to this headline">¶</a></h2>
<p>Here is an example of <a class="reference internal" href="../misc/monkeypatch.html"><em>monkey-patch</em></a>
which you can use to override relative URLs in your theme using
a dot notation.</p>
<p>It adds a custom behavior to normal <tt class="docutils literal"><span class="pre">urlparse.urljoin()</span></tt> logic.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">xdv</span> <span class="kn">import</span> <span class="n">rules</span>

<span class="kn">from</span> <span class="nn">urlparse</span> <span class="kn">import</span> <span class="n">urljoin</span>

<span class="k">def</span> <span class="nf">apply_absolute_prefix</span><span class="p">(</span><span class="n">theme_doc</span><span class="p">,</span> <span class="n">absolute_prefix</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">join</span><span class="p">(</span><span class="n">prefix</span><span class="p">,</span> <span class="n">url</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Handle relative URLs specially.</span>

<span class="sd">        Theme files may contain .. URLs referring to other file locations on the file system.</span>
<span class="sd">        Since transformation is not file system location aware, we need to manually fix these</span>
<span class="sd">        kind references. This join assumes that all URLs with .. go to the absolute prefix root.</span>

<span class="sd">        This behavior might depend on the context of the theme files, so we can&#39;t have</span>
<span class="sd">        bullet-proof solution here but these must be solved case-by-case basis.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">url</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&quot;../&quot;</span><span class="p">):</span>
            <span class="n">url</span> <span class="o">=</span> <span class="n">url</span><span class="p">[</span><span class="mi">3</span><span class="p">:]</span>

        <span class="n">final</span> <span class="o">=</span> <span class="n">urljoin</span><span class="p">(</span><span class="n">prefix</span><span class="p">,</span> <span class="n">url</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">final</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">absolute_prefix</span><span class="p">:</span>
        <span class="k">return</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">absolute_prefix</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s">&#39;/&#39;</span><span class="p">):</span>
        <span class="n">absolute_prefix</span> <span class="o">=</span> <span class="n">absolute_prefix</span> <span class="o">+</span> <span class="s">&#39;/&#39;</span>
    <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">theme_doc</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="s">&#39;//*[@src]&#39;</span><span class="p">):</span>
        <span class="n">url</span> <span class="o">=</span> <span class="n">join</span><span class="p">(</span><span class="n">absolute_prefix</span><span class="p">,</span> <span class="n">node</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;src&#39;</span><span class="p">))</span>
        <span class="n">node</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s">&#39;src&#39;</span><span class="p">,</span> <span class="n">url</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">theme_doc</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="s">&#39;//*[@href]&#39;</span><span class="p">):</span>
        <span class="n">url</span> <span class="o">=</span> <span class="n">join</span><span class="p">(</span><span class="n">absolute_prefix</span><span class="p">,</span> <span class="n">node</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;href&#39;</span><span class="p">))</span>
        <span class="n">node</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s">&#39;href&#39;</span><span class="p">,</span> <span class="n">url</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">theme_doc</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="s">&#39;//comment() | //style&#39;</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">node</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s">&#39;style&#39;</span> <span class="ow">or</span> <span class="n">node</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="n">etree</span><span class="o">.</span><span class="n">Comment</span> <span class="ow">and</span> <span class="n">node</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&quot;[if IE&quot;</span><span class="p">):</span>
            <span class="n">node</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="n">IMPORT_STYLESHEET</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span>
                <span class="k">lambda</span> <span class="n">match</span><span class="p">:</span> <span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="n">join</span><span class="p">(</span><span class="n">absolute_prefix</span><span class="p">,</span> <span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span> <span class="o">+</span> <span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span>
                <span class="n">node</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>

<span class="c"># Monkey-patch XDV to support relative URL handling</span>
<span class="n">rules</span><span class="o">.</span><span class="n">apply_absolute_prefix</span> <span class="o">=</span> <span class="n">apply_absolute_prefix</span>
</pre></div>
</div>
</div>
<div class="section" id="using-xdv-to-theme-and-integrate-a-wordpress-site">
<h2><a class="toc-backref" href="#id9">Using XDV to theme and integrate a Wordpress site</a><a class="headerlink" href="#using-xdv-to-theme-and-integrate-a-wordpress-site" title="Permalink to this headline">¶</a></h2>
<p>Below are instructions how to integrate a Wordpress site to your CMS.
In this example CMS is Plone, but it could be any other system.</p>
<p>We will create XDV theme which will theme Wordpress site
to match our CMS site in the fly.</p>
<p>Wordpress theme using built with XDV and using a live Plone web page
as a theme template.</p>
<p>This way Wordpress theme inherits &quot;live data&quot;
from Plone site, like top tabs (portal sections), footer, CSS and
other stuff which can be changed in-the-fly and reflecting
changes to two separaet theming products would be cumbersome.</p>
<p>Benefits using Wordpress for blogging instead of main CMS</p>
<ul class="simple">
<li>Wordpress post and comment management is easy</li>
<li>Wordpress does not need to be touched:
the old public Wordpress instance can keep
happily running wherever it is during the whole process</li>
<li>You do not need to migrate legacy Wordpress installations
to your CMS's internal blogging tool</li>
<li>Wordpress comes with extensive blog spam filtering tools.
We get 11000 spam comments a month.</li>
<li>Wordpress is designed for blogging and the user interface is
good for that</li>
<li>Wordpress integrates well with blog pingback support services</li>
<li>Wordpress supports Gravatars and other blogging plug-ins</li>
<li>..and so on...</li>
</ul>
<p>Benefits of using XDV theming instead of creating native Wordpress theme are</p>
<ul class="simple">
<li>You need to maintain only one theming add-on product
e.g. one for your main CMS and Wordpress
receives updates to this site and theme automatically</li>
<li>Wordpress does not need to be touched</li>
<li>You can host your Wordpress on a different server,
even wordpress.com, and still integrate it to your main CMS</li>
<li>The theme can be recycled not only for Wordpress, but also
other external services: Bugzilla, Trac, Webmail, phpBB,
you-name-it</li>
<li>Even though Wordpress has slick UI, it is a well known fact that
it is a can of worms internally.
My developers do not like the idea of PHP development and would
spit on my face if I ask them to go a develop a Wordpress
theme for us</li>
</ul>
<div class="section" id="theme-elements">
<h3><a class="toc-backref" href="#id10">Theme elements</a><a class="headerlink" href="#theme-elements" title="Permalink to this headline">¶</a></h3>
<p>The theme will consist of following pieces</p>
<ul class="simple">
<li>Deliverance rules XML file which defines how to combine Plone and Wordpress HTML
(rules.xml)</li>
<li>Additional CSS definitions active only for Wordpress (wordpress.css).
Dependency to this CSS in injected to the &lt;head&gt; by rules XML</li>
<li>Special Plone page template which will provide slots where Wordpress can drop in the content
(wordpress_listing.pt)</li>
<li>A helper script which makes it easy for repeatable perform
theming actions, like recompiling the theme
(xdv.py)</li>
</ul>
<div class="section" id="cms-page-template">
<h4><a class="toc-backref" href="#id11">CMS page template</a><a class="headerlink" href="#cms-page-template" title="Permalink to this headline">¶</a></h4>
<p>This explains how to create a Plone page template where Wordpress
content will be dropped in. This step is not necessary,
as we could do this without touching the Plone. However, it
makes things more straightforward and explicit when we known
that Wordpress theme uses a certain template and we explicitly define slots
for Wordpress content there.</p>
<p>Example:</p>
<div class="highlight-python"><pre>&lt;html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"
      xmlns:tal="http://xml.zope.org/namespaces/tal"
      xmlns:metal="http://xml.zope.org/namespaces/metal"
      xmlns:i18n="http://xml.zope.org/namespaces/i18n"
      lang="en"
      metal:use-macro="here/main_template/macros/master"
      i18n:domain="plone"&gt;


&lt;body&gt;

    &lt;div metal:fill-slot="content"&gt;

        &lt;div id="wordpress-content"&gt;
                &lt;!-- Your Wordpress "left column" will go there --&gt;
        &lt;/div&gt;

    &lt;/div&gt;

&lt;/body&gt;
&lt;/html&gt;</pre>
</div>
</div>
<div class="section" id="theming-rules">
<h4><a class="toc-backref" href="#id12">Theming rules</a><a class="headerlink" href="#theming-rules" title="Permalink to this headline">¶</a></h4>
<p>Following are XDV rules (rules.xml) how we will fit Wordpress site to Plone frame.</p>
<p>It will integrate</p>
<ul class="simple">
<li>Content from Wordpress</li>
<li>Metadata from Wordpress</li>
<li>CSS from Plone</li>
<li>Page basic structrure from Plone</li>
</ul>
<p>rules.xml:</p>
<div class="highlight-python"><pre>&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;rules xmlns="http://namespaces.plone.org/xdv"
       xmlns:xsl="http://www.w3.org/1999/XSL/Transform"
       xmlns:css="http://namespaces.plone.org/xdv+css"&gt;

    &lt;!-- Remove Wordpress CSS by filtering out &lt;style&gt; tags--&gt;
    &lt;drop css:content="style" /&gt;

    &lt;!-- Make sure that Wordpress metadata is present in &lt;head&gt; section --&gt;
    &lt;append css:content="head link" css:theme="head" /&gt;

    &lt;!-- note: replace does not seem to handle multiple meta tags very well --&gt;
    &lt;drop css:theme="meta" /&gt;
    &lt;append css:content="head meta" css:theme="head" /&gt;

    &lt;!-- Use blog title instead of Plone page title --&gt;
    &lt;replace css:content="title" css:theme="title" /&gt;

    &lt;!-- Put Wordpress sidebar to Plone's portlets section --&gt;
    &lt;append css:content="#r_sidebar" css:theme="#portal-column-one .visualPadding" /&gt;

    &lt;!-- Place wordpress content into our theme content area --&gt;
    &lt;copy css:content="#contentleft" css:theme="#wordpress-content" /&gt;

    &lt;!-- This mixes in Wordpress specific CSS sheet which is applied for pages
         served from Wordpress only and does not concern Plone CMS.
         This stylesheet will theme Wordpress specific tags,
         like blog posts and comment fields.
         We keep this file in Plone, but this could be served from elsewhere. --&gt;
    &lt;append css:theme="head"&gt;
        &lt;style type="text/css"&gt;
           @import url(http://mfabrik.com/++resource++plonetheme.mfabrik/wordpress.css);
        &lt;/style&gt;
    &lt;/append&gt;

    &lt;!-- This stylesheet is used by special spam protection plug-in NoSpamNX --&gt;
    &lt;append css:theme="head"&gt;
        &lt;link rel="stylesheet" href="http://blog.mfabrik.com/wp-content/plugins/nospamnx/nospamnx.css" type="text/css" /&gt;
    &lt;/append&gt;

    &lt;!-- Remove Google Analytics script used for CMS site --&gt;
    &lt;drop css:theme="#page-bottom script" /&gt;

    &lt;!-- Rebuild our Google Analytics code, using a different tracker id this time
         which is a specific to our blog.
      --&gt;
    &lt;append css:theme="#page-bottom"&gt;

        &lt;script type="text/javascript"&gt;
                var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
                document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
        &lt;/script&gt;

        &lt;script type="text/javascript"&gt;
                try {
                       var pageTracker = _gat._getTracker("UA-8819100-2");
                       pageTracker._trackPageview();
                } catch(err) {
                }
        &lt;/script&gt;
    &lt;/append&gt;

&lt;/rules&gt;</pre>
</div>
</div>
<div class="section" id="wordpress-specific-css">
<h4><a class="toc-backref" href="#id13">Wordpress specific CSS</a><a class="headerlink" href="#wordpress-specific-css" title="Permalink to this headline">¶</a></h4>
<p>This CSS has styles which are applied only to Wordpress pages.
They are mainly corner case fixes where Wordpress and CMS styles
must match.</p>
<p>The CSS file is loaded when rules.xml injects it to &lt;head&gt; section.</p>
<p>wordpress.css:</p>
<div class="highlight-python"><pre>/* Font and block style fixes */

#wordpress-content h1 {
        border: 0;
}

#wordpress-content .post-end {
        margin-bottom: 60px;
}

#wordpress-content pre {
        width: 600px;
        overflow: auto;
        background: white;
        border: 1px solid #888;
}

#wordpress-content ul {
        margin-left: 20px;
}


#wordpress-content .post-info-date,
#wordpress-content .post-info-categories,
#wordpress-content .post-info-tags {
        font-size: 80%;
        color: #888;
}

/* Make sure that posts and comments look sane in our theme */

#wordpress-content .post {
        margin-top: 15px;
}

#wordpress-content .commentlist li {
        margin: 20px;
        background: white;
        padding: 10px;
}

#wordpress-content .commentlist li img {
        float: left;
        margin-right: 20px;
        margin-bottom: 20px;
}

#wordpress-content #commentform {
        margin: 20px;
}

#wordpress-content {
        margin-left: 20px;
        margin-right: 20px;
}

/* Make Wordpress "sidebaar" look like Plone "portlets */

.template-wordpress_listing #portal-column-one ul {
        list-style: none;
        margin-bottom: 40px;
}

.template-wordpress_listing #portal-column-one ul#Recent li {
        margin-bottom: 8px;
}

.template-wordpress_listing #portal-column-one ul#Categories a {
        line-height: 120%;
}


.template-wordpress_listing #portal-column-one h2 {
        background: transparent;
        border: 0;
        font-weight:normal;
        line-height:1.6em;
        padding:0;
        text-transform:none;
        font-size: 16px;
        color: #9b9b9b;
        border-bottom:4px solid #CDCDCD;
}</pre>
</div>
</div>
<div class="section" id="helper-script">
<h4><a class="toc-backref" href="#id14">Helper script</a><a class="headerlink" href="#helper-script" title="Permalink to this headline">¶</a></h4>
<p>The following Python script (xdv.py) makes it easy for us</p>
<ul class="simple">
<li>Recompile the theme</li>
<li>Test the theme applied on the site</li>
<li>Preview the theme in our browser</li>
</ul>
<dl class="docutils">
<dt>It is basically wrapped with default file locations around</dt>
<dd><em>bin/xdvcompiler</em> and <em>bin/xdvrun</em> commands with some
webbrowser opening magic.</dd>
</dl>
<p>Drop the file to your Plone theme package and modify it for your needs.</p>
<p>xdv.py:</p>
<div class="highlight-python"><pre> """

 This command line Python script compiles your rules.xml to XDV XSL

 Modify it for your own needs.

 It assumes your buildout.cfg has xdv section and generated XDV
 commands under bin/

 To compile, execute in the buildout folder::

     python src/plonetheme.mfabrik/xdv.py

 To build test HTML::

     python src/plonetheme.mfabrik/xdv.py --test


 To build test HTML and preview it in browser, execute in buildout folder::

     python src/plonetheme.mfabrik/xdv.py --preview

 If you want to use alternative development theme source::

     python src/plonetheme.mfabrik/xdv.py --preview --development

"""

import getopt, sys
import os
import webbrowser

# rules XML for theming
RULES_XML = "src/plonetheme.mfabrik/deliverance/etc/rules.xml"

# Which XSL file to generate for compiled XDV
OUTPUT_FILE = "theme.xsl"

# Which file to generate applied theme test runs
TEST_HTML_FILE = "test.html"

# Our "theme.html" is a remote template served for each request.
# Because we are doing live integrattion, this is a HTTP resource,
# not a local file.
THEME="http://mfabrik.com/news/wordpress_listing/"

# Alternative theme location - used for development
DEVELOPMENT_THEME="http://localhost:8080/mfabrik/news/wordpress_listing/"

#
# External site you are theming.
# Note: must have ending slash (lxm cannot handle redirects)
#
SITE="http://blog.twinapex.fi/"

# We need to explicitly
INTEGRATED_SITE_URL="http://blog.mfabrik.com"

try:
    opts, args = getopt.getopt(sys.argv[1:], "ptd", ["preview", "test", "development"])
except getopt.GetoptError, err:
    # print help information and exit:
    print str(err) # will print something like "option -a not recognized"

# Convert options to simple list
opts = [ opt for opt, value in opts ]

if "-d" in opts or "--development" in opts:
    THEME = DEVELOPMENT_THEME
    print "Using development theme source:" + THEME
else:
    print "Using production theme source:" + THEME

print "Compiling transformation"
value = os.system("bin/xdvcompiler -o " + OUTPUT_FILE + " " + RULES_XML +" " + THEME)
if value != 0:
    print "Compilation failed"
    sys.exit(1)


if "-p" in opts or "--preview" in opts or "-t" in opts or "--test" in opts:
      print "Generating test HTML page"
      value = os.system("bin/xdvrun -o " + TEST_HTML_FILE + " " + OUTPUT_FILE + " " + SITE)
      if value != 0:
          print "Page transformation failed"
          sys.exit(1)

if "-p" in opts or "--preview" in opts:
    # Preview the result in a browser
    # NOTE: OSX needs Python &gt;= 2.5 to make this work

    # Make sure test run succeeded
    url = "file://" + os.path.abspath(TEST_HTML_FILE)
    print "Opening:" + url

    # We prefer Firefox for preview for its superious
    # Firebug HTML debugger and XPath rule generator
    try:
        browser = webbrowser.get("firefox")
    except webbrowser.Error:
        # No FF on the system, or OSX which can't find its browsers
        browser = webbrowser.get()

    browser.open_new_tab(url)</pre>
</div>
</div>
</div>
<div class="section" id="compiling-the-theme">
<h3><a class="toc-backref" href="#id15">Compiling the theme</a><a class="headerlink" href="#compiling-the-theme" title="Permalink to this headline">¶</a></h3>
<p>This will generate XSL templates to do theming transform.
It will compile rules XML with some boilerplate XSL.</p>
<p>Running our compile script:</p>
<div class="highlight-python"><pre>python src/plonetheme.mfabrik/xdv.py</pre>
</div>
<p>Since Plone usually does not use any relative paths or relative resources in HTML,
we do not give the parameter &quot;Absolute prefix&quot; to the compilation stage.
In Plone, everything is mapped through a virtual hosting aware resource
locator: portal_url and VirtualHostMonster.</p>
<p>For more information see</p>
<ul class="simple">
<li><a class="reference external" href="http://pypi.python.org/pypi/xdv/0.3a2#compilation">http://pypi.python.org/pypi/xdv/0.3a2#compilation</a></li>
</ul>
</div>
<div class="section" id="testing-the-theme">
<h3><a class="toc-backref" href="#id16">Testing the theme</a><a class="headerlink" href="#testing-the-theme" title="Permalink to this headline">¶</a></h3>
<p>The following command will apply theme for an example external page:</p>
<div class="highlight-python"><pre>bin/xdvrun -o theme.html theme.xsl http://blog.twinapex.fi
firefox theme.xhtml</pre>
</div>
<p>... or we can use shortcut provided by our script ...</p>
<div class="highlight-python"><pre>python src/plonetheme.mfabrik/xdv.py --preview</pre>
</div>
<p>... alternative we can specify development server (localhost) from where the theme source is fetched:</p>
<div class="highlight-python"><pre>python src/plonetheme.mfabrik/xdv.py --preview --development</pre>
</div>
</div>
<div class="section" id="applying-the-theme-in-apache-production-environment">
<h3><a class="toc-backref" href="#id17">Applying the theme in Apache production environment</a><a class="headerlink" href="#applying-the-theme-in-apache-production-environment" title="Permalink to this headline">¶</a></h3>
<p>These steps tell how to apply the integration
theme for Wordpress when Wordpress is running under
Apache virtualhost.</p>
<div class="section" id="installing-dependencies">
<h4><a class="toc-backref" href="#id18">Installing dependencies</a><a class="headerlink" href="#installing-dependencies" title="Permalink to this headline">¶</a></h4>
<p>We use Apache and mod_transform.
<a class="reference external" href="http://pypi.python.org/pypi/xdv#apache">Instructions how to set up modules for Apache</a>
are available on the XDV homepage. Some hand-built modules must be used,
instructions to set them up for Ubuntu / Debian are available.</p>
<p>Apache 2 supports <a class="reference external" href="http://httpd.apache.org/docs/2.2/mod/mod_filter.html">filter chains</a> which allow you to
perform magic on HTTP response before sending it out.
This corresponds to Python's WSGI middleware.</p>
<p>We will use special builds of mod_transform and mod_depends
which are known to work. These modules were forked from their
orignal creations to make them XDV compatible, as the orignal
has not been updated since 2004 (this is a good example of how
the freedom of open source guarantees that you &quot;won't run out of support&quot;)</p>
<ul class="simple">
<li><a class="reference external" href="http://code.google.com/p/html-xslt/">XDV mod_transform and mod_depends homepage</a></li>
<li><a class="reference external" href="http://www.outoforder.cc/projects/apache/mod_transform/">Orignal mod_transform and mod_depends homepage</a></li>
</ul>
<p>Example:</p>
<div class="highlight-python"><pre>sudo -i
apt-get install libxslt1-dev libapache2-mod-apreq2 libapreq2-dev apache2-threaded-dev
wget http://html-xslt.googlecode.com/files/mod-transform-html-xslt.tgz
wget http://html-xslt.googlecode.com/files/mod-depends-html-xslt.tgz
tar -xzf mod-transform-html-xslt.tgz
tar -xzf mod-depends-html-xslt.tgz
cd mod-depends-html-xslt ; ./configure ; make ; make install ; cd ..
cd mod-transform-html-xslt ; ./configure ; make ; make install ; cd ..</pre>
</div>
<p>Enable built-in Apache modules:</p>
<div class="highlight-python"><pre>a2enmod filter
a2enmod ext_filter</pre>
</div>
<p>For modules <em>depends</em> and <em>transform</em> you need to manually add
them to the end of Apache configuration, as they do not
provide a2enmod stubs for Debian. Edit /etc/apache2/apache.conf:</p>
<div class="highlight-python"><pre>LoadModule depends_module /usr/lib/apache2/modules/mod_depends.so
LoadModule transform_module /usr/lib/apache2/modules/mod_transform.so</pre>
</div>
<p>You need to hard reset Apache to make the new modules effective:</p>
<div class="highlight-python"><pre>/etc/init.d/apache2 force-reload</pre>
</div>
</div>
<div class="section" id="virtual-host-configuration">
<h4><a class="toc-backref" href="#id19">Virtual host configuration</a><a class="headerlink" href="#virtual-host-configuration" title="Permalink to this headline">¶</a></h4>
</div>
</div>
</div>
<div class="section" id="standard-configuration">
<h2><a class="toc-backref" href="#id20">Standard Configuration</a><a class="headerlink" href="#standard-configuration" title="Permalink to this headline">¶</a></h2>
<p>The example below shows a typical xdv setup</p>
<div class="highlight-python"><pre>&lt;VirtualHost *:80&gt;
ServerName www.yourserver.com

FilterDeclare THEME
FilterProvider THEME XSLT resp=Content-Type $text/html

TransformOptions ApacheFS HTML HideParseErrors
TransformSet /theme.xsl
TransformCache /theme.xsl /home/plone/path/to/your/theme.xsl


&lt;LocationMatch "/"&gt;
    FilterChain THEME
&lt;/LocationMatch&gt;


&lt;Proxy *&gt;
            Order deny,allow
            Allow from all
&lt;/Proxy&gt;

ProxyVia on
RewriteEngine On
RewriteRule ^/static(.*) /path/to/your/theme/static/$1 [L]
RewriteRule ^/(.*) http://localhost:8080/VirtualHostBase/http/%{HTTP_HOST}:80/Plone/VirtualHostRoot/$1 [L,P]</pre>
</div>
<p>&lt;/VirtualHost&gt;</p>
</div>
<div class="section" id="integrating-with-wordpress">
<h2><a class="toc-backref" href="#id21">Integrating with Wordpress</a><a class="headerlink" href="#integrating-with-wordpress" title="Permalink to this headline">¶</a></h2>
<p>Below is our virtualhost configuration which runs Wordpress and PHP.
Transformation filter chain has been added in.</p>
<p>/etc/apache/sites-enabled/blog.mfabrik.com:</p>
<div class="highlight-python"><pre>&lt;VirtualHost *&gt;

    ServerName blog.mfabrik.com
    ServerAdmin info@mfabrik.com

    LogFormat       combined
    TransferLog     /var/log/apache2/blog.mfabrik.com.log

    # Basic Wordpress setup

    Options +Indexes FollowSymLinks +ExecCGI

    DocumentRoot /srv/www/wordpress

    &lt;Directory /srv/www/wordpress&gt;
        Options FollowSymlinks
        AllowOverride All
    &lt;/Directory&gt;

    AddType application/x-httpd-php .php .php3 .php4 .php5
    AddType application/x-httpd-php-source .phps

    # Theming set-up

    # This chain is used for public web pages
    FilterDeclare THEME
    FilterProvider THEME XSLT resp=Content-Type $text/html

    TransformOptions +ApacheFS +HTML +HideParseErrors
    # This is the location of compiled XSL theme transform
    TransformSet /theme.xsl

    # This will make Apache not to reload transformation every time
    # it is performed. Instead, a compiled version is hold in the
    # virtual URL declared above.
    TransformCache /theme.xsl /srv/plone/twinapex.fi/theme.xsl

    # We want to apply theme only for
    # 1. public pages (otherwise Wordpress administrative interface stops working)
    &lt;Location "/"&gt;
        FilterChain THEME
    &lt;/Location&gt;

    # 2. Admin interface and feeds should not receive any kind of theming
    &lt;LocationMatch "(wp-login|wp-admin|wp-includes|xmlrpc|plugins|feed|rss|uploads)"&gt;
        # The following resets the filter chain
        # http://httpd.apache.org/docs/2.2/mod/mod_filter.html#filterchain
        FilterChain !
    &lt;/LocationMatch&gt;

&lt;/VirtualHost&gt;</pre>
</div>
<div class="section" id="running-it">
<h3><a class="toc-backref" href="#id22">Running it</a><a class="headerlink" href="#running-it" title="Permalink to this headline">¶</a></h3>
<p>After Apache has all modules enabled and your virtualhost configuration is ok,
you should see Wordpress through your new theme by visiting at the site
served through Apache:</p>
<ul class="simple">
<li><a class="reference external" href="http://blog.mfabrik.com">http://blog.mfabrik.com</a></li>
</ul>
<div class="section" id="automatically-reflecting-cms-changes-back-to-xdv-theme">
<h4><a class="toc-backref" href="#id23">Automatically reflecting CMS changes back to XDV theme</a><a class="headerlink" href="#automatically-reflecting-cms-changes-back-to-xdv-theme" title="Permalink to this headline">¶</a></h4>
<p>The theme should be recompiled every time</p>
<ul class="simple">
<li>Plone is restarted: CSS references change in &lt;head&gt; as CSS cache is rebuilt</li>
<li>CSS is modified: CSS references change in &lt;head&gt; as CSS cache is rebuilt</li>
<li>Plone content is changed and changes reflect back to Wordpress theme
(e.g. a new top level site section is being added)</li>
</ul>
<p>This is because the compilation will hard-link resources and template
snippets to resulting the theme.xsl file. If hard-linked resources change
on the Plone site, the transformation XSL file does not automatically
reflect back the changes.</p>
<p>It could be possible to use Plone events automatically to rerun theme
compilation when concerned resources change. However,
the would be quite complex.  For now, we are satisfied with a scheduled task
which will recompile the theme now and then.</p>
<p>Alternatively, mod_transforms could be run in non-cached mode with
some performance implications.</p>
<p>Here is a shell script, update-wordpress-theme.sh,
which will perform the recompilation
and make Apache's transformation cache aware of changes:</p>
<div class="highlight-python"><pre>#!/bin/sh
#
# Periodically update Wordpress theme to reflect changes on CMS site
#

# Recompile theme
sudo -H -u twinapex /bin/sh -c cd /srv/plone/twinapex.fi ; python src/plonetheme.mfabrik/xdv.py

# Make Apache aware of theme changes
sudo apache2ctl restart</pre>
</div>
<p>Then we call it periodically in cron job, every 15 minutes
in /etc/cron.d/update-wordpress:</p>
<div class="highlight-python"><pre># Make Wordpress XDV theme to reflect changes on CMS
0,15,30,45 * * * * /srv/plone/twinapex.fi/update-wordpress-theme.sh</pre>
</div>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">Looks like Varnish has issues with Apache 2 apache2ctl graceful
restart. Do only hard restarts when using Apache in conjuction
with Varnish.</p>
</div>
</div>
</div>
<div class="section" id="updating-wordpress-settings">
<h3><a class="toc-backref" href="#id24">Updating Wordpress settings</a><a class="headerlink" href="#updating-wordpress-settings" title="Permalink to this headline">¶</a></h3>
<p>No changes on Wordpress needed if the domain name is not changed in the theme
transformation process.</p>
<div class="section" id="site-url">
<h4><a class="toc-backref" href="#id25">Site URL</a><a class="headerlink" href="#site-url" title="Permalink to this headline">¶</a></h4>
<p>Unlike Plone, Wordpress does not have decent virtual hosting machinery.
It knowns only one URL which is uses to refer to the site in the external context
(e.g. RSS feeds).</p>
<p>This setting can be overridden in</p>
<ul class="simple">
<li>Wordpress administrative interface</li>
<li>wp-config.php</li>
</ul>
<p>Here is an example how we override this in our wp-config.php:</p>
<div class="highlight-python"><pre>// http://codex.wordpress.org/Editing_wp-config.php#WordPress_address_.28URL.29
define('WP_HOME','http://blog.mfabrik.com');
define('WP_SITEURL','http://blog.mfabrik.com');</pre>
</div>
</div>
</div>
<div class="section" id="http-404-not-found-special-case">
<h3><a class="toc-backref" href="#id26">HTTP 404 Not Found special case</a><a class="headerlink" href="#http-404-not-found-special-case" title="Permalink to this headline">¶</a></h3>
<p>Http 404 Not Found responses are not themed by Apache filter chain. This
is not possible due to order of pipeline in Apache.</p>
<p>As a workaround you can set up a custom HTTP 404 page in
Wordpress which does not expose the old theme.</p>
<ul>
<li><p class="first">Go to Wordpress admin interface, Theme editor</p>
</li>
<li><p class="first">Edit 404.php and modify it so that it does not pull in the Wordpress theme:</p>
<div class="highlight-python"><pre>&lt;html&gt;
&lt;head&gt;
&lt;title&gt;Not found&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;

        &lt;h1&gt;Not Found, Error 404&lt;/h1&gt;
        &lt;p&gt;Aaaaw, snap! The page you are looking for no longer exists. It must be our hamster who ate it.&lt;/p&gt;

        &lt;a href="&lt;?php bloginfo('url'); ?&gt;"&gt;Go to blog homepage&lt;/a&gt;

        &lt;a href="http://mfabrik.com"&gt;mFabrik business site&lt;/a&gt;
&lt;/body&gt;
&lt;/html&gt;</pre>
</div>
</li>
</ul>
<p>For more information see</p>
<ul class="simple">
<li><a class="reference external" href="http://codex.wordpress.org/Creating_an_Error_404_Page">http://codex.wordpress.org/Creating_an_Error_404_Page</a></li>
</ul>
</div>
<div class="section" id="roll-out-checklist">
<h3><a class="toc-backref" href="#id27">Roll-out checklist</a><a class="headerlink" href="#roll-out-checklist" title="Permalink to this headline">¶</a></h3>
<p>Below is a checklist you need to go to through to confirm
that the theme integration works on your production site</p>
<ul class="simple">
<li>Wordpress public pages are loaded with the new theme</li>
<li>Wordpress login works</li>
<li>Wordpress administrative interface works</li>
<li>RSS feed from Wordpress works and contain correct URLs</li>
<li>HTTP 404 not found is handled correctly</li>
<li>HTTP 302 redirect is handled correctly (i.e. missing / at the end of blog post URL)</li>
<li>Changes on CMS site are reflected to Wordpress theme within the update delay</li>
<li>Old blog site is redirected to new site using HTTP 301 (if applies)</li>
</ul>
</div>
</div>
<div class="section" id="using-xdv-to-theme-and-integrate-a-phpbb-forum">
<h2><a class="toc-backref" href="#id28">Using XDV to theme and integrate a phpBB forum</a><a class="headerlink" href="#using-xdv-to-theme-and-integrate-a-phpbb-forum" title="Permalink to this headline">¶</a></h2>
<p>What we want to achieve is to have a regular Plone site for
the CMS pages, and a mix of Plone and phpBB for the forum part.
By mix, I mean combination of elements from the two products.
The header and menu will come from Plone, and the body will be
from phpBB. This mixing will be done with XDV.</p>
<p>First thought that came to mind was to use collective.xdv which
has a nice control panel page that holds all the configuration
stuff needed for XDV, and it does all the magic for me and I
don’t need to think about configuration or compiling on each change.
This is a very nice thing when the Plone site is the main site and
only some elements are needed to be dropped in from another
location. As usually we need the opposite from this: the phpBB site
needs to be the main one, and drop in some minor content from the
Plone site. This means that we can’t use the magic of collective.xdv,
but we must set up everything by hand.</p>
<p>A detailed tutorial on how to make this happen can be found here:</p>
<ul class="simple">
<li><a class="reference external" href="http://alasdoo.com/2010/12/xdv-plone-and-phpbb-under-one-nginx-roof/">http://alasdoo.com/2010/12/xdv-plone-and-phpbb-under-one-nginx-roof/</a></li>
</ul>
</div>
</div>

  </div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
<p class="logo"><a href="../index.html"><img src="../_static/plone-icon-64.png" />
</a></p>

  <h3><a href="../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Diazo / XDV theming</a><ul>
<li><a class="reference internal" href="#introduction">Introduction</a><ul>
<li><a class="reference internal" href="#theming-editing-interface-backend">Theming editing interface (backend)</a></li>
</ul>
</li>
<li><a class="reference internal" href="#tutorials">Tutorials</a></li>
<li><a class="reference internal" href="#creating-your-first-xdv-project">Creating your first XDV project</a></li>
<li><a class="reference internal" href="#setting-up-xdv-development-tools">Setting up XDV development tools</a></li>
<li><a class="reference internal" href="#xdv-rules">XDV Rules</a></li>
<li><a class="reference internal" href="#dropping-specific-css-files-with-xdv">Dropping specific CSS files with XDV</a></li>
<li><a class="reference internal" href="#handling-relative-urls">Handling .. relative URLs</a></li>
<li><a class="reference internal" href="#using-xdv-to-theme-and-integrate-a-wordpress-site">Using XDV to theme and integrate a Wordpress site</a><ul>
<li><a class="reference internal" href="#theme-elements">Theme elements</a><ul>
<li><a class="reference internal" href="#cms-page-template">CMS page template</a></li>
<li><a class="reference internal" href="#theming-rules">Theming rules</a></li>
<li><a class="reference internal" href="#wordpress-specific-css">Wordpress specific CSS</a></li>
<li><a class="reference internal" href="#helper-script">Helper script</a></li>
</ul>
</li>
<li><a class="reference internal" href="#compiling-the-theme">Compiling the theme</a></li>
<li><a class="reference internal" href="#testing-the-theme">Testing the theme</a></li>
<li><a class="reference internal" href="#applying-the-theme-in-apache-production-environment">Applying the theme in Apache production environment</a><ul>
<li><a class="reference internal" href="#installing-dependencies">Installing dependencies</a></li>
<li><a class="reference internal" href="#virtual-host-configuration">Virtual host configuration</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#standard-configuration">Standard Configuration</a></li>
<li><a class="reference internal" href="#integrating-with-wordpress">Integrating with Wordpress</a><ul>
<li><a class="reference internal" href="#running-it">Running it</a><ul>
<li><a class="reference internal" href="#automatically-reflecting-cms-changes-back-to-xdv-theme">Automatically reflecting CMS changes back to XDV theme</a></li>
</ul>
</li>
<li><a class="reference internal" href="#updating-wordpress-settings">Updating Wordpress settings</a><ul>
<li><a class="reference internal" href="#site-url">Site URL</a></li>
</ul>
</li>
<li><a class="reference internal" href="#http-404-not-found-special-case">HTTP 404 Not Found special case</a></li>
<li><a class="reference internal" href="#roll-out-checklist">Roll-out checklist</a></li>
</ul>
</li>
<li><a class="reference internal" href="#using-xdv-to-theme-and-integrate-a-phpbb-forum">Using XDV to theme and integrate a phpBB forum</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="skin_layers.html"
                        title="previous chapter">Skin layers</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="dtml.html"
                        title="next chapter">DTML</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="../_sources/templates_css_and_javascripts/xdv.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" size="18" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="dtml.html" title="DTML"
             >next</a> |</li>
        <li class="right" >
          <a href="skin_layers.html" title="Skin layers"
             >previous</a> |</li>
        <li><a href="../index.html">Plone Community Managed Developer Manual v1.0 documentation</a> &raquo;</li>
          <li><a href="index.html" >Templates, CSS and Javascript</a> &raquo;</li> 
      </ul>
    </div>

    <div class="footer">
        &copy; Copyright 2010 mFabrik Research Oy and Plone community contributors.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.0.4.
    </div>


  </body>
</html>