<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Views &mdash; Plone Community Managed Developer Manual v1.0 documentation</title>
    <link rel="stylesheet" href="../_static/plone.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '1.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="top" title="Plone Community Managed Developer Manual v1.0 documentation" href="../index.html" />
    <link rel="up" title="Views and viewlets" href="index.html" />
    <link rel="next" title="Viewlets" href="viewlets.html" />
    <link rel="prev" title="Views and viewlets" href="index.html" />
<script language="javascript">
//<![CDATA[

Documentation.addTranslations({"locale": "fr", "plural_expr": "(n > 1)", "messages": {"See the definition": "Voir la d\u00e9finition"}});

// See http://disqus.disqus.com/general_integration_help/
var disqus_developer = 1;
if (document.location.protocol == 'http:') {
    disqus_developer = 0;
}

// Some HTML/CSS transforms we can't do in pure CSS (waiting for CSS3 support)
$(document).ready(function () {

    // Style of .. verisonmodified:: , .. versionadded:: ...
    $('p:has(span.versionmodified)').addClass('p-versionmodified');

    // Style of the TOC tree
    $('ul:has(li.toctree-l1)').addClass('toctree');

    // Decorate links to other sites
    $('a[class~=external]').attr('target', '_blank');

    // Glossary terms
    $('em.xref').attr('title', _('See the definition'));

    // We need to have all <pre> in a <div class="highlight"> to mimic pygments
    // to work around a pygments (?) bug
    var suffixes = {cfg: null, python:null};
    for (var suffix in suffixes) {
        var pattern = 'div.highlight-' + suffix + ' > pre';
        $(pattern).wrap('<div class="highlight" />');
    }
    return true;
});
//]]>
</script>

  </head>
  <body>
<!--[if lte IE 6]>
<style type="text/css">
#ie6msg{border:3px solid #090; margin:8px 0; background:#cfc; color:#000;}
#ie6msg h4{margin:8px; padding:0;}
#ie6msg p{margin:8px; padding:0;}
#ie6msg p a.getie8{font-weight:bold; color:#006;}
#ie6msg p a.ie6expl{font-weight:normal; color:#006;}
</style>
<div id="ie6msg">
<h4>Did you know that your browser is out of date?</h4>
<p>If the layout of this site seems ugly, that's because you're actually using
an outdated browser. And we wont put any effort to provide a nice layout to IE6
users.</p>
<p>To get the best possible experience using our website we recommend that you
upgrade your browser to a newer version. The current version
is <a class="getie8"
href="http://upgradeie.s3.amazonaws.com/eng/index.html">Internet Explorer
8</a>. The upgrade is free. If you're using a PC at work you should contact your
IT administrator.</p>
<p>If you want to you may also try some other popular Internet browsers
like <a class="ie6expl"
href="http://getfirefox.com">Firefox</a>, <a class="ie6expl"
href="http://www.google.com/chrome">Chrome</a>, <a class="ie6expl"
href="http://www.opera.com">Opera</a>, or <a class="ie6expl"
href="http://www.apple.com/safari/download/">Safari</a></p>
</div>
<![endif]-->

    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="viewlets.html" title="Viewlets"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="index.html" title="Views and viewlets"
             accesskey="P">previous</a> |</li>
        <li><a href="../index.html">Plone Community Managed Developer Manual v1.0 documentation</a> &raquo;</li>
          <li><a href="index.html" accesskey="U">Views and viewlets</a> &raquo;</li> 
      </ul>
    </div>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="sphinx-content">
    <div class="section" id="views">
<h1>Views<a class="headerlink" href="#views" title="Permalink to this headline">¶</a></h1>
<div class="admonition-description admonition ">
<p class="first admonition-title">Description</p>
<p class="last">Rendering HTML pages in Plone using Zope 3 view pattern.</p>
</div>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><a class="reference internal" href="#introduction" id="id2">Introduction</a><ul>
<li><a class="reference internal" href="#plain-zope-3-vs-grok" id="id3">Plain Zope 3 vs. Grok</a></li>
<li><a class="reference internal" href="#more-information" id="id4">More information</a></li>
<li><a class="reference internal" href="#view-components" id="id5">View components</a></li>
</ul>
</li>
<li><a class="reference internal" href="#finding-a-view-to-override" id="id6">Finding a view to override</a></li>
<li><a class="reference internal" href="#creating-and-registering-a-view" id="id7">Creating and registering a view</a><ul>
<li><a class="reference internal" href="#creating-a-view-using-grok" id="id8">Creating a view using Grok</a></li>
<li><a class="reference internal" href="#creating-a-view-using-zcml" id="id9">Creating a view using ZCML</a><ul>
<li><a class="reference internal" href="#registering-a-view" id="id10">Registering a view</a></li>
<li><a class="reference internal" href="#relationship-between-views-and-templates" id="id11">Relationship between views and templates</a></li>
<li><a class="reference internal" href="#overriding-a-view-template-in-run-time" id="id12">Overriding a view template in run-time</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#layers" id="id13">Layers</a></li>
<li><a class="reference internal" href="#content-type-mimetype-and-template-start-tag" id="id14">Content type, mimetype and Template start tag</a></li>
<li><a class="reference internal" href="#zope-viewpagetemplatefile-vs-five-viewpagetemplatefile" id="id15">Zope ViewPageTemplateFile vs. Five ViewPageTemplateFile</a></li>
<li><a class="reference internal" href="#overriding-a-view-class-in-a-product" id="id16">Overriding a view class in a product</a></li>
<li><a class="reference internal" href="#helper-views" id="id17">Helper views</a><ul>
<li><a class="reference internal" href="#id1" id="id18">More information</a></li>
<li><a class="reference internal" href="#historical-perspective" id="id19">Historical perspective</a></li>
</ul>
</li>
<li><a class="reference internal" href="#reusing-view-template-snippets-or-embedding-another-view" id="id20">Reusing view template snippets or embedding another view</a></li>
<li><a class="reference internal" href="#accessing-a-view-instance-in-code" id="id21">Accessing a view instance in code</a><ul>
<li><a class="reference internal" href="#by-using-getmultiadapter" id="id22">By using getMultiAdapter()</a></li>
<li><a class="reference internal" href="#by-using-traversing" id="id23">By using traversing</a></li>
<li><a class="reference internal" href="#use-a-skin-based-template-in-a-five-view" id="id24">Use a skin based template in a Five view</a></li>
</ul>
</li>
<li><a class="reference internal" href="#listing-available-views" id="id25">Listing available views</a><ul>
<li><a class="reference internal" href="#listing-all-views-of-certain-type" id="id26">Listing all views of certain type</a></li>
</ul>
</li>
<li><a class="reference internal" href="#default-view-of-a-content-item" id="id27">Default view of a content item</a></li>
<li><a class="reference internal" href="#views-and-magical-acquisition" id="id28">Views and magical acquisition</a></li>
</ul>
</div>
<div class="section" id="introduction">
<h2><a class="toc-backref" href="#id2">Introduction</a><a class="headerlink" href="#introduction" title="Permalink to this headline">¶</a></h2>
<p>Plone/Zope uses a view pattern to output dynamically generated HTML pages.</p>
<p>Views are the basic elements of modern Python web frameworks. A view runs code
to set-up  Python variables for a template rendering. Output may not limited
to HTML pages and snippets, but may contain JSON, file download payloads and other.</p>
<p>Views are usually combination of</p>
<ul class="simple">
<li>Python class which performs the user interface logic settup</li>
<li>Corresponding page template (in TAL language) or direct Python string output</li>
</ul>
<p>By keeping as much of the logic code
in a separate Python class and making page template as dumb as possible
better component readability and reuse is achieved. You can override
either Python logic or the template file separately.</p>
<p>When you are working with Plone, the most usual view type is <em>BrowserView</em> from
Products.Five package, but there are others.</p>
<p>Each BrowserView class is a Python callable. BrowserView.__call__()
method acts as an entry point of executing the view code. From Zope point of view,
even a function would be enough as it is callable.</p>
<div class="section" id="plain-zope-3-vs-grok">
<h3><a class="toc-backref" href="#id3">Plain Zope 3 vs. Grok</a><a class="headerlink" href="#plain-zope-3-vs-grok" title="Permalink to this headline">¶</a></h3>
<p>Views were introduced in Zope 3 and made available in Plone by Products.Five package
(which provides some Plone/Zope 2 specific adaption hooks).
However, Zope 3's way of XML based configuration languae ZCML and separating things to three different files
(Python module, ZCML configuration, TAL template) was later seen as cumbersome to maintain.</p>
<p>Later a project called <a class="reference external" href="http://grok.zope.org/">Grok</a> was started to introduce easy API to Zope,
including how to set up and maintain views. For more information how to use Grok (five.grok package)
with Plone, please read <a class="reference external" href="http://plone.org/products/dexterity/documentation/manual/five.grok">Plone and Grok tutorial</a>.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">When writing this (Q1/2010), all project templates in Paster still use old-style Zope views.</p>
</div>
</div>
<div class="section" id="more-information">
<h3><a class="toc-backref" href="#id4">More information</a><a class="headerlink" href="#more-information" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><a class="reference external" href="http://plone.org/documentation/tutorial/borg/zope-3-views">Zope view tutorial</a>.</li>
<li><a class="reference external" href="http://plone.org/products/dexterity/documentation/manual/five.grok/browser-components/views">Grok view tutorial</a>.</li>
</ul>
</div>
<div class="section" id="view-components">
<h3><a class="toc-backref" href="#id5">View components</a><a class="headerlink" href="#view-components" title="Permalink to this headline">¶</a></h3>
<p>Views are Zope component architecture multi-adapter registrations.
If you are doing manual view look-ups then this information concerns you.</p>
<p>Views are looked up by name. Zope publisher does forced
view look-up, instead of traversing, if the traversing name is prefixed with &#64;&#64;.</p>
<p>Views are resolved against different interfaces</p>
<ul class="simple">
<li>context: Any class/interface. If not given zope.interface.Interface is used (corresponds for=&quot;*&quot;)</li>
<li>request: Always HTTP request. Interface zope.publisher.interfaces.browser.IBrowserRequest is used.</li>
<li>layer: Theme layer interface. If not given zope.publisher.interfaces.browser.IDefaultBrowserLayer is used.</li>
</ul>
<p>See also <a class="reference external" href="http://svn.zope.org/zope.browserpage/trunk/src/zope/browserpage/metaconfigure.py?rev=103273&amp;view=auto">related source code</a>.</p>
</div>
</div>
<div class="section" id="finding-a-view-to-override">
<h2><a class="toc-backref" href="#id6">Finding a view to override</a><a class="headerlink" href="#finding-a-view-to-override" title="Permalink to this headline">¶</a></h2>
<p>Here is short introduction how to find how existing views are defined.
First, you go to portal_types to look what views have been registered to a particular content.</p>
<p>For example, if you want to override <em>Folder's</em> Tabular view, you find out that
it is registered as <tt class="docutils literal"><span class="pre">/folder_tabular_view</span></tt> handler.</p>
<p>You look for <em>folder_tabular_view</em> old style page
template or <tt class="docutils literal"><span class="pre">&#64;&#64;folder_tabular_view</span></tt> BrowserView ZCML registration in Plone source tree -
it can be either.</p>
<p>Example how to search for this using UNIX tools</p>
<div class="highlight-console"><div class="highlight"><pre><span class="go">find . | grep -i folder_tabular_view # find old style .pt files</span>
</pre></div>
</div>
<div class="highlight-console"><div class="highlight"><pre><span class="go">grep -Ri --include=&quot;*.zcml&quot; folder_tabular_view * # find new style view registrations in ZCML files</span>
</pre></div>
</div>
<p><tt class="docutils literal"><span class="pre">folder_tabular_view</span></tt> is found on <a class="reference internal" href="../templates_css_and_javascripts/skin_layers.html"><em>skin layer</em></a>
called <tt class="docutils literal"><span class="pre">plone_content</span></tt> in CMFPlone product.</p>
<p>More info</p>
<ul class="simple">
<li><a class="reference internal" href="../templates_css_and_javascripts/skin_layers.html"><em>How to override old style page templates</em></a></li>
</ul>
</div>
<div class="section" id="creating-and-registering-a-view">
<h2><a class="toc-backref" href="#id7">Creating and registering a view</a><a class="headerlink" href="#creating-and-registering-a-view" title="Permalink to this headline">¶</a></h2>
<p>This shows how to create and register view in Zope 3 manner.</p>
<div class="section" id="creating-a-view-using-grok">
<h3><a class="toc-backref" href="#id8">Creating a view using Grok</a><a class="headerlink" href="#creating-a-view-using-grok" title="Permalink to this headline">¶</a></h3>
<p>This is the simplest method and recommended for Plone 4.1+ onwards.</p>
<p>First create your add-on product using <a class="reference internal" href="../tutorials/paste.html"><em>Dexterity project template</em></a>.</p>
<p>Add file <em>yourcompany.app/yourcompany/app/browser/views.py</em>:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">    Viewlets related to application logic.</span>

<span class="sd">&quot;&quot;&quot;</span>

<span class="c"># Zope imports</span>
<span class="kn">from</span> <span class="nn">zope.interface</span> <span class="kn">import</span> <span class="n">Interface</span>
<span class="kn">from</span> <span class="nn">five</span> <span class="kn">import</span> <span class="n">grok</span>


<span class="c"># Use templates directory to search for templates.</span>
<span class="n">grok</span><span class="o">.</span><span class="n">templatedir</span><span class="p">(</span><span class="s">&#39;templates&#39;</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">MyView</span><span class="p">(</span><span class="n">grok</span><span class="o">.</span><span class="n">View</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Render the title and description of item only (example)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c"># The view is available on every content item type</span>
    <span class="n">grok</span><span class="o">.</span><span class="n">context</span><span class="p">(</span><span class="n">Interface</span><span class="p">)</span>
</pre></div>
</div>
<p>The view in the question is not registered against any <a class="reference internal" href="layers.html"><em>layer</em></a>,
so it is available always. The view becomes available on Zope start-up and is
available even if you don't run a add-on installer. This is the suggested
approach for logic views which are not theme related.</p>
<p>The <tt class="docutils literal"><span class="pre">grok.context(Interface)</span></tt> statement means that view is available for every content item:
you can use it in URL like <em>http://yoursite/news/newsitem/&#64;&#64;yourviewname</em> or
<em>http://yoursite/news/&#64;&#64;yourviewname</em> - just incoming self.context parameter changes.
Alternatively, you could use here some <a class="reference internal" href="../content/types.html"><em>content interface</em></a>
to make view available for certain content types only.</p>
<p>Then create <em>yourcompany.app/yourcompany/app/browser/templates</em> and add the related template:</p>
<div class="highlight-python"><pre>&lt;html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:metal="http://xml.zope.org/namespaces/metal"
      xmlns:tal="http://xml.zope.org/namespaces/tal"
      xmlns:i18n="http://xml.zope.org/namespaces/i18n"
      i18n:domain="example.dexterityforms"
      metal:use-macro="context/main_template/macros/master"&gt;

    &lt;metal:block fill-slot="main"&gt;

        &lt;h1 class="documentFirstHeading" tal:content="context/Title | string:'No title'" /&gt;

        &lt;p&gt;This is an example view.&lt;/p&gt;

        &lt;div id="content-core"&gt;
            XXX - render content using content widgets
        &lt;/div&gt;

    &lt;/metal:block&gt;

&lt;/html&gt;</pre>
</div>
<p>Another example (empty.pt) which renders only title and description Plone 3 way:</p>
<div class="highlight-python"><pre>&lt;html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:metal="http://xml.zope.org/namespaces/metal"
      xmlns:tal="http://xml.zope.org/namespaces/tal"
      xmlns:i18n="http://xml.zope.org/namespaces/i18n"
      i18n:domain="example.dexterityforms"
      metal:use-macro="context/main_template/macros/master"&gt;

    &lt;metal:block fill-slot="main"&gt;

        &lt;h1 class="documentFirstHeading" tal:content="context/pretty_title_or_id" /&gt;

        &lt;p class="documentDescription" tal:content="context/Description|nothing" /&gt;

    &lt;/metal:block&gt;

&lt;/html&gt;</pre>
</div>
<p>Possible <a class="reference internal" href="../templates_css_and_javascripts/template_basics.html"><em>slot</em></a> options you can fill in</p>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">main</span></tt> - render edit border yourself</li>
<li><tt class="docutils literal"><span class="pre">content</span></tt> - render title your self</li>
<li><tt class="docutils literal"><span class="pre">content-core</span></tt> - title prerendered, Plone version &gt; 4.x</li>
</ul>
<p>Now you can access your view with a news folder:</p>
<div class="highlight-python"><pre>http://localhost:8080/Plone/news/myview</pre>
</div>
<p>... or a site root:</p>
<div class="highlight-python"><pre>http://localhost:8080/Plone/myview</pre>
</div>
<p>... or any content item.</p>
<p>You can also use &#64;&#64; notation at the front of the view name to make sure a view is looked up. This
is used to separate view names from content item names, if these two conflict:</p>
<div class="highlight-python"><pre>http://localhost:8080/Plone/news/@@myview</pre>
</div>
<p>More info</p>
<ul class="simple">
<li><a class="reference external" href="http://plone.org/products/dexterity/documentation/manual/five.grok/browser-components/views">http://plone.org/products/dexterity/documentation/manual/five.grok/browser-components/views</a></li>
<li><a class="reference external" href="http://plone.org/documentation/kb/how-to-write-templates-for-plone-4">http://plone.org/documentation/kb/how-to-write-templates-for-plone-4</a></li>
</ul>
</div>
<div class="section" id="creating-a-view-using-zcml">
<h3><a class="toc-backref" href="#id9">Creating a view using ZCML</a><a class="headerlink" href="#creating-a-view-using-zcml" title="Permalink to this headline">¶</a></h3>
<p>Example:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c"># We must use BrowserView from view, not from zope.browser</span>
<span class="c"># Zope version does not</span>
<span class="kn">from</span> <span class="nn">Products.Five.browser</span> <span class="kn">import</span> <span class="n">BrowserView</span>

<span class="k">class</span> <span class="nc">MyView</span><span class="p">(</span><span class="n">BrowserView</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">context</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This will initialize context and request object as they are given as view multiadaption parameters.</span>

<span class="sd">        Note that BrowserView constructor does this for you and this step here is just to show</span>
<span class="sd">        how view receives its context and request parameter. You do not need to write</span>
<span class="sd">        __init__() for your views.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">context</span> <span class="o">=</span> <span class="n">context</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">request</span> <span class="o">=</span> <span class="n">request</span>

    <span class="c"># by default call will call self.index() method which is mapped</span>
    <span class="c"># to ViewPageTemplateFile specified in ZCML</span>
    <span class="c">#def __call__():</span>
    <span class="c">#</span>
</pre></div>
</div>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">Do not attempt to run any code in __init__() method of a view.
If this code fails and exception is caused, zope.component machinery
remaps this as &quot;View not found&quot; exception or traversing error.
Instead, use a pattern where you have setup() or similar
method which __call__() or view users explicitly call.</p>
</div>
<div class="section" id="registering-a-view">
<h4><a class="toc-backref" href="#id10">Registering a view</a><a class="headerlink" href="#registering-a-view" title="Permalink to this headline">¶</a></h4>
<p>Zope 3 views are registered in ZCML, XML-based configuration language.
Usually the configuration file, where the registration done is
<em>yourapp.package/yourapp/package/browser/configure.zcml</em>.</p>
<p>The following example registers a new view</p>
<ul class="simple">
<li><em>for</em> tells which content receive this view.
for=&quot;*&quot; means that this view can be used for any content. This equals for registering views
to zope.interface.Interface base class.</li>
<li><em>name</em> is view's name which exposes it to traversing and getMultiAdapter()
look-ups. If your view's name is &quot;test&quot; then you can render it in browser
by calling <a class="reference external" href="http://yourhost/site/page/&#64;&#64;test">http://yourhost/site/page/&#64;&#64;test</a></li>
<li><em>permission</em> is permission needed to access the view.
When HTTP request comes in, the currently logged in user's access rights
in the current context are checked against this permission.
See :doc:&lt;Security chapter /security/permission_lists.txt&gt;
for available Plone out-of-the-box permissions.&nbsp;Usually
you want have <em>zope2.View</em>, <em>cmf.ModifyPortalContent</em>, <em>cmf.ManagePortal</em> or <em>zope2.Public</em> here.</li>
<li><em>class</em> is Python dotted name for BrowserView based class which is
responsible for managing the view. Class __call__() method
is the entry point for view processing and rendering.</li>
<li>Note that you need to declare <em>browser</em> namespace in your configure.zcml
to use <em>browser</em> configuration directives</li>
</ul>
<div class="highlight-xml"><div class="highlight"><pre><span class="nt">&lt;configure</span>
      <span class="na">xmlns=</span><span class="s">&quot;http://namespaces.zope.org/zope&quot;</span>
      <span class="na">xmlns:browser=</span><span class="s">&quot;http://namespaces.zope.org/browser&quot;</span>
      <span class="nt">&gt;</span>

        <span class="nt">&lt;browser:page</span>
              <span class="na">for=</span><span class="s">&quot;*&quot;</span>
              <span class="na">name=</span><span class="s">&quot;test&quot;</span>
              <span class="na">permission=</span><span class="s">&quot;zope2.Public&quot;</span>
              <span class="na">class=</span><span class="s">&quot;.views.MyView&quot;</span>
              <span class="nt">/&gt;</span>

<span class="nt">&lt;/configure&gt;</span>
</pre></div>
</div>
</div>
<div class="section" id="relationship-between-views-and-templates">
<h4><a class="toc-backref" href="#id11">Relationship between views and templates</a><a class="headerlink" href="#relationship-between-views-and-templates" title="Permalink to this headline">¶</a></h4>
<p>ZCML &lt;browser:view template=&quot;&quot;&gt; will set <em>index</em> class attribute.</p>
<p>The default view __call__() method will return the value
returned by self.index() call.</p>
<p>Example:</p>
<div class="highlight-python"><pre>&lt;browser:page
    for="*"
    name="test"
    permission="zope2.Public"
    class=".views.MyView"
    /&gt;

from Products.Five.browser.pagetemplatefile import ViewPageTemplateFile

class MyView(BrowserView):

    index = ViewPageTemplateFile("my-template.pt")</pre>
</div>
<p>is equal to:</p>
<div class="highlight-python"><pre>&lt;browser:page
    for="*"
    name="test"
    permission="zope2.Public"
    class=".views.MyView"
    template="my-template.pt"
    /&gt;

class MyView(BrowserView):
    pass</pre>
</div>
<p>Rendering of the view is done by following:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">Products.Five.browser.pagetemplatefile</span> <span class="kn">import</span> <span class="n">ViewPageTemplateFile</span>

<span class="k">class</span> <span class="nc">MyView</span><span class="p">(</span><span class="n">BrowserView</span><span class="p">):</span>

    <span class="c"># This may be overridden in ZCML</span>
    <span class="n">index</span> <span class="o">=</span> <span class="n">ViewPageTemplateFile</span><span class="p">(</span><span class="s">&quot;my-template.pt&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">render</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">render</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="section" id="overriding-a-view-template-in-run-time">
<h4><a class="toc-backref" href="#id12">Overriding a view template in run-time</a><a class="headerlink" href="#overriding-a-view-template-in-run-time" title="Permalink to this headline">¶</a></h4>
<p>Below is an sample code snipped which allows override of already
constructed <tt class="docutils literal"><span class="pre">ViewPageTemplateFile</span></tt> with a chosen file in run-time:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">plone.z3cform</span>
<span class="kn">from</span> <span class="nn">zope.app.pagetemplate</span> <span class="kn">import</span> <span class="n">ViewPageTemplateFile</span> <span class="k">as</span> <span class="n">Zope3PageTemplateFile</span>
<span class="kn">from</span> <span class="nn">zope.app.pagetemplate.viewpagetemplatefile</span> <span class="kn">import</span> <span class="n">BoundPageTemplate</span>
<span class="c"># Construct template from a file which lies in a certain package</span>
<span class="n">template</span> <span class="o">=</span> <span class="n">Zope3PageTemplateFile</span><span class="p">(</span><span class="s">&#39;subform.pt&#39;</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">plone</span><span class="o">.</span><span class="n">z3cform</span><span class="o">.</span><span class="n">__file__</span><span class="p">),</span> <span class="s">&quot;templates&quot;</span><span class="p">))</span>
<span class="c"># Bind template to context</span>
<span class="c"># This will make template callable with template() syntax and context</span>
<span class="n">form_instance</span><span class="o">.</span><span class="n">template</span> <span class="o">=</span> <span class="n">BoundPageTemplate</span><span class="p">(</span><span class="n">template</span><span class="p">,</span> <span class="n">form_instance</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="layers">
<h2><a class="toc-backref" href="#id13">Layers</a><a class="headerlink" href="#layers" title="Permalink to this headline">¶</a></h2>
<p>Views can be registered against a specific layer interface. This means that
views are only looked up if the specific layer is effective.
Since one Zope application server can contain multiple Plone sites, layers
are used to determine which Python code is effective for which Plone site.</p>
<p>Layer can be be effective when</p>
<ul class="simple">
<li>certain theme is active</li>
<li>if a specific add-on product is installed</li>
</ul>
<p>You should generally always register your views against a certain layer in your own code.</p>
<p>For more information, see</p>
<ul class="simple">
<li><a class="reference internal" href="layers.html"><em>browser layers</em></a></li>
</ul>
</div>
<div class="section" id="content-type-mimetype-and-template-start-tag">
<h2><a class="toc-backref" href="#id14">Content type, mimetype and Template start tag</a><a class="headerlink" href="#content-type-mimetype-and-template-start-tag" title="Permalink to this headline">¶</a></h2>
<p>If you need to produce other output than (X)HTML here are some resources</p>
<ul class="simple">
<li><a class="reference external" href="http://n2.nabble.com/Setting-a-mime-type-on-a-Zope-3-browser-view-tp4442770p4442770.html">http://n2.nabble.com/Setting-a-mime-type-on-a-Zope-3-browser-view-tp4442770p4442770.html</a></li>
</ul>
</div>
<div class="section" id="zope-viewpagetemplatefile-vs-five-viewpagetemplatefile">
<h2><a class="toc-backref" href="#id15">Zope ViewPageTemplateFile vs. Five ViewPageTemplateFile</a><a class="headerlink" href="#zope-viewpagetemplatefile-vs-five-viewpagetemplatefile" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li>Zope  <a class="reference external" href="http://svn.zope.org/zope.publisher/trunk/src/zope/publisher/browser.py?rev=101538&amp;view=auto">BrowserView source code</a>.</li>
<li><a class="reference external" href="http://svn.zope.org/Zope/trunk/src/Products/Five/browser/__init__.py?rev=96262&amp;view=markup">Five version</a>. Products.Five is a way
to stick some of Zope 3 technologies to Zope 2 codebase used by Plone.</li>
</ul>
<p>Difference in code:</p>
<div class="highlight-python"><pre>from Products.Five.browser.pagetemplatefile import ViewPageTemplateFile

vs.

from zope.app.pagetemplate import ViewPageTemplateFile</pre>
</div>
<p>Difference is that Five version supports</p>
<ul class="simple">
<li>Acquisition</li>
<li>provider: TAL expression</li>
<li>Other Plone specific TAL expression functions like test()</li>
<li>Usually Plone code needs Five version of ViewPageTemplateFile</li>
<li>Some subsystems, notably z3c.form package, expect Zope 3 version of ViewPageTemplateFile instances</li>
</ul>
</div>
<div class="section" id="overriding-a-view-class-in-a-product">
<h2><a class="toc-backref" href="#id16">Overriding a view class in a product</a><a class="headerlink" href="#overriding-a-view-class-in-a-product" title="Permalink to this headline">¶</a></h2>
<p>Most of the code in this section is copied from a <a class="reference external" href="http://www.slideshare.net/wooda/martin-aspeli-extending-and-customising-plone-3">tutorial by Martin Aspeli
(on slideshare.net)</a>.
The main change is that, at least for Plone 4, the interface should subclass
plone.theme.interfaces.IDefaultPloneLayer instead of zope.interface.Interface.</p>
<p>In this example we override the &quot;&#64;&#64;register&quot; form from the
plone.app.users package, creating a custom form which subclasses the original.</p>
<ul class="simple">
<li>Create an interface in interfaces.py:</li>
</ul>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">plone.theme.interfaces</span> <span class="kn">import</span> <span class="n">IDefaultPloneLayer</span>

<span class="k">class</span> <span class="nc">IExamplePolicy</span><span class="p">(</span><span class="n">IDefaultPloneLayer</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; A marker interface for the theme layer</span>
<span class="sd">    &quot;&quot;&quot;</span>
</pre></div>
</div>
<ul class="simple">
<li>Then create profiles/default/browserlayer.xml:</li>
</ul>
<div class="highlight-xml"><div class="highlight"><pre><span class="nt">&lt;layers&gt;</span>
  <span class="nt">&lt;layer</span>
    <span class="na">name=</span><span class="s">&quot;example.policy.layer&quot;</span>
    <span class="na">interface=</span><span class="s">&quot;example.policy.interfaces.IExamplePolicy&quot;</span>
  <span class="nt">/&gt;</span>
<span class="nt">&lt;/layers&gt;</span>
</pre></div>
</div>
<ul class="simple">
<li>Create browser/configure.zcml:</li>
</ul>
<div class="highlight-xml"><div class="highlight"><pre><span class="nt">&lt;configure</span>
    <span class="na">xmlns=</span><span class="s">&quot;http://namespaces.zope.org/zope&quot;</span>
    <span class="na">xmlns:browser=</span><span class="s">&quot;http://namespaces.zope.org/browser&quot;</span>
    <span class="na">i18n_domain=</span><span class="s">&quot;example.policy&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;browser:page</span>
      <span class="na">name=</span><span class="s">&quot;register&quot;</span>
      <span class="na">class=</span><span class="s">&quot;.customregistration.CustomRegistrationForm&quot;</span>
      <span class="na">permission=</span><span class="s">&quot;zope2.View&quot;</span>
      <span class="na">layer=</span><span class="s">&quot;..interfaces.IExamplePolicy&quot;</span>
      <span class="nt">/&gt;</span>
<span class="nt">&lt;/configure&gt;</span>
</pre></div>
</div>
<ul class="simple">
<li>Create browser/customregistration.py:</li>
</ul>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">plone.app.users.browser.register</span> <span class="kn">import</span> <span class="n">RegistrationForm</span>

<span class="k">class</span> <span class="nc">CustomRegistrationForm</span><span class="p">(</span><span class="n">RegistrationForm</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Subclass the standard registration form</span>
<span class="sd">    &quot;&quot;&quot;</span>
</pre></div>
</div>
</div>
<div class="section" id="helper-views">
<h2><a class="toc-backref" href="#id17">Helper views</a><a class="headerlink" href="#helper-views" title="Permalink to this headline">¶</a></h2>
<p>Not all views need to return HTML output, or output at all. Views can be used as a helpers
around in the code to provide APIs to objects. Since views can be overridden using layers,
view is a natural plug-in point which an add-on product can customize or override
in a conflict-free manner.</p>
<p>View methods are exposed to page templates and such, so you can also call
view methods directly from a page template, besides Python code.</p>
<div class="section" id="id1">
<h3><a class="toc-backref" href="#id18">More information</a><a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><a class="reference internal" href="../misc/context.html"><em>Context helpers</em></a></li>
<li><a class="reference internal" href="../functionality/expressions.html"><em>Expressions</em></a></li>
</ul>
</div>
<div class="section" id="historical-perspective">
<h3><a class="toc-backref" href="#id19">Historical perspective</a><a class="headerlink" href="#historical-perspective" title="Permalink to this headline">¶</a></h3>
<p>Often the point of using helper views is that you can have reusable functionality which can be plugged-in as one-line code around the system. Helper views also get around the following limitations:</p>
<ul class="simple">
<li>TAL security</li>
<li>Limiting Python expression to one line</li>
<li>Not being able to import Python modules</li>
</ul>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Using RestrictedPython scripts (creating Python through
Zope Management Interface) and Zope 2 Extension modules is discouraged.
The same functionality can be achieved with helper views, with
less potential pitfalls.</p>
</div>
</div>
</div>
<div class="section" id="reusing-view-template-snippets-or-embedding-another-view">
<h2><a class="toc-backref" href="#id20">Reusing view template snippets or embedding another view</a><a class="headerlink" href="#reusing-view-template-snippets-or-embedding-another-view" title="Permalink to this headline">¶</a></h2>
<p>To use the same template code several times you can either</p>
<ul class="simple">
<li>Create a own BrowserView for it call this view (see <em>Getting a view</em> below)</li>
<li>Share a ViewPageTemplate instance between views and using it several times</li>
</ul>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Plone 2.x way, TAL template language macros, are discouraged to provide reusable
functionality in your add-on product. This is because macros are hardwired
to TAL template language and referring them outside templates is difficult.
Also, if you ever need to mix or change the template language, you can
do it easily when templates are a feature of a pure Python based view and not vice versa.</p>
</div>
<p>Here is an example how to have a view snippet which can be used subclasses of a base view class.
Subclasses can refer to this template in any point of the view rendering, making it possible
for subclasses to have fine tuned control over how the template snippet is represented.</p>
<p>Related Python code:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">Products.Five</span> <span class="kn">import</span> <span class="n">BrowserView</span>
<span class="kn">from</span> <span class="nn">Products.Five.browser.pagetemplatefile</span> <span class="kn">import</span> <span class="n">ViewPageTemplateFile</span>

<span class="k">class</span> <span class="nc">ProductCardView</span><span class="p">(</span><span class="n">BrowserView</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    End user visible product card presentation.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">implements</span><span class="p">(</span><span class="n">IProductCardView</span><span class="p">)</span>

    <span class="c"># Nested template which renders address box + buy button</span>
    <span class="n">summary_template</span> <span class="o">=</span> <span class="n">ViewPageTemplateFile</span><span class="p">(</span><span class="s">&quot;summarybox.pt&quot;</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">renderSummary</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Render summary box</span>

<span class="sd">        @return: Resulting HTML code as Python string</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">summary_template</span><span class="p">()</span>
</pre></div>
</div>
<p>Then you can render summary template in the main template associated with ProductCardView,
by calling <tt class="docutils literal"><span class="pre">renderSummary()</span></tt> method and TAL non-escaping HTML embedding.</p>
<div class="highlight-html"><div class="highlight"><pre><span class="nt">&lt;h1</span> <span class="na">tal:content=</span><span class="s">&quot;context/Title&quot;</span> <span class="nt">/&gt;</span>

<span class="nt">&lt;div</span> <span class="na">tal:replace=</span><span class="s">&quot;structure view/renderSummary&quot;</span> <span class="nt">/&gt;</span>

<span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;description&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">tal:condition=</span><span class="s">&quot;python:context.Description().decode(&#39;utf-8&#39;) != u&#39;None&#39;&quot;</span> <span class="na">tal:replace=</span><span class="s">&quot;structure context/Description&quot;</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;/div&gt;</span>
</pre></div>
</div>
<p>And the summarybox.pt itself is just HTML code without Plone decoration frame (main_template/master etc. macros).
Make sure that you declare i18n:domain again or the strings in this template are not translated.</p>
<div class="highlight-html"><div class="highlight"><pre><span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;summary-box&quot;</span> <span class="na">i18n:domain=</span><span class="s">&quot;your.package&quot;</span><span class="nt">&gt;</span>
        ...
<span class="nt">&lt;/div&gt;</span>
</pre></div>
</div>
</div>
<div class="section" id="accessing-a-view-instance-in-code">
<h2><a class="toc-backref" href="#id21">Accessing a view instance in code</a><a class="headerlink" href="#accessing-a-view-instance-in-code" title="Permalink to this headline">¶</a></h2>
<p>You need to get access to view in your code if you are</p>
<ul class="simple">
<li>Calling a view from inside another view</li>
<li>Calling a view from unit test code</li>
</ul>
<p>Below are two different approach.</p>
<div class="section" id="by-using-getmultiadapter">
<h3><a class="toc-backref" href="#id22">By using getMultiAdapter()</a><a class="headerlink" href="#by-using-getmultiadapter" title="Permalink to this headline">¶</a></h3>
<p>This is the most efficient way in Python.</p>
<p>Example</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">Acquisition</span> <span class="kn">import</span> <span class="n">aq_inner</span>
<span class="kn">from</span> <span class="nn">zope.component</span> <span class="kn">import</span> <span class="n">getMultiAdapter</span>

<span class="k">def</span> <span class="nf">getView</span><span class="p">(</span><span class="n">context</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
    <span class="c"># Remove acquisition wrapper which may cause false context assumptions</span>
    <span class="n">context</span> <span class="o">=</span> <span class="n">aq_inner</span><span class="p">(</span><span class="n">context</span><span class="p">)</span>
    <span class="c"># Will raise ComponentLookUpError</span>
    <span class="n">view</span> <span class="o">=</span> <span class="n">getMultiAdapter</span><span class="p">((</span><span class="n">context</span><span class="p">,</span> <span class="n">request</span><span class="p">),</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>
    <span class="c"># Put view to acquisition chain</span>
    <span class="n">view</span> <span class="o">=</span> <span class="n">view</span><span class="o">.</span><span class="n">__of__</span><span class="p">(</span><span class="n">context</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">view</span>
</pre></div>
</div>
</div>
<div class="section" id="by-using-traversing">
<h3><a class="toc-backref" href="#id23">By using traversing</a><a class="headerlink" href="#by-using-traversing" title="Permalink to this headline">¶</a></h3>
<p>Traversing is slower than direct getMultiAdapter() call.
However, traversing is available in templates and RestrictedPython modules easily.</p>
<p>Example</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">getView</span><span class="p">(</span><span class="n">context</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Return a view which is associated with context object and current HTTP request.</span>

<span class="sd">    @param context: Any Plone content object</span>
<span class="sd">    @param name: Attribute name holding the view name</span>
<span class="sd">    &quot;&quot;&quot;</span>


    <span class="k">try</span><span class="p">:</span>
        <span class="n">view</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="n">unrestrictedTraverse</span><span class="p">(</span><span class="s">&quot;@@&quot;</span> <span class="o">+</span> <span class="n">name</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s">&quot;Instance </span><span class="si">%s</span><span class="s"> did not have view </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">context</span><span class="p">),</span> <span class="n">name</span><span class="p">))</span>

    <span class="n">view</span> <span class="o">=</span> <span class="n">view</span><span class="o">.</span><span class="n">__of__</span><span class="p">(</span><span class="n">context</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">view</span>
</pre></div>
</div>
<p>You can also do direct view looks up and method calls in template by using &#64;&#64;&nbsp;notation in traversing.</p>
<div class="highlight-html"><div class="highlight"><pre><span class="nt">&lt;div</span> <span class="na">tal:attributes=</span><span class="s">&quot;lang context/@@plone_portal_state/current_language&quot;</span><span class="nt">&gt;</span>
    We look up lang attribute by using BrowserView which name is &quot;plone_portal_state&quot;
<span class="nt">&lt;/div&gt;</span>
</pre></div>
</div>
</div>
<div class="section" id="use-a-skin-based-template-in-a-five-view">
<h3><a class="toc-backref" href="#id24">Use a skin based template in a Five view</a><a class="headerlink" href="#use-a-skin-based-template-in-a-five-view" title="Permalink to this headline">¶</a></h3>
<p>Use aq_acquire(object, template_name)</p>
<p>Example: Get an object by its path and render it using its default template in the current context.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">Acquisition</span> <span class="kn">import</span> <span class="n">aq_base</span><span class="p">,</span> <span class="n">aq_acquire</span>
<span class="kn">from</span> <span class="nn">Products.Five.browser</span> <span class="kn">import</span> <span class="n">BrowserView</span>

<span class="k">class</span> <span class="nc">TelescopeView</span><span class="p">(</span><span class="n">BrowserView</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Renders an object in a different location of the site when passed the</span>
<span class="sd">    path to it in the querystring.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="p">[</span><span class="s">&quot;path&quot;</span><span class="p">]</span>
        <span class="n">target_obj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">restrictedTraverse</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
        <span class="c"># Strip the target_obj of context with aq_base.</span>
        <span class="c"># Put the target in the context of self.context.</span>
        <span class="c"># getDefaultLayout returns the name of the default</span>
        <span class="c"># view method from the factory type information</span>
        <span class="k">return</span> <span class="n">aq_acquire</span><span class="p">(</span><span class="n">aq_base</span><span class="p">(</span><span class="n">target_obj</span><span class="p">)</span><span class="o">.</span><span class="n">__of__</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="p">),</span>
                          <span class="n">target_obj</span><span class="o">.</span><span class="n">getDefaultLayout</span><span class="p">())()</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="listing-available-views">
<h2><a class="toc-backref" href="#id25">Listing available views</a><a class="headerlink" href="#listing-available-views" title="Permalink to this headline">¶</a></h2>
<p>This is useful for debugging purposes:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">plone.app.customerize</span> <span class="kn">import</span> <span class="n">registration</span>
<span class="kn">from</span> <span class="nn">zope.publisher.interfaces.browser</span> <span class="kn">import</span> <span class="n">IBrowserRequest</span>

<span class="c"># views is generator of zope.component.registry.AdapterRegistration objects</span>
<span class="n">views</span> <span class="o">=</span> <span class="n">registration</span><span class="o">.</span><span class="n">getViews</span><span class="p">(</span><span class="n">IBrowserRequest</span><span class="p">)</span>
</pre></div>
</div>
<div class="section" id="listing-all-views-of-certain-type">
<h3><a class="toc-backref" href="#id26">Listing all views of certain type</a><a class="headerlink" href="#listing-all-views-of-certain-type" title="Permalink to this headline">¶</a></h3>
<p>How to filter out views which provide certain interface.</p>
<blockquote>
<p>from plone.app.customerize import registration
from zope.publisher.interfaces.browser import IBrowserRequest</p>
<p># views is generator of zope.component.registry.AdapterRegistration objects
views = registration.getViews(IBrowserRequest)</p>
<p># Filter out all classes which do not filter a certain interface
views = [ view.factory for view in views if IBlocksView.implementedBy(view.factory) ]</p>
</blockquote>
</div>
</div>
<div class="section" id="default-view-of-a-content-item">
<h2><a class="toc-backref" href="#id27">Default view of a content item</a><a class="headerlink" href="#default-view-of-a-content-item" title="Permalink to this headline">¶</a></h2>
<p>Objects has views for &quot;default&quot;, view, edit, and so on.</p>
<p>The distinction between <em>default</em> and <em>view</em> views are that for files,
the default can be download.</p>
<p>The default view...</p>
<ul class="simple">
<li>This view is configured in <a class="reference internal" href="../content/types.html"><em>portal_types</em></a>.</li>
<li>This view is rendered when content item is called - even though
they are objects, they have <tt class="docutils literal"><span class="pre">__call__()</span></tt> Python method defined.</li>
</ul>
<p>If you explicitly need to get content item view for page rendering,
you can do it:</p>
<div class="highlight-python"><pre>def viewURLFor(item):
    cdtate = getMultiAdapter((item, item.REQUEST), name='plone_context_state)
    return cstate.view_url()</pre>
</div>
<p>More info</p>
<ul class="simple">
<li><a class="reference internal" href="../misc/context.html"><em>Context helpers and utilities</em></a></li>
<li><a class="reference external" href="http://plone.293351.n2.nabble.com/URL-to-content-view-tp6028204p6028204.html">http://plone.293351.n2.nabble.com/URL-to-content-view-tp6028204p6028204.html</a></li>
</ul>
</div>
<div class="section" id="views-and-magical-acquisition">
<h2><a class="toc-backref" href="#id28">Views and magical acquisition</a><a class="headerlink" href="#views-and-magical-acquisition" title="Permalink to this headline">¶</a></h2>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">This is really nasty stuff. If this were not be a public document I'd
use more harsh words here.</p>
</div>
<p>In Plone 3, the following will lead the very hard to debug errors.</p>
<p>Views will automatically assign themselves as a parent for all member variables.</p>
<p>E.g. you have Basket content item with absolute_url() of</p>
<div class="highlight-python"><pre>http://localhost:9666/isleofback/sisalto/matkasuunnitelmat/d59ca034c50995d6a77cacbe03e718de</pre>
</div>
<p>Then if you use this object in view code member variable assignment...</p>
<div class="highlight-python"><div class="highlight"><pre><span class="bp">self</span><span class="o">.</span><span class="n">basket</span> <span class="o">=</span> <span class="n">my_basket</span>
</pre></div>
</div>
<p>... this will mess up Basket content item acquisition chain:</p>
<div class="highlight-python"><pre>&lt;Basket at /isleofback/sisalto/yritykset/katajamaan_taksi/d59ca034c50995d6a77cacbe03e718de&gt;</pre>
</div>
<p>One workaround to avoid this mess it to put a member variable inside a Python array
and create an accessor method to read it when needed:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">initSomeVariables</span><span class="p">():</span>

    <span class="n">basket</span> <span class="o">=</span> <span class="n">collector</span><span class="o">.</span><span class="n">get_collector</span><span class="p">(</span><span class="n">basket_folder</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="p">,</span> <span class="n">create</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">basket</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
        <span class="c"># Work around acquisition wrapping thing</span>
        <span class="c"># which forces the parent</span>

        <span class="c"># Assign a variable inside an array which prevents automatic</span>
        <span class="c"># acquisition wrapping for doing its broken magic or something</span>
        <span class="c"># along the lines</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">basket_holder</span> <span class="o">=</span> <span class="p">[</span> <span class="n">basket</span> <span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">basket_holder</span> <span class="o">=</span> <span class="p">[</span> <span class="bp">None</span> <span class="p">]</span>


<span class="k">def</span> <span class="nf">getCollector</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    @return: User&#39;s collector object where pages are stored</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">basket_holder</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>

  </div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
<p class="logo"><a href="../index.html"><img src="../_static/plone-icon-64.png" />
</a></p>

  <h3><a href="../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Views</a><ul>
<li><a class="reference internal" href="#introduction">Introduction</a><ul>
<li><a class="reference internal" href="#plain-zope-3-vs-grok">Plain Zope 3 vs. Grok</a></li>
<li><a class="reference internal" href="#more-information">More information</a></li>
<li><a class="reference internal" href="#view-components">View components</a></li>
</ul>
</li>
<li><a class="reference internal" href="#finding-a-view-to-override">Finding a view to override</a></li>
<li><a class="reference internal" href="#creating-and-registering-a-view">Creating and registering a view</a><ul>
<li><a class="reference internal" href="#creating-a-view-using-grok">Creating a view using Grok</a></li>
<li><a class="reference internal" href="#creating-a-view-using-zcml">Creating a view using ZCML</a><ul>
<li><a class="reference internal" href="#registering-a-view">Registering a view</a></li>
<li><a class="reference internal" href="#relationship-between-views-and-templates">Relationship between views and templates</a></li>
<li><a class="reference internal" href="#overriding-a-view-template-in-run-time">Overriding a view template in run-time</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#layers">Layers</a></li>
<li><a class="reference internal" href="#content-type-mimetype-and-template-start-tag">Content type, mimetype and Template start tag</a></li>
<li><a class="reference internal" href="#zope-viewpagetemplatefile-vs-five-viewpagetemplatefile">Zope ViewPageTemplateFile vs. Five ViewPageTemplateFile</a></li>
<li><a class="reference internal" href="#overriding-a-view-class-in-a-product">Overriding a view class in a product</a></li>
<li><a class="reference internal" href="#helper-views">Helper views</a><ul>
<li><a class="reference internal" href="#id1">More information</a></li>
<li><a class="reference internal" href="#historical-perspective">Historical perspective</a></li>
</ul>
</li>
<li><a class="reference internal" href="#reusing-view-template-snippets-or-embedding-another-view">Reusing view template snippets or embedding another view</a></li>
<li><a class="reference internal" href="#accessing-a-view-instance-in-code">Accessing a view instance in code</a><ul>
<li><a class="reference internal" href="#by-using-getmultiadapter">By using getMultiAdapter()</a></li>
<li><a class="reference internal" href="#by-using-traversing">By using traversing</a></li>
<li><a class="reference internal" href="#use-a-skin-based-template-in-a-five-view">Use a skin based template in a Five view</a></li>
</ul>
</li>
<li><a class="reference internal" href="#listing-available-views">Listing available views</a><ul>
<li><a class="reference internal" href="#listing-all-views-of-certain-type">Listing all views of certain type</a></li>
</ul>
</li>
<li><a class="reference internal" href="#default-view-of-a-content-item">Default view of a content item</a></li>
<li><a class="reference internal" href="#views-and-magical-acquisition">Views and magical acquisition</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="index.html"
                        title="previous chapter">Views and viewlets</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="viewlets.html"
                        title="next chapter">Viewlets</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="../_sources/views/browserviews.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" size="18" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="viewlets.html" title="Viewlets"
             >next</a> |</li>
        <li class="right" >
          <a href="index.html" title="Views and viewlets"
             >previous</a> |</li>
        <li><a href="../index.html">Plone Community Managed Developer Manual v1.0 documentation</a> &raquo;</li>
          <li><a href="index.html" >Views and viewlets</a> &raquo;</li> 
      </ul>
    </div>

    <div class="footer">
        &copy; Copyright 2010 mFabrik Research Oy and Plone community contributors.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.0.4.
    </div>


  </body>
</html>