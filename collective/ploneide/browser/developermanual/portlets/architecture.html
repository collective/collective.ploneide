<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Basic plone.portlets architecture &mdash; Plone Community Managed Developer Manual v1.0 documentation</title>
    <link rel="stylesheet" href="../_static/plone.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '1.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="top" title="Plone Community Managed Developer Manual v1.0 documentation" href="../index.html" />
    <link rel="up" title="Portlets" href="index.html" />
    <link rel="next" title="Testing the portlet" href="testing.html" />
    <link rel="prev" title="What&#39;s a Portlet?" href="whats_a_portlet.html" />
<script language="javascript">
//<![CDATA[

Documentation.addTranslations({"locale": "fr", "plural_expr": "(n > 1)", "messages": {"See the definition": "Voir la d\u00e9finition"}});

// See http://disqus.disqus.com/general_integration_help/
var disqus_developer = 1;
if (document.location.protocol == 'http:') {
    disqus_developer = 0;
}

// Some HTML/CSS transforms we can't do in pure CSS (waiting for CSS3 support)
$(document).ready(function () {

    // Style of .. verisonmodified:: , .. versionadded:: ...
    $('p:has(span.versionmodified)').addClass('p-versionmodified');

    // Style of the TOC tree
    $('ul:has(li.toctree-l1)').addClass('toctree');

    // Decorate links to other sites
    $('a[class~=external]').attr('target', '_blank');

    // Glossary terms
    $('em.xref').attr('title', _('See the definition'));

    // We need to have all <pre> in a <div class="highlight"> to mimic pygments
    // to work around a pygments (?) bug
    var suffixes = {cfg: null, python:null};
    for (var suffix in suffixes) {
        var pattern = 'div.highlight-' + suffix + ' > pre';
        $(pattern).wrap('<div class="highlight" />');
    }
    return true;
});
//]]>
</script>

  </head>
  <body>
<!--[if lte IE 6]>
<style type="text/css">
#ie6msg{border:3px solid #090; margin:8px 0; background:#cfc; color:#000;}
#ie6msg h4{margin:8px; padding:0;}
#ie6msg p{margin:8px; padding:0;}
#ie6msg p a.getie8{font-weight:bold; color:#006;}
#ie6msg p a.ie6expl{font-weight:normal; color:#006;}
</style>
<div id="ie6msg">
<h4>Did you know that your browser is out of date?</h4>
<p>If the layout of this site seems ugly, that's because you're actually using
an outdated browser. And we wont put any effort to provide a nice layout to IE6
users.</p>
<p>To get the best possible experience using our website we recommend that you
upgrade your browser to a newer version. The current version
is <a class="getie8"
href="http://upgradeie.s3.amazonaws.com/eng/index.html">Internet Explorer
8</a>. The upgrade is free. If you're using a PC at work you should contact your
IT administrator.</p>
<p>If you want to you may also try some other popular Internet browsers
like <a class="ie6expl"
href="http://getfirefox.com">Firefox</a>, <a class="ie6expl"
href="http://www.google.com/chrome">Chrome</a>, <a class="ie6expl"
href="http://www.opera.com">Opera</a>, or <a class="ie6expl"
href="http://www.apple.com/safari/download/">Safari</a></p>
</div>
<![endif]-->

    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="testing.html" title="Testing the portlet"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="whats_a_portlet.html" title="What&#39;s a Portlet?"
             accesskey="P">previous</a> |</li>
        <li><a href="../index.html">Plone Community Managed Developer Manual v1.0 documentation</a> &raquo;</li>
          <li><a href="index.html" accesskey="U">Portlets</a> &raquo;</li> 
      </ul>
    </div>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="sphinx-content">
    <div class="section" id="basic-plone-portlets-architecture">
<h1>Basic plone.portlets architecture<a class="headerlink" href="#basic-plone-portlets-architecture" title="Permalink to this headline">¶</a></h1>
<div class="admonition-description admonition ">
<p class="first admonition-title">Description</p>
<p class="last">This section describes the general architecture of a portlet through an example. You can checkout the example code <a class="reference external" href="http://svn.plone.org/svn/collective/ploneexample.portlet/trunk/">from the collective</a>.</p>
</div>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><a class="reference internal" href="#the-use-case" id="id1">The use case</a></li>
<li><a class="reference internal" href="#the-configuration-data" id="id2">The configuration data</a></li>
<li><a class="reference internal" href="#the-add-and-edit-forms" id="id3">The add and edit forms</a></li>
<li><a class="reference internal" href="#the-portlet-presentation" id="id4">The portlet presentation</a></li>
<li><a class="reference internal" href="#registering-the-portlet" id="id5">Registering the portlet</a></li>
<li><a class="reference internal" href="#installing-the-portlet" id="id6">Installing the portlet</a></li>
</ul>
</div>
<div class="section" id="the-use-case">
<h2><a class="toc-backref" href="#id1">The use case</a><a class="headerlink" href="#the-use-case" title="Permalink to this headline">¶</a></h2>
<p>As an example, we will develop a portlet to display the last <em>n</em>
(where <em>n</em> is a positive integer ;) modified content items to
logged-in users, which will be available to add it to any portlet
manager (left or right column by default).</p>
<p>[screenshot follows]</p>
</div>
<div class="section" id="the-configuration-data">
<h2><a class="toc-backref" href="#id2">The configuration data</a><a class="headerlink" href="#the-configuration-data" title="Permalink to this headline">¶</a></h2>
<p>When a portlet is first created, &nbsp;there are often customizations
which can be made which tailor the portlet's behaviour to meet the
user's needs: eg. which content type to display, how many items to
list, etc... In our example, we want the person configuring the
portlet to be able to specify how many of the most recent items
will be displayed inside the portlet.</p>
<p>First, we have to describe the interface schema of the
configuration data we want to store using <tt class="docutils literal"><span class="pre">zope.schema</span></tt> (see
<a class="reference external" href="http://wiki.zope.org/zope3/schema.html">this page</a> for more info
on schemas). By convention, this interface derives from
<tt class="docutils literal"><span class="pre">IPortletDataProvider</span></tt>, which is just a marker interface. In the
package's <em>interfaces.py</em> file, type:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">plone.portlets.interfaces</span> <span class="kn">import</span> <span class="n">IPortletDataProvider</span>
<span class="kn">from</span> <span class="nn">Products.CMFPlone</span> <span class="kn">import</span> <span class="n">PloneMessageFactory</span> <span class="k">as</span> <span class="n">_</span>

<span class="k">class</span> <span class="nc">IRecentPortlet</span><span class="p">(</span><span class="n">IPortletDataProvider</span><span class="p">):</span>
    <span class="n">count</span> <span class="o">=</span> <span class="n">schema</span><span class="o">.</span><span class="n">Int</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s">u&#39;Number of items to display&#39;</span><span class="p">),</span>
                       <span class="n">description</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s">u&#39;How many items to list.&#39;</span><span class="p">),</span>
                       <span class="n">required</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
                       <span class="n">default</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
</pre></div>
</div>
<p>The <tt class="docutils literal"><span class="pre">PloneMessageFactory</span></tt> makes our code ready to be localized
using the Plone i18n machinery.</p>
<p>After defining the configuration schema interface, we implement it
in a class called the Assignment class. This is a persistent
&quot;content&quot; class which stores the persistent configuration data (if
any) of the portlet. Even when a portlet is not configurable, it
needs to have an Assignment class, because the presence of an
Assignment instance in various places is what determines what
portlets show up where.</p>
<p>The Assignment class has a <tt class="docutils literal"><span class="pre">title</span></tt> attribute that is used in the
portlet management UI to distinguish different instances of the
portlet.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">plone.app.portlets.portlets</span> <span class="kn">import</span> <span class="n">base</span>
<span class="kn">from</span> <span class="nn">zope.interface</span> <span class="kn">import</span> <span class="n">implements</span>
<span class="kn">from</span> <span class="nn">ploneexample.portlet.interfaces</span> <span class="kn">import</span> <span class="n">IRecentPortlet</span>

<span class="k">class</span> <span class="nc">Assignment</span><span class="p">(</span><span class="n">base</span><span class="o">.</span><span class="n">Assignment</span><span class="p">):</span>
    <span class="n">implements</span><span class="p">(</span><span class="n">IRecentPortlet</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">count</span><span class="o">=</span><span class="mi">5</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">count</span> <span class="o">=</span> <span class="n">count</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">title</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">_</span><span class="p">(</span><span class="s">u&quot;Recent items&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="the-add-and-edit-forms">
<h2><a class="toc-backref" href="#id3">The add and edit forms</a><a class="headerlink" href="#the-add-and-edit-forms" title="Permalink to this headline">¶</a></h2>
<p>To add the portlet and edit its configuration, we have to define
appropiate add and edit forms.</p>
<p>This is typically done using <em>zope.formlib</em> and the portlet schema,
together with some base form classes to save us from designing the
forms template and logic ourselves. If the portlet is not
configurable, this can use the special <tt class="docutils literal"><span class="pre">base.NullAddForm</span></tt>, which
is just a view that creates the portlet and then redirects back to
the portlet management screen.</p>
<p>For more information about <em>zope.formlib</em>, check
<a class="reference external" href="../../../tutorial/writing-forms-easily-with-zope-formlib">this tutorial</a>.</p>
<p>The edit form can be omitted if the portlet configuration is not
editable.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">zope.formlib</span> <span class="kn">import</span> <span class="n">form</span>
<span class="k">class</span> <span class="nc">AddForm</span><span class="p">(</span><span class="n">base</span><span class="o">.</span><span class="n">AddForm</span><span class="p">):</span>
    <span class="n">form_fields</span> <span class="o">=</span> <span class="n">form</span><span class="o">.</span><span class="n">Fields</span><span class="p">(</span><span class="n">IRecentPortlet</span><span class="p">)</span>
    <span class="n">label</span> <span class="o">=</span> <span class="n">_</span><span class="p">(</span><span class="s">u&quot;Add Recent Portlet&quot;</span><span class="p">)</span>
    <span class="n">description</span> <span class="o">=</span> <span class="n">_</span><span class="p">(</span><span class="s">u&quot;This portlet displays recently modified content.&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">create</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">Assignment</span><span class="p">(</span><span class="n">count</span><span class="o">=</span><span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;count&#39;</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>

<span class="k">class</span> <span class="nc">EditForm</span><span class="p">(</span><span class="n">base</span><span class="o">.</span><span class="n">EditForm</span><span class="p">):</span>
    <span class="n">form_fields</span> <span class="o">=</span> <span class="n">form</span><span class="o">.</span><span class="n">Fields</span><span class="p">(</span><span class="n">IRecentPortlet</span><span class="p">)</span>
    <span class="n">label</span> <span class="o">=</span> <span class="n">_</span><span class="p">(</span><span class="s">u&quot;Edit Recent Portlet&quot;</span><span class="p">)</span>
    <span class="n">description</span> <span class="o">=</span> <span class="n">_</span><span class="p">(</span><span class="s">u&quot;This portlet displays recently modified content.&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>As it can be seen above, the add form must return an Assignment
instance of the portlet.</p>
</div>
<div class="section" id="the-portlet-presentation">
<h2><a class="toc-backref" href="#id4">The portlet presentation</a><a class="headerlink" href="#the-portlet-presentation" title="Permalink to this headline">¶</a></h2>
<p>Next, we define how the portlet will be rendered.</p>
<p>The Portlet Renderer is the &quot;view&quot; of the portlet. This is just a
content provider (in the zope.contentprovider sense), in that it
has an <tt class="docutils literal"><span class="pre">update()</span></tt> and a <tt class="docutils literal"><span class="pre">render()</span></tt> method, which will be called
upon the rendering of the portlet.</p>
<p>It's a multi-adapter that takes a number of parameters which makes
it possible to vary the rendering of the portlet:</p>
<dl class="docutils">
<dt>context</dt>
<dd>&nbsp;The current content object. Mind the type of content object that's
being shown.</dd>
<dt>request</dt>
<dd>The current request. Mind the current theme/browser layer.</dd>
<dt>view</dt>
<dd>The current (full page) view. Mind the current view, and whether or
not this is the canonical view of the object (as indicated by the
<tt class="docutils literal"><span class="pre">IViewView</span></tt> marker interface) or a particular view, like the
manage-portlets view.</dd>
<dt>manager</dt>
<dd>The portlet manager where this portlet was rendered (for now, think
of a portlet manager as a column). Mind where in the page the
portlet was rendered.</dd>
<dt>data</dt>
<dd>The portlet data, which is basically an instance of the portlet
assignment class. Mind the configuration of the portlet
assignment.</dd>
</dl>
<p>The Renderer base class relieves us from having to remember all
these parameters.</p>
<p>The Renderer class must have an <tt class="docutils literal"><span class="pre">available</span></tt> property, which is
used to determine whether this portlet should be shown or not. Note
you shouldn't include checks for the user id, group or content-type
here, since you can perform these assignments later by registering
the portlet under a certain category (more on this later).</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">plone.memoize.instance</span> <span class="kn">import</span> <span class="n">memoize</span>
<span class="kn">from</span> <span class="nn">zope.component</span> <span class="kn">import</span> <span class="n">getMultiAdapter</span>
<span class="kn">from</span> <span class="nn">Acquisition</span> <span class="kn">import</span> <span class="n">aq_inner</span>
<span class="kn">from</span> <span class="nn">Products.Five.browser.pagetemplatefile</span> <span class="kn">import</span> <span class="n">ViewPageTemplateFile</span>

<span class="k">class</span> <span class="nc">Renderer</span><span class="p">(</span><span class="n">base</span><span class="o">.</span><span class="n">Renderer</span><span class="p">):</span>
    <span class="n">_template</span> <span class="o">=</span> <span class="n">ViewPageTemplateFile</span><span class="p">(</span><span class="s">&#39;recent.pt&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
        <span class="n">base</span><span class="o">.</span><span class="n">Renderer</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">)</span>

        <span class="n">context</span> <span class="o">=</span> <span class="n">aq_inner</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="p">)</span>
        <span class="n">portal_state</span> <span class="o">=</span> <span class="n">getMultiAdapter</span><span class="p">((</span><span class="n">context</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="p">),</span> <span class="n">name</span><span class="o">=</span><span class="s">u&#39;plone_portal_state&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">anonymous</span> <span class="o">=</span> <span class="n">portal_state</span><span class="o">.</span><span class="n">anonymous</span><span class="p">()</span>  <span class="c"># whether or not the current user is Anonymous</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">portal_url</span> <span class="o">=</span> <span class="n">portal_state</span><span class="o">.</span><span class="n">portal_url</span><span class="p">()</span>  <span class="c"># the URL of the portal object</span>

        <span class="c"># a list of portal types considered &quot;end user&quot; types</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">typesToShow</span> <span class="o">=</span> <span class="n">portal_state</span><span class="o">.</span><span class="n">friendly_types</span><span class="p">()</span>

        <span class="n">plone_tools</span> <span class="o">=</span> <span class="n">getMultiAdapter</span><span class="p">((</span><span class="n">context</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="p">),</span> <span class="n">name</span><span class="o">=</span><span class="s">u&#39;plone_tools&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">catalog</span> <span class="o">=</span> <span class="n">plone_tools</span><span class="o">.</span><span class="n">catalog</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">render</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_template</span><span class="p">()</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">available</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Show the portlet only if there are one or more elements.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">anonymous</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">())</span>

    <span class="k">def</span> <span class="nf">recent_items</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">recently_modified_link</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s">&#39;</span><span class="si">%s</span><span class="s">/recently_modified&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">portal_url</span>

    <span class="nd">@memoize</span>
    <span class="k">def</span> <span class="nf">_data</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">limit</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">count</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">catalog</span><span class="p">(</span><span class="n">portal_type</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">typesToShow</span><span class="p">,</span>
                            <span class="n">sort_on</span><span class="o">=</span><span class="s">&#39;modified&#39;</span><span class="p">,</span>
                            <span class="n">sort_order</span><span class="o">=</span><span class="s">&#39;reverse&#39;</span><span class="p">,</span>
                            <span class="n">sort_limit</span><span class="o">=</span><span class="n">limit</span><span class="p">)[:</span><span class="n">limit</span><span class="p">]</span>
</pre></div>
</div>
<p>When reading the previous code, note that:</p>
<ol class="arabic simple">
<li><tt class="docutils literal"><span class="pre">plone_portal_state</span></tt> and <tt class="docutils literal"><span class="pre">plone_tools</span></tt> are helper views
providing some useful attributes to gather information from.</li>
<li>The <tt class="docutils literal"><span class="pre">memoize</span></tt> decorator is used here to cache the results of
the catalog query to avoid the perfomance hit of re-generating them
in each request. See the
<a class="reference external" href="http://dev.plone.org/plone/browser/plone.memoize/trunk/plone/memoize/README.txt">plone.memoize doctests</a>
for more information.</li>
</ol>
</div>
<div class="section" id="registering-the-portlet">
<h2><a class="toc-backref" href="#id5">Registering the portlet</a><a class="headerlink" href="#registering-the-portlet" title="Permalink to this headline">¶</a></h2>
<p>A convenient ZCML directive is provided to glue all components of
the portlet in the Zope Component Architecture. In the package's
<em>configure.zcml</em> file (or any other ZCML file included from it),
write:</p>
<div class="highlight-xml"><div class="highlight"><pre><span class="nt">&lt;configure</span>
    <span class="na">xmlns:five=</span><span class="s">&quot;http://namespaces.zope.org/five&quot;</span>
    <span class="na">xmlns:plone=</span><span class="s">&quot;http://namespaces.plone.org/plone&quot;</span>
    <span class="na">i18n_domain=</span><span class="s">&quot;ploneexample.portlet&quot;</span><span class="nt">&gt;</span>

    <span class="nt">&lt;five:registerPackage</span> <span class="na">package=</span><span class="s">&quot;.&quot;</span> <span class="na">initialize=</span><span class="s">&quot;.initialize&quot;</span> <span class="nt">/&gt;</span>

    <span class="nt">&lt;include</span> <span class="na">package=</span><span class="s">&quot;plone.app.portlets&quot;</span><span class="nt">/&gt;</span>

    <span class="nt">&lt;plone:portlet</span>
        <span class="na">name=</span><span class="s">&quot;ploneexample.portlet.Recent&quot;</span>
        <span class="na">interface=</span><span class="s">&quot;.recent.IRecentPortlet&quot;</span>
        <span class="na">assignment=</span><span class="s">&quot;.recent.Assignment&quot;</span>
        <span class="na">renderer=</span><span class="s">&quot;.recent.Renderer&quot;</span>
        <span class="na">addview=</span><span class="s">&quot;.recent.AddForm&quot;</span>
        <span class="na">editview=</span><span class="s">&quot;.recent.EditForm&quot;</span>
        <span class="nt">/&gt;</span>

<span class="nt">&lt;/configure&gt;</span>
</pre></div>
</div>
<p>Note you have to define/reference the plone XML namespace for the
directive to work. There is also a <tt class="docutils literal"><span class="pre">&lt;plone:portletRenderer</span> <span class="pre">/&gt;</span></tt>
directive to override the renderer for a particular
context/layer/view/manager.</p>
<p>You can see the descriptions of all these directives together with
their arguments in the
<a class="reference external" href="http://dev.plone.org/plone/browser/plone.app.portlets/trunk/plone/app/portlets/metadirectives.py">metadirectives.py file of the plone.app.portlets package</a>.</p>
<p>This ZCML directive is read at the Zope startup, so to register
each class appropiately into the Component Architecture, but you
won't be able to add your new portlet yet. You first need to
install its portlet type into your Plone site, as described in the
section which follows.</p>
</div>
<div class="section" id="installing-the-portlet">
<h2><a class="toc-backref" href="#id6">Installing the portlet</a><a class="headerlink" href="#installing-the-portlet" title="Permalink to this headline">¶</a></h2>
<p>The components and registration above make a new type of portlet
available for installation. To install the portlet type into a
particular Plone site, use GenericSetup.</p>
<p>First, register a new GenericSetup extension profile using a
registerProfile ZCML directive:</p>
<div class="highlight-xml"><div class="highlight"><pre><span class="nt">&lt;configure</span>
    <span class="na">xmlns:five=</span><span class="s">&quot;http://namespaces.zope.org/five&quot;</span>
    <span class="na">xmlns:plone=</span><span class="s">&quot;http://namespaces.plone.org/plone&quot;</span>
    <span class="na">xmlns:gs=</span><span class="s">&quot;http://namespaces.zope.org/genericsetup&quot;</span>
    <span class="na">i18n_domain=</span><span class="s">&quot;ploneexample.portlet&quot;</span><span class="nt">&gt;</span>

    <span class="nt">&lt;five:registerPackage</span> <span class="na">package=</span><span class="s">&quot;.&quot;</span> <span class="na">initialize=</span><span class="s">&quot;.initialize&quot;</span> <span class="nt">/&gt;</span>

    <span class="nt">&lt;include</span> <span class="na">package=</span><span class="s">&quot;plone.app.portlets&quot;</span><span class="nt">/&gt;</span>

    <span class="nt">&lt;gs:registerProfile</span>
        <span class="na">name=</span><span class="s">&quot;ploneexample.portlet&quot;</span>
        <span class="na">title=</span><span class="s">&quot;Recent Items Example&quot;</span>
        <span class="na">directory=</span><span class="s">&quot;profiles/default&quot;</span>
        <span class="na">description=</span><span class="s">&quot;An example portlet&quot;</span>
        <span class="na">provides=</span><span class="s">&quot;Products.GenericSetup.interfaces.EXTENSION&quot;</span>
        <span class="nt">/&gt;</span>

    <span class="nt">&lt;plone:portlet</span>
        <span class="na">name=</span><span class="s">&quot;ploneexample.portlet.Recent&quot;</span>
        <span class="na">interface=</span><span class="s">&quot;.recent.IRecentPortlet&quot;</span>
        <span class="na">assignment=</span><span class="s">&quot;.recent.Assignment&quot;</span>
        <span class="na">renderer=</span><span class="s">&quot;.recent.Renderer&quot;</span>
        <span class="na">addview=</span><span class="s">&quot;.recent.AddForm&quot;</span>
        <span class="na">editview=</span><span class="s">&quot;.recent.EditForm&quot;</span>
        <span class="nt">/&gt;</span>

<span class="nt">&lt;/configure&gt;</span>
</pre></div>
</div>
<p>Next, create the folder profiles/default and place a
<tt class="docutils literal"><span class="pre">portlets.xml</span></tt> file inside with the following content:</p>
<div class="highlight-xml"><pre>&lt;?xml version="1.0"?&gt;
&lt;portlets
    xmlns:i18n="http://xml.zope.org/namespaces/i18n"
    i18n:domain="plone"&gt;
  &lt;portlet
    addview="ploneexample.portlet.Recent"
    title="Recent items Example"
    description="An example portlet which can render a listing of recently changed items."
    i18n:attributes="title title_recent_portlet;
                     description description_recent_portlet"&gt;
    &lt;for interface="plone.app.portlets.interfaces.IColumn" /&gt;
    &lt;for interface="plone.app.portlets.interfaces.IDashboard" /&gt;
  &lt;/portlet&gt;
&lt;/portlets</pre>
</div>
<p>When this is run, it will create a local utility in the Plone site
of the <tt class="docutils literal"><span class="pre">IPortletType</span></tt>. This just holds some metadata about the
portlet for UI purposes.</p>
<p><tt class="docutils literal"><span class="pre">Title</span></tt> and <tt class="docutils literal"><span class="pre">description</span></tt> should be self-explanatory.</p>
<p>The <tt class="docutils literal"><span class="pre">addview</span></tt> is the name of the view used to add the portlet,
which helps the UI to invoke the right form when the user asks to
add the portlet. This should match the portlet name.</p>
<p><tt class="docutils literal"><span class="pre">for</span></tt> is an interface or list of interfaces that describe the
type of portlet managers that this portlet is suitable for. This
means that we can install a portlet that's suitable for the
dashboard, say, but not for the general columns. In this case,
we're making the portlet suitable for the dashboard and for any
(either left or right) column. Current portlet manager interfaces
include <tt class="docutils literal"><span class="pre">IColumn</span></tt>, <tt class="docutils literal"><span class="pre">ILeftColumn</span></tt>, <tt class="docutils literal"><span class="pre">IRightColumn</span></tt> and
<tt class="docutils literal"><span class="pre">IDashboard</span></tt>, all of them defined inside the plone.app.portlets
package.</p>
<p>Again, this is primarily about helping the UI construct appropriate
menus.</p>
</div>
</div>

  </div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
<p class="logo"><a href="../index.html"><img src="../_static/plone-icon-64.png" />
</a></p>

  <h3><a href="../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Basic plone.portlets architecture</a><ul>
<li><a class="reference internal" href="#the-use-case">The use case</a></li>
<li><a class="reference internal" href="#the-configuration-data">The configuration data</a></li>
<li><a class="reference internal" href="#the-add-and-edit-forms">The add and edit forms</a></li>
<li><a class="reference internal" href="#the-portlet-presentation">The portlet presentation</a></li>
<li><a class="reference internal" href="#registering-the-portlet">Registering the portlet</a></li>
<li><a class="reference internal" href="#installing-the-portlet">Installing the portlet</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="whats_a_portlet.html"
                        title="previous chapter">What's a Portlet?</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="testing.html"
                        title="next chapter">Testing the portlet</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="../_sources/portlets/architecture.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" size="18" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="testing.html" title="Testing the portlet"
             >next</a> |</li>
        <li class="right" >
          <a href="whats_a_portlet.html" title="What&#39;s a Portlet?"
             >previous</a> |</li>
        <li><a href="../index.html">Plone Community Managed Developer Manual v1.0 documentation</a> &raquo;</li>
          <li><a href="index.html" >Portlets</a> &raquo;</li> 
      </ul>
    </div>

    <div class="footer">
        &copy; Copyright 2010 mFabrik Research Oy and Plone community contributors.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.0.4.
    </div>


  </body>
</html>