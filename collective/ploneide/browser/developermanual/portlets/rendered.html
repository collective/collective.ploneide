<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>How are portlets rendered? &mdash; Plone Community Managed Developer Manual v1.0 documentation</title>
    <link rel="stylesheet" href="../_static/plone.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '1.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="top" title="Plone Community Managed Developer Manual v1.0 documentation" href="../index.html" />
    <link rel="up" title="Portlets" href="index.html" />
    <link rel="next" title="Order and blacklisting" href="blacklisting.html" />
    <link rel="prev" title="How and where are Portlet Assignments stored?" href="assignments.html" />
<script language="javascript">
//<![CDATA[

Documentation.addTranslations({"locale": "fr", "plural_expr": "(n > 1)", "messages": {"See the definition": "Voir la d\u00e9finition"}});

// See http://disqus.disqus.com/general_integration_help/
var disqus_developer = 1;
if (document.location.protocol == 'http:') {
    disqus_developer = 0;
}

// Some HTML/CSS transforms we can't do in pure CSS (waiting for CSS3 support)
$(document).ready(function () {

    // Style of .. verisonmodified:: , .. versionadded:: ...
    $('p:has(span.versionmodified)').addClass('p-versionmodified');

    // Style of the TOC tree
    $('ul:has(li.toctree-l1)').addClass('toctree');

    // Decorate links to other sites
    $('a[class~=external]').attr('target', '_blank');

    // Glossary terms
    $('em.xref').attr('title', _('See the definition'));

    // We need to have all <pre> in a <div class="highlight"> to mimic pygments
    // to work around a pygments (?) bug
    var suffixes = {cfg: null, python:null};
    for (var suffix in suffixes) {
        var pattern = 'div.highlight-' + suffix + ' > pre';
        $(pattern).wrap('<div class="highlight" />');
    }
    return true;
});
//]]>
</script>

  </head>
  <body>
<!--[if lte IE 6]>
<style type="text/css">
#ie6msg{border:3px solid #090; margin:8px 0; background:#cfc; color:#000;}
#ie6msg h4{margin:8px; padding:0;}
#ie6msg p{margin:8px; padding:0;}
#ie6msg p a.getie8{font-weight:bold; color:#006;}
#ie6msg p a.ie6expl{font-weight:normal; color:#006;}
</style>
<div id="ie6msg">
<h4>Did you know that your browser is out of date?</h4>
<p>If the layout of this site seems ugly, that's because you're actually using
an outdated browser. And we wont put any effort to provide a nice layout to IE6
users.</p>
<p>To get the best possible experience using our website we recommend that you
upgrade your browser to a newer version. The current version
is <a class="getie8"
href="http://upgradeie.s3.amazonaws.com/eng/index.html">Internet Explorer
8</a>. The upgrade is free. If you're using a PC at work you should contact your
IT administrator.</p>
<p>If you want to you may also try some other popular Internet browsers
like <a class="ie6expl"
href="http://getfirefox.com">Firefox</a>, <a class="ie6expl"
href="http://www.google.com/chrome">Chrome</a>, <a class="ie6expl"
href="http://www.opera.com">Opera</a>, or <a class="ie6expl"
href="http://www.apple.com/safari/download/">Safari</a></p>
</div>
<![endif]-->

    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="blacklisting.html" title="Order and blacklisting"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="assignments.html" title="How and where are Portlet Assignments stored?"
             accesskey="P">previous</a> |</li>
        <li><a href="../index.html">Plone Community Managed Developer Manual v1.0 documentation</a> &raquo;</li>
          <li><a href="index.html" accesskey="U">Portlets</a> &raquo;</li> 
      </ul>
    </div>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="sphinx-content">
    <div class="section" id="how-are-portlets-rendered">
<h1>How are portlets rendered?<a class="headerlink" href="#how-are-portlets-rendered" title="Permalink to this headline">Â¶</a></h1>
<div class="admonition-description admonition ">
<p class="first admonition-title">Description</p>
<p class="last">The process to find, update and render portlets from
the main views is rather complex. Here we describe
how does it all work, step by step.</p>
</div>
<p>Portlets are always rendered inside a portlet manager. From a
template, we can ask a portlet manager to render itself and all its
portlets. This is achieved using a <em>zope.contentprovider</em>
'provider:' expression. In Plone's <em>main_template</em>, for example,
you will find:</p>
<div class="highlight-xml"><div class="highlight"><pre><span class="nt">&lt;tal:block</span> <span class="na">replace=</span><span class="s">&quot;structure provider:plone.leftcolumn&quot;</span> <span class="nt">/&gt;</span>
</pre></div>
</div>
<p>Behind the scenes, this will look up a local adapter on (context,
request, view) with name <tt class="docutils literal"><span class="pre">plone.leftcolumn</span></tt> (this is just how the
provider expression works).</p>
<p>As it happens, this local adapter factory was registered when the
portlet manager was installed (via <tt class="docutils literal"><span class="pre">portlets.xml</span></tt>), and is a
callable that returns an <tt class="docutils literal"><span class="pre">IPortletManagerRenderer</span></tt>. The portlet
manager renderer is the &quot;view&quot; of the portlet manager.</p>
<p>The default implementation will simply output each portlet wrapped
in a div tag with some helpful attributes to support AJAX via KSS.
You can of course register your own portlet manager renderers. A
portlet manager renderer is a multi-adapter on (context, request,
view, manager). The <tt class="docutils literal"><span class="pre">&#64;&#64;manage-portlets</span></tt> view, for example, relies
on a portlet manager renderer override for this particular view
that renders the add/move/delete operations. For most people, the
standard renderer will suffice, though.</p>
<p>The portlet manager renderer asks an <tt class="docutils literal"><span class="pre">IPortletRetriever</span></tt> to fetch
and order the portlet assignments that it should render. This is a
multi-adapter on (context, manager), which means that the fetch
algorithm can be overridden either based on the type of content
object being viewed, or the particular manager. There are two
default implementations - one for &quot;placeful&quot; portlet managers
(those which know about contextual portlets, such as the standard
left/right column ones) and one for &quot;placeless&quot; ones that only deal
in global categories. This latter retriever is used by the
dashboard, which stores its portlets in a global &quot;user&quot; category.</p>
<p>The <tt class="docutils literal"><span class="pre">IPortletRetriever</span></tt> algorithm is reasonably complex,
especially when contextual blacklisting/blocking is taken into
account (see below). To make it possible to re-use this algorithm
across multiple configurations, it is written in terms of an
<tt class="docutils literal"><span class="pre">IPortletContext</span></tt>. The context content object will be adapted to
this interface. The portlet context provides:</p>
<ul class="simple">
<li>A universal identifier for the current context (usually just the
physical path) - the <tt class="docutils literal"><span class="pre">uid</span></tt> property.</li>
<li>A way to obtain the parent object of the current context (for
acquiring portlets and blacklist information in a placeful
retriever) - the <tt class="docutils literal"><span class="pre">getParent()</span></tt> method.</li>
<li>A list of global portlet categories to look up, and the keys to
look under (obtainable by using the <tt class="docutils literal"><span class="pre">globalPortletCategories()</span></tt>
method on the adapted context).</li>
</ul>
<p>The last parameter is best described by an example. Let's say we're
logged in as &quot;testuser&quot;, a member of both the &quot;Administrators&quot; and
&quot;Reviewers&quot; groups, and were looking at a Folder. The return value
of <tt class="docutils literal"><span class="pre">globalPortletCategories()</span></tt> would then be:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">portlet_context</span><span class="o">.</span><span class="n">globalPortletCategories</span><span class="p">()</span>
<span class="go">[(&quot;content_type&quot;, &quot;Folder&quot;,),</span>
<span class="go"> (&quot;group&quot;, &quot;Administrators&quot;,),</span>
<span class="go"> (&quot;group&quot;, &quot;Reviewers&quot;,),</span>
<span class="go"> (&quot;user&quot;, &quot;testuser&quot;,)]</span>
</pre></div>
</div>
<p>This informs the retriever that it should first look up any
portlets in the current portlet manager in the &quot;content_type&quot;
category under the &quot;Folder&quot; key, and then portlets in the &quot;group&quot;
category under the &quot;Administators&quot; and &quot;Reviewers&quot; key, and finally
portlets in the &quot;user&quot; category under the &quot;testuser&quot; key, all in
that order. Thus, if we wanted to add a new category, or change the
order of categories, we could override the <tt class="docutils literal"><span class="pre">IPortletContext</span></tt>,
either everywhere or just for one particular type of context.</p>
<p>Once the <tt class="docutils literal"><span class="pre">IPortletRetriever</span></tt> has retrieved the assignments that
should be shown for the current portlet manager, the portlet
manager renderer will look up the portlet renderer for each
assignment, ensure that it should indeed be rendered by checking
its <tt class="docutils literal"><span class="pre">available</span></tt> property, and finally call <tt class="docutils literal"><span class="pre">update()</span></tt> and
<tt class="docutils literal"><span class="pre">render()</span></tt>, placing the output in the reponse.</p>
</div>

  </div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
<p class="logo"><a href="../index.html"><img src="../_static/plone-icon-64.png" />
</a></p>

  <h4>Previous topic</h4>
  <p class="topless"><a href="assignments.html"
                        title="previous chapter">How and where are Portlet Assignments stored?</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="blacklisting.html"
                        title="next chapter">Order and blacklisting</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="../_sources/portlets/rendered.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" size="18" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="blacklisting.html" title="Order and blacklisting"
             >next</a> |</li>
        <li class="right" >
          <a href="assignments.html" title="How and where are Portlet Assignments stored?"
             >previous</a> |</li>
        <li><a href="../index.html">Plone Community Managed Developer Manual v1.0 documentation</a> &raquo;</li>
          <li><a href="index.html" >Portlets</a> &raquo;</li> 
      </ul>
    </div>

    <div class="footer">
        &copy; Copyright 2010 mFabrik Research Oy and Plone community contributors.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.0.4.
    </div>


  </body>
</html>