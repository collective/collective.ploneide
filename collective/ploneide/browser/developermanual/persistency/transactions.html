<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Transactions &mdash; Plone Community Managed Developer Manual v1.0 documentation</title>
    <link rel="stylesheet" href="../_static/plone.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '1.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="top" title="Plone Community Managed Developer Manual v1.0 documentation" href="../index.html" />
    <link rel="up" title="Persistency and transactions" href="index.html" />
    <link rel="next" title="Object lifecycles" href="lifecycle.html" />
    <link rel="prev" title="Persistent objects" href="persistent.html" />
<script language="javascript">
//<![CDATA[

Documentation.addTranslations({"locale": "fr", "plural_expr": "(n > 1)", "messages": {"See the definition": "Voir la d\u00e9finition"}});

// See http://disqus.disqus.com/general_integration_help/
var disqus_developer = 1;
if (document.location.protocol == 'http:') {
    disqus_developer = 0;
}

// Some HTML/CSS transforms we can't do in pure CSS (waiting for CSS3 support)
$(document).ready(function () {

    // Style of .. verisonmodified:: , .. versionadded:: ...
    $('p:has(span.versionmodified)').addClass('p-versionmodified');

    // Style of the TOC tree
    $('ul:has(li.toctree-l1)').addClass('toctree');

    // Decorate links to other sites
    $('a[class~=external]').attr('target', '_blank');

    // Glossary terms
    $('em.xref').attr('title', _('See the definition'));

    // We need to have all <pre> in a <div class="highlight"> to mimic pygments
    // to work around a pygments (?) bug
    var suffixes = {cfg: null, python:null};
    for (var suffix in suffixes) {
        var pattern = 'div.highlight-' + suffix + ' > pre';
        $(pattern).wrap('<div class="highlight" />');
    }
    return true;
});
//]]>
</script>

  </head>
  <body>
<!--[if lte IE 6]>
<style type="text/css">
#ie6msg{border:3px solid #090; margin:8px 0; background:#cfc; color:#000;}
#ie6msg h4{margin:8px; padding:0;}
#ie6msg p{margin:8px; padding:0;}
#ie6msg p a.getie8{font-weight:bold; color:#006;}
#ie6msg p a.ie6expl{font-weight:normal; color:#006;}
</style>
<div id="ie6msg">
<h4>Did you know that your browser is out of date?</h4>
<p>If the layout of this site seems ugly, that's because you're actually using
an outdated browser. And we wont put any effort to provide a nice layout to IE6
users.</p>
<p>To get the best possible experience using our website we recommend that you
upgrade your browser to a newer version. The current version
is <a class="getie8"
href="http://upgradeie.s3.amazonaws.com/eng/index.html">Internet Explorer
8</a>. The upgrade is free. If you're using a PC at work you should contact your
IT administrator.</p>
<p>If you want to you may also try some other popular Internet browsers
like <a class="ie6expl"
href="http://getfirefox.com">Firefox</a>, <a class="ie6expl"
href="http://www.google.com/chrome">Chrome</a>, <a class="ie6expl"
href="http://www.opera.com">Opera</a>, or <a class="ie6expl"
href="http://www.apple.com/safari/download/">Safari</a></p>
</div>
<![endif]-->

    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="lifecycle.html" title="Object lifecycles"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="persistent.html" title="Persistent objects"
             accesskey="P">previous</a> |</li>
        <li><a href="../index.html">Plone Community Managed Developer Manual v1.0 documentation</a> &raquo;</li>
          <li><a href="index.html" accesskey="U">Persistency and transactions</a> &raquo;</li> 
      </ul>
    </div>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="sphinx-content">
    <div class="section" id="transactions">
<h1>Transactions<a class="headerlink" href="#transactions" title="Permalink to this headline">¶</a></h1>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><a class="reference internal" href="#introduction" id="id1">Introduction</a></li>
<li><a class="reference internal" href="#using-transactions" id="id2">Using transactions</a><ul>
<li><a class="reference internal" href="#subtransactions" id="id3">Subtransactions</a></li>
</ul>
</li>
<li><a class="reference internal" href="#transaction-boundary-events" id="id4">Transaction boundary events</a></li>
<li><a class="reference internal" href="#viewing-transaction-content-and-debugging-transactions" id="id5">Viewing transaction content and debugging transactions</a></li>
</ul>
</div>
<div class="section" id="introduction">
<h2><a class="toc-backref" href="#id1">Introduction</a><a class="headerlink" href="#introduction" title="Permalink to this headline">¶</a></h2>
<p>Plone uses <cite>ZODB database &lt;http://en.wikipedia.org/wiki/Zope_Object_database&gt;</cite> which follows
<a class="reference external" href="http://en.wikipedia.org/wiki/Multiversion_concurrency_control">Multiversion concurrency control pararigm</a>.</p>
<p>During the HTTP request process, Plone completes all modifications of the data or
none of them. There cannot end partially written data to database.</p>
<p>Plone and the underlying Zope handles transactions transparently.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Every transaction is read transaction until some of the
objects participating in the transaction is being mutated
(object attribute set), turning the transaction to a write transaction</p>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Old examples might refer to get_transaction() function. This has been
replaced by transaction.get() in the later Zope versions.</p>
</div>
<p>Please read <a class="reference external" href="http://www.zope.org/Members/mcdonc/HowTos/transaction">this Zope transaction tutorial</a>
to get started how to use transaction with your code.</p>
<ul class="simple">
<li><a class="reference external" href="https://bugs.launchpad.net/zope2/+bug/143584">https://bugs.launchpad.net/zope2/+bug/143584</a></li>
</ul>
</div>
<div class="section" id="using-transactions">
<h2><a class="toc-backref" href="#id2">Using transactions</a><a class="headerlink" href="#using-transactions" title="Permalink to this headline">¶</a></h2>
<p>Normally transactions are managed by Plone and the developer should not be interested in them.</p>
<p>Special cases where one would want to manage transaction life-cycle may include</p>
<ul class="simple">
<li>Batch creation or editing of many items once</li>
</ul>
<p>Example code</p>
<ul class="simple">
<li><a class="reference external" href="http://svn.zope.org/transaction/trunk/transaction/?rev=104430">transaction source code</a>.</li>
<li><a class="reference external" href="http://www.zope.org/Members/mcdonc/HowTos/transaction">http://www.zope.org/Members/mcdonc/HowTos/transaction</a></li>
<li><a class="reference external" href="https://bugs.launchpad.net/zope3/+bug/98382">https://bugs.launchpad.net/zope3/+bug/98382</a></li>
</ul>
<div class="section" id="subtransactions">
<h3><a class="toc-backref" href="#id3">Subtransactions</a><a class="headerlink" href="#subtransactions" title="Permalink to this headline">¶</a></h3>
<p>Normally, a Zope transaction keeps a list of objects modified within the transaction in a structure in RAM.
This list of objects can grow quite large when there is a lot of work done across a lot of objects in the context of a transaction. Subtransactions write portions of this object list out to disk, freeing the RAM required by the transaction list. Using subtransactions can allow you to build transactions
involving objects whose combined size is larger than available RAM.</p>
<p>Example:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">transaction</span>

<span class="o">...</span>

<span class="n">done</span> <span class="o">=</span> <span class="mi">0</span>

<span class="k">for</span> <span class="n">brain</span> <span class="ow">in</span> <span class="n">all_images</span><span class="p">:</span>

    <span class="n">done</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="o">...</span>

    <span class="c"># Since this is HUGE operation (think resizing 2 GB images)</span>
    <span class="c"># it is not nice idea to buffer the transaction (all changed data) in the memory</span>
    <span class="c"># (Zope default transaction behavior).</span>
    <span class="c"># Using subtransactions we hint Zope when it would be a good time to flush the</span>
    <span class="c"># changes to the disk.</span>
    <span class="k">if</span> <span class="n">done</span> <span class="o">%</span> <span class="mi">10</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="c"># Commit subtransaction for every 10th processed item</span>
        <span class="n">transaction</span><span class="o">.</span><span class="n">get</span><span class="p">()</span><span class="o">.</span><span class="n">commit</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="transaction-boundary-events">
<h2><a class="toc-backref" href="#id4">Transaction boundary events</a><a class="headerlink" href="#transaction-boundary-events" title="Permalink to this headline">¶</a></h2>
<p>It is possible to perform actions before and after transaction is written to the database.</p>
<p><a class="reference external" href="http://svn.zope.org/transaction/trunk/transaction/_transaction.py?rev=81646&amp;view=auto">http://svn.zope.org/transaction/trunk/transaction/_transaction.py?rev=81646&amp;view=auto</a></p>
</div>
<div class="section" id="viewing-transaction-content-and-debugging-transactions">
<h2><a class="toc-backref" href="#id5">Viewing transaction content and debugging transactions</a><a class="headerlink" href="#viewing-transaction-content-and-debugging-transactions" title="Permalink to this headline">¶</a></h2>
<p>Please see <a class="reference internal" href="../troubleshooting/transactions.html"><em>Transaction troubleshooting</em></a></p>
</div>
</div>

  </div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
<p class="logo"><a href="../index.html"><img src="../_static/plone-icon-64.png" />
</a></p>

  <h3><a href="../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Transactions</a><ul>
<li><a class="reference internal" href="#introduction">Introduction</a></li>
<li><a class="reference internal" href="#using-transactions">Using transactions</a><ul>
<li><a class="reference internal" href="#subtransactions">Subtransactions</a></li>
</ul>
</li>
<li><a class="reference internal" href="#transaction-boundary-events">Transaction boundary events</a></li>
<li><a class="reference internal" href="#viewing-transaction-content-and-debugging-transactions">Viewing transaction content and debugging transactions</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="persistent.html"
                        title="previous chapter">Persistent objects</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="lifecycle.html"
                        title="next chapter">Object lifecycles</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="../_sources/persistency/transactions.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" size="18" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="lifecycle.html" title="Object lifecycles"
             >next</a> |</li>
        <li class="right" >
          <a href="persistent.html" title="Persistent objects"
             >previous</a> |</li>
        <li><a href="../index.html">Plone Community Managed Developer Manual v1.0 documentation</a> &raquo;</li>
          <li><a href="index.html" >Persistency and transactions</a> &raquo;</li> 
      </ul>
    </div>

    <div class="footer">
        &copy; Copyright 2010 mFabrik Research Oy and Plone community contributors.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.0.4.
    </div>


  </body>
</html>