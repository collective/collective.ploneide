<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Custom permissions &mdash; Plone Community Managed Developer Manual v1.0 documentation</title>
    <link rel="stylesheet" href="../_static/plone.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '1.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="top" title="Plone Community Managed Developer Manual v1.0 documentation" href="../index.html" />
    <link rel="up" title="Security" href="index.html" />
    <link rel="next" title="Securing your code" href="code.html" />
    <link rel="prev" title="Available permissions in Plone" href="permission_lists.html" />
<script language="javascript">
//<![CDATA[

Documentation.addTranslations({"locale": "fr", "plural_expr": "(n > 1)", "messages": {"See the definition": "Voir la d\u00e9finition"}});

// See http://disqus.disqus.com/general_integration_help/
var disqus_developer = 1;
if (document.location.protocol == 'http:') {
    disqus_developer = 0;
}

// Some HTML/CSS transforms we can't do in pure CSS (waiting for CSS3 support)
$(document).ready(function () {

    // Style of .. verisonmodified:: , .. versionadded:: ...
    $('p:has(span.versionmodified)').addClass('p-versionmodified');

    // Style of the TOC tree
    $('ul:has(li.toctree-l1)').addClass('toctree');

    // Decorate links to other sites
    $('a[class~=external]').attr('target', '_blank');

    // Glossary terms
    $('em.xref').attr('title', _('See the definition'));

    // We need to have all <pre> in a <div class="highlight"> to mimic pygments
    // to work around a pygments (?) bug
    var suffixes = {cfg: null, python:null};
    for (var suffix in suffixes) {
        var pattern = 'div.highlight-' + suffix + ' > pre';
        $(pattern).wrap('<div class="highlight" />');
    }
    return true;
});
//]]>
</script>

  </head>
  <body>
<!--[if lte IE 6]>
<style type="text/css">
#ie6msg{border:3px solid #090; margin:8px 0; background:#cfc; color:#000;}
#ie6msg h4{margin:8px; padding:0;}
#ie6msg p{margin:8px; padding:0;}
#ie6msg p a.getie8{font-weight:bold; color:#006;}
#ie6msg p a.ie6expl{font-weight:normal; color:#006;}
</style>
<div id="ie6msg">
<h4>Did you know that your browser is out of date?</h4>
<p>If the layout of this site seems ugly, that's because you're actually using
an outdated browser. And we wont put any effort to provide a nice layout to IE6
users.</p>
<p>To get the best possible experience using our website we recommend that you
upgrade your browser to a newer version. The current version
is <a class="getie8"
href="http://upgradeie.s3.amazonaws.com/eng/index.html">Internet Explorer
8</a>. The upgrade is free. If you're using a PC at work you should contact your
IT administrator.</p>
<p>If you want to you may also try some other popular Internet browsers
like <a class="ie6expl"
href="http://getfirefox.com">Firefox</a>, <a class="ie6expl"
href="http://www.google.com/chrome">Chrome</a>, <a class="ie6expl"
href="http://www.opera.com">Opera</a>, or <a class="ie6expl"
href="http://www.apple.com/safari/download/">Safari</a></p>
</div>
<![endif]-->

    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="code.html" title="Securing your code"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="permission_lists.html" title="Available permissions in Plone"
             accesskey="P">previous</a> |</li>
        <li><a href="../index.html">Plone Community Managed Developer Manual v1.0 documentation</a> &raquo;</li>
          <li><a href="index.html" accesskey="U">Security</a> &raquo;</li> 
      </ul>
    </div>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="sphinx-content">
    <div class="section" id="custom-permissions">
<h1>Custom permissions<a class="headerlink" href="#custom-permissions" title="Permalink to this headline">¶</a></h1>
<p>Creating special permissions for your product</p>
<div class="section" id="define-zope-2-permissions-in-python-code">
<h2>Define Zope 2 permissions in python code<a class="headerlink" href="#define-zope-2-permissions-in-python-code" title="Permalink to this headline">¶</a></h2>
<p>If you want to protect certain actions in your product by a special permission,
you most likely will want to assign this permission to a role when the product
is installed.  You will want to use Generic Setup's rolemap.xml to assign these
permissions.  A new permission will be added to the Zope instance by calling
setDefaultRoles on it.</p>
<p>However, at the time when Generic Setup is run, almost none of your code has
actually been run, so the permission doesn't exist yet.  That's why we define
the permissions in permissions.py, and call this from __init__.py:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c"># __init__.py:</span>

<span class="kn">import</span> <span class="nn">permissions</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="c"># permissions.py:</span>

<span class="kn">from</span> <span class="nn">Products.CMFCore</span> <span class="kn">import</span> <span class="n">permissions</span> <span class="k">as</span> <span class="n">CMFCorePermissions</span>
<span class="kn">from</span> <span class="nn">AccessControl.SecurityInfo</span> <span class="kn">import</span> <span class="n">ModuleSecurityInfo</span>
<span class="kn">from</span> <span class="nn">Products.CMFCore.permissions</span> <span class="kn">import</span> <span class="n">setDefaultRoles</span>

<span class="n">security</span> <span class="o">=</span> <span class="n">ModuleSecurityInfo</span><span class="p">(</span><span class="s">&#39;MyProduct&#39;</span><span class="p">)</span>
<span class="n">security</span><span class="o">.</span><span class="n">declarePublic</span><span class="p">(</span><span class="s">&#39;MyPermission&#39;</span><span class="p">)</span>
<span class="n">MyPermission</span> <span class="o">=</span> <span class="s">&#39;MyProduct: MyPermission&#39;</span>
<span class="n">setDefaultRoles</span><span class="p">(</span><span class="n">MyPermission</span><span class="p">,</span> <span class="p">())</span>
</pre></div>
</div>
<p>When working with permissions, always use the variable name instead of the
string value.  This ensures that you can't make typos with the string value,
which are hard to debug.  If you do make a typo in the variable name, you'll
get an ImportError or NameError.</p>
</div>
<div class="section" id="make-the-permissions-available-as-a-zope-3-permissions">
<h2>Make the permissions available as a Zope 3 permissions<a class="headerlink" href="#make-the-permissions-available-as-a-zope-3-permissions" title="Permalink to this headline">¶</a></h2>
<p>To use your permissions with BrowserViews/formlib/z3c.form, you need
to make them available available as Zope 3 permissions. This is done
in ZCML using a the &lt;permission&gt; directive. Example configure.zcml:</p>
<div class="highlight-xml"><div class="highlight"><pre><span class="nt">&lt;configure</span>
  <span class="na">xmlns=</span><span class="s">&quot;http://namespaces.zope.org/zope&quot;</span><span class="nt">&gt;</span>

  <span class="nt">&lt;permission</span>
    <span class="na">id=</span><span class="s">&quot;myproduct.mypermission&quot;</span>
    <span class="na">title=</span><span class="s">&quot;MyProduct: MyPermission&quot;</span>
    <span class="nt">/&gt;</span>

<span class="nt">&lt;/configure&gt;</span>
</pre></div>
</div>
<p>It's convention to prefix the permission id with the nmame of the
package it's defined in and use lower case only. You have to take care
that the title matches exactly the permission string you used in
permissions.py. Otherwise a different, zope 3 only, permission is
registered.</p>
<p>You can use the permission to e.g. protect BrowserViews. Example
configure.zcml:</p>
<div class="highlight-xml"><div class="highlight"><pre><span class="nt">&lt;configure</span>
  <span class="na">xmlns=</span><span class="s">&quot;http://namespaces.zope.org/zope&quot;</span>
  <span class="na">xmlns:browser=</span><span class="s">&quot;http://namespaces.zope.org/browser&quot;</span><span class="nt">&gt;</span>

  <span class="nt">&lt;permission</span>
    <span class="na">id=</span><span class="s">&quot;myproduct.mypermission&quot;</span>
    <span class="na">title=</span><span class="s">&quot;MyProduct: MyPermission&quot;</span> <span class="nt">/&gt;</span>

  <span class="nt">&lt;browser:page</span>
    <span class="na">for=</span><span class="s">&quot;*&quot;</span>
    <span class="na">name=</span><span class="s">&quot;myexampleview&quot;</span>
    <span class="na">class=</span><span class="s">&quot;browser.MyExampleView&quot;</span>
    <span class="na">permission=</span><span class="s">&quot;myproduct.mypermission&quot;</span>
    <span class="nt">/&gt;</span>

<span class="nt">&lt;/configure&gt;</span>
</pre></div>
</div>
</div>
<div class="section" id="define-both-zope-2-and-zope3-permissions-in-one-step-in-zcml">
<h2>Define both Zope 2 and Zope3 permissions in one Step in ZCML<a class="headerlink" href="#define-both-zope-2-and-zope3-permissions-in-one-step-in-zcml" title="Permalink to this headline">¶</a></h2>
<p>You can use <cite>collective.autopermission
&lt;http://pypi.python.org/pypi/collective.autopermission/1.0b1&gt;</cite>
(<cite>svn repository
&lt;http://svn.plone.org/svn/collective/collective.autopermission&gt;</cite>)
and define both the Zope 2 and Zope 3 permission at once with the
&lt;permission&gt; zcml-directive. To do that install
collective.autopermission. Either add &quot;collective.autopermission&quot; to
&quot;install_requires&quot; in setup.py or to your buildout. Then include
collective.autopermission's configure.zcml <em>before</em> you define the
permissions <em>and</em> before you use them.  (collective.autopermission is
not required in Zope 2.12/Plone 4 anymore!)</p>
<div class="highlight-xml"><div class="highlight"><pre><span class="nt">&lt;configure</span>
  <span class="na">xmlns=</span><span class="s">&quot;http://namespaces.zope.org/zope&quot;</span>
  <span class="na">xmlns:browser=</span><span class="s">&quot;http://namespaces.zope.org/browser&quot;</span><span class="nt">&gt;</span>

  <span class="nt">&lt;include</span> <span class="na">package=</span><span class="s">&quot;collective.autopermission&quot;</span> <span class="nt">/&gt;</span>

  <span class="nt">&lt;permission</span>
    <span class="na">id=</span><span class="s">&quot;myproduct.mypermission&quot;</span>
    <span class="na">title=</span><span class="s">&quot;MyProduct: MyPermission&quot;</span>
    <span class="nt">/&gt;</span>

  <span class="nt">&lt;browser:page</span>
    <span class="na">for=</span><span class="s">&quot;*&quot;</span>
    <span class="na">name=</span><span class="s">&quot;myexampleview&quot;</span>
    <span class="na">class=</span><span class="s">&quot;browser.MyExampleView&quot;</span>
    <span class="na">permission=</span><span class="s">&quot;myproduct.mypermission&quot;</span>
    <span class="nt">/&gt;</span>

<span class="nt">&lt;/configure&gt;</span>
</pre></div>
</div>
<p>Now you can use the permission both as a Zope 2 permission <em>('MyProduct:
MyPermission')</em> or a Zope 3 permission <em>('myproduct.mypermission')</em>. The
only disadvantage is that you can't import the permissionstring as a
variable from permissions.py.</p>
</div>
</div>

  </div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
<p class="logo"><a href="../index.html"><img src="../_static/plone-icon-64.png" />
</a></p>

  <h3><a href="../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Custom permissions</a><ul>
<li><a class="reference internal" href="#define-zope-2-permissions-in-python-code">Define Zope 2 permissions in python code</a></li>
<li><a class="reference internal" href="#make-the-permissions-available-as-a-zope-3-permissions">Make the permissions available as a Zope 3 permissions</a></li>
<li><a class="reference internal" href="#define-both-zope-2-and-zope3-permissions-in-one-step-in-zcml">Define both Zope 2 and Zope3 permissions in one Step in ZCML</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="permission_lists.html"
                        title="previous chapter">Available permissions in Plone</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="code.html"
                        title="next chapter">Securing your code</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="../_sources/security/custom_permissions.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" size="18" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="code.html" title="Securing your code"
             >next</a> |</li>
        <li class="right" >
          <a href="permission_lists.html" title="Available permissions in Plone"
             >previous</a> |</li>
        <li><a href="../index.html">Plone Community Managed Developer Manual v1.0 documentation</a> &raquo;</li>
          <li><a href="index.html" >Security</a> &raquo;</li> 
      </ul>
    </div>

    <div class="footer">
        &copy; Copyright 2010 mFabrik Research Oy and Plone community contributors.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.0.4.
    </div>


  </body>
</html>