<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>z3c.form &mdash; Plone Community Managed Developer Manual v1.0 documentation</title>
    <link rel="stylesheet" href="../_static/plone.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '1.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="top" title="Plone Community Managed Developer Manual v1.0 documentation" href="../index.html" />
    <link rel="up" title="Forms, fields and widgets" href="index.html" />
    <link rel="next" title="Files" href="files.html" />
    <link rel="prev" title="Manual form processing" href="manual.html" />
<script language="javascript">
//<![CDATA[

Documentation.addTranslations({"locale": "fr", "plural_expr": "(n > 1)", "messages": {"See the definition": "Voir la d\u00e9finition"}});

// See http://disqus.disqus.com/general_integration_help/
var disqus_developer = 1;
if (document.location.protocol == 'http:') {
    disqus_developer = 0;
}

// Some HTML/CSS transforms we can't do in pure CSS (waiting for CSS3 support)
$(document).ready(function () {

    // Style of .. verisonmodified:: , .. versionadded:: ...
    $('p:has(span.versionmodified)').addClass('p-versionmodified');

    // Style of the TOC tree
    $('ul:has(li.toctree-l1)').addClass('toctree');

    // Decorate links to other sites
    $('a[class~=external]').attr('target', '_blank');

    // Glossary terms
    $('em.xref').attr('title', _('See the definition'));

    // We need to have all <pre> in a <div class="highlight"> to mimic pygments
    // to work around a pygments (?) bug
    var suffixes = {cfg: null, python:null};
    for (var suffix in suffixes) {
        var pattern = 'div.highlight-' + suffix + ' > pre';
        $(pattern).wrap('<div class="highlight" />');
    }
    return true;
});
//]]>
</script>

  </head>
  <body>
<!--[if lte IE 6]>
<style type="text/css">
#ie6msg{border:3px solid #090; margin:8px 0; background:#cfc; color:#000;}
#ie6msg h4{margin:8px; padding:0;}
#ie6msg p{margin:8px; padding:0;}
#ie6msg p a.getie8{font-weight:bold; color:#006;}
#ie6msg p a.ie6expl{font-weight:normal; color:#006;}
</style>
<div id="ie6msg">
<h4>Did you know that your browser is out of date?</h4>
<p>If the layout of this site seems ugly, that's because you're actually using
an outdated browser. And we wont put any effort to provide a nice layout to IE6
users.</p>
<p>To get the best possible experience using our website we recommend that you
upgrade your browser to a newer version. The current version
is <a class="getie8"
href="http://upgradeie.s3.amazonaws.com/eng/index.html">Internet Explorer
8</a>. The upgrade is free. If you're using a PC at work you should contact your
IT administrator.</p>
<p>If you want to you may also try some other popular Internet browsers
like <a class="ie6expl"
href="http://getfirefox.com">Firefox</a>, <a class="ie6expl"
href="http://www.google.com/chrome">Chrome</a>, <a class="ie6expl"
href="http://www.opera.com">Opera</a>, or <a class="ie6expl"
href="http://www.apple.com/safari/download/">Safari</a></p>
</div>
<![endif]-->

    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="files.html" title="Files"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="manual.html" title="Manual form processing"
             accesskey="P">previous</a> |</li>
        <li><a href="../index.html">Plone Community Managed Developer Manual v1.0 documentation</a> &raquo;</li>
          <li><a href="index.html" accesskey="U">Forms, fields and widgets</a> &raquo;</li> 
      </ul>
    </div>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="sphinx-content">
    <div class="section" id="z3c-form">
<h1>z3c.form<a class="headerlink" href="#z3c-form" title="Permalink to this headline">¶</a></h1>
<div class="admonition-description admonition ">
<p class="first admonition-title">Description</p>
<p class="last">z3c.form is modern, flexible, form library for web frameworks.
A Plone specific implementation, plone.app.z3cform exists.
This document will give you pointers how to use z3c.form
to build your web forms programmaticaly.</p>
</div>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><a class="reference internal" href="#introduction" id="id7">Introduction</a></li>
<li><a class="reference internal" href="#z3c-form-big-picture" id="id8">z3c.form big picture</a></li>
<li><a class="reference internal" href="#form" id="id9">Form</a><ul>
<li><a class="reference internal" href="#setting-form-status-message" id="id10">Setting form status message</a></li>
<li><a class="reference internal" href="#emulating-form-http-post-in-unit-tests" id="id11">Emulating form HTTP POST in unit tests</a></li>
<li><a class="reference internal" href="#customizing-form-template" id="id12">Customizing form template</a></li>
<li><a class="reference internal" href="#customizing-form-frame" id="id13">Customizing form frame</a></li>
</ul>
</li>
<li><a class="reference internal" href="#fields" id="id14">Fields</a><ul>
<li><a class="reference internal" href="#creating-a-field" id="id15">Creating a field</a></li>
<li><a class="reference internal" href="#adding-a-field-to-a-form" id="id16">Adding a field to a form</a></li>
<li><a class="reference internal" href="#modifying-a-field" id="id17">Modifying a field</a></li>
<li><a class="reference internal" href="#accesing-schema-of-the-field" id="id18">Accesing schema of the field</a></li>
<li><a class="reference internal" href="#read-only-fields" id="id19">Read-only fields</a></li>
<li><a class="reference internal" href="#dynamic-schemas" id="id20">Dynamic schemas</a></li>
</ul>
</li>
<li><a class="reference internal" href="#widgets" id="id21">Widgets</a><ul>
<li><a class="reference internal" href="#accessing-a-widget" id="id22">Accessing a widget</a></li>
<li><a class="reference internal" href="#introspecting-form-widgets" id="id23">Introspecting form widgets</a></li>
<li><a class="reference internal" href="#reordering-and-hiding-widgets" id="id24">Reordering and hiding widgets</a></li>
<li><a class="reference internal" href="#modifying-a-widget" id="id25">Modifying a widget</a></li>
<li><a class="reference internal" href="#reorder-form-widgets" id="id26">Reorder form widgets</a><ul>
<li><a class="reference internal" href="#making-widgets-required-conditionally" id="id27">Making widgets required conditionally</a></li>
</ul>
</li>
<li><a class="reference internal" href="#setting-widget-types" id="id28">Setting widget types</a></li>
<li><a class="reference internal" href="#widget-save" id="id29">Widget save</a></li>
<li><a class="reference internal" href="#widget-value" id="id30">Widget value</a></li>
<li><a class="reference internal" href="#adding-a-css-class" id="id31">Adding a CSS class</a></li>
<li><a class="reference internal" href="#id2" id="id32">Accesing schema of the field</a></li>
<li><a class="reference internal" href="#getting-selection-widget-vocabulary-value-as-human-readable-text" id="id33">Getting selection widget vocabulary value as human readable text</a></li>
<li><a class="reference internal" href="#setting-widget-templates" id="id34">Setting widget templates</a></li>
</ul>
</li>
<li><a class="reference internal" href="#setting-the-template-of-an-individual-widget" id="id35">Setting the template of an individual widget</a></li>
<li><a class="reference internal" href="#setting-template-for-your-own-widget-type" id="id36">Setting template for your own widget type</a></li>
<li><a class="reference internal" href="#buttons" id="id37">Buttons</a><ul>
<li><a class="reference internal" href="#adding-a-button-to-form" id="id38">Adding a button to form</a></li>
<li><a class="reference internal" href="#manipulating-form-buttons-programmatically" id="id39">Manipulating form buttons programmatically</a><ul>
<li><a class="reference internal" href="#reading-buttons" id="id40">Reading buttons</a></li>
<li><a class="reference internal" href="#removing-or-hiding-buttons" id="id41">Removing or hiding buttons</a></li>
<li><a class="reference internal" href="#adding-buttons-dynamically" id="id42">Adding buttons dynamically</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#subforms" id="id43">Subforms</a><ul>
<li><a class="reference internal" href="#adding-an-action-to-parent-and-subform" id="id44">Adding an action to parent and subform</a></li>
</ul>
</li>
<li><a class="reference internal" href="#creating-subforms-run-time" id="id45">Creating subforms run-time</a></li>
<li><a class="reference internal" href="#crud-form" id="id46">CRUD form</a><ul>
<li><a class="reference internal" href="#examples" id="id47">Examples</a></li>
</ul>
</li>
<li><a class="reference internal" href="#displaying-the-status-message-in-a-non-standard-location" id="id48">Displaying the status message in a non-standard location</a></li>
<li><a class="reference internal" href="#storage-format-and-data-managers" id="id49">Storage format and data managers</a><ul>
<li><a class="reference internal" href="#custom-content-objects" id="id50">Custom content objects</a></li>
<li><a class="reference internal" href="#custom-change-applying" id="id51">Custom change applying</a></li>
</ul>
</li>
<li><a class="reference internal" href="#wysiwyg-widgets" id="id52">WYSIWYG widgets</a></li>
<li><a class="reference internal" href="#wrapped-and-non-wrapped-forms" id="id53">Wrapped and non-wrapped forms</a></li>
<li><a class="reference internal" href="#embedding-z3c-form-forms-in-portlets-viewlets-and-views" id="id54">Embedding z3c.form forms in portlets, viewlets and views</a><ul>
<li><a class="reference internal" href="#further-reading" id="id55">Further reading</a></li>
<li><a class="reference internal" href="#adding-validators" id="id56">Adding validators</a></li>
<li><a class="reference internal" href="#customizing-and-translating-error-messages" id="id57">Customizing and translating error messages</a></li>
<li><a class="reference internal" href="#read-only-and-disabled-fields" id="id58">Read-only and disabled fields</a></li>
</ul>
</li>
</ul>
</div>
<div class="section" id="introduction">
<h2><a class="toc-backref" href="#id7">Introduction</a><a class="headerlink" href="#introduction" title="Permalink to this headline">¶</a></h2>
<p><a class="reference external" href="http://pypi.python.org/pypi/z3c.form/">z3c.form</a> is generic, very flexible and very complex form library for Python.
<a class="reference external" href="http://pypi.python.org/pypi/plone.app.z3cform">plone.app.z3cform</a> and
<a class="reference external" href="http://pypi.python.org/pypi/plone.z3cform">plone.z3cform</a>
provide Plone adaptions of this library.</p>
<p>Read each package tutorials before proceeding.</p>
<ul class="simple">
<li><a class="reference external" href="http://maurits.vanrees.org/weblog/archive/2009/10/complex-forms-with-z3c.form">Rok Garbas talk in Ploneconf 2009</a></li>
<li><a class="reference external" href="http://n2.nabble.com/z3c-form-and-plone-z3cform-in-Plone-4-Zope-2-12-tp4449218p4449218.html">plone.z3cform and Plone 4</a></li>
<li><a class="reference external" href="http://svn.zope.org/plone.z3cform/trunk/plone/z3cform/">plone.z3cform source</a></li>
<li><a class="reference external" href="http://svn.plone.org/svn/plone/plone.app.z3cform/trunk/">plone.app.z3cform source</a>.</li>
<li><a class="reference external" href="http://svn.plone.org/svn/collective/">collective</a> has several components for z3c.form,
find by z3cform in their name.</li>
</ul>
</div>
<div class="section" id="z3c-form-big-picture">
<h2><a class="toc-backref" href="#id8">z3c.form big picture</a><a class="headerlink" href="#z3c-form-big-picture" title="Permalink to this headline">¶</a></h2>
<p>Form model consist of</p>
<ul class="simple">
<li>self.request - HTTP request coming in</li>
<li>self.context - The Plone content item which was associated with the form view when URL traversing was done</li>
<li>self.getContent() - The actual object extracted from context and manipulated by the form if ignoreContext is not False</li>
<li>self.status - A message displayed at the top of the form to the user when the form is rendered. Usually it will be &quot;Please correct the errors below&quot;.</li>
</ul>
<p>Form call chain goes like</p>
<ul>
<li><p class="first">Form.update() is called</p>
<blockquote>
<ul>
<li><p class="first">[plone.autoform based forms only]
Calls Form.updateFields() - this will set widget factory
methods for fields. If you want to customize the type
of the widget associated with the field do it here. If
your form is not plone.autoform based you need to
edit form.schema widget factories on the module level code
after the class has been constructed. The logic
mapping widget hints to widgets is in <tt class="docutils literal"><span class="pre">plone.autoform.utils</span></tt>.</p>
</li>
<li><p class="first">Calls Form.updateWidgets() - you can customize widgets in this
point if you override this method. self.widgets instance
is created based on self.fields property.</p>
</li>
<li><p class="first">Calls Form.updateActions()</p>
<blockquote>
<ul class="simple">
<li>Calls the action handler (button handler which was pressed)</li>
<li>If it's edit form, action handler calls applyChanges()
to store new values on the object and return True
if any value was changed.</li>
</ul>
</blockquote>
</li>
</ul>
</blockquote>
</li>
<li><p class="first">Form.render() is called</p>
<blockquote>
<ul class="simple">
<li>Outputs form HTML based on widgets and their templates</li>
</ul>
</blockquote>
</li>
</ul>
</div>
<div class="section" id="form">
<h2><a class="toc-backref" href="#id9">Form</a><a class="headerlink" href="#form" title="Permalink to this headline">¶</a></h2>
<div class="section" id="setting-form-status-message">
<h3><a class="toc-backref" href="#id10">Setting form status message</a><a class="headerlink" href="#setting-form-status-message" title="Permalink to this headline">¶</a></h3>
<p>Form global status message tells whether the form action succeeded or not.</p>
<p>Form status message will be rendered only on the form.
If you want to set a message which will be visible even if the user renders other page after form,
you need to use Products.statusmessage.</p>
<p>To set the form status message:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">form</span><span class="o">.</span><span class="n">status</span> <span class="o">=</span> <span class="s">u&quot;My message&quot;</span>
</pre></div>
</div>
</div>
<div class="section" id="emulating-form-http-post-in-unit-tests">
<h3><a class="toc-backref" href="#id11">Emulating form HTTP POST in unit tests</a><a class="headerlink" href="#emulating-form-http-post-in-unit-tests" title="Permalink to this headline">¶</a></h3>
<ul>
<li><p class="first">HTTP request must have field at least one of buttons filled</p>
</li>
<li><p class="first">Form widget naming must match HTTP post values. Usually widgets have <em>form.widgets</em> prefix.</p>
</li>
<li><dl class="first docutils">
<dt>You must emulate the ZPublisher behavior</dt>
<dd><p class="first last">which automatically converts string input to Python primitives.
For example, all choice/select values are Python lists.</p>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>Some z3c widgets, like &lt;select&gt;, need to have WIDGETNAME-empty-marker value set to</dt>
<dd><p class="first last">interger 1 to be processed</p>
</dd>
</dl>
</li>
<li><p class="first">Usually you can get the dummy HTTP request object via acquisition self.portal.REQUEST</p>
</li>
</ul>
<p>Example (incomplete):</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">layout</span> <span class="o">=</span> <span class="s">&quot;accommondationsummary_view&quot;</span>

<span class="c"># Zope publisher uses Python list to mark &lt;select&gt; values</span>
<span class="bp">self</span><span class="o">.</span><span class="n">portal</span><span class="o">.</span><span class="n">REQUEST</span><span class="p">[</span><span class="s">&quot;form.widgets.area&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">SAMPLE_AREA</span><span class="p">]</span>
<span class="bp">self</span><span class="o">.</span><span class="n">portal</span><span class="o">.</span><span class="n">REQUEST</span><span class="p">[</span><span class="s">&quot;form.buttons.search&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s">u&quot;Search&quot;</span>
<span class="n">view</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">portal</span><span class="o">.</span><span class="n">cards</span><span class="o">.</span><span class="n">restrictedTraverse</span><span class="p">(</span><span class="n">layout</span><span class="p">)</span>

<span class="c"># Call update() for form</span>
<span class="n">view</span><span class="o">.</span><span class="n">process_form</span><span class="p">()</span>
<span class="k">print</span> <span class="n">view</span><span class="o">.</span><span class="n">form</span><span class="o">.</span><span class="n">render</span><span class="p">()</span>

<span class="c"># Always check form errors after update()</span>
<span class="n">errors</span> <span class="o">=</span> <span class="n">view</span><span class="o">.</span><span class="n">errors</span>
<span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">errors</span><span class="p">),</span> <span class="mi">0</span><span class="p">,</span> <span class="s">&quot;Got errors:&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">errors</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="section" id="customizing-form-template">
<h3><a class="toc-backref" href="#id12">Customizing form template</a><a class="headerlink" href="#customizing-form-template" title="Permalink to this headline">¶</a></h3>
<p>If you want to change the page template producing <tt class="docutils literal"><span class="pre">&lt;form&gt;...&lt;/form&gt;</span></tt>
part of the HTML code, follow the instructions below.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Generally, when you have a template which extends Plone main_template
you need to use class from Products.Five.browser.pagetemplatefile.ViewPageTemplateFile.</p>
</div>
<p>Example:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c"># Do not mix with Products.Five.browser.pagetemplatefile.ViewPageTemplateFile</span>
<span class="kn">from</span> <span class="nn">zope.app.pagetemplate</span> <span class="kn">import</span> <span class="n">ViewPageTemplateFile</span> <span class="k">as</span> <span class="n">Zope3PageTemplateFile</span>

<span class="k">class</span> <span class="nc">AddHeaderAnimationForm</span><span class="p">(</span><span class="n">crud</span><span class="o">.</span><span class="n">AddForm</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Present form for adding a header animation &quot;&quot;&quot;</span>

    <span class="n">template</span> <span class="o">=</span> <span class="n">Zope3PageTemplateFile</span><span class="p">(</span><span class="s">&quot;custom-form-template.pt&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="customizing-form-frame">
<h3><a class="toc-backref" href="#id13">Customizing form frame</a><a class="headerlink" href="#customizing-form-frame" title="Permalink to this headline">¶</a></h3>
<p>If you want to change the surroundings around the z3c.form form, like Plone main template,
text above and below the form, you can do as in the following example:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">Products.Five.browser</span> <span class="kn">import</span> <span class="n">BrowserView</span>
<span class="kn">from</span> <span class="nn">Products.Five.browser.pagetemplatefile</span> <span class="kn">import</span> <span class="n">ViewPageTemplateFile</span> <span class="k">as</span> <span class="n">FiveViewPageTemplateFile</span>

<span class="kn">from</span> <span class="nn">plone.directives</span> <span class="kn">import</span> <span class="n">form</span>
<span class="kn">from</span> <span class="nn">plone.z3cform.layout</span> <span class="kn">import</span> <span class="n">FormWrapper</span><span class="p">,</span> <span class="n">wrap_form</span>

<span class="k">class</span> <span class="nc">EditHeaderBehaviorForm</span><span class="p">(</span><span class="n">form</span><span class="o">.</span><span class="n">EditForm</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Form which displays options to edit header animation.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="o">...</span>

<span class="k">class</span> <span class="nc">EditHeaderBehaviorView</span><span class="p">(</span><span class="n">FormWrapper</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Render Plone frame around our form with little modifications &quot;&quot;&quot;</span>

    <span class="c"># We need to define form and index attributes for custom FormWrapper</span>

    <span class="c"># form points to our Form class</span>
    <span class="n">form</span> <span class="o">=</span> <span class="n">EditHeaderBehaviorForm</span>

    <span class="c"># Index is Zope 2 page template file which renders the frame around the form</span>
    <span class="n">index</span> <span class="o">=</span> <span class="n">FiveViewPageTemplateFile</span><span class="p">(</span><span class="s">&quot;edit_header.pt&quot;</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">context</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
        <span class="c"># We can optionally set some variables in the constructor</span>
        <span class="n">FormWrapper</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">context</span><span class="p">,</span> <span class="n">request</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">header_animation_helper</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">restrictedTraverse</span><span class="p">(</span><span class="s">&quot;@@header_animation_helper&quot;</span><span class="p">)</span>

    <span class="c"># Our view exposes two custom functions to the template</span>

    <span class="k">def</span> <span class="nf">getAnimationCount</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Return how many animations are availabe in the context &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">header_animation_helper</span><span class="o">.</span><span class="n">header</span><span class="o">.</span><span class="n">alternatives</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">getHeadeDefiner</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Return the parent object defining animations in this context &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">header_animation_helper</span><span class="o">.</span><span class="n">defining_context</span>
</pre></div>
</div>
<p>And corresponding template edit_header.pt:</p>
<div class="highlight-python"><pre>&lt;html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"
      xmlns:tal="http://xml.zope.org/namespaces/tal"
      xmlns:metal="http://xml.zope.org/namespaces/metal"
      xmlns:i18n="http://xml.zope.org/namespaces/i18n"
      lang="en"
      metal:use-macro="here/main_template/macros/master"
      i18n:domain="plone.app.headeranimation"&gt;
&lt;body&gt;

  &lt;metal:main fill-slot="main"&gt;
    &lt;tal:main-macro metal:define-macro="main"&gt;

      &lt;h1 class="documentFirstHeading" tal:content="view/label"&gt;Title&lt;/h1&gt;

      &lt;div id="skel-contents"&gt;
        &lt;span tal:replace="structure view/contents" /&gt;
      &lt;/div&gt;


      &lt;!-- Custom section goes here below the form --&gt;

      &lt;h2&gt;Available animations&lt;/h2&gt;

      &lt;div id="animations"&gt;
        &lt;span&gt;
            We have &lt;b tal:content="view/getAnimationCount"&gt; animations or images&lt;/b&gt;
            defined by &lt;a tal:attributes="href view/getHeaderDefiner/absolute_url" tal:content="view/getHeadeDefiner/title_or_id" /&gt;
        &lt;/span&gt;
      &lt;/div&gt;

    &lt;/tal:main-macro&gt;
&lt;/metal:main&gt;</pre>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Generally, when you have a template which extends Plone main_template
you need to use class from Products.Five.browser.pagetemplatefile.ViewPageTemplateFile.</p>
</div>
</div>
</div>
<div class="section" id="fields">
<h2><a class="toc-backref" href="#id14">Fields</a><a class="headerlink" href="#fields" title="Permalink to this headline">¶</a></h2>
<p>Field is responsible for 1) prepopulating form values from context 2) storing data to context after succesful POST.</p>
<p>Form fields are stored in form.fields variable which is instance of Fields class (ordered dictionary like).</p>
<div class="section" id="creating-a-field">
<h3><a class="toc-backref" href="#id15">Creating a field</a><a class="headerlink" href="#creating-a-field" title="Permalink to this headline">¶</a></h3>
<p>Fields are created by adapting one or more zope.schema fields for z3c.form using Fields() constructor.</p>
<p>Example of creating one field:</p>
<div class="highlight-python"><pre>import zope.schema
import z3c.form.field


 schema_field = zope.schema.TextLine()
 form_fields = z3c.form.field.Fields(schema_field)

 # This is a reference to newly created z3c.form.field.Field object
 one_form_field = zfields.values()[0]</pre>
</div>
<p>Another example:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">zope.schema</span>
<span class="kn">import</span> <span class="nn">z3c.form.field</span>

<span class="o">...</span>

<span class="n">field</span> <span class="o">=</span> <span class="n">zope</span><span class="o">.</span><span class="n">schema</span><span class="o">.</span><span class="n">Bool</span><span class="p">(</span><span class="n">__name__</span> <span class="o">=</span> <span class="s">&quot;death_autofill&quot;</span><span class="p">,</span>
                         <span class="n">title</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s">u&quot;Fill missing timepoints&quot;</span><span class="p">),</span>
                         <span class="n">description</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s">u&quot;Automatically fill information in missing timepoints if they occur after the death time&quot;</span><span class="p">),</span>
                         <span class="n">required</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
                         <span class="n">default</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="c"># Construct z3c.form field</span>
<span class="n">fields_objects</span> <span class="o">=</span> <span class="n">z3c</span><span class="o">.</span><span class="n">form</span><span class="o">.</span><span class="n">field</span><span class="o">.</span><span class="n">Fields</span><span class="p">(</span><span class="n">field</span><span class="p">)</span>

<span class="c"># We can perform autofill only if we know the treatment time</span>
<span class="n">form</span><span class="o">.</span><span class="n">fields</span> <span class="o">+=</span> <span class="n">fields_objects</span>
</pre></div>
</div>
</div>
<div class="section" id="adding-a-field-to-a-form">
<h3><a class="toc-backref" href="#id16">Adding a field to a form</a><a class="headerlink" href="#adding-a-field-to-a-form" title="Permalink to this headline">¶</a></h3>
<p>Use overridden += operator of Fields instance.
Fields instances can be added to the existing Fields instances.</p>
<p>Example:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="bp">self</span><span class="o">.</span><span class="n">form</span><span class="o">.</span><span class="n">fields</span> <span class="o">+=</span> <span class="n">z3c</span><span class="o">.</span><span class="n">form</span><span class="o">.</span><span class="n">Fields</span><span class="p">(</span><span class="n">schema_field</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="modifying-a-field">
<h3><a class="toc-backref" href="#id17">Modifying a field</a><a class="headerlink" href="#modifying-a-field" title="Permalink to this headline">¶</a></h3>
<p>Fields can be accessed by their name in form.fields. Example:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="bp">self</span><span class="o">.</span><span class="n">form</span><span class="o">.</span><span class="n">fields</span><span class="p">[</span><span class="s">&quot;myfieldname&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">u&quot;Foobar&quot;</span>
</pre></div>
</div>
</div>
<div class="section" id="accesing-schema-of-the-field">
<h3><a class="toc-backref" href="#id18">Accesing schema of the field</a><a class="headerlink" href="#accesing-schema-of-the-field" title="Permalink to this headline">¶</a></h3>
<p>zope.schema Field is stored as a <em>field</em> attribute of a field. Example:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">textline</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">form</span><span class="o">.</span><span class="n">fields</span><span class="p">[</span><span class="s">&quot;myfieldname&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">field</span> <span class="c"># zope.schema.TextLine</span>
</pre></div>
</div>
</div>
<div class="section" id="read-only-fields">
<h3><a class="toc-backref" href="#id19">Read-only fields</a><a class="headerlink" href="#read-only-fields" title="Permalink to this headline">¶</a></h3>
<p>There is <tt class="docutils literal"><span class="pre">field.readonly</span></tt> flag.</p>
<p>Example code:</p>
<div class="highlight-python"><pre>class AREditForm(crud.EditForm):
    """ Form whose fields are dynamically constructed """

    def ar_editable(self):
        """ Arbitary condition deciding whether fields on this form are
        patient=self.__parent__.__parent__
        if patient.getConfirmedAR()  in (None,'','EDITABLE_AR'):
            return True
        return False


    @property
    def fields(self):
        """
        Dynamically create field data based on run-time constructed schema.

        Instead using static ``fields`` attribute, we use Python property
        which allows us to generate z3c.form.fields.Fields instance for the
        for run-time.
        """


        constructor = ARFormConstructor(self.context, self.context.context, self.request)

        # Create z3c.form.field.Fields object instance
        fields = constructor.getFields()

        if not self.ar_editable():
            # Disable all fields in edit mode if this form is locked out
            for f in fields.values():
                f.mode = z3c.form.interfaces.DISPLAY_MODE

        return fields</pre>
</div>
<p>You might also want to disable edit button if none if the fields are editable:</p>
<blockquote>
# Make edit button conditional
AREditSubForm.buttons[&quot;apply&quot;].condition = lambda form: form.has_edit_button()</blockquote>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">You can also set = z3c.form.interfaces.DISPLAY_MODE in updateWidgets() if you
are not dynamically poking form fields themselves.</p>
</div>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">Do not modify fields on singleton instances (form or fields objects are shared between all forms).
This causes problems on concurrent access.</p>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">zope.schema.Field has readonly propertly. z3c.form.field.Field does not have this property,
but has mode property. Do not confuse these two.</p>
</div>
</div>
<div class="section" id="dynamic-schemas">
<h3><a class="toc-backref" href="#id20">Dynamic schemas</a><a class="headerlink" href="#dynamic-schemas" title="Permalink to this headline">¶</a></h3>
<p>Below is an example how to include new schemas in fly:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">EditForm</span><span class="p">(</span><span class="n">dexterity</span><span class="o">.</span><span class="n">EditForm</span><span class="p">,</span> <span class="n">Helper</span><span class="p">):</span>

    <span class="n">grok</span><span class="o">.</span><span class="n">context</span><span class="p">(</span><span class="n">IFlexibleContent</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">updateFields</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="nb">super</span><span class="p">(</span><span class="n">dexterity</span><span class="o">.</span><span class="n">EditForm</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">updateFields</span><span class="p">()</span>
        <span class="n">sections</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getSections</span><span class="p">()</span>

        <span class="c"># See plone.app.z3cform.fieldsets.extensible for more examples</span>
        <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">sections</span><span class="p">:</span>

            <span class="c"># s = {&#39;schema&#39;: &lt;InterfaceClass your.app.content.flexiblecontent.IBodyText&gt;, &#39;id&#39;: u&#39;title&#39;, &#39;name&#39;: u&#39;Title&#39;}</span>
            <span class="k">if</span> <span class="n">s</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span>
                <span class="c"># This section has been removed from available flexi_blocks</span>
                <span class="k">continue</span>

            <span class="c"># convert zope schema interface to z3c.form.Fields instance</span>
            <span class="n">schema</span> <span class="o">=</span> <span class="n">s</span><span class="p">[</span><span class="s">&quot;schema&quot;</span><span class="p">]</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">schema</span><span class="o">.</span><span class="n">providedBy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="p">):</span>
                <span class="c"># We need to force the content item to provide</span>
                <span class="c"># custom for interfaces or datamanger is not happy</span>
                <span class="c">#   Module z3c.form.datamanager, line 51, in adapted_context</span>
                <span class="c">#   TypeError: (&#39;Could not adapt&#39;, &lt;Item at /xxx/tydryd&gt;, &lt;InterfaceClass xxx.app.content.flexiblecontent.IColumns&gt;)</span>
                <span class="n">alsoProvides</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="p">,</span> <span class="n">schema</span><span class="p">)</span> <span class="c"># XXX: This is persistent change?</span>

            <span class="c"># We need to manually apply hints from plone.directives.form, as</span>
            <span class="c"># updateFields() does it for base schema earlier</span>
            <span class="n">processFields</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">schema</span><span class="p">,</span> <span class="n">permissionChecks</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

        <span class="k">print</span> <span class="s">&quot;Final results&quot;</span>
        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">field</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">fields</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">print</span> <span class="nb">str</span><span class="p">(</span><span class="n">name</span><span class="p">)</span> <span class="o">+</span> <span class="s">&quot; &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">field</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="widgets">
<h2><a class="toc-backref" href="#id21">Widgets</a><a class="headerlink" href="#widgets" title="Permalink to this headline">¶</a></h2>
<p>Widget is responsible for 1) rendering HTML code for input 2) parsing HTTP post input.</p>
<p>Widgets are stored as widgets attribute of a form. It is presented by ordered dict like Widgets class.</p>
<p>Widgets are not available until form's update() and updateWidgets() methods have been called.
updateWidgets() will bind() widgets to the form context. For example, vocabularies defined by
name are resolved in this point.</p>
<p>Widget has two names:</p>
<blockquote>
<ul class="simple">
<li>widget.__name__ is the name of the corresponding field. Look ups from form.widgets[] can be done using this name.</li>
<li>widget.name is the decorated name used in HTML code. It is in format ${form name}.${field set name}.${widget.__name__}.</li>
</ul>
</blockquote>
<p>Zope publisher will also mangle widget names based on what kind of input the widget takes. When HTTP POST request comes in,
Zope publisher automatically converts &lt;select&gt; dropdowns to lists and so on.</p>
<div class="section" id="accessing-a-widget">
<h3><a class="toc-backref" href="#id22">Accessing a widget</a><a class="headerlink" href="#accessing-a-widget" title="Permalink to this headline">¶</a></h3>
<p>Widget can be accessed by its field's name. Example:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">MyForm</span><span class="p">(</span><span class="n">z3c</span><span class="o">.</span><span class="n">form</span><span class="o">.</span><span class="n">Form</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">update</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">z3c</span><span class="o">.</span><span class="n">form</span><span class="o">.</span><span class="n">Form</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">widget</span> <span class="o">=</span> <span class="n">form</span><span class="o">.</span><span class="n">widgets</span><span class="p">[</span><span class="s">&quot;myfieldname&quot;</span><span class="p">]</span> <span class="c"># Get one wiget</span>

        <span class="k">for</span> <span class="n">w</span> <span class="ow">in</span> <span class="n">wiget</span><span class="o">.</span><span class="n">items</span><span class="p">():</span> <span class="k">print</span> <span class="n">w</span> <span class="c"># Dump all widgets</span>
</pre></div>
</div>
</div>
<div class="section" id="introspecting-form-widgets">
<h3><a class="toc-backref" href="#id23">Introspecting form widgets</a><a class="headerlink" href="#introspecting-form-widgets" title="Permalink to this headline">¶</a></h3>
<p>Example:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">z3c.form</span> <span class="kn">import</span> <span class="n">form</span>

<span class="k">class</span> <span class="nc">MyForm</span><span class="p">(</span><span class="n">form</span><span class="o">.</span><span class="n">Form</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">updateWidgets</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Customize widget options before rendering the form. &quot;&quot;&quot;</span>
        <span class="n">form</span><span class="o">.</span><span class="n">Form</span><span class="o">.</span><span class="n">updateWidgets</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

        <span class="c"># Dump out all widgets - note that each &lt;fieldset&gt; is a subform and this function only</span>
        <span class="c"># concerns the current fieldset</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">widgets</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">print</span> <span class="n">i</span>
</pre></div>
</div>
</div>
<div class="section" id="reordering-and-hiding-widgets">
<h3><a class="toc-backref" href="#id24">Reordering and hiding widgets</a><a class="headerlink" href="#reordering-and-hiding-widgets" title="Permalink to this headline">¶</a></h3>
<p>With Dexterity forms you can use <a class="reference external" href="http://pypi.python.org/pypi/plone.directives.form">plone.directives.fotm</a>:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">z3c.form.interfaces</span> <span class="kn">import</span> <span class="n">IAddForm</span><span class="p">,</span> <span class="n">IEditForm</span>

<span class="k">class</span> <span class="nc">IFlexibleContent</span><span class="p">(</span><span class="n">form</span><span class="o">.</span><span class="n">Schema</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Description of the Example Type</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c"># -*- Your Zope schema definitions here ... -*-</span>
    <span class="n">form</span><span class="o">.</span><span class="n">order_before</span><span class="p">(</span><span class="n">sections</span><span class="o">=</span><span class="s">&#39;title&#39;</span><span class="p">)</span>
    <span class="n">form</span><span class="o">.</span><span class="n">mode</span><span class="p">(</span><span class="n">sections</span><span class="o">=</span><span class="s">&#39;hidden&#39;</span><span class="p">)</span>
    <span class="n">form</span><span class="o">.</span><span class="n">mode</span><span class="p">(</span><span class="n">IEditForm</span><span class="p">,</span> <span class="n">sections</span><span class="o">=</span><span class="s">&#39;input&#39;</span><span class="p">)</span>
    <span class="n">form</span><span class="o">.</span><span class="n">mode</span><span class="p">(</span><span class="n">IAddForm</span><span class="p">,</span> <span class="n">sections</span><span class="o">=</span><span class="s">&#39;input&#39;</span><span class="p">)</span>
    <span class="n">sections</span> <span class="o">=</span> <span class="n">schema</span><span class="o">.</span><span class="n">TextLine</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s">u&quot;Sections&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="modifying-a-widget">
<h3><a class="toc-backref" href="#id25">Modifying a widget</a><a class="headerlink" href="#modifying-a-widget" title="Permalink to this headline">¶</a></h3>
<p>Widgets are stored in form.widgets dictionary. Mapping is field name -&gt; widget. Widget label can be different than field name.</p>
<p>Example:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">z3c.form</span> <span class="kn">import</span> <span class="n">form</span>

<span class="k">class</span> <span class="nc">MyForm</span><span class="p">(</span><span class="n">form</span><span class="o">.</span><span class="n">Form</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">updateWidgets</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Customize widget options before rendering the form. &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">widgets</span><span class="p">[</span><span class="s">&quot;myfield&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">label</span> <span class="o">=</span> <span class="s">u&quot;Foobar&quot;</span>
</pre></div>
</div>
<p>If you want to have a complete different Python class
for widget you need to override field's widget factory in
module body code after fields have been constructed in the class
or in update() for dynamically constructed fields:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">update</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

     <span class="bp">self</span><span class="o">.</span><span class="n">fields</span><span class="p">[</span><span class="s">&quot;animation&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">widgetFactory</span> <span class="o">=</span> <span class="n">HeaderFileFieldWidget</span>
</pre></div>
</div>
</div>
<div class="section" id="reorder-form-widgets">
<h3><a class="toc-backref" href="#id26">Reorder form widgets</a><a class="headerlink" href="#reorder-form-widgets" title="Permalink to this headline">¶</a></h3>
<p>plone.z3cform allows you to reorder the field widgets by overriding the update
method of the form class.</p>
<p>Example:</p>
<div class="highlight-python"><pre>from z3c.form import form
from plone.z3cform.fieldsets.utils import move

class MyForm(form.Form):

    def update(self):
    super(MyForm, self).update()
    move(self, 'fullname', before='*')
    move(self, 'username', after='fullname')
    super(ProfileRegistrationForm, self).update()</pre>
</div>
<p>For more information about how to reorder fields see the plone.z3cform pypi
page:</p>
<p>&lt;<a class="reference external" href="http://pypi.python.org/pypi/plone.z3cform#fieldsets-and-form-extenders">http://pypi.python.org/pypi/plone.z3cform#fieldsets-and-form-extenders</a>&gt;`_</p>
<div class="section" id="making-widgets-required-conditionally">
<h4><a class="toc-backref" href="#id27">Making widgets required conditionally</a><a class="headerlink" href="#making-widgets-required-conditionally" title="Permalink to this headline">¶</a></h4>
<p>If you want to avoid hardwired required on fields
and toggle then conditionally you need to supplied
dynamically modified schema field to
<cite>z3c.form.field.Fields</cite> instance of the form.</p>
<p>Example:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">ShippingAddressForm</span><span class="p">(</span><span class="n">CheckoutSubform</span><span class="p">):</span>
    <span class="n">ignoreContext</span> <span class="o">=</span> <span class="bp">True</span>
    <span class="n">label</span> <span class="o">=</span> <span class="n">_</span><span class="p">(</span><span class="s">u&quot;Shipping address&quot;</span><span class="p">)</span>

    <span class="c"># Distinct fields on same &lt;form&gt; HTML element</span>
    <span class="n">prefix</span> <span class="o">=</span> <span class="s">&quot;shipping&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">optional</span><span class="p">,</span> <span class="n">content</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">parentForm</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        @param optional: Whether shipping address should be validated or not.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">subform</span><span class="o">.</span><span class="n">EditSubForm</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">content</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">parentForm</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">optional</span> <span class="o">=</span> <span class="n">optional</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">fields</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Get the field definition for this form.</span>

<span class="sd">        Form class&#39;s fields attribute does not have to</span>
<span class="sd">        be fixed, it can be property also.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c"># Construct the Fields instance as we would</span>
        <span class="c"># normally do in more static way</span>
        <span class="n">fields</span> <span class="o">=</span> <span class="n">z3c</span><span class="o">.</span><span class="n">form</span><span class="o">.</span><span class="n">field</span><span class="o">.</span><span class="n">Fields</span><span class="p">(</span><span class="n">ICheckoutAddress</span><span class="p">)</span>

        <span class="c"># We need to override the actual required from the</span>
        <span class="c"># schema field which is litte tricky.</span>
        <span class="c"># Schema fields are shared between instances</span>
        <span class="c"># by default, so we need to create a copy of it</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">optional</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">fields</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
                <span class="c"># Create copy of a schema field</span>
                <span class="c"># and force it unrequired</span>
                <span class="n">schema_field</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">field</span><span class="p">)</span> <span class="c"># shallow copy of an instance</span>
                <span class="n">schema_field</span><span class="o">.</span><span class="n">required</span> <span class="o">=</span> <span class="bp">False</span>
                <span class="n">f</span><span class="o">.</span><span class="n">field</span> <span class="o">=</span> <span class="n">schema_field</span>

        <span class="k">return</span> <span class="n">fields</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="setting-widget-types">
<h3><a class="toc-backref" href="#id28">Setting widget types</a><a class="headerlink" href="#setting-widget-types" title="Permalink to this headline">¶</a></h3>
<p>By default, widgets for form fields are determined by FieldWidget adapters (defined in ZCML).
You can override adapters per field using field's widgetFactory property.</p>
<p>Below is an example which creates a custom widget, its FieldWidget factory and uses it for
one field in one form:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">zope.component</span> <span class="kn">import</span> <span class="n">adapter</span><span class="p">,</span> <span class="n">getMultiAdapter</span>
<span class="kn">from</span> <span class="nn">zope.interface</span> <span class="kn">import</span> <span class="n">implementer</span><span class="p">,</span> <span class="n">implements</span><span class="p">,</span> <span class="n">implementsOnly</span>

<span class="kn">from</span> <span class="nn">z3c.form.interfaces</span> <span class="kn">import</span> <span class="n">IFieldWidget</span>
<span class="kn">from</span> <span class="nn">z3c.form.widget</span> <span class="kn">import</span> <span class="n">FieldWidget</span>

<span class="kn">from</span> <span class="nn">plone.formwidget.namedfile.widget</span> <span class="kn">import</span> <span class="n">NamedFileWidget</span><span class="p">,</span> <span class="n">NamedImageWidget</span>


<span class="k">class</span> <span class="nc">HeaderFileWidget</span><span class="p">(</span><span class="n">HeaderWidgetMixin</span><span class="p">,</span> <span class="n">NamedFileWidget</span><span class="p">):</span>

    <span class="c"># Get download url for HeaderAnimation object&#39;s file.</span>
    <span class="c"># Download URL is set externally by edit sub form and</span>
    <span class="n">download_url</span> <span class="o">=</span> <span class="bp">None</span>

<span class="k">class</span> <span class="nc">HeaderImageWidget</span><span class="p">(</span><span class="n">HeaderWidgetMixin</span><span class="p">,</span> <span class="n">NamedImageWidget</span><span class="p">):</span>
    <span class="k">pass</span>

<span class="nd">@implementer</span><span class="p">(</span><span class="n">IFieldWidget</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">HeaderFileFieldWidget</span><span class="p">(</span><span class="n">field</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Factory for creating HeaderFileWidget which is bound to one field &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">FieldWidget</span><span class="p">(</span><span class="n">field</span><span class="p">,</span> <span class="n">HeaderFileWidget</span><span class="p">(</span><span class="n">request</span><span class="p">))</span>

<span class="k">class</span> <span class="nc">EditHeaderAnimationSubForm</span><span class="p">(</span><span class="n">crud</span><span class="o">.</span><span class="n">EditSubForm</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">updateWidgets</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Enforce custom widget types which get file/image attachment URL right &quot;&quot;&quot;</span>
        <span class="c"># Custom widget types are provided by FieldWidget factories</span>
        <span class="c"># before updateWidgets() is called</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fields</span><span class="p">[</span><span class="s">&quot;animation&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">widgetFactory</span> <span class="o">=</span> <span class="n">HeaderFileFieldWidget</span>

        <span class="n">crud</span><span class="o">.</span><span class="n">EditSubForm</span><span class="o">.</span><span class="n">updateWidgets</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

        <span class="c"># Make edit form aware of correct image download URLs</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">widgets</span><span class="p">[</span><span class="s">&quot;animation&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">download_url</span> <span class="o">=</span> <span class="s">&quot;http://mymagicalurl.com&quot;</span>
</pre></div>
</div>
<p>Alternatively, you can use <a class="reference external" href="http://pypi.python.org/pypi/plone.directives.form">plone.directives.form</a>
to add widget hints to form schema.</p>
</div>
<div class="section" id="widget-save">
<h3><a class="toc-backref" href="#id29">Widget save</a><a class="headerlink" href="#widget-save" title="Permalink to this headline">¶</a></h3>
<p>After form.update() if the request was save request and all data was valid form applyChanges(data) is called.</p>
<p>By default widgets use datamanger.AttributeField and tries to store its value as a member attribute of the object returned by form.getContent().</p>
<p>TODO: How do add custom DataManager</p>
</div>
<div class="section" id="widget-value">
<h3><a class="toc-backref" href="#id30">Widget value</a><a class="headerlink" href="#widget-value" title="Permalink to this headline">¶</a></h3>
<p>Widget value, either from form POST or previous context data, is available in widget.value
after form.update() call.</p>
</div>
<div class="section" id="adding-a-css-class">
<h3><a class="toc-backref" href="#id31">Adding a CSS class</a><a class="headerlink" href="#adding-a-css-class" title="Permalink to this headline">¶</a></h3>
<p>Widgets have a method addClass() to add extra CSS classes. This is useful if you have
Javascript/JQuery associated with your special form:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">widget</span><span class="o">.</span><span class="n">addClass</span><span class="p">(</span><span class="s">&quot;myspecialwidgetclass&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>Note that these classes are directly applied to &lt;input&gt;, &lt;select&gt; etc. itself and
not the wrapping &lt;div&gt; element.</p>
</div>
<div class="section" id="id2">
<h3><a class="toc-backref" href="#id32">Accesing schema of the field</a><a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h3>
<p>zope.schema Field is stored as a <em>field</em> attribute of a widget. Example:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">textline</span> <span class="o">=</span> <span class="n">form</span><span class="o">.</span><span class="n">widgets</span><span class="p">[</span><span class="s">&quot;myfieldname&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">field</span> <span class="c"># zope.schema.TextLine</span>
</pre></div>
</div>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">Widget.field is not z3c.form.field.Field object.</p>
</div>
</div>
<div class="section" id="getting-selection-widget-vocabulary-value-as-human-readable-text">
<h3><a class="toc-backref" href="#id33">Getting selection widget vocabulary value as human readable text</a><a class="headerlink" href="#getting-selection-widget-vocabulary-value-as-human-readable-text" title="Permalink to this headline">¶</a></h3>
<p>Example:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">widget</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">widgets</span><span class="p">[</span><span class="s">&quot;myselectionlist&quot;</span><span class="p">]</span>

<span class="n">token</span> <span class="o">=</span> <span class="n">widget</span><span class="o">.</span><span class="n">value</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="c"># widget.value is list of unicode strings, each is token for the vocabulary</span>

<span class="n">user_readable</span> <span class="o">=</span> <span class="n">widget</span><span class="o">.</span><span class="n">terms</span><span class="o">.</span><span class="n">getTermByToken</span><span class="p">(</span><span class="n">token</span><span class="p">)</span><span class="o">.</span><span class="n">title</span>
</pre></div>
</div>
<p>Example (page template):</p>
<div class="highlight-python"><pre>&lt;td tal:define="widget view/widgets/myselectionlist"&gt;
    &lt;span tal:define="token python:widget.value[0]" tal:content="python:widget.terms.getTermByToken(token).title" /&gt;
&lt;/td&gt;</pre>
</div>
</div>
<div class="section" id="setting-widget-templates">
<h3><a class="toc-backref" href="#id34">Setting widget templates</a><a class="headerlink" href="#setting-widget-templates" title="Permalink to this headline">¶</a></h3>
<p>You might want to customize the template of a widget to have custom HTML code for a specific use case.</p>
</div>
</div>
<div class="section" id="setting-the-template-of-an-individual-widget">
<h2><a class="toc-backref" href="#id35">Setting the template of an individual widget</a><a class="headerlink" href="#setting-the-template-of-an-individual-widget" title="Permalink to this headline">¶</a></h2>
<p>First copy the existing page template code of the widget.
For basic widgets you can find the template in <a href="#id3"><span class="problematic" id="id4">``</span></a>z3c.form source tree &lt;<a class="reference external" href="http://svn.zope.org/z3c.form/trunk/src/z3c/form/browser/">http://svn.zope.org/z3c.form/trunk/src/z3c/form/browser/</a>&gt;``_.</p>
<p>yourwidget.pt (text area widget copied over an example text)</p>
<div class="highlight-html"><div class="highlight"><pre><span class="nt">&lt;html</span> <span class="na">xmlns=</span><span class="s">&quot;http://www.w3.org/1999/xhtml&quot;</span>
      <span class="na">xmlns:tal=</span><span class="s">&quot;http://xml.zope.org/namespaces/tal&quot;</span>
      <span class="na">tal:omit-tag=</span><span class="s">&quot;&quot;</span><span class="nt">&gt;</span>

<span class="c">&lt;!-- Sections widget custom templates --&gt;</span>

<span class="nt">&lt;textarea</span>
   <span class="na">id=</span><span class="s">&quot;&quot;</span> <span class="na">name=</span><span class="s">&quot;&quot;</span> <span class="na">class=</span><span class="s">&quot;&quot;</span> <span class="na">cols=</span><span class="s">&quot;&quot;</span> <span class="na">rows=</span><span class="s">&quot;&quot;</span>
   <span class="na">tabindex=</span><span class="s">&quot;&quot;</span> <span class="na">disabled=</span><span class="s">&quot;&quot;</span> <span class="na">readonly=</span><span class="s">&quot;&quot;</span> <span class="na">accesskey=</span><span class="s">&quot;&quot;</span>
   <span class="na">tal:attributes=</span><span class="s">&quot;id view/id;</span>
<span class="s">                   name view/name;</span>
<span class="s">                   class view/klass;</span>
<span class="s">                   style view/style;</span>
<span class="s">                   title view/title;</span>
<span class="s">                   lang view/lang;</span>
<span class="s">                   onclick view/onclick;</span>
<span class="s">                   ondblclick view/ondblclick;</span>
<span class="s">                   onmousedown view/onmousedown;</span>
<span class="s">                   onmouseup view/onmouseup;</span>
<span class="s">                   onmouseover view/onmouseover;</span>
<span class="s">                   onmousemove view/onmousemove;</span>
<span class="s">                   onmouseout view/onmouseout;</span>
<span class="s">                   onkeypress view/onkeypress;</span>
<span class="s">                   onkeydown view/onkeydown;</span>
<span class="s">                   onkeyup view/onkeyup;</span>
<span class="s">                   disabled view/disabled;</span>
<span class="s">                   tabindex view/tabindex;</span>
<span class="s">                   onfocus view/onfocus;</span>
<span class="s">                   onblur view/onblur;</span>
<span class="s">                   onchange view/onchange;</span>
<span class="s">                   cols view/cols;</span>
<span class="s">                   rows view/rows;</span>
<span class="s">                   readonly view/readonly;</span>
<span class="s">                   accesskey view/accesskey;</span>
<span class="s">                   onselect view/onselect&quot;</span>
   <span class="na">tal:content=</span><span class="s">&quot;view/value&quot;</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">z3c.form.ptcompat</span> <span class="kn">import</span> <span class="n">ViewPageTemplateFile</span>
<span class="kn">from</span> <span class="nn">z3c.form.interfaces</span> <span class="kn">import</span> <span class="n">INPUT_MODE</span>

<span class="k">class</span> <span class="nc">AddForm</span><span class="p">(</span><span class="n">DefaultAddForm</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">updateWidgets</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; &quot;&quot;&quot;</span>
        <span class="c"># Call parent to set-up initial widget data</span>
        <span class="n">DefaultAddForm</span><span class="o">.</span><span class="n">updateWidgets</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

        <span class="c"># Note we need to be discreet to different form modes (view, edit, hidden)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">fields</span><span class="p">[</span><span class="s">&quot;sections&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">mode</span> <span class="o">==</span> <span class="n">INPUT_MODE</span><span class="p">:</span>

            <span class="c"># Modify a widget with certain name for our purposes</span>
            <span class="n">widget</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">widgets</span><span class="p">[</span><span class="s">&quot;sections&quot;</span><span class="p">]</span>

            <span class="c"># widget.template is a template factory -</span>
            <span class="c"># Widget.render() will associate later this factory with the widget</span>
            <span class="n">widget</span><span class="o">.</span><span class="n">template</span> <span class="o">=</span> <span class="n">ViewPageTemplateFile</span><span class="p">(</span><span class="s">&quot;templates/sections.pt&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>You can also interact with your <tt class="docutils literal"><span class="pre">form</span></tt> class instance from the widget template</p>
<div class="highlight-html"><div class="highlight"><pre><span class="c">&lt;!-- Some hidden JSON data for our Javascripts by calling a method on our form class --&gt;</span>
<span class="nt">&lt;span</span> <span class="na">style=</span><span class="s">&quot;display:none&quot;</span> <span class="na">tal:content=</span><span class="s">&quot;view/form/getBlockPlanJSON&quot;</span> <span class="nt">/&gt;</span>
</pre></div>
</div>
</div>
<div class="section" id="setting-template-for-your-own-widget-type">
<h2><a class="toc-backref" href="#id36">Setting template for your own widget type</a><a class="headerlink" href="#setting-template-for-your-own-widget-type" title="Permalink to this headline">¶</a></h2>
<p>You can set the widget template is using <tt class="docutils literal"><span class="pre">&lt;z3c:widgetTemplate&gt;</span></tt> ZCML directive</p>
<div class="highlight-xml"><div class="highlight"><pre><span class="nt">&lt;z3c:widgetTemplate</span>
       <span class="na">mode=</span><span class="s">&quot;display&quot;</span>
       <span class="na">widget=</span><span class="s">&quot;.interfaces.INamedFileWidget&quot;</span>
       <span class="na">layer=</span><span class="s">&quot;z3c.form.interfaces.IFormLayer&quot;</span>
       <span class="na">template=</span><span class="s">&quot;file_display.pt&quot;</span>
       <span class="nt">/&gt;</span>
</pre></div>
</div>
<p>You can also enforce widget template in the render() method of the widget class:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">zope.component</span> <span class="kn">import</span> <span class="n">adapter</span><span class="p">,</span> <span class="n">getMultiAdapter</span>
<span class="kn">from</span> <span class="nn">zope.interface</span> <span class="kn">import</span> <span class="n">implementer</span><span class="p">,</span> <span class="n">implements</span><span class="p">,</span> <span class="n">implementsOnly</span>
<span class="kn">from</span> <span class="nn">zope.app.pagetemplate.viewpagetemplatefile</span> <span class="kn">import</span> <span class="n">ViewPageTemplateFile</span>

<span class="kn">from</span> <span class="nn">z3c.form.interfaces</span> <span class="kn">import</span> <span class="n">IFieldWidget</span><span class="p">,</span> <span class="n">INPUT_MODE</span><span class="p">,</span> <span class="n">DISPLAY_MODE</span><span class="p">,</span> <span class="n">HIDDEN_MODE</span>
<span class="kn">from</span> <span class="nn">z3c.form.widget</span> <span class="kn">import</span> <span class="n">FieldWidget</span>

<span class="kn">from</span> <span class="nn">plone.formwidget.namedfile.widget</span> <span class="kn">import</span> <span class="n">NamedFileWidget</span><span class="p">,</span> <span class="n">NamedImageWidget</span>

<span class="k">class</span> <span class="nc">HeaderFileWidget</span><span class="p">(</span><span class="n">NamedFileWidget</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Subclass widget a use a custom template &quot;&quot;&quot;</span>

    <span class="n">display_template</span> <span class="o">=</span> <span class="n">ViewPageTemplateFile</span><span class="p">(</span><span class="s">&quot;header_file_display.pt&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">render</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;See z3c.form.interfaces.IWidget.&quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mode</span> <span class="o">==</span> <span class="n">DISPLAY_MODE</span><span class="p">:</span>
            <span class="c"># Enforce template and do not query it from the widget template factory</span>
            <span class="n">template</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">display_template</span>

        <span class="k">return</span> <span class="n">NamedFileWidget</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</pre></div>
</div>
<p>Widget template example:</p>
<div class="highlight-python"><pre>&lt;span id="" class="" i18n:domain="plone.formwidget.namedfile"
      tal:attributes="id view/id;
                      class view/klass;
                      style view/style;
                      title view/title;
                      lang view/lang;
                      onclick view/onclick;
                      ondblclick view/ondblclick;
                      onmousedown view/onmousedown;
                      onmouseup view/onmouseup;
                      onmouseover view/onmouseover;
                      onmousemove view/onmousemove;
                      onmouseout view/onmouseout;
                      onkeypress view/onkeypress;
                      onkeydown view/onkeydown;
                      onkeyup view/onkeyup"
        tal:define="value view/value;
                    exists python:value is not None"&gt;
    &lt;span tal:define="fieldname view/field/__name__ | nothing;
                      filename view/filename;
                      filename_encoded view/filename_encoded;"
            tal:condition="python: exists and fieldname"&gt;
        &lt;a tal:content="filename"
           tal:attributes="href string:${view/download_url}"&gt;Filename&lt;/a&gt;
        &lt;span class="discreet"&gt; &amp;mdash; &lt;span tal:define="sizekb view/file_size" tal:replace="sizekb"&gt;100&lt;/span&gt; KB&lt;/span&gt;
    &lt;/span&gt;
    &lt;span tal:condition="not:exists" class="discreet" i18n:translate="no_file"&gt;
        No file
    &lt;/span&gt;
&lt;/span&gt;</pre>
</div>
</div>
<div class="section" id="buttons">
<h2><a class="toc-backref" href="#id37">Buttons</a><a class="headerlink" href="#buttons" title="Permalink to this headline">¶</a></h2>
<p>Buttons enable actions in forms. <tt class="docutils literal"><span class="pre">AddForm</span></tt> and <tt class="docutils literal"><span class="pre">EditForm</span></tt>
base classes come with default buttons (Save).</p>
<p>More information in z3c.form documentation</p>
<ul class="simple">
<li><a class="reference external" href="http://packages.python.org/z3c.form/button.html">http://packages.python.org/z3c.form/button.html</a></li>
</ul>
<div class="section" id="adding-a-button-to-form">
<h3><a class="toc-backref" href="#id38">Adding a button to form</a><a class="headerlink" href="#adding-a-button-to-form" title="Permalink to this headline">¶</a></h3>
<p>The easiest way to add buttons their handlers is to use
a function decorator <tt class="docutils literal"><span class="pre">z3c.form.button.buttonAndHandler()</span></tt>.</p>
<p>The first parameter is user visible label and
the second one is <cite>&lt;input&gt;</cite> name.</p>
<p>Example:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">z3c.form</span> <span class="kn">import</span> <span class="n">button</span>


<span class="k">class</span> <span class="nc">Form</span><span class="p">(</span><span class="o">...</span><span class="p">):</span>

    <span class="n">button</span><span class="o">.</span><span class="n">buttonAndHandler</span><span class="p">(</span><span class="n">_</span><span class="p">(</span><span class="s">&#39;Add&#39;</span><span class="p">),</span> <span class="n">name</span><span class="o">=</span><span class="s">&#39;add&#39;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">handle_add</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">action</span><span class="p">):</span>
        <span class="n">data</span><span class="p">,</span> <span class="n">errors</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">extractData</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">errors</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">status</span> <span class="o">=</span> <span class="s">&quot;Please correct errors&quot;</span>
            <span class="k">return</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">applyChanges</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">status</span> <span class="o">=</span> <span class="n">_</span><span class="p">(</span><span class="s">u&quot;Item added successfully.&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>The default <tt class="docutils literal"><span class="pre">z3c.form.form.AddForm</span></tt> and <tt class="docutils literal"><span class="pre">z3c.form.form.EditForm</span></tt>
<em>Add</em> and <em>Save</em> button handler calls are good code examples.</p>
<ul class="simple">
<li><a class="reference external" href="http://svn.zope.org/z3c.form/trunk/src/z3c/form/form.py?rev=114824&amp;view=auto">http://svn.zope.org/z3c.form/trunk/src/z3c/form/form.py?rev=114824&amp;view=auto</a></li>
</ul>
</div>
<div class="section" id="manipulating-form-buttons-programmatically">
<h3><a class="toc-backref" href="#id39">Manipulating form buttons programmatically</a><a class="headerlink" href="#manipulating-form-buttons-programmatically" title="Permalink to this headline">¶</a></h3>
<p>You want to manipulate buttons if you want to hide buttons dynamically,
manipulate labels, etc.</p>
<p>Buttons are stored in <tt class="docutils literal"><span class="pre">buttons</span></tt> class attribute.</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">Button storage is shared between all form instances,
so do not mutate its content. Instead create a copy
of it if you wish to have form specific changes.</p>
</div>
<div class="section" id="reading-buttons">
<h4><a class="toc-backref" href="#id40">Reading buttons</a><a class="headerlink" href="#reading-buttons" title="Permalink to this headline">¶</a></h4>
<p>Example:</p>
<div class="highlight-python"><pre>self.mobile_form_instance = MobileForm(self.context, self.request)

for i in self.mobile_form_instance.buttons.items(): print i
('apply', &lt;Button 'apply' u'Apply'&gt;)</pre>
</div>
</div>
<div class="section" id="removing-or-hiding-buttons">
<h4><a class="toc-backref" href="#id41">Removing or hiding buttons</a><a class="headerlink" href="#removing-or-hiding-buttons" title="Permalink to this headline">¶</a></h4>
<p>Here is an example how to hide all buttons from a certain form instance.</p>
<p>Example:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">copy</span>


<span class="k">def</span> <span class="nf">update</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Hide form buttons</span>

        <span class="c"># Create immutable copy which you can manipulate</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mobile_form_instance</span><span class="o">.</span><span class="n">buttons</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mobile_form_instance</span><span class="o">.</span><span class="n">buttons</span><span class="p">)</span>

        <span class="c"># Remove button using dictionary style delete</span>
        <span class="k">for</span> <span class="n">button_id</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">mobile_form_instance</span><span class="o">.</span><span class="n">buttons</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">mobile_form_instance</span><span class="o">.</span><span class="n">buttons</span><span class="p">[</span><span class="n">button_id</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="section" id="adding-buttons-dynamically">
<h4><a class="toc-backref" href="#id42">Adding buttons dynamically</a><a class="headerlink" href="#adding-buttons-dynamically" title="Permalink to this headline">¶</a></h4>
<p>In the example below Buttons array is already constructed dynamically
and we can manipulate it:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">setActions</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Add button to the form based on dynamic conditions. &quot;&quot;&quot;</span>


    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">isSaveEnabled</span><span class="p">():</span>

        <span class="n">but</span> <span class="o">=</span> <span class="n">button</span><span class="o">.</span><span class="n">Button</span><span class="p">(</span><span class="s">&quot;save&quot;</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s">u&quot;Save&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">form</span><span class="o">.</span><span class="n">buttons</span> <span class="o">+=</span> <span class="n">button</span><span class="o">.</span><span class="n">Buttons</span><span class="p">(</span><span class="n">but</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">form</span><span class="o">.</span><span class="n">buttons</span><span class="o">.</span><span class="n">_data_keys</span><span class="o">.</span><span class="n">reverse</span><span class="p">()</span> <span class="c"># Fix Save button to left</span>

        <span class="n">handler</span> <span class="o">=</span> <span class="n">button</span><span class="o">.</span><span class="n">Handler</span><span class="p">(</span><span class="n">but</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">form</span><span class="o">.</span><span class="n">__class__</span><span class="o">.</span><span class="n">handleSave</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">form</span><span class="o">.</span><span class="n">handlers</span><span class="o">.</span><span class="n">addHandler</span><span class="p">(</span><span class="n">but</span><span class="p">,</span> <span class="n">handler</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="subforms">
<h2><a class="toc-backref" href="#id43">Subforms</a><a class="headerlink" href="#subforms" title="Permalink to this headline">¶</a></h2>
<p>Subforms are embedded z3c forms inside a master form.</p>
<p>Subforms may have their own
buttons or use the controls from the maste form.
You need to call update() manually for subforms.</p>
<p>More info</p>
<ul class="simple">
<li><a class="reference external" href="http://packages.python.org/z3c.form/subform.html">http://packages.python.org/z3c.form/subform.html</a></li>
</ul>
<div class="section" id="adding-an-action-to-parent-and-subform">
<h3><a class="toc-backref" href="#id44">Adding an action to parent and subform</a><a class="headerlink" href="#adding-an-action-to-parent-and-subform" title="Permalink to this headline">¶</a></h3>
<p>Parent and subform actions must be linked.</p>
<p>Example:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">CheckoutForm</span><span class="p">(</span><span class="n">z3c</span><span class="o">.</span><span class="n">form</span><span class="o">.</span><span class="n">form</span><span class="o">.</span><span class="n">EditForm</span><span class="p">):</span>


    <span class="nd">@button.buttonAndHandler</span><span class="p">(</span><span class="n">_</span><span class="p">(</span><span class="s">&#39;Continue&#39;</span><span class="p">),</span> <span class="n">name</span><span class="o">=</span><span class="s">&#39;continue&#39;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">handleContinue</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">action</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Extract the checkout data to session and redirect to payment processer checkout screen.</span>

<span class="sd">        Note:</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c"># Following has been copied from z3c.form.form.EditForm</span>
        <span class="n">data</span><span class="p">,</span> <span class="n">errors</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">extractData</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">errors</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">status</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">formErrorsMessage</span>
            <span class="k">return</span>

        <span class="n">changes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">applyChanges</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">changes</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">status</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">successMessage</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">status</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">noChangesMessage</span>


<span class="k">class</span> <span class="nc">CheckoutSubform</span><span class="p">(</span><span class="n">subform</span><span class="o">.</span><span class="n">EditSubForm</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Add support for continue action. &quot;&quot;&quot;</span>


    <span class="k">def</span> <span class="nf">execute</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Make sure that the form is refreshed when parent</span>
<span class="sd">        form Continue is pressed.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">data</span><span class="p">,</span> <span class="n">errors</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">extractData</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">errors</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">errors</span> <span class="o">=</span> <span class="n">errors</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">status</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">formErrorsMessage</span>
            <span class="k">return</span> <span class="n">errors</span>

        <span class="n">content</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getContent</span><span class="p">()</span>
        <span class="n">z3c</span><span class="o">.</span><span class="n">form</span><span class="o">.</span><span class="n">form</span><span class="o">.</span><span class="n">applyChanges</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">content</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">None</span>

    <span class="nd">@button.handler</span><span class="p">(</span><span class="n">CheckoutForm</span><span class="o">.</span><span class="n">buttons</span><span class="p">[</span><span class="s">&#39;continue&#39;</span><span class="p">])</span>
    <span class="k">def</span> <span class="nf">handleContinue</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">action</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; What happens when the parent form button is pressed &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">execute</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="creating-subforms-run-time">
<h2><a class="toc-backref" href="#id45">Creating subforms run-time</a><a class="headerlink" href="#creating-subforms-run-time" title="Permalink to this headline">¶</a></h2>
<p>Below is an example how to convert existing form instance to
be used as an subform in another form:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">convertToSubForm</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">form_instance</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Make existing form object behave like subform object.</span>

<span class="sd">    * Do not render &lt;form&gt; frame</span>

<span class="sd">    * Do not render actions</span>

<span class="sd">    @param form_instance: Constructed z3c.form.form.Form object</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c"># Create mutable copy which you can manipulate</span>
    <span class="n">form_instance</span><span class="o">.</span><span class="n">buttons</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">form_instance</span><span class="o">.</span><span class="n">buttons</span><span class="p">)</span>

    <span class="c"># Remove subform action buttons using dictionary style delete</span>
    <span class="k">for</span> <span class="n">button_id</span> <span class="ow">in</span> <span class="n">form_instance</span><span class="o">.</span><span class="n">buttons</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
        <span class="k">del</span> <span class="n">form_instance</span><span class="o">.</span><span class="n">buttons</span><span class="p">[</span><span class="n">button_id</span><span class="p">]</span>

    <span class="k">if</span> <span class="n">HAS_WRAPPER_FORM</span><span class="p">:</span>
        <span class="c"># Plone 4 / Plone 3 compatibility</span>
        <span class="n">zope</span><span class="o">.</span><span class="n">interface</span><span class="o">.</span><span class="n">alsoProvides</span><span class="p">(</span><span class="n">form_instance</span><span class="p">,</span> <span class="n">IWrappedForm</span><span class="p">)</span>

    <span class="c"># Use subform template - this prevents getting embedded &lt;form&gt;</span>
    <span class="c"># elements inside the master &lt;form&gt;</span>
    <span class="kn">import</span> <span class="nn">plone.z3cform</span>
    <span class="c">#from zope.pagetemplatefile import ViewPageTemplateFile as Zope3PageTemplateFile</span>
    <span class="kn">from</span> <span class="nn">zope.app.pagetemplate</span> <span class="kn">import</span> <span class="n">ViewPageTemplateFile</span> <span class="k">as</span> <span class="n">Zope3PageTemplateFile</span>
    <span class="kn">from</span> <span class="nn">zope.app.pagetemplate.viewpagetemplatefile</span> <span class="kn">import</span> <span class="n">BoundPageTemplate</span>
    <span class="n">template</span> <span class="o">=</span> <span class="n">Zope3PageTemplateFile</span><span class="p">(</span><span class="s">&#39;subform.pt&#39;</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">plone</span><span class="o">.</span><span class="n">z3cform</span><span class="o">.</span><span class="n">__file__</span><span class="p">),</span> <span class="s">&quot;templates&quot;</span><span class="p">))</span>
    <span class="n">form_instance</span><span class="o">.</span><span class="n">template</span> <span class="o">=</span> <span class="n">BoundPageTemplate</span><span class="p">(</span><span class="n">template</span><span class="p">,</span> <span class="n">form_instance</span><span class="p">)</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">If it's possible try to base class your form class hiearchy so that
you can use the same class mix-in for normal forms and subforms.</p>
</div>
</div>
<div class="section" id="crud-form">
<h2><a class="toc-backref" href="#id46">CRUD form</a><a class="headerlink" href="#crud-form" title="Permalink to this headline">¶</a></h2>
<p>CRUD (Create, read, update, delete) forms manage list of objects.</p>
<p>CRUD form elements</p>
<ul class="simple">
<li>Add form creates new objects and renders the form below the     le</li>
<li>Edit sub-form edits existing object and renders one     le row</li>
<li>Edit form lists all objects and allows deleting them (    le master)</li>
<li>CRUD form orchestrates the whole thing and renders add and edit forms</li>
<li>view_schema outputs read-only fields in CRUD     le</li>
<li>update_schema outputs edi    le fields in CRUD     le. Usually you want either view_schema or update_schema</li>
<li>add_schema outputs add form</li>
</ul>
<p>Notes: context attribute of add and edit form is the parent CRUD form. Context attribute of edit sub form
is the edit form.</p>
<div class="section" id="examples">
<h3><a class="toc-backref" href="#id47">Examples</a><a class="headerlink" href="#examples" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Easy: <a class="reference external" href="https://svn.plone.org/svn/collective/plone.app.headeranimation/trunk/plone/app/headeranimation/browser/forms.py">plone.app.headeranimation animation and image list manager</a>.</li>
<li>Complex: <a class="reference external" href="https://svn.plone.org/svn/collective/collective.dancing/trunk/collective/dancing/browser/channel.py">Singing &amp; dancing channel manager example</a></li>
</ul>
</div>
</div>
<div class="section" id="displaying-the-status-message-in-a-non-standard-location">
<h2><a class="toc-backref" href="#id48">Displaying the status message in a non-standard location</a><a class="headerlink" href="#displaying-the-status-message-in-a-non-standard-location" title="Permalink to this headline">¶</a></h2>
<p>By default, the status message is rendered inside plone.app.z3cform <tt class="docutils literal"><span class="pre">macros.pt</span></tt> above the form:</p>
<div class="highlight-python"><pre>&lt;metal:define define-macro="titlelessform"&gt;

    &lt;tal:status define="status view/status" condition="status"&gt;
        &lt;dl class="portalMessage error" tal:condition="view/widgets/errors"&gt;
            &lt;dt i18n:domain="plone" i18n:translate=""&gt;
                Error
            &lt;/dt&gt;
            &lt;dd tal:content="status" /&gt;
        &lt;/dl&gt;
        &lt;dl class="portalMessage info" tal:condition="not: view/widgets/errors"&gt;
            &lt;dt i18n:domain="plone" i18n:translate=""&gt;
                Info
            &lt;/dt&gt;
            &lt;dd tal:content="status" /&gt;
        &lt;/dl&gt;
    &lt;/tal:status&gt;</pre>
</div>
<p>We can decouple the status message from the form, without overriding all the templates,
by copying status message variable to another variable and then playing around with it in our
wrapper view template.</p>
<p>Form class:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">HolidayServiceSearchForm</span><span class="p">(</span><span class="n">form</span><span class="o">.</span><span class="n">Form</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>

<span class="sd">    &quot;&quot;&quot;</span>


    <span class="nd">@button.buttonAndHandler</span><span class="p">(</span><span class="n">_</span><span class="p">(</span><span class="s">u&quot;Search&quot;</span><span class="p">))</span>
    <span class="k">def</span> <span class="nf">searchHandler</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">action</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Search form submit handler for product card search.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">data</span><span class="p">,</span> <span class="n">errors</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">extractData</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">search_results</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">status</span> <span class="o">=</span> <span class="n">_</span><span class="p">(</span><span class="s">u&quot;No holiday services found.&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">msgid</span> <span class="o">=</span> <span class="n">_</span><span class="p">(</span><span class="s">&quot;found_results&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s">u&quot;Found ${results} holiday services.&quot;</span><span class="p">,</span> <span class="n">mapping</span><span class="o">=</span><span class="p">{</span><span class="s">u&quot;results&quot;</span> <span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">search_results</span><span class="p">)})</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">status</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">translate</span><span class="p">(</span><span class="n">msgid</span><span class="p">)</span>

        <span class="o">...</span>

        <span class="c"># Use non-standard location to display the status</span>
        <span class="c"># for success messages</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">widgets</span><span class="o">.</span><span class="n">errors</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">result_message</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">status</span> <span class="o">=</span> <span class="bp">None</span>

<span class="k">class</span> <span class="nc">HolidayServiceSearchView</span><span class="p">(</span><span class="n">FormWrapper</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    HolidayService browser view</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">form</span> <span class="o">=</span> <span class="n">HolidayServiceSearchForm</span>


    <span class="k">def</span> <span class="nf">result_message</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Display result message in non-standard location &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">form_instance</span><span class="o">.</span><span class="n">widgets</span><span class="o">.</span><span class="n">errors</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="c"># Do not display form highlight errors here</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">form_instance</span><span class="o">.</span><span class="n">result_message</span>
</pre></div>
</div>
<p>... and then we can use a special result_message view accessor in our view template code</p>
</div>
<div class="section" id="storage-format-and-data-managers">
<h2><a class="toc-backref" href="#id49">Storage format and data managers</a><a class="headerlink" href="#storage-format-and-data-managers" title="Permalink to this headline">¶</a></h2>
<p>By default, z3c.form reads incoming context values as the object attributes.
This behavior can be customized using data managers.</p>
<p>You can, for example, use Python dictionaries to read and store form data.</p>
<ul class="simple">
<li><a class="reference external" href="http://packages.python.org/z3c.form/datamanager.html">http://packages.python.org/z3c.form/datamanager.html</a></li>
</ul>
<div class="section" id="custom-content-objects">
<h3><a class="toc-backref" href="#id50">Custom content objects</a><a class="headerlink" href="#custom-content-objects" title="Permalink to this headline">¶</a></h3>
<p>The following hack can be used if you have an object which does not conform your form
interface and you want to explose only certain object attribute to the form to be edited.</p>
<p>Example:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">ISettings</span><span class="p">(</span><span class="n">zope</span><span class="o">.</span><span class="n">interface</span><span class="o">.</span><span class="n">Interface</span><span class="p">):</span>

    <span class="c"># This maps to Archetypes field confirmedAR on SitsPatient</span>
    <span class="n">confirmedAR</span> <span class="o">=</span> <span class="n">zope</span><span class="o">.</span><span class="n">schema</span><span class="o">.</span><span class="n">Choice</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s">u&quot;Confirm adherse reactions&quot;</span><span class="p">),</span>
                                       <span class="n">description</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s">u&quot;Confirm that all adherse reactions regarding the patient life cycle have been entered here and there will be no longer adherse reaction data&quot;</span><span class="p">),</span>
                                       <span class="n">vocabulary</span><span class="o">=</span><span class="n">make_zope_schema_vocabulary</span><span class="p">(</span><span class="n">ADVERSE_STATUS_VOCABULARY</span><span class="p">))</span>


<span class="k">class</span> <span class="nc">ARSettingsForm</span><span class="p">(</span><span class="n">form</span><span class="o">.</span><span class="n">Form</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; General settings for all adherse reactions &quot;&quot;&quot;</span>

    <span class="n">fields</span> <span class="o">=</span> <span class="n">Fields</span><span class="p">(</span><span class="n">ISettings</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">getContent</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; &quot;&quot;&quot;</span>

        <span class="c"># Create a temporary object holding the settings values out of the patient</span>

        <span class="k">class</span> <span class="nc">TemporarySettingsContext</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
            <span class="n">zope</span><span class="o">.</span><span class="n">interface</span><span class="o">.</span><span class="n">implements</span><span class="p">(</span><span class="n">ISettings</span><span class="p">)</span>

        <span class="n">obj</span> <span class="o">=</span> <span class="n">TemporarySettingsContext</span><span class="p">()</span>

        <span class="c"># Copy values we want to expose to the form from Plone context item to the temporary object</span>
        <span class="n">obj</span><span class="o">.</span><span class="n">confirmedAR</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">confirmedAR</span>

        <span class="k">return</span> <span class="n">obj</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Since getContent() is also used in applyChanges() you need to override applyChanges()
too to save values correctly back to non-temporary object.</p>
</div>
</div>
<div class="section" id="custom-change-applying">
<h3><a class="toc-backref" href="#id51">Custom change applying</a><a class="headerlink" href="#custom-change-applying" title="Permalink to this headline">¶</a></h3>
<p>The default behavior of z3c.form edit form is to write incoming
data as the attributes of the object returned by <tt class="docutils literal"><span class="pre">getContent()</span></tt>.</p>
<p>You can override this behavior by overriding <tt class="docutils literal"><span class="pre">applyChanges()</span></tt> method.</p>
<p>Example:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">applyChanges</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Reflect confirmed status to Archetypes schema.</span>

<span class="sd">    @param data: Dictionary of cleaned form data, keyed by field</span>
<span class="sd">    &quot;&quot;&quot;</span>


    <span class="c"># This is the context given to the form when the form object was constructed</span>
    <span class="n">patient</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">context</span>

    <span class="k">assert</span> <span class="n">ISitsPatient</span><span class="o">.</span><span class="n">providedBy</span><span class="p">(</span><span class="n">patient</span><span class="p">)</span> <span class="c"># safety check</span>

    <span class="c"># Call archetypes field mutator to store the value on the patient object</span>
    <span class="n">patient</span><span class="o">.</span><span class="n">setConfirmedAR</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s">&quot;confirmedAR&quot;</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="wysiwyg-widgets">
<h2><a class="toc-backref" href="#id52">WYSIWYG widgets</a><a class="headerlink" href="#wysiwyg-widgets" title="Permalink to this headline">¶</a></h2>
<p>By using <a class="reference external" href="http://pypi.python.org/pypi/plone.directives.form">plone.directives.form</a>
and <a class="reference external" href="http://pypi.python.org/pypi/plone.app.z3cform">plone.app.z3cform</a> packages you can do:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">plone.app.z3cform.wysiwyg</span> <span class="kn">import</span> <span class="n">WysiwygFieldWidget</span>

<span class="kn">from</span> <span class="nn">mfabrik.plonezohointegration</span> <span class="kn">import</span> <span class="n">_</span>

<span class="k">class</span> <span class="nc">ISettings</span><span class="p">(</span><span class="n">form</span><span class="o">.</span><span class="n">Schema</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Define schema for settings of the add-on product &quot;&quot;&quot;</span>

    <span class="n">form</span><span class="o">.</span><span class="n">widget</span><span class="p">(</span><span class="n">contact_form_prefix</span><span class="o">=</span><span class="n">WysiwygFieldWidget</span><span class="p">)</span>
    <span class="n">contact_form_prefix</span> <span class="o">=</span> <span class="n">schema</span><span class="o">.</span><span class="n">Text</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s">u&quot;Contact form top text&quot;</span><span class="p">),</span>
                                      <span class="n">description</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s">u&quot;Custom text for the long contact form upper part&quot;</span><span class="p">),</span>
                                      <span class="n">required</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
                                      <span class="n">default</span><span class="o">=</span><span class="s">u&quot;&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>More information</p>
<ul class="simple">
<li><a class="reference external" href="http://pypi.python.org/pypi/plone.directives.form">http://pypi.python.org/pypi/plone.directives.form</a></li>
</ul>
</div>
<div class="section" id="wrapped-and-non-wrapped-forms">
<h2><a class="toc-backref" href="#id53">Wrapped and non-wrapped forms</a><a class="headerlink" href="#wrapped-and-non-wrapped-forms" title="Permalink to this headline">¶</a></h2>
<p><tt class="docutils literal"><span class="pre">z3c.form.form.Form</span></tt> object is &quot;wrapped&quot; when it is
rendered inside Plone page frame and having
acquisition chain in intact.</p>
<p>Since <tt class="docutils literal"><span class="pre">plone.app.z3cform</span></tt> 0.5.0 the behavior goes like this</p>
<ul class="simple">
<li>Plone 3 forms are automatically wrapped</li>
<li>Plone 4 forms are unwrapped</li>
</ul>
<p>Wrapper is a <tt class="docutils literal"><span class="pre">plone.z3cform.interfaces.IWrappedForm</span></tt> <a class="reference internal" href="../components/interfaces.html"><em>marker interface</em></a>
on the form object, applied it after the form instance has been constructed.
If this marker interface is not applied, <tt class="docutils literal"><span class="pre">plone.z3cform.ZopeTwoFormTemplateFactory</span></tt>
tries to embed form into Plone page frame. If the form is indended not be rendered
as full page form, this usually leads to the following exception:</p>
<div class="highlight-python"><pre>*** ContentProviderLookupError: plone.htmlhead</pre>
</div>
<p>The form tries to render the full Plone page. Rendering this page needs an acquisition
chain set-up for the view and the template. Embedded forms do not have this,
or it would lead to recursion error.</p>
<p>If you are constructing form instances manually and want to render them
without Plone page decoration, you must make sure that automatic form wrapping does not take place:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">zope.interface</span>
<span class="kn">from</span> <span class="nn">plone.z3cform.interfaces</span> <span class="kn">import</span> <span class="n">IWrappedForm</span>

<span class="k">class</span> <span class="nc">SomeView</span><span class="p">(</span><span class="n">BrowserView</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">init</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Constructor embedded sub forms &quot;&quot;&quot;</span>


        <span class="c"># Construct few embedded forms</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mobile_form_instance</span> <span class="o">=</span> <span class="n">MobileForm</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="p">)</span>
        <span class="n">zope</span><span class="o">.</span><span class="n">interface</span><span class="o">.</span><span class="n">alsoProvides</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mobile_form_instance</span><span class="p">,</span> <span class="n">IWrappedForm</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">publishing_form_instance</span> <span class="o">=</span> <span class="n">PublishingForm</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="p">)</span>
        <span class="n">zope</span><span class="o">.</span><span class="n">interface</span><span class="o">.</span><span class="n">alsoProvides</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">publishing_form_instance</span><span class="p">,</span> <span class="n">IWrappedForm</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">override_form_instance</span> <span class="o">=</span> <span class="n">getMultiAdapter</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="p">),</span> <span class="n">IOverrideForm</span><span class="p">)</span>
        <span class="n">zope</span><span class="o">.</span><span class="n">interface</span><span class="o">.</span><span class="n">alsoProvides</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">override_form_instance</span><span class="p">,</span> <span class="n">IWrappedForm</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="embedding-z3c-form-forms-in-portlets-viewlets-and-views">
<h2><a class="toc-backref" href="#id54">Embedding z3c.form forms in portlets, viewlets and views</a><a class="headerlink" href="#embedding-z3c-form-forms-in-portlets-viewlets-and-views" title="Permalink to this headline">¶</a></h2>
<p>By default, when <tt class="docutils literal"><span class="pre">plone.app.z3cform</span></tt> is installed through
the add-on installer, all forms have full Plone page frame.
If you are rendering forms inside non-full-page objects,
you need to change the default template.</p>
<p>Below is an example how to put z3c.form based form into a portlet.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">plone.app.z3cform version 0.5.1 or later is needed,
as older versions do not support overriding form.action
property.</p>
</div>
<p>You need following</p>
<ul class="simple">
<li>z3c.form class</li>
<li>viewlet/portlet class</li>
<li>A form wrapper template which renders the frame around the form. The default version renders the whole Plone page frame -
you don't want this when the form is embedded, otherwise you get infinite recursion (plone page having a form having a plone page...)</li>
<li>Portlet/viewlet template which refers to the form</li>
<li>ZCML to register all components</li>
</ul>
<p>Portlet code:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">plone.z3cform.layout</span> <span class="kn">import</span> <span class="n">FormWrapper</span>

<span class="k">class</span> <span class="nc">PortletFormView</span><span class="p">(</span><span class="n">FormWrapper</span><span class="p">):</span>
     <span class="sd">&quot;&quot;&quot; Form view which renders z3c.forms embedded in a portlet.</span>

<span class="sd">     Subclass FormWrapper so that we can use custom frame template. &quot;&quot;&quot;</span>

     <span class="n">index</span> <span class="o">=</span> <span class="n">ViewPageTemplateFile</span><span class="p">(</span><span class="s">&quot;formwrapper.pt&quot;</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">Renderer</span><span class="p">(</span><span class="n">base</span><span class="o">.</span><span class="n">Renderer</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; z3c.form portlet renderer.</span>

<span class="sd">    Instiate form and wrap it to a special layout template</span>
<span class="sd">    which will give the form suitable frame to be used in the portlet.</span>

<span class="sd">    We also set a form action attribute, so that</span>
<span class="sd">    the browser goes to another page after the form has been submitted</span>
<span class="sd">    (we really don&#39;t know what kind of page the portlet is displayed</span>
<span class="sd">    and is it safe to submit forms there, so we do this to make sure).</span>
<span class="sd">    The action page points to a browser:page view where the same</span>
<span class="sd">    form is displayed as full-page form, giving the user to better</span>
<span class="sd">    user experience to fix validation errors.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">render</span> <span class="o">=</span> <span class="n">ViewPageTemplateFile</span><span class="p">(</span><span class="s">&#39;zohocrmcontact.pt&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">context</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">view</span><span class="p">,</span> <span class="n">manager</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="n">base</span><span class="o">.</span><span class="n">Renderer</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">context</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">view</span><span class="p">,</span> <span class="n">manager</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">form_wrapper</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">createForm</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">createForm</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Create a form instance.</span>

<span class="sd">        @return: z3c.form wrapped for Plone 3 view</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">context</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">aq_inner</span>

        <span class="n">returnURL</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">absolute_url</span><span class="p">()</span>

        <span class="c"># Create a compact version of the contact form</span>
        <span class="c"># (not all fields visible)</span>
        <span class="n">form</span> <span class="o">=</span> <span class="n">ZohoContactForm</span><span class="p">(</span><span class="n">context</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="p">,</span> <span class="n">returnURLHint</span><span class="o">=</span><span class="n">returnURL</span><span class="p">,</span> <span class="n">full</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>

        <span class="c"># Wrap a form in Plone view</span>
        <span class="n">view</span> <span class="o">=</span> <span class="n">PortletFormView</span><span class="p">(</span><span class="n">context</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="p">)</span>
        <span class="n">view</span> <span class="o">=</span> <span class="n">view</span><span class="o">.</span><span class="n">__of__</span><span class="p">(</span><span class="n">context</span><span class="p">)</span> <span class="c"># Make sure acquisition chain is respected</span>
        <span class="n">view</span><span class="o">.</span><span class="n">form_instance</span> <span class="o">=</span> <span class="n">form</span>

        <span class="k">return</span> <span class="n">view</span>

    <span class="k">def</span> <span class="nf">getContactFormURL</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; For rendering the form link at the bottom of the portlet.</span>

<span class="sd">        @return: URL leading to the full contact form</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">form_wrapper</span><span class="o">.</span><span class="n">form_instance</span><span class="o">.</span><span class="n">action</span>
</pre></div>
</div>
<p><tt class="docutils literal"><span class="pre">formwrapper.pt</span></tt> is just a dummy form view template which wraps the form.
This differs from standard form wrapper by <em>not</em> rendering Plone
main layout around the form.</p>
<div class="highlight-html"><div class="highlight"><pre><span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;portlet-form&quot;</span><span class="nt">&gt;</span>
   <span class="nt">&lt;div</span> <span class="na">tal:replace=</span><span class="s">&quot;structure view/contents&quot;</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;/div&gt;</span>
</pre></div>
</div>
<p>Then the portlet template itself (zohoportlet.pt)
renders the portlet. Form is referred by
syntax <tt class="docutils literal"><span class="pre">&lt;form</span> <span class="pre">tal:replace=&quot;structure</span> <span class="pre">view/form_wrapper&quot;</span> <span class="pre">/&gt;</span></tt>.</p>
<div class="highlight-html"><div class="highlight"><pre><span class="nt">&lt;dl</span> <span class="na">class=</span><span class="s">&quot;portlet portletZohoCRMContact&quot;</span>
    <span class="na">i18n:domain=</span><span class="s">&quot;mfabrik.plonezohointegration&quot;</span><span class="nt">&gt;</span>

    <span class="nt">&lt;dt</span> <span class="na">class=</span><span class="s">&quot;portletHeader&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">&quot;portletTopLeft&quot;</span><span class="nt">&gt;&lt;/span&gt;</span>
        <span class="nt">&lt;span</span> <span class="na">i18n:translate=</span><span class="s">&quot;portlet_title&quot;</span><span class="nt">&gt;</span>
           Contact Us
        <span class="nt">&lt;/span&gt;</span>
        <span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">&quot;portletTopRight&quot;</span><span class="nt">&gt;&lt;/span&gt;</span>
    <span class="nt">&lt;/dt&gt;</span>

    <span class="nt">&lt;dd</span> <span class="na">class=</span><span class="s">&quot;portletItem odd&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;form</span> <span class="na">tal:replace=</span><span class="s">&quot;structure view/form_wrapper&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;/dd&gt;</span>

    <span class="nt">&lt;dd</span> <span class="na">class=</span><span class="s">&quot;portletFooter&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">&quot;portletBottomLeft&quot;</span><span class="nt">&gt;&lt;/span&gt;</span>
        <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">&quot;&quot;</span>
           <span class="na">tal:attributes=</span><span class="s">&quot;href view/getContactFormURL&quot;</span>
           <span class="na">i18n:translate=</span><span class="s">&quot;box_more_news_link&quot;</span><span class="nt">&gt;</span>
          Longer contact form<span class="ni">&amp;hellip;</span>
        <span class="nt">&lt;/a&gt;</span>
        <span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">&quot;portletBottomRight&quot;</span><span class="nt">&gt;&lt;/span&gt;</span>
    <span class="nt">&lt;/dd&gt;</span>

<span class="nt">&lt;/dl&gt;</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Viewlet behave little different, since they do automatically some acquisition
chain mangling when you assign variables to self. Thus you should
never have self.view = view or self.form = form in viewlet.</p>
</div>
<p>Template example for viewlet (don't do sel.form_wrapper)</p>
<div class="highlight-html"><div class="highlight"><pre><span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">&quot;my-viewlet&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;form</span> <span class="na">tal:replace=</span><span class="s">&quot;structure python:view.createForm()()&quot;</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;/div&gt;</span>
</pre></div>
</div>
<p>Then the necessary parts of form itself:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">IZohoContactForm</span><span class="p">(</span><span class="n">zope</span><span class="o">.</span><span class="n">interface</span><span class="o">.</span><span class="n">Interface</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Form field definitions for Zoho contact forms &quot;&quot;&quot;</span>

    <span class="n">first_name</span> <span class="o">=</span> <span class="n">schema</span><span class="o">.</span><span class="n">TextLine</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s">u&quot;First name&quot;</span><span class="p">))</span>

    <span class="n">last_name</span> <span class="o">=</span> <span class="n">schema</span><span class="o">.</span><span class="n">TextLine</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s">u&quot;Last name&quot;</span><span class="p">))</span>

    <span class="n">company</span> <span class="o">=</span> <span class="n">schema</span><span class="o">.</span><span class="n">TextLine</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s">u&quot;Company / organization&quot;</span><span class="p">),</span> <span class="n">description</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s">u&quot;The organization which you represent&quot;</span><span class="p">))</span>

    <span class="n">email</span> <span class="o">=</span> <span class="n">schema</span><span class="o">.</span><span class="n">TextLine</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s">u&quot;Email address&quot;</span><span class="p">),</span> <span class="n">description</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s">u&quot;Email address we will use to contact you&quot;</span><span class="p">))</span>

    <span class="n">phone_number</span> <span class="o">=</span> <span class="n">schema</span><span class="o">.</span><span class="n">TextLine</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s">u&quot;Phone number&quot;</span><span class="p">),</span>
                                   <span class="n">description</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s">u&quot;Your phone number in international format. E.g. +44 12 123 1234&quot;</span><span class="p">),</span>
                                   <span class="n">required</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
                                   <span class="n">default</span><span class="o">=</span><span class="s">u&quot;&quot;</span><span class="p">)</span>


    <span class="n">returnURL</span> <span class="o">=</span> <span class="n">schema</span><span class="o">.</span><span class="n">TextLine</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s">u&quot;Return URL&quot;</span><span class="p">),</span>
                                <span class="n">description</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s">u&quot;Where the user is taken after the form is succesfully submitted&quot;</span><span class="p">),</span>
                                <span class="n">required</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
                                <span class="n">default</span><span class="o">=</span><span class="s">u&quot;&quot;</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">ZohoContactForm</span><span class="p">(</span><span class="n">Form</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; z3c.form used to handle the new lead submission.</span>

<span class="sd">    This form can be rendered</span>

<span class="sd">    * standalone (@@zoho-contact-form view)</span>

<span class="sd">    * embedded into the portlet</span>

<span class="sd">    ..note::</span>

<span class="sd">        It is recommended to use a CSS rule</span>
<span class="sd">        to hide form descriptions when rendered in the portlet to save</span>
<span class="sd">        some screen estate.</span>

<span class="sd">    Example CSS::</span>

<span class="sd">        .portletZohoCRMContact .formHelp {</span>
<span class="sd">           display: none;</span>
<span class="sd">        }</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">fields</span> <span class="o">=</span> <span class="n">Fields</span><span class="p">(</span><span class="n">IZohoContactForm</span><span class="p">)</span>

    <span class="n">label</span> <span class="o">=</span> <span class="n">_</span><span class="p">(</span><span class="s">u&quot;Contact Us&quot;</span><span class="p">)</span>

    <span class="n">description</span> <span class="o">=</span> <span class="n">_</span><span class="p">(</span><span class="s">u&quot;If you are interested our services leave your contact information below and our sales representatives will contact you.&quot;</span><span class="p">)</span>

    <span class="n">ignoreContext</span> <span class="o">=</span> <span class="bp">True</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">context</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">returnURLHint</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">full</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        @param returnURLHint: Should we enforce return URL for this form</span>

<span class="sd">        @param full: Show all available fields or just required ones.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">Form</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">context</span><span class="p">,</span> <span class="n">request</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">all_fields</span> <span class="o">=</span> <span class="n">full</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">returnURLHint</span> <span class="o">=</span> <span class="n">returnURLHint</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">action</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Rewrite HTTP POST action.</span>

<span class="sd">        If the form is rendered embedded on the others pages we</span>
<span class="sd">        make sure the form is posted through the same view always,</span>
<span class="sd">        instead of making HTTP POST to the page where the form was rendered.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">portal_url</span><span class="p">()</span> <span class="o">+</span> <span class="s">&quot;/@@zoho-contact-form&quot;</span>

    <span class="k">def</span> <span class="nf">updateWidgets</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Make sure that return URL is not visible to the user.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">Form</span><span class="o">.</span><span class="n">updateWidgets</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

        <span class="c"># Use the return URL suggested by the creator of this form</span>
        <span class="c"># (if not acting standalone)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">widgets</span><span class="p">[</span><span class="s">&quot;returnURL&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">mode</span> <span class="o">=</span> <span class="n">z3c</span><span class="o">.</span><span class="n">form</span><span class="o">.</span><span class="n">interfaces</span><span class="o">.</span><span class="n">HIDDEN_MODE</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">returnURLHint</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">widgets</span><span class="p">[</span><span class="s">&quot;returnURL&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">returnURLHint</span>

        <span class="c"># Prepare compact version of this formw</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">all_fields</span><span class="p">:</span>
            <span class="c"># Hide fields which we don&#39;t want to bother user with</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">widgets</span><span class="p">[</span><span class="s">&quot;phone_number&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">mode</span> <span class="o">=</span> <span class="n">z3c</span><span class="o">.</span><span class="n">form</span><span class="o">.</span><span class="n">interfaces</span><span class="o">.</span><span class="n">HIDDEN_MODE</span>


    <span class="nd">@button.buttonAndHandler</span><span class="p">(</span><span class="n">_</span><span class="p">(</span><span class="s">&#39;Send contact request&#39;</span><span class="p">),</span> <span class="n">name</span><span class="o">=</span><span class="s">&#39;ok&#39;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">send</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">action</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Form button hander. &quot;&quot;&quot;</span>

        <span class="n">data</span><span class="p">,</span> <span class="n">errors</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">extractData</span><span class="p">()</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">errors</span><span class="p">:</span>

            <span class="n">settings</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getZohoSettings</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">settings</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">status</span> <span class="o">=</span> <span class="n">_</span><span class="p">(</span><span class="s">u&quot;Zoho is not configured in Site Setup. Please contact the site administration.&quot;</span><span class="p">)</span>
                <span class="k">return</span>

            <span class="n">crm</span> <span class="o">=</span> <span class="n">CRM</span><span class="p">(</span><span class="n">settings</span><span class="o">.</span><span class="n">username</span><span class="p">,</span> <span class="n">settings</span><span class="o">.</span><span class="n">password</span><span class="p">,</span> <span class="n">settings</span><span class="o">.</span><span class="n">apikey</span><span class="p">)</span>

            <span class="c"># Fill in data going to Zoho CRM</span>
            <span class="n">lead</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s">&quot;First Name&quot;</span> <span class="p">:</span> <span class="n">data</span><span class="p">[</span><span class="s">&quot;first_name&quot;</span><span class="p">],</span>
                <span class="s">&quot;Last Name&quot;</span> <span class="p">:</span> <span class="n">data</span><span class="p">[</span><span class="s">&quot;last_name&quot;</span><span class="p">],</span>
                <span class="s">&quot;Company&quot;</span> <span class="p">:</span> <span class="n">data</span><span class="p">[</span><span class="s">&quot;company&quot;</span><span class="p">],</span>
                <span class="s">&quot;Email&quot;</span> <span class="p">:</span> <span class="n">data</span><span class="p">[</span><span class="s">&quot;email&quot;</span><span class="p">],</span>
            <span class="p">}</span>

            <span class="n">phone</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;phone_number&quot;</span><span class="p">,</span> <span class="s">&quot;&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">phone</span> <span class="o">!=</span> <span class="s">&quot;&quot;</span><span class="p">:</span>
                <span class="c"># Only pass phone number to Zoho if it&#39;s set</span>
                <span class="n">lead</span><span class="p">[</span><span class="s">&quot;Phone&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">phone</span>

            <span class="c"># Pass in all prefilled lead fields configured in the site setup</span>
            <span class="n">lead</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parseExtraFields</span><span class="p">(</span><span class="n">settings</span><span class="o">.</span><span class="n">crm_lead_extra_data</span><span class="p">))</span>

            <span class="c"># Open Zoho API connection</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="c"># This will raise ZohoException and nuke the request</span>
                <span class="c"># if Zoho credentials are wrong</span>
                <span class="n">crm</span><span class="o">.</span><span class="n">open</span><span class="p">()</span>

                <span class="c"># Make sure that wfTrigger is true</span>
                <span class="c"># and Zoho does workflow actions for the new leads</span>
                <span class="c"># (like informing sales about the availability of the lead)</span>
                <span class="n">crm</span><span class="o">.</span><span class="n">insert_records</span><span class="p">([</span><span class="n">lead</span><span class="p">],</span> <span class="p">{</span><span class="s">&quot;wfTrigger&quot;</span> <span class="p">:</span> <span class="s">&quot;true&quot;</span><span class="p">})</span>
            <span class="k">except</span> <span class="ne">IOError</span><span class="p">:</span>
                <span class="c"># Network down?</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">status</span> <span class="o">=</span> <span class="n">_</span><span class="p">(</span><span class="s">u&quot;Cannot connect to Zoho servers. Please contact web site administration&quot;</span><span class="p">)</span>
                <span class="k">return</span>

            <span class="n">ok_message</span> <span class="o">=</span> <span class="n">_</span><span class="p">(</span><span class="s">u&quot;Thank you for contacting us. Our sales representatives will come back to you in few days&quot;</span><span class="p">)</span>


            <span class="c"># Check whether this form was submitted from another page</span>
            <span class="n">returnURL</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;returnURL&quot;</span><span class="p">,</span> <span class="s">&quot;&quot;</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">returnURL</span> <span class="o">!=</span> <span class="s">&quot;&quot;</span> <span class="ow">and</span> <span class="n">returnURL</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>

                <span class="c"># Go to page where we were sent and</span>
                <span class="c"># pass the confirmation message as status message (in session)</span>
                <span class="c"># as we are not in the control of the destination page</span>
                <span class="kn">from</span> <span class="nn">Products.statusmessages.interfaces</span> <span class="kn">import</span> <span class="n">IStatusMessage</span>
                <span class="n">messages</span> <span class="o">=</span> <span class="n">IStatusMessage</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="p">)</span>
                <span class="n">messages</span><span class="o">.</span><span class="n">addStatusMessage</span><span class="p">(</span><span class="n">ok_message</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="s">&quot;info&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">response</span><span class="o">.</span><span class="n">redirect</span><span class="p">(</span><span class="n">returnURL</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c"># Act standalone</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">status</span> <span class="o">=</span> <span class="n">ok_message</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c"># errors on the form</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">status</span> <span class="o">=</span> <span class="n">_</span><span class="p">(</span><span class="s">u&quot;Please fill in all the fields&quot;</span><span class="p">)</span>
</pre></div>
</div>
<div class="section" id="further-reading">
<h3><a class="toc-backref" href="#id55">Further reading</a><a class="headerlink" href="#further-reading" title="Permalink to this headline">¶</a></h3>
<p>This example code was taken from <em>mfabrik.plonezohointegration</em>
product which is in Plone collective SVN.</p>
<p>Another tutorial</p>
<ul class="simple">
<li><a class="reference external" href="http://plone.org/documentation/kb/using-z3c.form-forms-in-plone">http://plone.org/documentation/kb/using-z3c.form-forms-in-plone</a></li>
</ul>
<p>Validators</p>
</div>
<div class="section" id="adding-validators">
<h3><a class="toc-backref" href="#id56">Adding validators</a><a class="headerlink" href="#adding-validators" title="Permalink to this headline">¶</a></h3>
<p>Validators are best to be added in the schema itself.</p>
<ul class="simple">
<li>If you are using plain <tt class="docutils literal"><span class="pre">z3c.form</span></tt>, you can check the <a class="reference external" href="http://packages.python.org/z3c.form/validator.html">validators documentation</a>.</li>
<li><a class="reference external" href="http://pypi.python.org/pypi/plone.directives.form#validators">plone.form.directives</a> package provides
convenient decorators for form validators. If you use <tt class="docutils literal"><span class="pre">plone.form.directives</span></tt> validators make sure your package
is <a class="reference internal" href="../components/grok.html"><em>grokked</em></a> (otherwise validators are not registered).</li>
</ul>
<p>How to use widget specific validators with z3c.form example:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">z3c.form</span> <span class="kn">import</span> <span class="n">validator</span>
<span class="kn">import</span> <span class="nn">zope.component</span>

<span class="k">class</span> <span class="nc">IZohoContactForm</span><span class="p">(</span><span class="n">form</span><span class="o">.</span><span class="n">Schema</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Form field definitions for Zoho contact forms &quot;&quot;&quot;</span>

    <span class="n">phone_number</span> <span class="o">=</span> <span class="n">schema</span><span class="o">.</span><span class="n">TextLine</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s">u&quot;Phone number&quot;</span><span class="p">),</span>
                                   <span class="n">description</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s">u&quot;Your phone number in international format. E.g. +44 12 123 1234&quot;</span><span class="p">),</span>
                                   <span class="n">required</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
                                   <span class="n">default</span><span class="o">=</span><span class="s">u&quot;&quot;</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">PhoneNumberValidator</span><span class="p">(</span><span class="n">validator</span><span class="o">.</span><span class="n">SimpleFieldValidator</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; z3c.form validator class for international phone numbers &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">validate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Validate international phone number on input &quot;&quot;&quot;</span>
        <span class="n">allowed_characters</span> <span class="o">=</span> <span class="s">&quot;+- () / 0123456789&quot;</span>

        <span class="k">if</span> <span class="n">value</span> <span class="o">!=</span> <span class="bp">None</span><span class="p">:</span>

            <span class="n">value</span> <span class="o">=</span> <span class="n">value</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>

            <span class="k">if</span> <span class="n">value</span> <span class="o">==</span> <span class="s">&quot;&quot;</span><span class="p">:</span>
                <span class="c"># Assume empty string = no input</span>
                <span class="k">return</span>

            <span class="c"># The value is not required</span>
            <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">value</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">c</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">allowed_characters</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">zope</span><span class="o">.</span><span class="n">interface</span><span class="o">.</span><span class="n">Invalid</span><span class="p">(</span><span class="n">_</span><span class="p">(</span><span class="s">u&quot;Phone number contains bad characters&quot;</span><span class="p">))</span>

            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">7</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">zope</span><span class="o">.</span><span class="n">interface</span><span class="o">.</span><span class="n">Invalid</span><span class="p">(</span><span class="n">_</span><span class="p">(</span><span class="s">u&quot;Phone number is too short&quot;</span><span class="p">))</span>

<span class="c"># Set conditions for which fields the validator class applies</span>
<span class="n">validator</span><span class="o">.</span><span class="n">WidgetValidatorDiscriminators</span><span class="p">(</span><span class="n">PhoneNumberValidator</span><span class="p">,</span> <span class="n">field</span><span class="o">=</span><span class="n">IZohoContactForm</span><span class="p">[</span><span class="s">&#39;phone_number&#39;</span><span class="p">])</span>

<span class="c"># Register the validator so it will be looked up by z3c.form machinery</span>

<span class="n">zope</span><span class="o">.</span><span class="n">component</span><span class="o">.</span><span class="n">provideAdapter</span><span class="p">(</span><span class="n">PhoneNumberValidator</span><span class="p">)</span>
</pre></div>
</div>
<p>More info</p>
<ul class="simple">
<li><a class="reference external" href="http://plone.org/products/dexterity/documentation/manual/schema-driven-forms/customising-form-behaviour/validation">http://plone.org/products/dexterity/documentation/manual/schema-driven-forms/customising-form-behaviour/validation</a></li>
</ul>
</div>
<div class="section" id="customizing-and-translating-error-messages">
<h3><a class="toc-backref" href="#id57">Customizing and translating error messages</a><a class="headerlink" href="#customizing-and-translating-error-messages" title="Permalink to this headline">¶</a></h3>
<p>If you want to custom error messages on per field level:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">zope.schema._bootstrapinterfaces</span> <span class="kn">import</span> <span class="n">RequiredMissing</span>
<span class="n">RequiredMissingErrorMessage</span> <span class="o">=</span> <span class="n">error</span><span class="o">.</span><span class="n">ErrorViewMessage</span><span class="p">(</span><span class="n">_</span><span class="p">(</span><span class="s">u&#39;Required value is missing.&#39;</span><span class="p">),</span> <span class="n">error</span><span class="o">=</span><span class="n">RequiredMissing</span><span class="p">,</span> <span class="n">field</span><span class="o">=</span><span class="n">IEmailFormSchema</span><span class="p">[</span><span class="s">&#39;email&#39;</span><span class="p">])</span>
<span class="n">zope</span><span class="o">.</span><span class="n">component</span><span class="o">.</span><span class="n">provideAdapter</span><span class="p">(</span><span class="n">RequiredMissingErrorMessage</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s">&#39;message&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Leave <tt class="docutils literal"><span class="pre">field</span></tt> parameter away if you want the new error message apply to all fields.</p>
</div>
<div class="section" id="read-only-and-disabled-fields">
<h3><a class="toc-backref" href="#id58">Read-only and disabled fields</a><a class="headerlink" href="#read-only-and-disabled-fields" title="Permalink to this headline">¶</a></h3>
<p>Read-only fields are not rendered in form edit mode:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">courseModeAccordion</span> <span class="o">=</span> <span class="n">schema</span><span class="o">.</span><span class="n">TextLine</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s">u&quot;Courses by mode accordion&quot;</span><span class="p">,</span>
                                  <span class="n">default</span><span class="o">=</span><span class="s">u&quot;Automatically from database&quot;</span><span class="p">,</span>
                                  <span class="n">readonly</span><span class="o">=</span><span class="bp">True</span>
                                  <span class="p">)</span>
</pre></div>
</div>
<p>If widget mode is display then it is rendered, but user cannot edit (the output as in form view mode):</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">form</span><span class="o">.</span><span class="n">mode</span><span class="p">(</span><span class="n">courseModeAccordion</span><span class="o">=</span><span class="s">&quot;display&quot;</span><span class="p">)</span>
<span class="n">courseModeAccordion</span> <span class="o">=</span> <span class="n">schema</span><span class="o">.</span><span class="n">TextLine</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s">u&quot;Courses by mode accordion&quot;</span><span class="p">,</span>
                                  <span class="n">default</span><span class="o">=</span><span class="s">u&quot;Automatically from database&quot;</span><span class="p">,</span>
                                  <span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>

  </div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
<p class="logo"><a href="../index.html"><img src="../_static/plone-icon-64.png" />
</a></p>

  <h3><a href="../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">z3c.form</a><ul>
<li><a class="reference internal" href="#introduction">Introduction</a></li>
<li><a class="reference internal" href="#z3c-form-big-picture">z3c.form big picture</a></li>
<li><a class="reference internal" href="#form">Form</a><ul>
<li><a class="reference internal" href="#setting-form-status-message">Setting form status message</a></li>
<li><a class="reference internal" href="#emulating-form-http-post-in-unit-tests">Emulating form HTTP POST in unit tests</a></li>
<li><a class="reference internal" href="#customizing-form-template">Customizing form template</a></li>
<li><a class="reference internal" href="#customizing-form-frame">Customizing form frame</a></li>
</ul>
</li>
<li><a class="reference internal" href="#fields">Fields</a><ul>
<li><a class="reference internal" href="#creating-a-field">Creating a field</a></li>
<li><a class="reference internal" href="#adding-a-field-to-a-form">Adding a field to a form</a></li>
<li><a class="reference internal" href="#modifying-a-field">Modifying a field</a></li>
<li><a class="reference internal" href="#accesing-schema-of-the-field">Accesing schema of the field</a></li>
<li><a class="reference internal" href="#read-only-fields">Read-only fields</a></li>
<li><a class="reference internal" href="#dynamic-schemas">Dynamic schemas</a></li>
</ul>
</li>
<li><a class="reference internal" href="#widgets">Widgets</a><ul>
<li><a class="reference internal" href="#accessing-a-widget">Accessing a widget</a></li>
<li><a class="reference internal" href="#introspecting-form-widgets">Introspecting form widgets</a></li>
<li><a class="reference internal" href="#reordering-and-hiding-widgets">Reordering and hiding widgets</a></li>
<li><a class="reference internal" href="#modifying-a-widget">Modifying a widget</a></li>
<li><a class="reference internal" href="#reorder-form-widgets">Reorder form widgets</a><ul>
<li><a class="reference internal" href="#making-widgets-required-conditionally">Making widgets required conditionally</a></li>
</ul>
</li>
<li><a class="reference internal" href="#setting-widget-types">Setting widget types</a></li>
<li><a class="reference internal" href="#widget-save">Widget save</a></li>
<li><a class="reference internal" href="#widget-value">Widget value</a></li>
<li><a class="reference internal" href="#adding-a-css-class">Adding a CSS class</a></li>
<li><a class="reference internal" href="#id2">Accesing schema of the field</a></li>
<li><a class="reference internal" href="#getting-selection-widget-vocabulary-value-as-human-readable-text">Getting selection widget vocabulary value as human readable text</a></li>
<li><a class="reference internal" href="#setting-widget-templates">Setting widget templates</a></li>
</ul>
</li>
<li><a class="reference internal" href="#setting-the-template-of-an-individual-widget">Setting the template of an individual widget</a></li>
<li><a class="reference internal" href="#setting-template-for-your-own-widget-type">Setting template for your own widget type</a></li>
<li><a class="reference internal" href="#buttons">Buttons</a><ul>
<li><a class="reference internal" href="#adding-a-button-to-form">Adding a button to form</a></li>
<li><a class="reference internal" href="#manipulating-form-buttons-programmatically">Manipulating form buttons programmatically</a><ul>
<li><a class="reference internal" href="#reading-buttons">Reading buttons</a></li>
<li><a class="reference internal" href="#removing-or-hiding-buttons">Removing or hiding buttons</a></li>
<li><a class="reference internal" href="#adding-buttons-dynamically">Adding buttons dynamically</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#subforms">Subforms</a><ul>
<li><a class="reference internal" href="#adding-an-action-to-parent-and-subform">Adding an action to parent and subform</a></li>
</ul>
</li>
<li><a class="reference internal" href="#creating-subforms-run-time">Creating subforms run-time</a></li>
<li><a class="reference internal" href="#crud-form">CRUD form</a><ul>
<li><a class="reference internal" href="#examples">Examples</a></li>
</ul>
</li>
<li><a class="reference internal" href="#displaying-the-status-message-in-a-non-standard-location">Displaying the status message in a non-standard location</a></li>
<li><a class="reference internal" href="#storage-format-and-data-managers">Storage format and data managers</a><ul>
<li><a class="reference internal" href="#custom-content-objects">Custom content objects</a></li>
<li><a class="reference internal" href="#custom-change-applying">Custom change applying</a></li>
</ul>
</li>
<li><a class="reference internal" href="#wysiwyg-widgets">WYSIWYG widgets</a></li>
<li><a class="reference internal" href="#wrapped-and-non-wrapped-forms">Wrapped and non-wrapped forms</a></li>
<li><a class="reference internal" href="#embedding-z3c-form-forms-in-portlets-viewlets-and-views">Embedding z3c.form forms in portlets, viewlets and views</a><ul>
<li><a class="reference internal" href="#further-reading">Further reading</a></li>
<li><a class="reference internal" href="#adding-validators">Adding validators</a></li>
<li><a class="reference internal" href="#customizing-and-translating-error-messages">Customizing and translating error messages</a></li>
<li><a class="reference internal" href="#read-only-and-disabled-fields">Read-only and disabled fields</a></li>
</ul>
</li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="manual.html"
                        title="previous chapter">Manual form processing</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="files.html"
                        title="next chapter">Files</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="../_sources/forms/z3c.form.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" size="18" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="files.html" title="Files"
             >next</a> |</li>
        <li class="right" >
          <a href="manual.html" title="Manual form processing"
             >previous</a> |</li>
        <li><a href="../index.html">Plone Community Managed Developer Manual v1.0 documentation</a> &raquo;</li>
          <li><a href="index.html" >Forms, fields and widgets</a> &raquo;</li> 
      </ul>
    </div>

    <div class="footer">
        &copy; Copyright 2010 mFabrik Research Oy and Plone community contributors.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.0.4.
    </div>


  </body>
</html>